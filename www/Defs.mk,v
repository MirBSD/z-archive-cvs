head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2019.12.29.23.02.03;	author tg;	state Exp;
branches;
next	;
commitid	1005E09307D70DD0C6C;


desc
@@


1.1
log
@refactor, Defs.mk will be needed elsewhere
@
text
@# $MirOS: www/Makefile,v 1.123 2019/07/27 00:06:05 tg Exp $
#-
# This file is part of the MirBSD website; see LICENCE for details.

TOP?=		${BSDSRCDIR}/www
_xhtmldtd=	${TOP}/files/xhtml11.dtd
_xhtmlbeg=	<?xml version="1.0"?> \
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" \
		 "file://${_xhtmldtd}"> \
		<html
_xhtmlpag=	${_xhtmlbeg} xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> \
		<head> \
		 <title>XHTML page</title> \
		</head><body>
_xhtmlend=	</body></html>

_htm_2xhtml=	(tr '\n' '﷐' | \
		sed 's^.*<html'${_xhtmlbeg:Q}'' | \
		tr '﷐' '\n')

_inc2xhtml=	( (print '\n----'; sed -e '/^\#/d' -e '/^RCSID: \$$/d') | \
		    tr '\n' '' | sed \
		    -e 'sg' \
		    -e 's----g' \
		    -e 's\([^]*\)\1g' \
		    -e 's\([^]*\)\1g' \
		    -e 's\([^]*\)*[Tt][Ii][Tt][Ll][Ee]:[	 ]*\([^]*\)\([^]*\)\{0,1\}</div><h2><a href="/">\2</a></h2><div>g' \
		    -e 's[^]*</div><div>g' \
		    -e 's^</div>'${_xhtmlpag:Q}'' \
		    -e 's$$</div>'${_xhtmlend:Q}'' \
		    -e 's<><error><>g' \
		    -e 'sg' \
		    | \
		tr '' '\n')
@
