head	1.29;
access;
symbols;
locks; strict;
comment	@# @;


1.29
date	2019.06.08.17.17.46;	author tg;	state Exp;
branches;
next	1.28;
commitid	1005CFBEDAB5D84AFDF;

1.28
date	2018.08.29.02.13.26;	author tg;	state Exp;
branches;
next	1.27;
commitid	1005B8601524E6F1A70;

1.27
date	2018.08.29.01.19.11;	author tg;	state Exp;
branches;
next	1.26;
commitid	1005B85F4A156426139;

1.26
date	2018.08.29.00.48.46;	author tg;	state Exp;
branches;
next	1.25;
commitid	1005B85ED7E6CD71226;

1.25
date	2018.07.15.19.52.21;	author tg;	state Exp;
branches;
next	1.24;
commitid	1005B4BA5FE2D280B25;

1.24
date	2018.07.15.19.47.45;	author tg;	state Exp;
branches;
next	1.23;
commitid	1005B4BA4B16421EB97;

1.23
date	2017.12.19.00.56.34;	author tg;	state Exp;
branches;
next	1.22;
commitid	1005A38636B714CDF30;

1.22
date	2016.11.19.17.57.59;	author tg;	state Exp;
branches;
next	1.21;
commitid	1005830925C030FAED1;

1.21
date	2016.10.04.19.22.11;	author tg;	state Exp;
branches;
next	1.20;
commitid	10057F401692BF44CAB;

1.20
date	2015.11.13.17.45.17;	author tg;	state Exp;
branches;
next	1.19;
commitid	100564621B370C943EB;

1.19
date	2015.10.16.21.50.03;	author tg;	state Exp;
branches;
next	1.18;
commitid	100562171242404239D;

1.18
date	2015.10.16.18.15.46;	author tg;	state Exp;
branches;
next	1.17;
commitid	10056213EEB238ED74D;

1.17
date	2015.08.13.22.02.24;	author tg;	state Exp;
branches;
next	1.16;
commitid	10055CD14084AEA0364;

1.16
date	2014.11.11.01.46.51;	author tg;	state Exp;
branches;
next	1.15;
commitid	10054616A9F5FC69400;

1.15
date	2014.11.10.22.11.14;	author tg;	state Exp;
branches;
next	1.14;
commitid	1005461355E6C10075C;

1.14
date	2014.11.10.16.18.07;	author tg;	state Exp;
branches;
next	1.13;
commitid	1005460E5160894EF06;

1.13
date	2014.09.08.15.45.25;	author tg;	state Exp;
branches;
next	1.12;
commitid	100540DCF27664458EF;

1.12
date	2014.08.27.20.05.52;	author tg;	state Exp;
branches;
next	1.11;
commitid	10053FE39EF61D32DB7;

1.11
date	2014.08.18.22.23.40;	author tg;	state Exp;
branches;
next	1.10;
commitid	10053F27CDB15F1E881;

1.10
date	2014.07.25.22.01.51;	author tg;	state Exp;
branches;
next	1.9;
commitid	10053D2D3DD56581E50;

1.9
date	2014.07.18.22.55.51;	author tg;	state Exp;
branches;
next	1.8;
commitid	10053C9A5A435EB242C;

1.8
date	2014.07.15.22.14.34;	author tg;	state Exp;
branches;
next	1.7;
commitid	10053C5A7DD5CE6696E;

1.7
date	2014.07.15.20.52.09;	author tg;	state Exp;
branches;
next	1.6;
commitid	10053C59488096050AA;

1.6
date	2014.07.11.18.41.09;	author tg;	state Exp;
branches;
next	1.5;
commitid	10053C02FCD10052798;

1.5
date	2014.07.06.17.08.41;	author tg;	state Exp;
branches;
next	1.4;
commitid	10053B982B169DF0D74;

1.4
date	2013.10.20.19.09.21;	author tg;	state Exp;
branches;
next	1.3;
commitid	10052642A7879AC2732;

1.3
date	2013.06.23.20.02.48;	author tg;	state Exp;
branches;
next	1.2;
commitid	10051C7546600DA0332;

1.2
date	2013.06.23.16.17.09;	author tg;	state Exp;
branches;
next	1.1;
commitid	10051C71F9C76C386ED;

1.1
date	2013.06.22.23.26.03;	author tg;	state Exp;
branches;
next	;
commitid	10051C632026F4F6AC1;


desc
@@


1.29
log
@let explwp() also return the waypoint code, normalised
(e.g. fixup trailing / in Munzee, BC/EC leading zeroes
as well as xkcd Geohashing coordinate leading zeroes);
let it untaint in Perl
@
text
@#!/usr/bin/perl -T
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.27 2018/08/29 01:19:11 tg Exp $';
#-
# Copyright © 2013, 2014, 2015, 2016, 2018
#	mirabilos <m@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un‐
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided “AS IS” and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person’s immediate fault when using the work as intended.

use strict;
use warnings;

# magic to allow including relative to dirname($0)
use FindBin qw/$Bin/;
BEGIN {
	if ($Bin =~ m!([\w\./]+)!) {
		$Bin = $1;
	} else {
		die "Bad directory $Bin\n";
	}
}
use lib $Bin;
# include wp.pm, hopefully from dirname($0)
use wp;

my $output = "";
my $query = "";
my $found = 0;

if (defined($ENV{QUERY_STRING})) {
	for my $p (split(/[;&]+/, $ENV{QUERY_STRING})) {
		next unless $p;
		$p =~ y/+/ /;
		my ($key, $val) = split(/=/, $p, 2);
		next unless defined($key);

		next unless ($key eq "q");
		next unless defined($val);
		$val =~ s/%([0-9A-Fa-f][0-9A-Fa-f])/chr(hex($1))/eg;
		next if $val =~ /[\t\r\n]/;
		$query = $val;
	}
	if ($query eq "") {
		my $p = $ENV{QUERY_STRING};
		$p =~ y/+/ /;
		$p =~ s/%([0-9A-Fa-f][0-9A-Fa-f])/chr(hex($1))/eg;
		next if $p =~ /[\t\r\n]/;
		$query = $p;
	}
}

# ltrim and rtrim
$query =~ s/^\s+//;
$query =~ s/\s+$//;

# handle early, before uppercasing
if ($query =~ m!^(m/[0-9A-Za-z_-]+/[0-9]+)/?$!) {
	&redirect("https://www.munzee.com/$1/");
}

# early drop invalid requests
$query = "" unless $query =~ /^[0-9A-Za-z_-]*$/;
# uppercase, nice to the user
$query =~ y/a-z/A-Z/;
# revert special string
$query =~ s/_GLOBAL/_global/g;

# local substitution helper
sub chkwp($) {
	my ($q) = @@_;
	my ($code, $wp, $label, $url) = explwp($q);

	return ($query = $url);
}

if ($query ne "") {
	substwps($query);
	$found = 1 if $query =~ /http/;
}

$query = "http://www.mirbsd.org/wp.htm" unless $found;
&redirect($query);
@


1.28
log
@add www/mk/wp.inc to clone-ish www/files/wp.pm
@
text
@d83 1
a83 1
	my ($code, $label, $url) = explwp($q);
@


1.27
log
@share into a module and carry the test vectors
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.26 2018/08/29 00:48:46 tg Exp $';
d69 1
a69 1
if ($query =~ m!^(m/[0-9A-Za-z_-]*/[0-9]+)/?$!) {
@


1.26
log
@switch Perl code for waypoint resolving to generic-shared functions
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.24 2018/07/15 19:47:45 tg Exp $';
d25 8
a32 97
# generic HTML encode (&<>" but not ')
sub htmlencode($) {
	local ($_) = @@_;

	s/&/&amp;/g;
	s/</&lt;/g;
	s/>/&gt;/g;
	s/\"/&#34;/g;

	return $_;
}

# generic HTML and HTTP redirect
sub redirect($) {
	my ($dst) = @@_;
	my $enc = htmlencode($dst);

	print("Status: 301\r\nLocation: $dst\r\n");
	print("Content-Type: text/html; charset=UTF-8\r\n\r\n");
	print("<html><head><title>Redirection</title></head><body>\n");
	print("<h1>Redirection</h1>\n");
	print("<p>Please visit <a href=\"$enc\">$enc</a> instead!</p>\n");
	print("</body></html>\n");
	exit(0);
}

# generic Y-M-D date validity checker
sub chkdate($$$) {
	my ($y, $m, $d) = @@_;
	my @@mdays = (0,31,28,31,30,31,30,31,31,30,31,30,31);

	$mdays[2] = (($y % 4) == 0 && (($y % 100) != 0 || ($y % 400) == 0)) ?
	    29 : 28 if ($m == 2);

	return !($y < 1 || $y > 9999 || $m < 1 || $m > 12 || $d < 1 ||
	    $d > $mdays[$m]);
}

# see MirCVS revision log for test vectors
# generic waypoint code exploder (classifyer, label, URL)
sub explwp($) {
	my ($wp) = @@_;
	return ("BC", "BesserCacher#$1", "https://bessercacher.de/forum/viewtopic.php?t=$1") if
	    ($wp =~ m!^BC(\d+)$!);
	return ("EC", "$wp", "http://extremcaching.com/index.php/output-2/$1") if
	    ($wp =~ m!^EC([0-9A-Z]{1,6})$!);
	return ("GA", "$wp", "https://geocaching.com.au/cache/$wp") if
	    ($wp =~ m!^GA[0-9A-Z]{1,6}$!);
	return ("GC", "$wp", "https://www.geocaching.com/seek/cache_details.aspx?wp=$wp") if
	    ($wp =~ m!^GC[0-9A-Z]{1,6}$!);
	return ("GD", "$wp", "http://geodashing.gpsgames.org/cgi-bin/dp.pl?dp=$wp") if
	    ($wp =~ m!^GD[0-9A-Z]{2}-[A-Z]{4}$!);
	return ("GE", "$wp", "http://geocaching.gpsgames.org/cgi-bin/ge.pl?wp=$wp") if
	    ($wp =~ m!^GE[0-9A-Z]{1,6}$!);
	return ("GG", "$wp", "http://golf.gpsgames.org/cgi-bin/golf.pl?course=$wp&coursedetails=Go") if
	    ($wp =~ m!^GG[0-9A-Z]{1,6}$!);
	return ("GK", "$wp", "https://geokrety.org/konkret.php?id=" . hex($1)) if
	    ($wp =~ m!^GK([0-9A-F]+)$!);
	return ("GL", "$wp", "http://coord.info/$wp") if
	    ($wp =~ m!^GL[0-9A-Z]{1,6}$!);
	return ("NC", "$wp", "http://www.navicache.com/cgi-bin/db/displaycache2.pl?CacheID=" . hex($1)) if
	    ($wp =~ m!^N([0-9][0-9A-F]{4})$!);
	return ("OB", "$wp", "https://www.opencaching.nl/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OB[0-9A-Z]{1,6}$!);
	return ("OC", "$wp", "https://www.opencaching.de/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OC[0-9A-Z]{1,6}$!);
	return ("OK", "$wp", "https://opencache.uk/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OK[0-9A-Z]{1,6}$!);
	return ("OP", "$wp", "https://opencaching.pl/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OP[0-9A-Z]{1,6}$!);
	return ("OR", "$wp", "https://www.opencaching.ro/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OR[0-9A-Z]{1,6}$!);
	return ("OU", "$wp", "http://www.opencaching.us/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OU[0-9A-Z]{1,6}$!);
	return ("OZ", "$wp", "https://opencaching.cz/viewcache.php?wp=$wp") if
	    ($wp =~ m!^OZ[0-9A-Z]{1,6}$!);
	return ("PR", "$wp", "http://coord.info/$wp") if
	    ($wp =~ m!^PR[0-9A-Z]{1,6}$!);
	return ("SH", "$wp", "http://shutterspot.gpsgames.org/cgi-bin/sh.pl?wp=$wp") if
	    ($wp =~ m!^SH[0-9A-Z]{1,6}$!);
	return ("TB", "$wp", "https://www.geocaching.com/track/details.aspx?tracker=$wp") if
	    ($wp =~ m!^TB[0-9A-Z]{1,6}$!);
	return ("TC", "$wp", "https://play.terracaching.com/Cache/$wp") if
	    ($wp =~ m!^[TLC]C[0-9A-Z]{1,6}$!);
	return ("VX", "$wp", "http://geovexilla.gpsgames.org/cgi-bin/vx.pl?listwaypointlogs=yes&wp=$wp") if
	    ($wp =~ m!^VX[0-9A-Z]{2}-[A-Z]{4}$!);
	return ("WM", "$wp", "http://www.waymarking.com/waymarks/$wp") if
	    ($wp =~ m!^WM[0-9A-Z]{1,6}$!);
	return ("m/", "$1", "https://www.munzee.com/$1/") if
	    ($wp =~ m!^(m/[0-9A-Za-z_-]*/[0-9]+)/?$!);
	return ("gh", "$wp", "http://wiki.xkcd.com/geohashing/$wp") if
	    ($wp =~ m!^(2[0-9]{3})-(0[1-9]|1[0-2])-([0-2][1-9]|[1-3][01])_(-?[0-9]{1,2})_(-?[0-9]{1,3})$! &&
	    chkdate($1, $2, $3) && $4 >= -90 && $4 <= 90 && $5 >= -180 && $5 <= 180);
	return ("Gh", "$wp", "http://wiki.xkcd.com/geohashing/$wp") if
	    ($wp =~ m!^(2[0-9]{3})-(0[1-9]|1[0-2])-([0-2][1-9]|[1-3][01])_global$! &&
	    chkdate($1, $2, $3));
	return ("", "$wp", "");
d34 3
d85 1
a85 1
	return $url;
d89 1
a89 1
	$query =~ s@@\b((?:[BETLC]C|G[ACEGKL]|O[BCKPRUXZ]|PR|SH|TB|WM|N[0-9])[0-9A-Z]{1,6}|(?:GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-[0-9]{2}-[0-9]{2}_(?:-?[0-9]{1,2}_-?[0-9]{1,3}|global))\b@@($query = chkwp($1));@@eg;
@


1.25
log
@add some types of hitchhikers (GeoKrety and TravelBug®)
@
text
@d25 1
d37 1
d43 1
a43 1
	print("Content-type: text/html\r\n\r\n");
d51 73
d154 1
d159 1
d161 1
d163 10
d175 1
a175 38
	## test vectors:
	# GC4M90G BC2036 (Beach TB Hotel GBH)
	# EC988 (Programmieren für Geocacher)
	# GA12512 (Only a Picnic Away)
	# GDCI-JUNU; GGACUO(Bergen Center)
	# GE0300 N02F79 OC11141 TC1OYX (August-Eis MMXIV)
	# GL12VZCR; PR2950G(Hasenbärenbande)
	# OB1A74 (3 Landen punt); OK00CA (House of Correction)
	# OP8U1S (Kalkberg); OR01E2 (Vrăbiile)
	# OU0B34 (Above Or Below?); OZ0277 (nic)
	# SH02BF; LC7TL; CCHU; VX76-DIKA; WM5CZY; 2014-10-28_50_7

	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGKL]|O[BCKPRUXZ]|PR|SH|TB|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_(-?[0-9]{1,2}_-?[0-9]{1,3}|GLOBAL)|BC\d+)\b@@
					($query = $1) =~ /^GC/ ? "https://www.geocaching.com/seek/cache_details.aspx?wp=$query" :
					$query =~ /^BC/ ? sprintf("https://bessercacher.de/forum/viewtopic.php?t=%s", substr($query, 2)) :
					$query =~ /^EC/ ? sprintf("http://extremcaching.com/index.php/output-2/%s", substr($query, 2)) :
					$query =~ /^GA/ ? "https://geocaching.com.au/cache/$query" :
					$query =~ /^GD/ ? "http://geodashing.gpsgames.org/cgi-bin/dp.pl?dp=$query" :
					$query =~ /^GE/ ? "http://geocaching.gpsgames.org/cgi-bin/ge.pl?wp=$query" :
					$query =~ /^GG/ ? "http://golf.gpsgames.org/cgi-bin/golf.pl?course=$query&coursedetails=Go" :
					$query =~ /^GK/ ? sprintf("https://geokrety.org/konkret.php?id=%d", hex(substr($query, 2))) :
					$query =~ /^(GL|PR)/ ? "http://coord.info/$query" :
					$query =~ /^N[0-9]/ ? sprintf("http://www.navicache.com/cgi-bin/db/displaycache2.pl?CacheID=%d", hex(substr($query, 1))) :
					$query =~ /^OB/ ? "https://www.opencaching.nl/viewcache.php?wp=$query" :
					$query =~ /^OC/ ? "https://www.opencaching.de/viewcache.php?wp=$query" :
					$query =~ /^OK/ ? "https://opencache.uk/viewcache.php?wp=$query" :
					$query =~ /^OP/ ? "https://opencaching.pl/viewcache.php?wp=$query" :
					$query =~ /^OR/ ? "https://www.opencaching.ro/viewcache.php?wp=$query" :
					$query =~ /^OU/ ? "http://www.opencaching.us/viewcache.php?wp=$query" :
					$query =~ /^OZ/ ? "https://opencaching.cz/viewcache.php?wp=$query" :
					$query =~ /^SH/ ? "http://shutterspot.gpsgames.org/cgi-bin/sh.pl?wp=$query" :
					$query =~ /^TB/ ? "https://www.geocaching.com/track/details.aspx?tracker=$query" :
					$query =~ /^[TLC]C/ ? "https://play.terracaching.com/Cache/$query" :
					$query =~ /^VX/ ? "http://geovexilla.gpsgames.org/cgi-bin/vx.pl?listwaypointlogs=yes&wp=$query" :
					$query =~ /^WM/ ? "http://www.waymarking.com/waymarks/$query" :
					$query =~ /^2/ ? "http://wiki.xkcd.com/geohashing/$query" :
					"";
				@@eg;
@


1.24
log
@update website URLs; also:
• add OR: OC Romania
• drop OS: OC Sweden (SE/NO), apparently shit down in 2014
  after failed merger plans with OC.DE (redirects to OC.DE
  now, old waypoints don’t work tho)
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.22 2016/11/19 17:57:59 tg Exp $';
d99 1
a99 1
	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPRUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_(-?[0-9]{1,2}_-?[0-9]{1,3}|GLOBAL)|BC\d+)\b@@
d107 1
d118 1
@


1.23
log
@https → http, nowadays (unwillingly) considered proper
@
text
@d4 1
a4 1
# Copyright © 2013, 2014, 2015, 2016
d87 15
a101 3
	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_(-?[0-9]{1,2}_-?[0-9]{1,3}|GLOBAL)|BC\d+)\b@@
					($query = $1) =~ /^GC/ ? "http://www.geocaching.com/seek/cache_details.aspx?wp=$query" :
					$query =~ /^BC/ ? sprintf("http://www.bessercacher.de/Forum/phpBB3/viewtopic.php?t=%s", substr($query, 2)) :
d103 1
a103 1
					$query =~ /^GA/ ? "http://geocaching.com.au/cache/$query" :
d109 2
a110 2
					$query =~ /^OB/ ? "http://www.opencaching.nl/viewcache.php?wp=$query" :
					$query =~ /^OC/ ? "http://www.opencaching.de/viewcache.php?wp=$query" :
d112 2
a113 2
					$query =~ /^OP/ ? "http://www.opencaching.pl/viewcache.php?wp=$query" :
					$query =~ /^OS/ ? "http://www.opencaching.se/viewcache.php?wp=$query" :
d115 1
a115 1
					$query =~ /^OZ/ ? "http://www.opencaching.cz/viewcache.php?wp=$query" :
d117 1
a117 1
					$query =~ /^[TLC]C/ ? "http://play.terracaching.com/Cache/$query" :
@


1.22
log
@Island Apes (OKUK) is now being disputed; link to the new site (with
top-of-the-line OC.PL source code) under its new domain now, as that
works, while the old site (with code specifically demanded by UK law
but using older OC codebase) 500s out on caches and is “being trans‐
ferred” (wtf‽) — IMHO they just should merge with OC.DE like .ES did
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.21 2016/10/04 19:22:11 tg Exp $';
d114 1
a114 1
$query = "https://www.mirbsd.org/wp.htm" unless $found;
@


1.21
log
@+
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.19 2015/10/16 21:50:03 tg Exp $';
d99 1
a99 1
					$query =~ /^OK/ ? "http://www.opencaching.org.uk/viewcache.php?wp=$query" :
@


1.20
log
@Munzee is just getting ridiculous, remove it entirely
@
text
@d4 2
a5 2
# Copyright © 2013, 2014, 2015
#	mirabilos <tg@@mirbsd.org>
d79 4
d87 1
a87 1
	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_(-?[0-9]{1,2}_-?[0-9]{1,3}|GLOBAL))\b@@
d89 1
@


1.19
log
@OX is finally dead \o/
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.18 2015/10/16 18:15:46 tg Exp $';
a78 4
if ($query =~ m!^(m/[0-9A-Za-z_-]*/[0-9]+)/?$!) {
	&redirect("https://www.munzee.com/$1/");
}

@


1.18
log
@TC changed URLs ☹
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.17 2015/08/13 22:02:24 tg Exp $';
a102 1
					$query =~ /^OX/ ? "http://www.opencaching.com/#!geocache/$query" :
@


1.17
log
@Munzee switch to https
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.15 2014/11/10 22:11:14 tg Exp $';
d105 1
a105 1
					$query =~ /^[TLC]C/ ? "http://www.terracaching.com/Cache/$query" :
@


1.16
log
@oops, uppercase here
@
text
@d4 2
a5 2
# Copyright © 2013, 2014
#	Thorsten Glaser <tg@@mirbsd.org>
d80 1
a80 1
	&redirect("http://www.munzee.com/$1/");
@


1.15
log
@• new: validation for files/*.htm (static content)
• several more acronyms from the weekend (Nik, Niklas Bildhauer) and cached
• float-left w/o box CSS class
• add support for xkcd Globalhash, from MirKarte
• link new (unfinished) MirKarte GPX download CGI
• fix BesserCacher stats pasto
• unify style for GD/VX/GeoHashing “cache name”s
• add finds and prospectives
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.14 2014/11/10 16:18:07 tg Exp $';
d87 1
a87 1
	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_(-?[0-9]{1,2}_-?[0-9]{1,3}|global))\b@@
@


1.14
log
@latitude has only 2 digits; use perlre separator more easily digestable by jsf
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.13 2014/09/08 15:45:25 tg Exp $';
d87 1
a87 1
	$query =~		s@@\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_-?[0-9]{1,2}_-?[0-9]{1,3})\b@@
@


1.13
log
@fix GeoVexilia links
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.12 2014/08/27 20:05:52 tg Exp $';
d87 1
a87 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[0-9A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_-?[0-9]{1,3}_-?[0-9]{1,3})\b`
d110 1
a110 1
				`eg;
@


1.12
log
@• more acronyms
• TNF sync
• allow links to GL (GS log) and PR (GS profile)
• ’nother Find
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.11 2014/08/18 22:23:40 tg Exp $';
d87 1
a87 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACEGL]|O[BCKPSUXZ]|PR|SH|[TLC]C|WM)[0-9A-Z]{1,6}|(GD|VX)[A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_-?[0-9]{1,3}_-?[0-9]{1,3})\b`
@


1.11
log
@add support for Geo Hashing – http://wiki.xkcd.com/geohashing/ – and
count Wherigo Cartridges (separately) and Waymarks (for Groundspeak)
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.10 2014/07/25 22:01:51 tg Exp $';
d87 1
a87 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACEG]|O[BCKPSUXZ]|SH|[TLC]C|WM)[0-9A-Z]{1,5}|(GD|VX)[A-Z]{2}-[A-Z]{4}|2[0-9]{3}-(0[1-9]|1[0-2])-[0-3][0-9]_-?[0-9]{1,3}_-?[0-9]{1,3})\b`
d94 1
@


1.10
log
@send HTML bodies when HTTP redirecting, as per RFC
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.9 2014/07/18 22:55:51 tg Exp $';
d83 1
a83 1
$query = "" unless $query =~ /^[0-9A-Za-z-]*$/;
d87 1
a87 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACEG]|O[BCKPSUXZ]|SH|[TLC]C|WM)[0-9A-Z]{1,5}|(GD|VX)[A-Z]{2}-[A-Z]{4})\b`
d107 1
@


1.9
log
@apparently, Terracaching…
• upgraded from TC1 to TC3…
• which broke permalinks to caches…
• with an ASP.NET error page…
• and is utterly slow…
• to add insult to injury, 200+ px too wide for my laptop monitor…
• even too wide for my desktop monitor at work (widest I have)…
• and renamed some LCxxx caches to CCxxx for whatever reason I have yet to discover…
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.8 2014/07/15 22:14:34 tg Exp $';
d25 24
d80 1
a80 3
	$query = "http://www.munzee.com/$1/";
	print("Status: 301\r\nLocation: $query\r\n\r\nRedirect: $query\r\n");
	exit(0);
d113 1
a113 3

print("Status: 301\r\nLocation: $query\r\n\r\nRedirect: $query\r\n");
exit(0);
@


1.8
log
@add GeoVexilla and Geodashing Golf (both gpsgames)
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.6 2014/07/11 18:41:09 tg Exp $';
d65 1
a65 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACEG]|O[BCKPSUXZ]|SH|[TL]C|WM)[0-9A-Z]{1,5}|(GD|VX)[A-Z]{2}-[A-Z]{4})\b`
d82 1
a82 1
					$query =~ /^[TL]C/ ? "http://www.terracaching.com/viewcache.cgi?ID=$query" :
@


1.7
log
@some updates; also trim() $query in the CGIs
@
text
@d65 1
a65 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(EC|G[ACE]|O[BCKPSUXZ]|SH|[TL]C|WM)[0-9A-Z]{1,5}|GD[A-Z]{2}-[A-Z]{4})\b`
d71 1
d83 1
@


1.6
log
@Extremcaching und andere Annehmlichkeiten
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.5 2014/07/06 17:08:41 tg Exp $';
d51 5
a55 1
if ($query =~ m!\b(m/[0-9A-Za-z_-]*/[0-9]+)/?\b!) {
@


1.5
log
@broaden my horizon
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.4 2013/10/20 19:09:21 tg Exp $';
d61 1
a61 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(G[ACE]|O[BCKPSUXZ]|SH|[TL]C|WM)[0-9A-Z]{1,5}|GD[A-Z]{2}-[A-Z]{4})\b`
d63 1
@


1.4
log
@unbreak GA/GD/SH in wp.cgi
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.3 2013/06/23 20:02:48 tg Exp $';
d4 1
a4 1
# Copyright © 2013
d51 6
d61 1
a61 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(G[ACE]|O[BCKPSUXZ]|SH|[TL]C)[0-9A-Z]{1,5}|GD[A-Z]{2}-[A-Z]{4})\b`
d77 1
@


1.3
log
@… at least I found *one* cache out of two, today…

Also, add a PocketIE optimised version for waypoint lookup
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.2 2013/06/23 16:17:09 tg Exp $';
d51 1
a51 1
$query = "" unless $query =~ /^[0-9A-Za-z]*$/;
d55 1
a55 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(GC|O[BCKPSUXZ]|[TL]C)[0-9A-Z]{1,5})\b`
d58 1
@


1.2
log
@fix buglets
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wp.cgi,v 1.1 2013/06/22 23:26:03 tg Exp $';
d75 1
a75 1
$query = "https://www.mirbsd.org/WPtg.htm#lookup" unless $found;
@


1.1
log
@• I was a bit frustrated by not finding a few Mystery caches but
  don’t know whether to log DNF (I do log DNF, but some are vague),
  and by lack of Geochecker for several puzzles I did, so I decided
  that a cache a day *still* keeps the Doctor away (unless the Doctor
  is called benz) and do some Virtual caches
• Also, unconfuse ABSPATH vs. RELPATH use: standardise on using
  RELPATH for anything we install and ABSPATH for anything we don’t;
  for cvs.cgi, it sure depends on something we don’t install (a local
  copy of the repo), but I guess that can be solved per-installation
• And – because I’m so nice *cough* need it – add jump-to-cache CGI
  (its HTML form only linked from my page, for now)
@
text
@d2 1
a2 1
my $rcsid = '$MirOS: www/files/wtf.cgi,v 1.8 2012/08/18 04:48:47 tg Exp $';
d55 1
a55 1
	$query =~		s`\b(N[0-9][0-9A-F]{4}|(GC|O[BCKPSUXZ]|[TL]C)[0-9A-Z]{4,5})\b`
@

