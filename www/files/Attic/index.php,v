head	1.13;
access;
symbols;
locks; strict;
comment	@# @;


1.13
date	2008.09.17.21.12.20;	author tg;	state dead;
branches;
next	1.12;
commitid	10048D172B4707A4228;

1.12
date	2008.07.10.22.12.46;	author tg;	state Exp;
branches;
next	1.11;
commitid	100487689234766DF9C;

1.11
date	2008.05.17.20.56.10;	author tg;	state Exp;
branches;
next	1.10;
commitid	100482F46267D1B170E;

1.10
date	2008.05.03.02.26.29;	author tg;	state Exp;
branches;
next	1.9;
commitid	100481BCD685AE36433;

1.9
date	2008.05.03.02.20.26;	author tg;	state Exp;
branches;
next	1.8;
commitid	100481BCBF75EAB5385;

1.8
date	2008.05.03.02.11.16;	author tg;	state Exp;
branches;
next	1.7;
commitid	100481BC9D74F3DB19B;

1.7
date	2008.05.03.02.05.26;	author tg;	state Exp;
branches;
next	1.6;
commitid	100481BC87907AE9221;

1.6
date	2008.05.03.01.47.26;	author tg;	state Exp;
branches;
next	1.5;
commitid	100481BC43866EDC1E7;

1.5
date	2008.05.03.01.44.05;	author tg;	state Exp;
branches;
next	1.4;
commitid	100481BC370715FF7E0;

1.4
date	2008.05.03.01.41.45;	author tg;	state Exp;
branches;
next	1.3;
commitid	100481BC2EC49741D8C;

1.3
date	2007.12.28.17.52.12;	author bsiegert;	state Exp;
branches;
next	1.2;
commitid	100477537E400031215;

1.2
date	2007.10.02.18.55.00;	author tg;	state Exp;
branches;
next	1.1;
commitid	10047029416501385E1;

1.1
date	2007.06.09.23.29.51;	author tg;	state Exp;
branches;
next	;
commitid	100466B37F0373CAEA0;


desc
@@


1.13
log
@retire PHP
@
text
@<?php
/* $MirOS: www/files/index.php,v 1.12 2008/07/10 22:12:46 tg Exp $ */
/*-
 * The MirOS Project - Webpages
 * Copyrighted material; read LICENCE for terms of use.
 */

/*
 * base64 encoding, file system safe
 * used for locating of arguments
 */
function mybase64($arg)
{
	$tmp1 = base64_encode($arg);
	$balt = array("+", "=", "/");
	$bneu = array(".", "_", "-");
	$tmp2 = str_replace($balt, $bneu, $tmp1);
	return $tmp2;
}

/*
 * From the PHP Website:
 * Parse include statement but return its output
 * instead of sending it to the client (false on error)
 */
function get_include_contents($filename) {
	if (is_file($filename)) {
		ob_start();
		include $filename;
		$contents = ob_get_contents();
		ob_end_clean();
		return $contents;
	}
	return false;
}

	if (!empty($_SERVER["QUERY_STRING"])) {
		$qs = $_SERVER["QUERY_STRING"];
		$rq = urldecode($qs);
		$qs = "?".$qs;
	} else {
		$rq = "main";
		$qs = "";
	}
	/* --- begin www3 hooks --- */
	$i = 0;
	$flag = false;	/* don't accept zero-length strings */
	while ($i < strlen($rq)) {
		$c = ord($rq[$i]);
		$i++;
		if (($c == 0x2D) || ($c == 0x5F) ||
		    (($c >= 0x30) && ($c <= 0x39)) ||
		    (($c >= 0x41) && ($c <= 0x5A)) ||
		    (($c >= 0x61) && ($c <= 0x7A))) {
			$flag = true;
			continue;
		}
		$flag = false;
		break;
	}
	if (!$flag) {
		$rq = "content/".mybase64($rq).".inc";
		if (!is_readable($rq)) {
			$flag = true;
			$rq = "main";
		}
	}
	if ($flag) {
		if (!empty($_SERVER["HTTPS"]))
			$svr = "https";
		else
			$svr = "http";
		$svr .= "://" . $_SERVER['HTTP_HOST'];
		$fn = $svr . "/main.htm";
		if (is_readable($rq . ".htm"))
			$fn = $svr . "/" . $rq . ".htm";
		else {
			$rq = "content/".mybase64($rq).".inc";
			if (is_readable($rq))
				$fn = false;
		}
		if ($fn !== false) {
			header("Status: 301 Moved Permanently", true, 301);
			header("Location: " . $fn, true);
			echo "Please go to " . $fn . " instead!";
			exit;
		}
	}
	/* --- end www3 hooks --- */

 // Send HTTP headers our way
 header("Content-type: text/html; charset=utf-8");

 // Send HTML headers our way
 echo "<?xml version=\"1.0\"?>\r\n";
?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <meta name="MSSmartTagsPreventParsing" content="TRUE" />
 <link rel="stylesheet" type="text/css" href="vstyle.css" />
 <meta name="author" content="Thorsten Glaser" />
 <meta name="copyright" content="All rights reserved. Redistribution except for scientific and educational uses strictly prohibited." />
 <meta name="owner" content="The MirOS Project and The MirPorts Framework" />
 <meta name="licence" content="see the source files in CVSWEB for details" />
 <!-- $MirOS: www/files/index.php,v 1.12 2008/07/10 22:12:46 tg Exp $ -->
 <title>MirOS/MirPorts: a wonderful operating system for a world of peace</title>
 <meta name="robots" content="index, follow" />
 <!--
	This is copyrighted material. For the full licence text, see the file
	LICENCE in the current directory. In no event may text from this page
	be simply copied into another work covered by an unfree (or otherwise
	mismatching) licence, such as the GNU Free Documentation License.
 -->
</head><body>
<div class="index">
 <ul class="lv1">
  <li><a href="/main.htm">Main</a><ul class="lv2">
	<li><a href="/wlog-10.htm">Weblog</a> for #10</li>
	<li><a href="/news.htm">Old News</a> &amp;
	    <a href="/oldnews.htm#owlog">WLog</a></li>
  </ul></li>
  <li><a href="/?about">About</a></li>
<!-- these are not in a usable state
  <li><a href="/?docs">Documentation</a></li>
  <li><a href="/?faq">FAQ</a></li>
-->
  <li class="spacer"><a href="/getting.htm">Download</a></li>
  <li><a href="/irc.htm">IRC</a></li>
  <li><a href="/projects.htm">Project Ideas</a></li>
  <li><a href="/danke.htm">Donate</a></li>
  <li>Manpages<ul class="lv2">
    <li><a href="/htman/i386/">i386</a></li>
    <li><a href="/htman/sparc/">sparc</a></li>
  </ul></li>
  <li><a href="/ports.htm">MirPorts</a> Framework</li>
  <li>Subprojects<ul class="lv2">
	<li><a href="/jupp.htm">jupp</a> Editor</li>
	<li><a href="/mksh.htm">mksh</a> Shell</li>
  </ul></li>
 </ul>
</div>
<div class="content">
 <?php
	$cmsc = get_include_contents($rq);
	if ($cmsc === false) {
 ?>
		<p>Error during including CMS content file!</p>
 <?php
	} else {
		echo ereg_replace(
		    "([0-9A-z][-.,0-9A-z]*)\(([1-9])[/0-9A-Za-z]*\)",
		    "<a href=\"/htman/i386/man\\2/\\1.htm\">\\0</a>", ereg_replace(
		    "([0-9A-z][-.,0-9A-z]*)\((DOCS|PAPERS|PSD|SMM|USD)\)",
		    "<a href=\"/htman/i386/man\\2/\\1.htm\">\\0</a>", $cmsc));
	}
 ?>
</div>
<div class="heading">
 <a href="main.htm"><img class="hdrlnks"
  src="pics/logo-grey.png" alt="MirOS Logo" /></a>
</div>
<div class="footer"><p>• <a
 href="http://validator.w3.org/check/referer">Valid HTML!</a> • <a
 href="mailto:miros-discuss@@mirbsd.org">eMail</a> contact to the
 MirOS Project •</p>
<p class="rcsdiv">Generated using the old, abandoned CMS</p>
</div>
</body></html>
@


1.12
log
@switch the "old news" from oldnews.htm (no anchor) to news.htm (i.e. these
which just dropped away from the front page first), and add a link under
the "wlog" from the same list item, to oldnews.htm (new anchor: owlog)
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.11 2008/05/17 20:56:10 tg Exp $ */
d106 1
a106 1
 <!-- $MirOS: www/files/index.php,v 1.11 2008/05/17 20:56:10 tg Exp $ -->
@


1.11
log
@‣ http://www.heise.de/newsticker/E-Mail-im-Web-Impressum-soll-genuegen--/meldung/108026
The EuGH decided that an eMail address in place of an imprint is enough for
“normal” purposes if it’s a direct and immediate contact address.
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.10 2008/05/03 02:26:29 tg Exp $ */
d106 1
a106 1
 <!-- $MirOS: www/files/index.php,v 1.10 2008/05/03 02:26:29 tg Exp $ -->
d120 2
a121 1
	<li><a href="/oldnews.htm">Old News</a> &amp; WLog</li>
@


1.10
log
@sync with current templates
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.9 2008/05/03 02:20:26 tg Exp $ */
d106 1
a106 1
 <!-- $MirOS: www/mk/tmpl.pre,v 1.14 2008/03/14 21:13:09 tg Exp $ -->
a162 1
 href="http://mirbsd.de/impressum">Impressum</a> • <a
d164 1
a164 1
 href="mailto:miros-discuss@@66h.42h.de">E-Mail</a> contact to the
@


1.9
log
@clean up this legacy mess as much as possible and switch to wlog-10 ;)
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.8 2008/05/03 02:11:16 tg Exp $ */
d99 1
d106 1
d120 1
a120 1
	<li><a href="/?older">Old News</a> &amp; Log</li>
d127 1
a127 3
  <li class="spacer"><a href="/getting.htm">Download</a><!-- <ul class="lv2">
	<li><a href="/?mirrors">Mirrors</a></li>
  </ul>--></li>
d159 2
a160 2
 <img class="hdrlnks" src="pics/logo-grey.png"
  alt="MirOS Logo" />
d167 1
@


1.8
log
@pasto
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.7 2008/05/03 02:05:26 tg Exp $ */
a5 2
 *-
 * This is the "master" CMS manager file. It streams content.
a90 103
 // Declare global variables
 unset($tg_svr);
 unset($tg_bws);
 unset($tg_pts);
 unset($tg_sur);
 unset($tg_pfad);
 unset($tg_pflv);
 unset($tg_htt0);
 unset($tg_htt1);
 unset($tg_htlv);
 unset($tg_realm);

 // get server environment
 $tg_svr = strtolower($_SERVER["HTTP_HOST"]);
 if (strpos($tg_svr, ":")) {
	$tg_svp = substr($tg_svr, strpos($tg_svr, ":") + 1);
	$tg_svr = substr($tg_svr, 0, strpos($tg_svr, ":"));
 } else	$tg_svp = "80";
 $tg_bws = $_SERVER["HTTP_USER_AGENT"];
 $tg_pts = $_SERVER["REQUEST_URI"];
 if (!empty($_SERVER["SCRIPT_URI"])) {
	$tg_sur = $_SERVER["SCRIPT_URI"];
 } else {
	$tg_sur = "http://" . $tg_svr . $tg_pts;
 }

 // Try to find out the offset to this file per server
 $i = substr_count($tg_pts, "/");
 $sl = $i ? $i - 1 : 0;
 $tg_ist = 2;

 // get local variables:
 //  $sl = number of subdirectory layers			(default: 0 [DEL:1])
 //  $ht = HTML type (0=transitional 1=strict 2=XHTML/1.1)	(default: 2)

 if (!isset($sl)) { $sl = "0"; }
 if (!isset($ht)) { $ht = "2"; }

 // Generate possible subdirectory layers
 if ($sl == "0") {
	$tg_pfad = "";
	$tg_pflv = 0;
 } else if ($sl == "1") {
	$tg_pfad = "../";
	$tg_pflv = 1;
 } else if ($sl == "2") {
	$tg_pfad = "../../";
	$tg_pflv = 2;
 } else if ($sl == "3") {
	$tg_pfad = "../../../";
	$tg_pflv = 3;
 } else if ($sl == "4") {
	$tg_pfad = "../../../../";
	$tg_pflv = 4;
 } else if ($sl == "5") {
	$tg_pfad = "../../../../../";
	$tg_pflv = 5;
 } else if ($sl == "6") {
	$tg_pfad = "../../../../../../";
	$tg_pflv = 6;
 } else if ($sl == "7") {
	$tg_pfad = "../../../../../../../";
	$tg_pflv = 7;
 } else if ($sl == "8") {
	$tg_pfad = "../../../../../../../../";
	$tg_pflv = 8;
 } else {
	header("Content-type: text/plain");
	echo "Script error: subdirectory layers!\r\n";
	exit;
 }

 unset($tg_noie);
 $tg_realm = 2;

 // Fill in HTML flavour dependant variables
 if ($ht == "0") {
	$tg_htt0 = "XHTML 1.0 Transitional";
	$tg_htt1 = "xhtml1/DTD/xhtml1-transitional";
	$tg_htlv = 0;
 } else if ($ht == "1") {
	$tg_htt0 = "XHTML 1.0 Strict";
	$tg_htt1 = "xhtml1/DTD/xhtml1-strict";
	$tg_htlv = 1;
 } else if ($ht == "2") {
	$tg_htt0 = "XHTML 1.1";
	$tg_htt1 = "xhtml11/DTD/xhtml11";
	$tg_htlv = 2;
 } else {
	header("Content-type: text/plain");
	echo "Script error: HTML subtype!\r\n";
	exit;
 }

 // Unset locals
 unset($i);
 unset($sl);
 unset($ht);
 unset($tmp);

 // Marker that this script has been executed
 $tg_init = "v11";

a92 1
 // XXX? header("Pragma: no-cache");
d96 3
a98 4
?><!DOCTYPE html PUBLIC "-//W3C//DTD <?php echo "${tg_htt0}"; ?>//EN"
 "http://www.w3.org/TR/<?php echo "${tg_htt1}"; ?>.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"<?php
	if ($tg_htlv < 2) echo ' lang="en"';	?>><head>
d117 1
a117 1
	<li><a href="/wlog-9.htm">Weblog</a> for #9</li>
d162 6
a167 8
<div class="footer">
&bull; <a href="http://mirbsd.de/impressum">Impressum</a> &bull;
<a href="http://validator.w3.org/check/referer">Valid <?php
	echo substr_replace($tg_htt0, "/", strpos($tg_htt0, " "), 1)."!</a>\n";
?> - <a href="http://jigsaw.w3.org/css-validator/validator?warning=1&amp;profile=none&amp;uri=<?php
	echo urlencode($tg_sur);	?>">Valid CSS!</a><?php
?> - <small><a href="mailto:miros-discuss@@66h.42h.de">eMail</a>
 contact to</small> the MirOS Project</div>
@


1.7
log
@simplify 404ing
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.6 2008/05/03 01:47:26 tg Exp $ */
d81 1
a81 1
			if (is_readable("content/".mybase64($rq).".inc"))
@


1.6
log
@the less vulnerable php code we have, the better ;-)
nuked the style selector, mostly
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.5 2008/05/03 01:44:05 tg Exp $ */
d63 7
a70 2
		$fhtm = is_readable($rq . ".htm");
		$fphp = is_readable($rq . ".php");
d76 2
a77 3
		if ($fphp)
			$fn = $svr . "/" . $rq . ".php";
		else if ($fhtm)
d79 5
a83 2
		else
			$fn = false;
d92 1
a92 18
	if (is_readable("content/".mybase64($rq).".override")) {
		header('Content-Type: text/html');
		$fn = file_get_contents("content/".mybase64($rq).".override");
		readfile(rtrim($fn));
		exit;
	}
	$rq = "content/".mybase64($rq).".inc";
	if (!is_readable($rq)) {
		if (!empty($_SERVER["HTTPS"])) {
			$proto="https";
		} else {
			$proto="http";
		}
		header("Status: 404 Content Not Found");
		header("Location: ".$proto."://".
		    $_SERVER['HTTP_HOST']."/404.php".$qs);
		exit;
	}
@


1.5
log
@uninclude some more, there is no content/*.index any more anyway
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.4 2008/05/03 01:41:45 tg Exp $ */
a9 3
$has_vfuncs = 1;
$is_admin = 0;

a23 35
 * read cookie telling which CSS to use
 */
function getcsscookie()
{
	global $is_admin;

	$tmp = "nonexistent";
	if (!empty($_COOKIE['usecss'])) {
		$tmp = "vs".$_COOKIE['usecss'].".css";
	}
	if (!is_readable($tmp)) {
		$tmp = "vstyle.css";
	}

	if ($tmp === "vsroot.css") {
		$is_admin = 1;
	} else {
		$is_admin = 2;
	}
	return $tmp;
}

/*
 * Is admin?
 */
function isadm()
{
	global $is_admin;

	if ($is_admin == 0)
		getcsscookie();
	return ($is_admin === 1) ? true : false;
}

/*
a114 4
 if (empty($has_vfuncs)) {
	require("vfuncs.php");
 }

a196 3
 // Style Sheet
 $tg_ucss = getcsscookie();

d217 1
a217 21
<?php
 // Stylesheet link
 if ($tg_realm == 2) {
	if (!isset($tg_noss)) {
?> <link rel="stylesheet" type="text/css" href="<?php
		echo "${tg_pfad}${tg_ucss}"; ?>" />
<?php
	}
 } else if ($tg_realm != 3) {
?> <link rel="stylesheet" type="text/css" href="<?php
	echo "${tg_pfad}"; ?>rstil.css" />
<?php
 }

 // Stylesheet MS Internet Exploder Crash Service ;-)
 if (empty($tg_noie) && (strstr($tg_bws, "MSIE "))) {
?> <style type="text/css"> <!--
  p { cssText:font-weight:bold; } --></style>
<?php
 }
?>
@


1.4
log
@un-modularise
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.3 2007/12/28 17:52:12 bsiegert Exp $ */
a128 1
	$ridx="content/".mybase64($rq).".index";
a140 3
	if (!is_readable($ridx)) {
		$ridx="vindex.inc";
	}
d298 24
a321 1
  <?php include($ridx); ?>
@


1.3
log
@Now the changes that require modifying the HTML source.

- new header without the ASCII art
- rcsids are now part of the footer
- vindex.inc: sync
- remove second mksh link from index
- /?about: move h1->h2, h2->h3
- only one h1 per page, placed inside the header
- miros logo inside the header is clickable and a link to the home page
- add news entry about the change
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.2 2007/10/02 18:55:00 tg Exp $ */
d10 66
a75 1
	require("vfuncs.php");
d145 141
a285 1
	require("vbegin.php");
d287 4
d325 9
a333 1
<?php include("vend.php"); ?>
@


1.2
log
@new manpages format
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.1 2007/06/09 23:29:51 tg Exp $ */
a96 24
 <?php	if (!(($rq == "content/bWtzaA__.inc") ||
	    ($rq == "content/aXJj.inc") ||
	    ($rq == "content/YnQ_.inc") ||
	    ($rq == "content/bGljZW5jZQ__.inc") ||
	    ($rq == "content/bWFpbg__.inc") ||
	    ($rq == "content/d2xvZy0w.inc") ||
	    ($rq == "content/d2xvZy0x.inc") ||
	    ($rq == "content/d2xvZy0y.inc") ||
	    ($rq == "content/d2xvZy0z.inc") ||
	    ($rq == "content/d2xvZy00.inc") ||
	    ($rq == "content/d2xvZy01.inc") ||
	    ($rq == "content/d2xvZy02.inc") ||
	    ($rq == "content/d2xvZy03.inc") ||
	    ($rq == "content/d2xvZy04.inc") ||
	    ($rq == "content/d2xvZy05.inc") ||
	    ($rq == "content/YWJvdXQ_.inc"))) { ?>
 <div style="border:4px ridge red; margin:0px 24px 0px 24px; padding:12px;">
  <h1>Important message</h1>
  <p>This website is currently under reconstruction. The information
   you find here is probably out of date and not maintained any more
   in favour of the new website. If you want to volunteer helping us
   to set up the new website (same design, KISS content), mail Benny
   at bsiegert@@mirbsd.de, thanks.</p>
 </div>
a97 1
	}
d113 1
a113 1
 <img class="hdrlnks" src="pics/logosmw.png"
a114 10
<pre class="hdrflf">     ___                                                  __
    -   ---___- ,,                  /\\,/\\,            ,-||-,     -_-/
       (' ||    ||                 /| || ||   '        ('|||  )   (_ /
      ((  ||    ||/\\  _-_         || || ||  \\ ,._-_ (( |||--)) (_ --_
     ((   ||    || || || \\        ||=|= ||  ||  ||   (( |||--))   --_ )
      (( //     || || ||/         ~|| || ||  ||  ||    ( / |  )   _/  ))
        -____-  \\ |/ \\,/         |, \\,\\, \\  \\,    -____-   (_-_-
                  _/              _-                    <a href="/LICENCE"><small>Website Licence</small></a></pre>
 <img class="hdrrhts" src="pics/quilt.png"
  alt="Collage with MirOS and MirPorts impressions" />
@


1.1
log
@switch to the new website system, keeping legacy content around
@
text
@d2 1
a2 1
/* $MirOS: www/files/index.php,v 1.3 2007/06/03 22:39:54 tg Exp $ */
d131 3
a133 3
		    "<a href=\"/man\\2/\\1.htm\">\\0</a>", ereg_replace(
		    "([0-9A-z][-.,0-9A-z]*)\((PAPERS|PSD|SMM|USD)\)",
		    "<a href=\"/cman/man\\2/\\1.htm\">\\0</a>", $cmsc));
@

