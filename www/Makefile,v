head	1.124;
access;
symbols;
locks; strict;
comment	@# @;


1.124
date	2019.12.29.23.02.03;	author tg;	state Exp;
branches;
next	1.123;
commitid	1005E09307D70DD0C6C;

1.123
date	2019.07.27.00.06.05;	author tg;	state Exp;
branches;
next	1.122;
commitid	1005D3B95862349AE13;

1.122
date	2018.12.25.02.20.51;	author tg;	state Exp;
branches;
next	1.121;
commitid	1005C21941248BF7F0B;

1.121
date	2018.07.13.23.36.13;	author tg;	state Exp;
branches;
next	1.120;
commitid	1005B49377E1BD4E27A;

1.120
date	2018.05.06.13.53.03;	author tg;	state Exp;
branches;
next	1.119;
commitid	1005AEF08D606A7C417;

1.119
date	2018.05.05.21.38.21;	author tg;	state Exp;
branches;
next	1.118;
commitid	1005AEE24233D686FFB;

1.118
date	2018.05.05.17.40.23;	author tg;	state Exp;
branches;
next	1.117;
commitid	1005AEDEC757B8FE8AE;

1.117
date	2018.04.26.19.38.07;	author tg;	state Exp;
branches;
next	1.116;
commitid	1005AE22A317C1B57A3;

1.116
date	2017.08.10.19.25.14;	author tg;	state Exp;
branches;
next	1.115;
commitid	100598CB32730354517;

1.115
date	2017.08.10.18.30.07;	author tg;	state Exp;
branches;
next	1.114;
commitid	100598CA6476858FE3C;

1.114
date	2017.06.26.02.25.36;	author tg;	state Exp;
branches;
next	1.113;
commitid	100595070BA33582A59;

1.113
date	2017.03.01.22.40.25;	author tg;	state Exp;
branches;
next	1.112;
commitid	10058B74DF055C2D552;

1.112
date	2016.08.01.21.18.24;	author tg;	state Exp;
branches;
next	1.111;
commitid	100579FBC921EA96F1E;

1.111
date	2016.05.03.21.08.29;	author tg;	state Exp;
branches;
next	1.110;
commitid	1005729135F0ED6D0B8;

1.110
date	2016.04.27.19.56.27;	author tg;	state Exp;
branches;
next	1.109;
commitid	1005721195934F3BEA2;

1.109
date	2016.03.06.19.05.35;	author tg;	state Exp;
branches;
next	1.108;
commitid	10056DC7F980BC7EED4;

1.108
date	2015.12.13.01.36.15;	author tg;	state Exp;
branches;
next	1.107;
commitid	100566CCB90696F57E8;

1.107
date	2015.10.13.20.51.44;	author tg;	state Exp;
branches;
next	1.106;
commitid	100561D6EF014623BC3;

1.106
date	2015.10.13.18.35.24;	author tg;	state Exp;
branches;
next	1.105;
commitid	100561D4EEB5F77F79F;

1.105
date	2015.09.12.18.03.47;	author tg;	state Exp;
branches;
next	1.104;
commitid	10055F4690F1CE42587;

1.104
date	2015.09.12.16.28.37;	author tg;	state Exp;
branches;
next	1.103;
commitid	10055F452CD428A16E6;

1.103
date	2015.08.27.14.32.53;	author tg;	state Exp;
branches;
next	1.102;
commitid	10055DF1FAE69204D66;

1.102
date	2015.04.12.19.37.07;	author tg;	state Exp;
branches;
next	1.101;
commitid	100552AC97C2824E4B2;

1.101
date	2015.04.12.19.36.22;	author tg;	state Exp;
branches;
next	1.100;
commitid	100552AC9401DA626A6;

1.100
date	2014.11.10.22.11.09;	author tg;	state Exp;
branches;
next	1.99;
commitid	1005461355E6C10075C;

1.99
date	2014.06.29.13.56.28;	author tg;	state Exp;
branches;
next	1.98;
commitid	10053B01B164296BB8C;

1.98
date	2014.04.18.22.59.51;	author tg;	state Exp;
branches;
next	1.97;
commitid	1005351AE7D024DC9C7;

1.97
date	2014.04.14.20.10.51;	author tg;	state Exp;
branches;
next	1.96;
commitid	100534C40E07AEED922;

1.96
date	2014.04.14.19.29.30;	author tg;	state Exp;
branches;
next	1.95;
commitid	100534C3730417ACF22;

1.95
date	2014.04.04.22.20.06;	author tg;	state Exp;
branches;
next	1.94;
commitid	100533F302805226E6A;

1.94
date	2014.03.30.14.24.36;	author tg;	state Exp;
branches;
next	1.93;
commitid	100533829122E6CFE0A;

1.93
date	2014.03.30.13.04.54;	author tg;	state Exp;
branches;
next	1.92;
commitid	10053381677098DC1D1;

1.92
date	2014.03.29.12.25.24;	author tg;	state Exp;
branches;
next	1.91;
commitid	1005336BBCD686CEC4F;

1.91
date	2014.03.29.12.12.52;	author tg;	state Exp;
branches;
next	1.90;
commitid	1005336B8DD3254C771;

1.90
date	2014.01.02.22.54.54;	author tg;	state Exp;
branches;
next	1.89;
commitid	10052C5EE5707DD531E;

1.89
date	2013.11.06.21.11.43;	author tg;	state Exp;
branches;
next	1.88;
commitid	100527AB0A70D1D4D0A;

1.88
date	2013.11.06.21.10.11;	author tg;	state Exp;
branches;
next	1.87;
commitid	100527AB0491A0AFA5D;

1.87
date	2013.06.23.16.17.08;	author tg;	state Exp;
branches;
next	1.86;
commitid	10051C71F9C76C386ED;

1.86
date	2013.06.08.17.31.19;	author tg;	state Exp;
branches;
next	1.85;
commitid	10051B36A7D39170DE9;

1.85
date	2013.06.08.16.55.53;	author tg;	state Exp;
branches;
next	1.84;
commitid	10051B3622F5503CB12;

1.84
date	2013.01.02.23.02.13;	author tg;	state Exp;
branches;
next	1.83;
commitid	10050E4BC8D477E591C;

1.83
date	2012.12.20.22.16.09;	author tg;	state Exp;
branches;
next	1.82;
commitid	10050D38EBD21CF856E;

1.82
date	2012.07.15.14.16.41;	author tg;	state Exp;
branches;
next	1.81;
commitid	1005002D0836F391385;

1.81
date	2012.05.19.21.40.11;	author tg;	state Exp;
branches;
next	1.80;
commitid	1004FB813525E874044;

1.80
date	2012.05.15.20.18.33;	author tg;	state Exp;
branches;
next	1.79;
commitid	1004FB2BA2C264D657A;

1.79
date	2012.05.15.20.10.09;	author tg;	state Exp;
branches;
next	1.78;
commitid	1004FB2B839725FAB28;

1.78
date	2012.05.15.18.42.20;	author tg;	state Exp;
branches;
next	1.77;
commitid	1004FB2A36E3425DD56;

1.77
date	2012.05.07.16.42.27;	author tg;	state Exp;
branches;
next	1.76;
commitid	1004FA7FB8A51F28A5C;

1.76
date	2011.06.06.22.05.48;	author tg;	state Exp;
branches;
next	1.75;
commitid	1004DED4F536CD4E658;

1.75
date	2011.06.06.21.36.44;	author tg;	state Exp;
branches;
next	1.74;
commitid	1004DED486F31670654;

1.74
date	2011.05.29.17.30.30;	author tg;	state Exp;
branches;
next	1.73;
commitid	1004DE282CE4357156F;

1.73
date	2011.02.12.23.00.00;	author bsiegert;	state Exp;
branches;
next	1.72;
commitid	1004D5710F10BF74BC2;

1.72
date	2011.02.08.22.13.27;	author bsiegert;	state Exp;
branches;
next	1.71;
commitid	1004D51BFEB0E63C2EB;

1.71
date	2010.05.13.19.04.14;	author tg;	state Exp;
branches;
next	1.70;
commitid	1004BEC4D3B4BDAD246;

1.70
date	2010.04.09.19.29.16;	author tg;	state Exp;
branches;
next	1.69;
commitid	1004BBF7FB83931CC5C;

1.69
date	2010.03.27.18.03.34;	author tg;	state Exp;
branches;
next	1.68;
commitid	1004BAE48880D5C43E2;

1.68
date	2010.02.09.15.13.25;	author tg;	state Exp;
branches;
next	1.67;
commitid	1004B717BAC76474C35;

1.67
date	2010.01.28.21.05.32;	author tg;	state Exp;
branches;
next	1.66;
commitid	1004B61FC2959124508;

1.66
date	2010.01.28.17.11.48;	author tg;	state Exp;
branches;
next	1.65;
commitid	1004B61C56848DD3101;

1.65
date	2009.12.28.16.50.36;	author tg;	state Exp;
branches;
next	1.64;
commitid	1004B38E1F40D9AFAF7;

1.64
date	2009.12.28.14.58.04;	author tg;	state Exp;
branches;
next	1.63;
commitid	1004B38C779528FBEE6;

1.63
date	2009.12.12.18.30.53;	author tg;	state Exp;
branches;
next	1.62;
commitid	1004B23E15D0630FE65;

1.62
date	2009.12.12.17.14.28;	author tg;	state Exp;
branches;
next	1.61;
commitid	1004B23CF5879BEBD12;

1.61
date	2009.11.25.09.14.58;	author tg;	state Exp;
branches;
next	1.60;
commitid	1004B0CF5A93F8CEB7C;

1.60
date	2009.11.12.22.41.30;	author tg;	state Exp;
branches;
next	1.59;
commitid	1004AFC8F2730334AEB;

1.59
date	2009.10.31.17.16.17;	author tg;	state Exp;
branches;
next	1.58;
commitid	1004AEC70F66C0C3F72;

1.58
date	2009.10.31.17.02.36;	author tg;	state Exp;
branches;
next	1.57;
commitid	1004AEC6DB33733AAE1;

1.57
date	2009.10.31.15.54.09;	author tg;	state Exp;
branches;
next	1.56;
commitid	1004AEC5DB12341EBD1;

1.56
date	2009.10.15.16.55.03;	author tg;	state Exp;
branches;
next	1.55;
commitid	1004AD753B84BE82FBC;

1.55
date	2009.07.27.12.04.55;	author tg;	state Exp;
branches;
next	1.54;
commitid	1004A6D97F74704496E;

1.54
date	2009.07.19.11.28.27;	author tg;	state Exp;
branches;
next	1.53;
commitid	1004A63035B2B7F5383;

1.53
date	2009.06.22.12.17.54;	author tg;	state Exp;
branches;
next	1.52;
commitid	1004A3F7683425ABB44;

1.52
date	2009.06.21.11.20.58;	author tg;	state Exp;
branches;
next	1.51;
commitid	1004A3E17AA7CAA8DC9;

1.51
date	2009.04.23.18.13.49;	author tg;	state Exp;
branches;
next	1.50;
commitid	10049F0AFF565148ECE;

1.50
date	2009.04.23.18.13.02;	author tg;	state Exp;
branches;
next	1.49;
commitid	10049F0AFC45090DCF9;

1.49
date	2009.02.16.21.48.34;	author tg;	state Exp;
branches;
next	1.48;
commitid	1004999DF477458D6E7;

1.48
date	2009.02.16.21.42.11;	author tg;	state Exp;
branches;
next	1.47;
commitid	1004999DDB523FEAD92;

1.47
date	2009.01.21.13.11.53;	author tg;	state Exp;
branches;
next	1.46;
commitid	10049771F1F66350D6A;

1.46
date	2009.01.14.19.43.18;	author tg;	state Exp;
branches;
next	1.45;
commitid	100496E40687890A688;

1.45
date	2008.12.24.11.53.53;	author tg;	state Exp;
branches;
next	1.44;
commitid	100495222DC38A6C526;

1.44
date	2008.12.07.17.10.38;	author tg;	state Exp;
branches;
next	1.43;
commitid	100493C03A2014AA922;

1.43
date	2008.12.04.20.33.02;	author tg;	state Exp;
branches;
next	1.42;
commitid	10049383E8962FA289D;

1.42
date	2008.12.04.20.31.32;	author tg;	state Exp;
branches;
next	1.41;
commitid	10049383E3809AC325E;

1.41
date	2008.12.04.20.27.10;	author tg;	state Exp;
branches;
next	1.40;
commitid	10049383D2D5E05084A;

1.40
date	2008.12.04.19.51.00;	author tg;	state Exp;
branches;
next	1.39;
commitid	100493834B94DDB1634;

1.39
date	2008.12.04.19.38.12;	author tg;	state Exp;
branches;
next	1.38;
commitid	100493831A54A1FB1A8;

1.38
date	2008.12.04.13.45.45;	author tg;	state Exp;
branches;
next	1.37;
commitid	1004937DF1F21383B8F;

1.37
date	2008.12.04.12.40.53;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004937CFD74C7EAB05;

1.36
date	2008.11.08.16.28.45;	author tg;	state Exp;
branches;
next	1.35;
commitid	1004915BE2D4E504864;

1.35
date	2008.11.08.15.37.42;	author tg;	state Exp;
branches;
next	1.34;
commitid	1004915B20211547724;

1.34
date	2008.10.05.16.26.20;	author tg;	state Exp;
branches;
next	1.33;
commitid	10048E8EA7D6EAD401E;

1.33
date	2008.09.19.07.29.48;	author tg;	state Exp;
branches;
next	1.32;
commitid	10048D354F97F2325F0;

1.32
date	2008.09.17.21.52.04;	author tg;	state Exp;
branches;
next	1.31;
commitid	10048D17C0865DB7CBA;

1.31
date	2008.09.17.21.21.37;	author tg;	state Exp;
branches;
next	1.30;
commitid	10048D174ED72003551;

1.30
date	2008.09.17.21.12.01;	author tg;	state Exp;
branches;
next	1.29;
commitid	10048D172B4707A4228;

1.29
date	2008.06.28.20.42.44;	author bsiegert;	state Exp;
branches;
next	1.28;
commitid	1004866A24B7CE0B57F;

1.28
date	2008.05.29.16.01.07;	author bsiegert;	state Exp;
branches;
next	1.27;
commitid	100483ED2C07AD902E2;

1.27
date	2008.05.03.01.44.04;	author tg;	state Exp;
branches;
next	1.26;
commitid	100481BC370715FF7E0;

1.26
date	2008.03.27.21.46.33;	author tg;	state Exp;
branches;
next	1.25;
commitid	10047EC15CC7D5FB5E6;

1.25
date	2008.03.22.20.38.16;	author tg;	state Exp;
branches;
next	1.24;
commitid	10047E56E14233E1390;

1.24
date	2008.03.15.23.41.48;	author tg;	state Exp;
branches;
next	1.23;
commitid	10047DC5ED06483D7F0;

1.23
date	2008.03.14.21.13.05;	author tg;	state Exp;
branches;
next	1.22;
commitid	10047DAEA6C5933200C;

1.22
date	2008.03.10.14.56.47;	author tg;	state Exp;
branches;
next	1.21;
commitid	10047D54C323469953F;

1.21
date	2008.02.28.18.54.07;	author tg;	state Exp;
branches;
next	1.20;
commitid	10047C703633E03AF1A;

1.20
date	2008.02.22.22.09.11;	author tg;	state Exp;
branches;
next	1.19;
commitid	10047BF481A552596EF;

1.19
date	2008.02.22.21.49.30;	author tg;	state Exp;
branches;
next	1.18;
commitid	10047BF436E00C93DD9;

1.18
date	2008.01.19.22.12.52;	author bsiegert;	state Exp;
branches;
next	1.17;
commitid	100479275FB00027237;

1.17
date	2007.09.30.19.33.49;	author tg;	state Exp;
branches;
next	1.16;
commitid	10046FFFA2009CAB902;

1.16
date	2007.09.28.13.42.28;	author tg;	state Exp;
branches;
next	1.15;
commitid	10046FD04D2150A1A07;

1.15
date	2007.08.30.09.37.12;	author tg;	state Exp;
branches;
next	1.14;
commitid	10046D68FBC283CBDB4;

1.14
date	2007.08.29.19.53.34;	author tg;	state Exp;
branches;
next	1.13;
commitid	10046D5CECB1E1F493B;

1.13
date	2007.08.28.19.23.42;	author bsiegert;	state Exp;
branches;
next	1.12;
commitid	10046D4763823E5A479;

1.12
date	2007.08.24.19.33.59;	author bsiegert;	state Exp;
branches;
next	1.11;
commitid	10046CF325B5353DAC6;

1.11
date	2007.08.09.19.14.55;	author tg;	state Exp;
branches;
next	1.10;
commitid	10046BB67AB762CBA73;

1.10
date	2007.08.05.23.23.22;	author tg;	state Exp;
branches;
next	1.9;
commitid	10046B65C012678110C;

1.9
date	2007.07.23.14.39.36;	author tg;	state Exp;
branches;
next	1.8;
commitid	10046A4BDAB32043E76;

1.8
date	2007.07.05.23.21.49;	author tg;	state Exp;
branches;
next	1.7;
commitid	100468D7D20346E17FF;

1.7
date	2007.07.01.22.07.09;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004688259849144338;

1.6
date	2007.06.22.23.37.29;	author tg;	state Exp;
branches;
next	1.5;
commitid	100467C5D4340B78338;

1.5
date	2007.06.21.16.14.22;	author tg;	state Exp;
branches;
next	1.4;
commitid	100467AA3F400121F04;

1.4
date	2007.06.21.16.13.50;	author tg;	state Exp;
branches;
next	1.3;
commitid	100467AA3D4781E719F;

1.3
date	2007.06.10.00.02.35;	author tg;	state Exp;
branches;
next	1.2;
commitid	100466B3FA438254923;

1.2
date	2007.06.09.23.59.27;	author tg;	state Exp;
branches;
next	1.1;
commitid	100466B3EED1BD54E96;

1.1
date	2007.06.09.23.29.42;	author tg;	state Exp;
branches;
next	;
commitid	100466B37F0373CAEA0;


desc
@@


1.124
log
@refactor, Defs.mk will be needed elsewhere
@
text
@# $MirOS: www/Makefile,v 1.122 2018/12/25 02:20:51 tg Exp $
#-
# This file is part of the MirBSD website; see LICENCE for details.

.ifndef TOP
TOP!=		realpath ${.CURDIR:Q}
DST!=		realpath ${.OBJDIR:Q}
.MAKEFLAGS:=	${.MAKEFLAGS} TOP=${TOP:Q} DST=${DST:Q}
.endif

all:

.include <bsd.own.mk>
BSDSRCDIR?=/nonexistant
.if exists(${DST}/.depend)
.  include "${DST}/.depend"
.endif
.include "${.CURDIR}/Defs.mk"

U_ENV+=		TOP=${TOP:Q} DST=${DST:Q} MKSH=${MKSH:Q} SHELL=${MKSH:Q} TZ=UTC

SRCS+=		FreeWRT.hts
SRCS+=		a4rcontrb.hts a4rp5bsd.hts
SRCS+=		about.hts
SRCS+=		anargeek.hts
SRCS+=		ann-10.hts
SRCS+=		bt.hts
SRCS+=		clog11.hts
SRCS+=		danke.hts
SRCS+=		devel.hts
SRCS+=		errata10.hts
SRCS+=		getting.hts
SRCS+=		imprint.hts
SRCS+=		irc.hts
SRCS+=		jupp.hts
SRCS+=		ksh-chan.hts
SRCS+=		kwalletcli.hts
SRCS+=		main.hts
SRCS+=		makefs.hts
SRCS+=		man.hts
SRCS+=		mgp.hts
SRCS+=		mksh-faq.hts
SRCS+=		mksh.hts mksh_bld.hts mksh_old.hts
SRCS+=		oldnews.hts
SRCS+=		pax.hts
SRCS+=		pkgsrc.hts
SRCS+=		ports.hts
SRCS+=		projects.hts
SRCS+=		randex.hts
SRCS+=		rss.hts
SRCS+=		wptg.hts
SRCS+=		wtf.hts
USELINKED+=	acronyms
WLOGS=		-9 -10
WPS=		tg

# legacy content
SRCS+=		ann-7.hts ann-8.hts anoncvs.hts bsd-intro.hts clog-2004.hts \
		clog-2005.hts clog-2006.hts cvsweb.hts docs.hts errata8.hts \
		faq.es.hts faq.hts history.hts ipv6-sixxs.hts \
		isdn.hts mirrors.hts mirwarum.hts
SRCS+=		wlog-0.hts wlog-1.hts wlog-2.hts wlog-3.hts wlog-4.hts \
		wlog-5.hts wlog-6.hts wlog-7.hts wlog-8.hts

INCSRCS+=	news
news.cut: stamp_htm_news
CLEANFILES+=	news.cut

.PATH: ${TOP}/src

all:
install: site.tgz.stamp

FPSRCS+=	${SRCS:S,^,src/,}

OBJS+=		${FPSRCS:T:M*.hts:S/hts$/htm~/}
VOBJS+=		${FPSRCS:T:M*.hts:S/hts$/val/}
CLEANFILES+=	${FPSRCS:T:M*.hts:S/hts$/htm~/}

DEPSRCS+=	${FPSRCS}
INCSRCS+=	${WLOGS:S/^/wlog/}

.for _i in ${INCSRCS}
DEPSRCS+=	data/${_i}.cfg
GENSRCS+=	stamp_htm_${_i} stamp_rss_${_i}

stamp_htm_${_i}: ${DEPS_mk_inc2htm} ${DEPS_data_${_i}_cfg}
	${U_ENV} ${MKSH} ${TOP}/mk/inc2htm ${_i} >$@@~
	mv $@@~ $@@

stamp_rss_${_i}: ${DEPS_mk_inc2rss} ${DEPS_data_${_i}_cfg}
	${U_ENV} PATH=.:$$PATH ${MKSH} ${TOP}/mk/inc2rss ${_i} >$@@~
	mv $@@~ $@@
.endfor

DEPSRCS+=	mk/WPmk
.for _i in ${WPS}
DEPSRCS+=	data/${_i}.gc
GENSRCS+=	stamp_wp_${_i}

stamp_wp_${_i}: ${DEPS_mk_WPmk} ${DEPS_data_${_i}_gc}
	${U_ENV} ${MKSH} ${TOP}/mk/WPmk ${_i} >$@@~
	mv $@@~ $@@
.endfor

DEPSRCS+=	mk/inc2htm mk/inc2rss
OBJS+=		${GENSRCS}
CLEANFILES+=	${GENSRCS}

OBJS+=		acronyms.gz acronyms.ver
CLEANFILES+=	acronyms.gz acronyms.ver

acronyms.gz: ${TOP}/.linked/acronyms
	gzip -n9 <${.ALLSRC:Q} >$@@~
	mv $@@~ $@@

acronyms.ver: ${TOP}/.linked/acronyms
	sed -n '2s/^ ....//p' <${.ALLSRC:Q} >$@@~
	mv $@@~ $@@

clean:
.for _i in ${GENSRCS}
	-rm -rf $$(<${_i})
.endfor
	-rm -rf dst permalinks
	-rm -f ${CLEANFILES} site.tgz* *.tmp *~

cleandir: clean
	-rm -rf hashed
	-rm -f .depend ${CLEANFILES:M*~:S/~$//}

deinstall:
	-rm -rf dst site.tgz*

reinstall: deinstall .WAIT install

all: ${OBJS}

site.tgz.stamp: _reinstall
#	find dst | sort | sed -e '/^dst$$/d' -e 's,^dst/,,' | \
#	    (cd dst && cpio -ovC512 -Hustar -Mdist) | gzip -n9 >site.tgz.tmp
#	mv site.tgz.tmp site.tgz
	:>$@@

.for _i in ${WLOGS}
WLOG_LATEST:=${_i}
.endfor

_reinstall:
	-rm -rf dst
	mkdir dst dst/permalinks
	ln -s ../LICENCE dst/permalinks/
	pax -rw -pe -v hashed dst/
	pax -rw -pe -v -d ${OBJS:Nstamp_*:S/htm~$/htm/} dst/
.for _i in ${GENSRCS}
	[[ -s ${_i} ]]
	pax -rw -pe -v -d $$(<${_i}) dst/
.endfor
	cd ${TOP}/.linked && pax -rw -pe -v ${USELINKED} ${DST}/dst/
	cd ${TOP}/files && pax -rw -pe -v . ${DST}/dst/
	print '/MirOS:/s!www/files/MirOS-Licence.asc,v!src/share/misc/licence.template,v!\nwq' | \
	    ed -s ${DST}/dst/MirOS-Licence.asc
	touch -r ${TOP}/files/MirOS-Licence.asc ${DST}/dst/MirOS-Licence.asc
	cd ${TOP} && pax -rw -pe -v pics ${DST}/dst/
	cd dst && \
	    ln -sf wlog${WLOG_LATEST}.htm wlog.htm && \
	    ln -sf wlog${WLOG_LATEST}.rss wlog.rss && \
	    rm -rf $$(find . -name CVS -o -name .cvsignore)
	chgrp -R miros-cvswww dst
	chmod -R ug=rwX,o=rX dst
	chmod a+x dst/cvs.cgi dst/man.cgi dst/raw.cgi dst/wp.cgi dst/wtf.cgi

.SUFFIXES: .val .htm~ .hts

.hts.htm~:
	@@dstd='$@@'; dstf=$${dstd%\~}; rm -f $@@; \
	 print -r "(. mk/htsconv; mws_basepath $$dstf; mws__do $<) >$$dstf"; \
	 export ${U_ENV}; if (cd ${DST}; . ${TOP}/mk/htsconv; \
	    mws_basepath $$dstf; mws__do $<) >$@@; then \
		(. ${TOP}/mk/htsconv; mws_moveifchange -k $$dstd $$dstf); \
	 else \
		rm -f $@@; \
		exit 1; \
	fi

.htm~.val:
	@@print -r Creating ${@@:Q} from ${<:Q} ...
	@@${_htm_2xhtml} <$< >$@@

.for _i in ${WPS}
WP${_i}.val: stamp_wp_${_i}
	@@${_htm_2xhtml} <WP${_i}.htm >$@@
.endfor

.ifdef validate
VOBJS:=		${validate:=.val}

HTM_FILES!=	cd ${.CURDIR}/files; echo *.htm
.  for _i in ${HTM_FILES}
${_i:R}.val: files/${_i}
	@@print -r Creating ${@@:Q} from ${.ALLSRC:Q} ...
	@@${_htm_2xhtml} <${.ALLSRC} >$@@
.  endfor

.MAIN: validation
.endif

validation: .PHONY ${VOBJS}
	@@print -r Validating ${.ALLSRC:Q} ...
	@@xmlstarlet val -d ${_xhtmldtd} -e ${.ALLSRC}
	@@print '\nValidation complete.'

.PHONY: clean cleandir depend install deinstall reinstall _reinstall \
	cp-herc rs-fish

#cp-herc: site.tgz.stamp
#	ssh hercs 'cd /var/www/oldsite; tar xzvf -' <site.tgz

rs-fish:
	@@if [[ $$(hostname) = fish.mirbsd.org ]]; then hn=; else hn=fish:; fi; \
	 set -x; rsync -rxlztpgavPHK --rsh='ssh -4' dst/ $${hn}/var/anoncvs/www/

depend: .depend

.depend: ${TOP}/mk/mkdepend ${DEPSRCS} ${.CURDIR}/Makefile
	-rm -f $@@
	${U_ENV} ${MKSH} ${TOP}/mk/mkdepend ${DEPSRCS}

lazy: .PHONY
	cd ${.CURDIR} && make depend && make && \
	    make _reinstall && exec make rs-fish

.include <bsd.obj.mk>
@


1.123
log
@+mgp
@
text
@d18 1
a70 9
_htm_2xhtml=	(tr '\n' '﷐' | \
		sed 's^.*<html'${_xhtmlbeg:Q}'' | \
		tr '﷐' '\n')
_xhtmldtd=	${TOP}/files/xhtml11.dtd
_xhtmlbeg=	<?xml version="1.0"?> \
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" \
		 "file://${_xhtmldtd}"> \
		<html

@


1.122
log
@further simplification: drop entire tag cloud functionality
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.121 2018/07/13 23:36:13 tg Exp $
d40 1
@


1.121
log
@remove rs-gecko2 job in preparation of server decommissioning
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.120 2018/05/06 13:53:03 tg Exp $
a48 1
SRCS+=		tags.hts
a50 6
CLEANFILES+=	tags.lst tags.out
TAGCLOUD+=	debian
TAGCLOUD+=	event
TAGCLOUD+=	geocache
TAGCLOUD+=	mksh
TAGCLOUD+=	pcli
a62 2
INCSRCS+=	datatest

a88 1
INCSRCS+=	${TAGCLOUD:S/^/tag_/}
a92 1
CLEANFILES+=	stamp_tag_${_i}
d238 1
a238 5
	    make _reinstall && exec make rs-fish tagslst

tagslst: .PHONY
	@@(echo === TAGS USED/UNUSED/ACCOUNTED FOR ==; cat stamp_tag_* | \
	    sort -u | comm - tags.out) | tee tags.lst
@


1.120
log
@on fish, install locally
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.118 2018/05/05 17:40:23 tg Exp $
d232 1
a232 1
	cp-herc rs-gecko2 rs-fish
a236 3
rs-gecko2:
	rsync -rxlztpgavPHK dst/ tglaser@@www.ig42.org:/var/www/miros.unixforge.de/htdocs/

d249 1
a249 1
	    make _reinstall && exec make rs-fish rs-gecko2 tagslst
@


1.119
log
@TNF sync and two from Sarah and two caches with Sarah ☺
@
text
@d241 2
a242 1
	rsync -rxlztpgavPHK --rsh='ssh -4' dst/ fish:/var/anoncvs/www/
@


1.118
log
@consolidate users/ subdirectory; I think this is as good as I get

also, do not use -nn any more, stop using Author: in .inc files,
change some MirOS/MirSolutions to MirBSD
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.113 2017/03/01 22:40:25 tg Exp $
d106 2
a107 1
	${U_ENV} ${MKSH} ${TOP}/mk/inc2htm ${_i} >$@@ || (rm -f $@@; exit 1)
d110 2
a111 2
	${U_ENV} PATH=.:$$PATH ${MKSH} ${TOP}/mk/inc2rss ${_i} >$@@ || \
	    (rm -f $@@; exit 1)
d120 2
a121 1
	${U_ENV} ${MKSH} ${TOP}/mk/WPmk ${_i} >$@@ || (rm -f $@@; exit 1)
d133 1
a133 1
	mv -f $@@~ $@@
d137 1
a137 1
	mv -f $@@~ $@@
d208 5
@


1.117
log
@• move www/mk/xhtml11.dtd,v to www/files/xhtml11.dtd,v
• apply bugfixes from the second revision of W3C’s XHTML/1.1
  (carefully, sans new bugs and without the XML feature creep)
  retaining the FPU as it’s still a valid version of the standard
• use our local copy of this file, as it’s known to be stable
• reference a debbugs issue with an alternative licence grant, for if needed
• © for xhtml11.dtd moves from www/LICENCE to www/files/LICENCE accordingly
@
text
@d3 1
a3 2
# This file is part of the website of The MirOS Project, which is
# copyrighted material, please read the LICENCE file for details.
d40 1
a41 1
SRCS+=		mksh-faq.hts
d50 1
a51 1
FPSRCS+=	users/tg/wptg.hts
d59 1
a59 1
WLOGS=		9 10
d76 1
a76 1
.PATH: ${TOP}/src ${TOP}/users/tg
d97 1
a97 1
INCSRCS+=	${WLOGS:S/^/wlog-/}
d182 2
a183 2
	    ln -sf wlog-${WLOG_LATEST}.htm wlog.htm && \
	    ln -sf wlog-${WLOG_LATEST}.rss wlog.rss && \
@


1.116
log
@we have a FAQ now! (well, two of them, different scope though)
@
text
@d82 1
a82 1
_xhtmldtd=	${TOP}/mk/xhtml11.dtd
@


1.115
log
@fix dependency logic
@
text
@d42 1
@


1.114
log
@clean up
@
text
@d238 1
a238 1
.depend: ${TOP}/mk/mkdepend ${DEPSRCS}
@


1.113
log
@plug a hole
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.112 2016/08/01 21:18:24 tg Exp $
d60 1
a60 1
WPS=		gecko2 tg
@


1.112
log
@also install an acronyms.ver file to enable more intelligent updater in the äpp
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.111 2016/05/03 21:08:29 tg Exp $
d168 1
@


1.111
log
@stop trying to push www to eurynome
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.107 2015/10/13 20:51:44 tg Exp $
d126 2
a127 2
OBJS+=		acronyms.gz
CLEANFILES+=	acronyms.gz
d133 4
@


1.110
log
@publish gzip(1)d version of acronyms (324 kB vs. 922 kB)
@
text
@d220 1
a220 1
	cp-herc cp-heph rs-heph rs-eurynome rs-fish
a223 3
#
#cp-heph: site.tgz.stamp
#	ssh hephaistos 'cd Web; tar xzvpf -' <site.tgz
d225 1
a225 1
rs-heph:
a227 3
rs-eurynome:
	rsync -rxlztpgavPHK --rsh='ssh -4' dst/ eurynome:/var/anoncvs/anoncvs/www/

d239 1
a239 1
	    make _reinstall && exec make rs-fish rs-eurynome rs-heph tagslst
@


1.109
log
@hook up packager homepage for mircpio
@
text
@d126 7
@


1.108
log
@more tilde fixes
@
text
@d43 1
@


1.107
log
@revert verbosity removal: pax is now fixed
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.105 2015/09/12 18:03:47 tg Exp $
d179 1
a179 1
	@@dstd='$@@'; dstf=$${dstd%~}; rm -f $@@; \
@


1.106
log
@disable paxtar -v until its bug (writes one byte each time) is fixed
as it trashes my ssh connections like that
@
text
@d145 1
a145 1
#	    (cd dst && cpio -oC512 -Hustar -Mdist) | gzip -n9 >site.tgz.tmp
d156 2
a157 2
	pax -rw -pe hashed dst/
	pax -rw -pe -d ${OBJS:Nstamp_*:S/htm~$/htm/} dst/
d160 1
a160 1
	pax -rw -pe -d $$(<${_i}) dst/
d162 2
a163 2
	cd ${TOP}/.linked && pax -rw -pe ${USELINKED} ${DST}/dst/
	cd ${TOP}/files && pax -rw -pe . ${DST}/dst/
d167 1
a167 1
	cd ${TOP} && pax -rw -pe pics ${DST}/dst/
@


1.105
log
@ok, miros.unixforge.de is back, even if it redirects unconditionally atm and lacks CVSweb
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.102 2015/04/12 19:37:07 tg Exp $
d145 1
a145 1
#	    (cd dst && cpio -voC512 -Hustar -Mdist) | gzip -n9 >site.tgz.tmp
d156 2
a157 2
	pax -rw -pe -v hashed dst/
	pax -rw -pe -dv ${OBJS:Nstamp_*:S/htm~$/htm/} dst/
d160 1
a160 1
	pax -rw -pe -dv $$(<${_i}) dst/
d162 2
a163 2
	cd ${TOP}/.linked && pax -rw -pe -v ${USELINKED} ${DST}/dst/
	cd ${TOP}/files && pax -rw -pe -v . ${DST}/dst/
d167 1
a167 1
	cd ${TOP} && pax -rw -pe -v pics ${DST}/dst/
@


1.104
log
@miros.unixforge.de may be back
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.103 2015/08/27 14:32:53 tg Exp $
d237 1
a237 1
	    make _reinstall && exec make rs-fish rs-eurynome tagslst
@


1.103
log
@heph is gone atm
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.102 2015/04/12 19:37:07 tg Exp $
d221 1
a221 2
	rsync -rxlztpgavPHK dst/ hephaistos:Web/
	ssh hephaistos mv -f Web/.htaccess-heph Web/.htaccess
@


1.102
log
@resort
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.101 2015/04/12 19:36:22 tg Exp $
d238 1
a238 1
	    make _reinstall && exec make rs-fish rs-eurynome rs-heph tagslst
@


1.101
log
@… I forgot the password for the secret door to my CA… again. I give up.
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.100 2014/11/10 22:11:09 tg Exp $
d238 1
a238 1
	    make _reinstall && exec make rs-eurynome rs-fish rs-heph tagslst
@


1.100
log
@• new: validation for files/*.htm (static content)
• several more acronyms from the weekend (Nik, Niklas Bildhauer) and cached
• float-left w/o box CSS class
• add support for xkcd Globalhash, from MirKarte
• link new (unfinished) MirKarte GPX download CGI
• fix BesserCacher stats pasto
• unify style for GD/VX/GeoHashing “cache name”s
• add finds and prospectives
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.99 2014/06/29 13:56:28 tg Exp $
a21 1
SRCS+=		CA.hts
@


1.99
log
@new CGI for returning raw-text wtf and man results
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.98 2014/04/18 22:59:51 tg Exp $
d197 7
@


1.98
log
@protect from empty files
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.97 2014/04/14 20:10:51 tg Exp $
d175 1
a175 1
	chmod a+x dst/cvs.cgi dst/man.cgi dst/wp.cgi dst/wtf.cgi
@


1.97
log
@maybe fix make depend
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.96 2014/04/14 19:29:30 tg Exp $
d160 1
@


1.96
log
@this should allow reading waypoint info (and wlog entries) from a users/ subdir
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.95 2014/04/04 22:20:06 tg Exp $
a49 1
SRCS+=		wptg.hts
d51 1
d90 1
a90 3
OBJS+=		${SRCS:M*.hts:S/hts$/htm~/}
VOBJS+=		${SRCS:M*.hts:S/hts$/val/}
CLEANFILES+=	${SRCS:M*.hts:S/hts$/htm~/}
d92 5
a96 1
DEPSRCS+=	${SRCS:S,^,src/,}
@


1.95
log
@push www to fish, too
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.94 2014/03/30 14:24:36 tg Exp $
d76 1
a76 1
.PATH: ${TOP}/src
@


1.94
log
@migrate FreeWRT-related things here
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.93 2014/03/30 13:04:54 tg Exp $
d203 1
a203 1
	cp-herc cp-heph rs-heph rs-eurynome
d218 3
d229 1
a229 1
	    make _reinstall && exec make rs-eurynome rs-heph tagslst
@


1.93
log
@move my GC banners’n’stuff into a separate page
‣ loads faster
̅‣ less user tracking
‣ it grows
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.92 2014/03/29 12:25:24 tg Exp $
d23 1
@


1.92
log
@make heph usable
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.91 2014/03/29 12:12:52 tg Exp $
d49 1
@


1.91
log
@CA Ⅳ stub
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.90 2014/01/02 22:54:54 tg Exp $
d211 1
@


1.90
log
@add explicit -e to “xmlstarlet val”, needed in newer versions; spotted by my Haustier
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.89 2013/11/06 21:11:43 tg Exp $
d22 1
@


1.89
log
@better tweak
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.88 2013/11/06 21:10:11 tg Exp $
d196 1
a196 1
	@@xmlstarlet val -d ${_xhtmldtd} ${.ALLSRC}
@


1.88
log
@small tweak
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.87 2013/06/23 16:17:08 tg Exp $
d161 1
@


1.87
log
@fix buglets
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.86 2013/06/08 17:31:19 tg Exp $
d159 2
@


1.86
log
@hook up gc statpics and statpages
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.84 2013/01/02 23:02:13 tg Exp $
d166 1
a166 1
	chmod a+x dst/cvs.cgi dst/man.cgi dst/wtf.cgi
@


1.85
log
@infrastructure for geocache stat generation
@
text
@d57 1
a57 1
#WPS=		gecko2 tg
@


1.84
log
@pfau went victim of server consolidation; thanks to Speedpartner for all their good service and cooperation!
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.83 2012/12/20 22:16:09 tg Exp $
d57 1
d108 9
@


1.83
log
@bring back the “event” and “geocache” tag clouds, now I no longer compile on herc but on hugh
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.82 2012/07/15 14:16:41 tg Exp $
d187 1
a187 1
	cp-herc cp-heph rs-heph rs-eurynome rs-pfau
a200 3
rs-pfau:
	rsync -rxlztpgavPHK --rsh='ssh -4' dst/ pfau:/Web/

d209 1
a209 1
	    make _reinstall && exec make rs-eurynome rs-heph rs-pfau tagslst
@


1.82
log
@use the mkah time manipulation code instead of spawning a C helper

\o/

actually, we can now write wlog entries with timezones!
they're mostly ignored for the HTML output, which stupidly takes
the day.month.year for the output (and the d.m.y H:M:S for sorting)
but used in the RSS feed (for sorting – subtracting the time zone
offset appropriately – and the entry date, which shows the original
time zone offset now)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.81 2012/05/19 21:40:11 tg Exp $
d51 2
@


1.81
log
@first draft of a manpage searching CGI
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.80 2012/05/15 20:18:33 tg Exp $
a83 3
STRFTM_MAKE=	cd ${.CURDIR:Q} && ${MAKE} -f ${.SYSMK}/bsd.prog.mk NOMAN=Yes \
		    VPATH=${.CURDIR:Q}/mk PROG=strftm

d100 1
a100 1
stamp_rss_${_i}: ${DEPS_mk_inc2rss} strftm ${DEPS_data_${_i}_cfg}
a109 1
	-${STRFTM_MAKE} clean
a126 3
strftm: mk/strftm.c
	${STRFTM_MAKE} $@@

a205 1
	${STRFTM_MAKE} depend
@


1.80
log
@make wtf.cgi executable, too
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.79 2012/05/15 20:10:09 tg Exp $
d39 1
d161 1
a161 1
	chmod a+x dst/cvs.cgi dst/wtf.cgi
@


1.79
log
@add first experimental draft of a wtf(1) CGI
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.78 2012/05/15 18:42:20 tg Exp $
d160 1
a160 1
	chmod a+x dst/cvs.cgi
@


1.78
log
@add new directory mircvs://www/.linked which contains only symlink(7)s to rcsfile(5)s maintained elsewhere
and copy .linked/acronyms into the dst tree upon installation
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.77 2012/05/07 16:42:27 tg Exp $
d47 1
@


1.77
log
@hook up imprint
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.76 2011/06/06 22:05:48 tg Exp $
d51 1
d150 1
@


1.76
log
@drop almost-unused "event" tag as separate
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.75 2011/06/06 21:36:44 tg Exp $
d32 1
@


1.75
log
@add new tag for RSS: pcli (for planet-commandline.org – hi XTaran)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.74 2011/05/29 17:30:30 tg Exp $
a47 1
TAGCLOUD+=	event
@


1.74
log
@put a website mirror on pfau, since eurynome is currently down (and gecko2@@ who can reboot it EAVAIL), and the mirror on heph seems EAVAIL, and again, only gecko2@@ could fix that
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.73 2011/02/12 23:00:00 bsiegert Exp $
d50 1
@


1.73
log
@Remove overview and fornow page, as they are old, outdated and embarassing
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.72 2011/02/08 22:13:27 bsiegert Exp $
d187 1
a187 1
	cp-herc cp-heph rs-heph rs-eurynome
d201 3
d213 1
a213 1
	    make _reinstall && exec make rs-eurynome rs-heph tagslst
@


1.72
log
@news entry about pkgsrc; also add a new page about pkgsrc support for MirOS,
containing links to the necessary patches.
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.71 2010/05/13 19:04:14 tg Exp $
d55 2
a56 2
		faq.es.hts faq.hts fornow.hts history.hts ipv6-sixxs.hts \
		isdn.hts mirrors.hts mirwarum.hts overview.hts
@


1.71
log
@'make obj' in a chain in a Makefile DOES NOT WORK
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.70 2010/04/09 19:29:16 tg Exp $
d40 1
@


1.70
log
@• remove “RSA Security 1024 V3” root, cf.
  http://groups.google.com/group/mozilla.dev.security.policy/browse_thread/thread/b6493a285ba79998/26fca75f9aeff1dc
• I managed to forget the passphrase for the MirBSD Infrastructure CA, RIP…
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.69 2010/03/27 18:03:34 tg Exp $
d208 2
a209 2
	cd ${.CURDIR} && make obj && make depend && \
	    make && make _reinstall && exec make rs-eurynome rs-heph tagslst
@


1.69
log
@… of course, I had to forget to add it here…
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.68 2010/02/09 15:13:25 tg Exp $
a26 1
SRCS+=		ca.hts
@


1.68
log
@as shown in commitid 1004B38C6D25E238175 for The MirPorts Framework, our BSD make(1) is slightly different from NetBSD®’s…
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.67 2010/01/28 21:05:32 tg Exp $
d38 1
@


1.67
log
@split mksh webpages to reduce size of each
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.66 2010/01/28 17:11:48 tg Exp $
d9 1
a9 1
MAKEFLAGS+=	TOP=${TOP:Q} DST=${DST:Q}
@


1.66
log
@make “make validate=mksh\ mksh_old” work
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.65 2009/12/28 16:50:36 tg Exp $
d38 1
a38 1
SRCS+=		mksh.hts mksh_old.hts
@


1.65
log
@remove, rarely used, to speed things up
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.64 2009/12/28 14:58:04 tg Exp $
d174 6
@


1.64
log
@prevent tags.lst to end up in /usr/src/www ipv /usr/src/www/obj/ upon
first run of "make lazy" by splitting it into a separate target
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.63 2009/12/12 18:30:53 tg Exp $
a47 1
TAGCLOUD+=	geocache
@


1.63
log
@new hosted page: channel webpage for #ksh on freenode (experimental)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.62 2009/12/12 17:14:28 tg Exp $
d204 3
a206 1
	    make && make _reinstall && exec make rs-eurynome rs-heph
@


1.62
log
@say hello to (optional) automatic TOC generation
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.61 2009/11/25 09:14:58 tg Exp $
d35 1
@


1.61
log
@make it so
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.60 2009/11/12 22:41:30 tg Exp $
d161 1
a161 1
	 print -r "( . mk/htsconv; mws_basepath $$dstf; . $< ) >$$dstf"; \
d163 1
a163 1
	    mws_basepath $$dstf; . $<) >$@@; then \
@


1.60
log
@offline validation for *.hts, too (run on bleu, not on herc: slow)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.59 2009/10/31 17:16:17 tg Exp $
d45 1
@


1.59
log
@add ca.hts
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.58 2009/10/31 17:02:36 tg Exp $
d66 9
d82 1
d156 1
a156 1
.SUFFIXES: .htm~ .hts
d169 9
@


1.58
log
@another case of auto-generated text pictures, plus test cases
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.57 2009/10/31 15:54:09 tg Exp $
d27 1
@


1.57
log
@add a test page for data/ stuff
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.56 2009/10/15 16:55:03 tg Exp $
d150 1
a150 1
	 if (export ${U_ENV}; cd ${DST}; . ${TOP}/mk/htsconv; \
@


1.56
log
@add three (empty, for now) more subproject pages, tbf with content
• BSD::arc4random with changelog, links, docs and things
• arc4random.c with changelog; including the klibc implementation
  with different backend (jrand48) but same to-user API
• The RANDEX protocol, available clients and plugins, with changelogs
  for them, to serve as homepages too
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.55 2009/07/27 12:04:55 tg Exp $
d57 2
@


1.55
log
@for-now page for kwalletcli
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.54 2009/07/19 11:28:27 tg Exp $
d22 1
d40 1
@


1.54
log
@merge mail.hts into rss.hts entirely and un-link it
also mention that we don’t inspect content of any eMails sent
via our servers
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.53 2009/06/22 12:17:54 tg Exp $
d33 1
@


1.53
log
@don't tar any more, for now, we use rsync
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.52 2009/06/21 11:20:58 tg Exp $
d50 1
a50 1
		isdn.hts mail.hts mirrors.hts mirwarum.hts overview.hts
@


1.52
log
@Take care of the new hashed/ directory
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.51 2009/04/23 18:13:49 tg Exp $
d61 1
a61 1
install: site.tgz
d96 1
a96 1
	-rm -f ${CLEANFILES} site.tgz *.tmp *~
d103 1
a103 1
	-rm -rf dst site.tgz
d112 5
a116 4
site.tgz: _reinstall
	find dst | sort | sed -e '/^dst$$/d' -e 's,^dst/,,' | \
	    (cd dst && cpio -voC512 -Hustar -Mdist) | gzip -n9 >$@@.tmp
	mv $@@.tmp $@@
d156 5
a160 5
cp-herc: site.tgz
	ssh hercs 'cd /var/www/oldsite; tar xzvf -' <site.tgz

cp-heph: site.tgz
	ssh hephaistos 'cd Web; tar xzvpf -' <site.tgz
@


1.51
log
@better
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.50 2009/04/23 18:13:02 tg Exp $
d99 1
d124 1
@


1.50
log
@new tags.lst
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.49 2009/02/16 21:48:34 tg Exp $
d175 2
a176 2
	@@echo === TAGS USED/UNUSED/ACCOUNTED FOR ==; cat stamp_tag_* | \
	    sort -u | comm - tags.out | tee tags.lst
@


1.49
log
@cosmetic oops
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.48 2009/02/16 21:42:11 tg Exp $
d40 1
a40 1
CLEANFILES+=	tags.out
d176 1
a176 1
	    sort -u | comm - tags.out
@


1.48
log
@introduce canonical URIs, as per http://www.golem.de/0902/65259.html
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.47 2009/01/21 13:11:53 tg Exp $
d141 1
a141 1
	 print '( . mk/htsconv; mws_basepath $$dstf; . $< ) >'$$dstf; \
@


1.47
log
@… and one more “tag cloud” inhabitant

PS: we could even aggregate… rss2inc or something.
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.46 2009/01/14 19:43:18 tg Exp $
d141 3
a143 3
	 print '( . mk/htsconv; . $< ) >'$$dstf; \
	 if (export ${U_ENV}; cd ${DST}; . ${TOP}/mk/htsconv; . $<) \
	    >$@@; then \
@


1.46
log
@order mirrors
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.45 2008/12/24 11:53:53 tg Exp $
d42 1
@


1.45
log
@emphasise events more; we need more PR, people!
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.44 2008/12/07 17:10:38 tg Exp $
d173 1
a173 1
	    make && make _reinstall && exec make rs-heph rs-eurynome
@


1.44
log
@remove -static for now
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.43 2008/12/04 20:33:02 tg Exp $
d41 2
a42 1
TAGCLOUD=	mksh
@


1.43
log
@sync CLEANFILES and fix cleandir target
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.42 2008/12/04 20:31:32 tg Exp $
d62 1
a62 1
		    VPATH=${.CURDIR:Q}/mk PROG=strftm LDSTATIC=-static
@


1.42
log
@do tag accounting
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.41 2008/12/04 20:27:10 tg Exp $
d40 1
d97 1
a97 1
	-rm -f .depend
@


1.41
log
@add a collected tag cloud
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.40 2008/12/04 19:51:00 tg Exp $
d172 2
a173 1
	@@echo === TAGS USED ==; cat stamp_tag_* | sort -u | sed 's/^/| /'
@


1.40
log
@fix cleanfiles
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.39 2008/12/04 19:38:12 tg Exp $
d39 1
@


1.39
log
@introduce the "tag cloud" with a first entry (mksh)
others welcome (pcc security event bug ...)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.38 2008/12/04 13:45:45 tg Exp $
d72 1
@


1.38
log
@emit tag list; rss proper media type, tags as categories, permalink as guid
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.37 2008/12/04 12:40:53 tg Exp $
d39 1
d67 1
@


1.37
log
@* fix wlog-10 being confused about being wlog-9
* use automatic dependency generation for htm+rss sources
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.36 2008/11/08 16:28:45 tg Exp $
d168 1
@


1.36
log
@use a C tool (statically linked for speed) instead of perl for calculating
the RSS time stamps, because this is much faster (and brings back dst info)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.35 2008/11/08 15:37:42 tg Exp $
d68 1
d71 1
a71 2
stamp_htm_${_i}: ${DEPS_mk_inc2htm} \
    ${TOP}/data/${_i}.inc ${TOP}/data/${_i}.cfg
d74 1
a74 2
stamp_rss_${_i}: ${DEPS_mk_inc2rss} strftm \
    ${TOP}/data/${_i}.inc ${TOP}/data/${_i}.cfg
d78 1
@


1.35
log
@add rsync commands for a website mirror at eurynome
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.34 2008/10/05 16:26:20 tg Exp $
d58 3
d72 1
a72 1
	${U_ENV} ${MKSH} ${TOP}/mk/inc2htm ${_i} >$@@
d74 1
a74 1
stamp_rss_${_i}: ${DEPS_mk_inc2rss} \
d76 2
a77 1
	${U_ENV} ${MKSH} ${TOP}/mk/inc2rss ${_i} >$@@
d84 1
d101 3
d161 2
@


1.34
log
@use mksh realpath builtin instead of readlink -f for canonicalisation

note: there’s still a readlink(1) call left in, for instance, mirmake;
this does not hurt because we initially assumed that readlink(1) does
exist anyway and bundled ours just because some do not have the ‘-f’
option for realpath(2)isation
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.33 2008/09/19 07:29:48 tg Exp $
d118 2
a119 1
	chmod -R u=rwX,go=rX dst
d136 1
a136 1
	cp-herc cp-heph rs-heph
d147 3
d157 1
a157 1
	    make && make _reinstall && exec make rs-heph
@


1.33
log
@do a symlink for wlog-LATEST.htm too, not just rss
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.32 2008/09/17 21:52:04 tg Exp $
d7 2
a8 2
TOP!=		readlink -nf ${.CURDIR:Q}
DST!=		readlink -nf ${.OBJDIR:Q}
@


1.32
log
@• ensure UTC
• calculate things only when needed
• fold calculations many-into-one
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.31 2008/09/17 21:21:37 tg Exp $
d115 1
@


1.31
log
@retire getdate
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.30 2008/09/17 21:12:01 tg Exp $
d20 1
a20 1
U_ENV+=		TOP=${TOP:Q} DST=${DST:Q} MKSH=${MKSH:Q} SHELL=${MKSH:Q}
@


1.30
log
@retire PHP
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.29 2008/06/28 20:42:44 bsiegert Exp $
d67 1
a67 1
stamp_htm_${_i}: getdate ${DEPS_mk_inc2htm} \
d71 1
a71 1
stamp_rss_${_i}: getdate ${DEPS_mk_inc2rss} \
a95 4
CLEANFILES+=	getdate
getdate: ${TOP}/mk/getdate.c ${TOP}/mk/getdate.h ${TOP}/mk/gettime.c
	${LINK.c} ${COPTS} -I${TOP}/mk -DTEST -DIN_RCS -o $@@ ${.ALLSRC:N*.h}

@


1.29
log
@Move /?about, the last page from the old site in the index on the left,
to the new format. While here, fucking fix the HTML.
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.28 2008/05/29 16:01:07 bsiegert Exp $
d23 1
d41 8
a115 1
	cd ${TOP} && pax -rw -pe -v content ${DST}/dst/		# legacy
@


1.28
log
@CSS: Increase min-height to sensible value (500px)

Move RSS feeds away from the home page into their own page, aptly called
"RSS feeds". Heavy refactoring of content while here.
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.27 2008/05/03 01:44:04 tg Exp $
d22 1
@


1.27
log
@uninclude some more, there is no content/*.index any more anyway
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.26 2008/03/27 21:46:33 tg Exp $
d36 1
@


1.26
log
@improve dependencies
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.25 2008/03/22 20:38:16 tg Exp $
a104 1
	cd ${TOP}/legacy && pax -rw -pe -v . ${DST}/dst/	# legacy
@


1.25
log
@add new files
• changelog for #11 (i.e. past #10, until we release)
  → helps writing release announcements and flyers ☻☺
  ‣ empty at the moment
• errata for #10
  ‣ populated with MIRBSD_10 branch info already
both are not yet linked anywhere tho
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.24 2008/03/15 23:41:48 tg Exp $
d47 2
a48 2
OBJS+=		${SRCS:M*.hts:S/hts$/htm/}
CLEANFILES+=	${SRCS:M*.hts:S/hts$/htm/}
d101 1
a101 1
	pax -rw -pe -dv ${OBJS:Nstamp_*} dst/
d115 1
a115 1
.SUFFIXES: .htm .hts
d117 10
a126 6
.hts.htm:
	@@rm -f $@@.tmp
	@@print '( . mk/htsconv; . $< ) >$@@'
	@@(export ${U_ENV}; cd ${DST}; . ${TOP}/mk/htsconv; . $<) >$@@.tmp || \
	    (rm -f $@@.tmp; exit 1)
	@@(. ${TOP}/mk/htsconv; mws_moveifchange $@@.tmp $@@)
@


1.24
log
@• nuke old Wiki pages
• convert /?bt
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.23 2008/03/14 21:13:05 tg Exp $
d24 1
d27 1
@


1.23
log
@switch to marc.info and wlog-10 etc.
I'm as good as done
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.21 2008/02/28 18:54:07 tg Exp $
d23 1
@


1.22
log
@new wlog feed: wlog.rss@@ → wlog-9.rss (later: wlog-10.rss)
I hope the readers get that…
@
text
@d22 3
a24 1
SRCS+=		danke.hts devel.hts
d30 1
d33 1
a33 1
WLOGS=		9
@


1.21
log
@link the ports page (still needs work), add some text and a wlog
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.20 2008/02/22 22:09:11 tg Exp $
d88 4
d103 3
a105 1
	cd dst && rm -rf $$(find . -name CVS -o -name .cvsignore)
@


1.20
log
@fix
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.19 2008/02/22 21:49:30 tg Exp $
d28 1
@


1.19
log
@the big strength of make(1) is the splitting in small jobs
this benefits -j too
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.18 2008/01/19 22:12:52 bsiegert Exp $
d32 1
a32 1
news.cut: stamp_news
@


1.18
log
@Build RSS files during website build
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.17 2007/09/30 19:33:49 tg Exp $
d47 1
a47 1
GENSRCS+=	stamp_${_i}
d49 1
a49 1
stamp_${_i}: getdate ${DEPS_mk_inc2htm} ${DEPS_mk_inc2rss} \
d52 4
a55 1
	${U_ENV} ${MKSH} ${TOP}/mk/inc2rss ${_i} >>$@@
d107 1
a107 1
	(export ${U_ENV}; cd ${DST}; . ${TOP}/mk/htsconv; . $<) >$@@.tmp || \
@


1.17
log
@convert /?devel and add missing freeforge (from old irc page)
any more missings? esp. from mksh page?
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.16 2007/09/28 13:42:28 tg Exp $
d49 1
a49 1
stamp_${_i}: getdate ${DEPS_mk_inc2htm} \
d52 1
d54 1
a54 1
DEPSRCS+=	mk/inc2htm
d104 1
a104 1
	@@(export ${U_ENV}; cd ${DST}; . ${TOP}/mk/htsconv; . $<) >$@@.tmp || \
@


1.16
log
@convert the jupp page (sort of)
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.15 2007/08/30 09:37:12 tg Exp $
d22 1
a22 1
SRCS+=		danke.hts
@


1.15
log
@benz wanted me to merge this page too, I should probably nuke the old
wishlist and convert the devel page, merge the list of donators and
maybe the wishlist here looks more sensible even
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.14 2007/08/29 19:53:34 tg Exp $
d22 7
a28 2
SRCS+=		danke.hts getting.hts irc.hts main.hts mksh.hts mksh_old.hts \
		projects.hts
@


1.14
log
@move IRC info to the new framework
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.13 2007/08/28 19:23:42 bsiegert Exp $
d22 2
a23 1
SRCS+=		getting.hts irc.hts main.hts mksh.hts mksh_old.hts projects.hts
@


1.13
log
@Move getting and projects over to the new website
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.11 2007/08/09 19:14:55 tg Exp $
d22 1
a22 1
SRCS+=		main.hts mksh.hts mksh_old.hts getting.hts projects.hts
@


1.12
log
@Port infrastructure to Mac OS, which does not have clock_gettime. Pull in
one more file from the CVS source for this.
@
text
@d22 1
a22 1
SRCS+=		main.hts mksh.hts mksh_old.hts
@


1.11
log
@try to make regeneration of pages sparely (i.e. don't change if no change)
news.htm is slightly buggily always regenerated, no idea why
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.10 2007/08/05 23:23:22 tg Exp $
d69 1
a69 1
getdate: ${TOP}/mk/getdate.c ${TOP}/mk/getdate.h
@


1.10
log
@deps
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.9 2007/07/23 14:39:36 tg Exp $
d56 1
a56 1
	-rm -f ${CLEANFILES} site.tgz *.tmp
d95 1
a95 1
	@@rm -f $@@{,.tmp}
d99 1
a99 1
	@@mv -f $@@.tmp $@@
@


1.9
log
@• split off most of the pre-R30 stuff, more to follow
• prepare for the “mksh news beat”
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.8 2007/07/05 23:21:49 tg Exp $
d69 2
a70 2
getdate: ${TOP}/mk/getdate.c
	${LINK.c} ${COPTS} -I${TOP}/mk -DTEST -DIN_RCS -o $@@ ${.ALLSRC}
@


1.8
log
@be even lazier
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.7 2007/07/01 22:07:09 tg Exp $
d22 1
a22 1
SRCS+=		main.hts mksh.hts
@


1.7
log
@retain timestamps, for less rsync traffic
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.6 2007/06/22 23:37:29 tg Exp $
d72 7
a78 2
site.tgz:
	-rm -rf dst $@@
a90 3
	find dst | sort | sed -e '/^dst$$/d' -e 's,^dst/,,' | \
	    (cd dst && cpio -voC512 -Hustar -Mdist) | gzip -n9 >$@@.tmp
	mv $@@.tmp $@@
d101 2
a102 1
.PHONY: clean cleandir depend install deinstall reinstall cp-herc cp-heph rs-heph
d110 1
a110 1
rs-heph: site.tgz
d120 1
a120 1
	    make && make reinstall && exec make rs-heph
@


1.6
log
@• news.inc: I'll always forget that…
• Makefile: rsync is faster, much faster…
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.5 2007/06/21 16:14:22 tg Exp $
d75 1
a75 1
	cp ${OBJS:Nstamp_*} dst/
@


1.5
log
@ugh...
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.4 2007/06/21 16:13:50 tg Exp $
d117 1
a117 1
	    make && make reinstall && exec make cp-heph
@


1.4
log
@I'm lazy
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.3 2007/06/10 00:02:35 tg Exp $
d116 2
a117 1
	make obj && make depend && make && make reinstall && exec make cp-heph
@


1.3
log
@• Makefile: .PHONY
• news: this was not valid xhtml *sigh*
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.2 2007/06/09 23:59:27 tg Exp $
d115 3
@


1.2
log
@new target: rsync i.p.v. ssh
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.1 2007/06/09 23:29:42 tg Exp $
d99 1
a99 1
.PHONY: clean cleandir depend install deinstall reinstall cp-herc cp-heph
@


1.1
log
@switch to the new website system, keeping legacy content around
@
text
@d1 1
a1 1
# $MirOS: www/Makefile,v 1.11 2007/06/09 23:23:40 tg Exp $
d107 3
@

