head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2018.05.05.17.40.38;	author tg;	state dead;
branches;
next	1.5;
commitid	1005AEDEC757B8FE8AE;

1.5
date	2018.04.26.19.38.12;	author tg;	state Exp;
branches;
next	1.4;
commitid	1005AE22A317C1B57A3;

1.4
date	2014.08.16.20.19.54;	author tg;	state Exp;
branches;
next	1.3;
commitid	10053EFBCE875D80464;

1.3
date	2014.04.14.20.03.25;	author tg;	state Exp;
branches;
next	1.2;
commitid	100534C3F20711F7258;

1.2
date	2014.04.14.19.38.19;	author tg;	state Exp;
branches;
next	1.1;
commitid	100534C39316C97D3C2;

1.1
date	2014.04.14.19.29.42;	author tg;	state Exp;
branches;
next	;
commitid	100534C3730417ACF22;


desc
@@


1.6
log
@consolidate users/ subdirectory; I think this is as good as I get

also, do not use -nn any more, stop using Author: in .inc files,
change some MirOS/MirSolutions to MirBSD
@
text
@# $MirOS: www/users/tg/Makefile,v 1.5 2018/04/26 19:38:12 tg Exp $
#-
# This file is part of the website of The MirOS Project, which is
# copyrighted material, please read the LICENCE file for details.

.ifndef TOP
TOP!=		realpath ${.CURDIR:Q}/../..
DST!=		realpath ${.OBJDIR:Q}/../..
.MAKEFLAGS:=	${.MAKEFLAGS} TOP=${TOP:Q} DST=${DST:Q}
.endif

U_ENV+=		TOP=${TOP:Q} DST=${DST:Q} MKSH=${MKSH:Q} SHELL=${MKSH:Q} TZ=UTC

FILES!=		cd ${.CURDIR} && print -r -- *.inc
_inc2xhtml=	( (print '\n----'; sed -e '/^\#/d' -e '/^RCSID: \$$/d') | \
		    tr '\n' '' | sed \
		    -e 'sg' \
		    -e 's----g' \
		    -e 's\([^]*\)\1g' \
		    -e 's\([^]*\)\1g' \
		    -e 's\([^]*\)*[Tt][Ii][Tt][Ll][Ee]:[	 ]*\([^]*\)\([^]*\)\{0,1\}</div><h2><a href="/">\2</a></h2><div>g' \
		    -e 's[^]*</div><div>g' \
		    -e 's^</div>'${_xhtmlbeg:Q}'' \
		    -e 's$$</div>'${_xhtmlend:Q}'' \
		    -e 's<><error><>g' \
		    -e 'sg' \
		    | \
		tr '' '\n')
_xhtmldtd=	${TOP}/files/xhtml11.dtd
_xhtmlbeg=	<?xml version="1.0"?> \
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" \
		 "file://${_xhtmldtd}"> \
		<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> \
		<head> \
		 <title>XHTML page</title> \
		</head><body>
_xhtmlend=	</body></html>

all: validations

.SUFFIXES: .xml .inc

.inc.xml:
	@@print -r Creating ${@@:Q} from ${<:Q} ...
	@@${_inc2xhtml} <$< >$@@

validations: xmlcheck wpcheck validation

xmlcheck: .PHONY
	cd ${TOP} && ${MAKE} validate="$$(cd ${.CURDIR:Q} && \
	    for x in *.hts; do \
		[[ -e $$x ]] && print -r -- "$${x%%.hts}"; \
	done)"

wpcheck:
	@@cd ${TOP}/data && ${MAKE} $@@ WPS=tg.gc

validation: .PHONY ${FILES:.inc=.xml}
	@@print -r Validating ${FILES:Q} ...
	@@xmlstarlet val -d ${_xhtmldtd} -e ${.ALLSRC}
	@@print '\nValidation complete.'

.ifdef validate
root_validation:
	@@cd ${TOP} && ${MAKE} validate=${validate:Q}
.MAIN: root_validation
.endif

.include <bsd.obj.mk>
@


1.5
log
@• move www/mk/xhtml11.dtd,v to www/files/xhtml11.dtd,v
• apply bugfixes from the second revision of W3C’s XHTML/1.1
  (carefully, sans new bugs and without the XML feature creep)
  retaining the FPU as it’s still a valid version of the standard
• use our local copy of this file, as it’s known to be stable
• reference a debbugs issue with an alternative licence grant, for if needed
• © for xhtml11.dtd moves from www/LICENCE to www/files/LICENCE accordingly
@
text
@d1 1
a1 1
# $MirOS: www/users/tg/Makefile,v 1.4 2014/08/16 20:19:54 tg Exp $
@


1.4
log
@IGCD Summer Feast
@
text
@d1 1
a1 1
# $MirOS: www/users/tg/Makefile,v 1.3 2014/04/14 20:03:25 tg Exp $
d29 1
a29 1
_xhtmldtd=	${TOP}/mk/xhtml11.dtd
@


1.3
log
@permit validation in this subdir
@
text
@d1 1
a1 1
# $MirOS: www/users/tg/Makefile,v 1.2 2014/04/14 19:38:19 tg Exp $
d47 7
a53 1
validations: wpcheck validation
@


1.2
log
@check WPs too
@
text
@d1 1
a1 1
# $MirOS: www/users/tg/Makefile,v 1.1 2014/04/14 19:29:42 tg Exp $
d57 6
@


1.1
log
@this should allow reading waypoint info (and wlog entries) from a users/ subdir
@
text
@d1 1
a1 1
# $MirOS: www/data/Makefile,v 1.11 2014/01/02 22:54:55 tg Exp $
d39 1
a39 1
all: validation
d47 5
@

