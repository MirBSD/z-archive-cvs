head	1.39;
access;
symbols
	tg-mirmake-dev_BASE:1.24
	tg-mirmake-dev:1.24.0.2
	mirbsd:1.1.7;
locks; strict;
comment	@# @;


1.39
date	2014.12.20.22.35.51;	author tg;	state Exp;
branches;
next	1.38;
commitid	1005495F9DD74E22D36;

1.38
date	2014.12.20.22.32.59;	author tg;	state Exp;
branches;
next	1.37;
commitid	1005495F92C5497A12B;

1.37
date	2014.12.20.22.12.16;	author tg;	state Exp;
branches;
next	1.36;
commitid	1005495F45834CE1BDB;

1.36
date	2014.12.20.21.44.19;	author tg;	state Exp;
branches;
next	1.35;
commitid	1005495EDC70A6E07C4;

1.35
date	2014.11.16.12.16.25;	author tg;	state Exp;
branches;
next	1.34;
commitid	100546895A24DE6792D;

1.34
date	2013.11.30.13.45.19;	author tg;	state Exp;
branches;
next	1.33;
commitid	1005299EBBC46543D75;

1.33
date	2009.11.09.22.40.59;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004AF89A832AF9327C;

1.32
date	2008.10.12.18.04.28;	author tg;	state Exp;
branches;
next	1.31;
commitid	10048F23C3813584639;

1.31
date	2008.10.12.17.56.25;	author tg;	state Exp;
branches;
next	1.30;
commitid	10048F23A5D008A2D9A;

1.30
date	2008.10.12.17.43.50;	author tg;	state Exp;
branches;
next	1.29;
commitid	10048F2376912E579C6;

1.29
date	2008.07.11.11.34.27;	author tg;	state Exp;
branches;
next	1.28;
commitid	100487745536D7BF2C3;

1.28
date	2008.04.06.22.48.19;	author tg;	state Exp;
branches;
next	1.27;
commitid	10047F95344756F123A;

1.27
date	2008.03.12.23.51.18;	author tg;	state Exp;
branches;
next	1.26;
commitid	10047D86C8344DDBCC6;

1.26
date	2008.03.09.14.16.07;	author tg;	state Exp;
branches;
next	1.25;
commitid	10047D3F13463609C08;

1.25
date	2006.10.13.16.41.47;	author tg;	state Exp;
branches;
next	1.24;
commitid	100452FC1E1409E7210;

1.24
date	2006.08.26.22.46.44;	author tg;	state Exp;
branches;
next	1.23;
commitid	10044F0CF6A4E28F290;

1.23
date	2005.12.17.05.46.09;	author tg;	state Exp;
branches;
next	1.22;
commitid	10043A3A3E65E20A413;

1.22
date	2005.11.24.14.01.26;	author tg;	state Exp;
branches;
next	1.21;
commitid	3b804385c7c93124;

1.21
date	2005.11.24.11.07.43;	author tg;	state Exp;
branches;
next	1.20;
commitid	606d43859f0ac8a0;

1.20
date	2005.11.19.12.39.19;	author tg;	state Exp;
branches;
next	1.19;
commitid	7409437f1d038178;

1.19
date	2005.11.19.12.37.00;	author tg;	state Exp;
branches;
next	1.18;
commitid	56e9437f1c7771f4;

1.18
date	2005.09.18.20.19.13;	author tg;	state Exp;
branches;
next	1.17;
commitid	6b6432dcbcbe367;

1.17
date	2005.09.01.22.27.33;	author tg;	state Exp;
branches;
next	1.16;
commitid	328243178058062c;

1.16
date	2005.07.12.11.18.13;	author tg;	state Exp;
branches;
next	1.15;
commitid	4c3142d3a707becb;

1.15
date	2005.06.09.22.12.12;	author tg;	state Exp;
branches;
next	1.14;
commitid	6e2c42a8be8765a4;

1.14
date	2005.06.09.22.06.16;	author tg;	state Exp;
branches;
next	1.12;
commitid	4e3a42a8bd6a8228;

1.12
date	2005.06.09.21.57.46;	author tg;	state Exp;
branches;
next	1.11;
commitid	6e3942a8bb6aa9de;

1.11
date	2005.06.09.21.51.57;	author tg;	state Exp;
branches;
next	1.10;
commitid	71fa42a8ba0c964e;

1.10
date	2005.06.02.23.13.46;	author tg;	state Exp;
branches;
next	1.9;
commitid	3453429f92bc70ee;

1.9
date	2005.06.02.23.11.27;	author tg;	state Exp;
branches;
next	1.8;
commitid	616a429f92313881;

1.8
date	2005.06.02.22.58.18;	author tg;	state Exp;
branches;
next	1.7;
commitid	7b16429f8f0a160a;

1.7
date	2005.05.25.23.50.31;	author tg;	state Exp;
branches;
next	1.6;
commitid	715c42950f4ccef2;

1.6
date	2005.05.20.23.18.34;	author tg;	state Exp;
branches;
next	1.5;
commitid	2c1e428e704d6564;

1.5
date	2005.05.20.22.50.41;	author tg;	state Exp;
branches;
next	1.4;
commitid	152d428e69d0f634;

1.4
date	2005.04.12.10.26.38;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.02.28.21.43.15;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.26.13.53.24;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.02.36.15;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.02.05.02.36.15;	author tg;	state Exp;
branches;
next	;


desc
@@


1.39
log
@make directly usable ustar
@
text
@#!/bin/sh
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.38 2014/12/20 22:32:59 tg Exp $

wd=$(realpath "$0/..")
version=$(date +%Y%m%d)
echo version=$version >$wd/Version.sh

cd $wd/..
rm -rf src
cvs -Rqd ${CVSROOT:-/cvs} co -PA \
    contrib/code/Snippets/arc4random.c \
    contrib/gnu/config/config.guess \
    src/kern/include/md5.h \
    src/usr.bin/lndir src/usr.bin/xinstall \
    src/usr.bin/make src/usr.bin/mkdep src/usr.bin/lorder \
    src/usr.bin/tsort \
    src/include/getopt.h src/include/ohash.h src/include/sysexits.h \
    src/include/stdbool.h \
    src/include/adler32.h src/include/md4.h \
    src/include/rmd160.h src/include/sfv.h src/include/sha1.h \
    src/include/sha2.h src/include/suma.h src/include/tiger.h \
    src/include/whirlpool.h src/kern/include/libckern.h \
    src/kern/c/miscdata.c src/kern/c/strlfun.c \
    src/lib/libc/hash src/lib/libc/ohash \
    src/lib/libc/stdio/asprintf.c src/lib/libc/stdio/vasprintf.c \
    src/lib/libc/stdio/mktemp.c \
    src/lib/libc/stdlib/getopt_long.c src/lib/libc/stdlib/strtoll.c \
    src/share/mk/bsd.cfwrap.mk src/share/mk/bsd.dep.mk \
    src/share/mk/bsd.doc.mk src/share/mk/bsd.lib.mk \
    src/share/mk/bsd.lt.mk src/share/mk/bsd.man.mk \
    src/share/mk/bsd.obj.mk src/share/mk/bsd.own.mk \
    src/share/mk/bsd.prog.mk src/share/mk/bsd.subdir.mk \
    src/share/mk/bsd.sys.mk src/share/mk/sys.mk
mv src/kern/include/md5.h src/include/
cvs -Rqd ${CVSROOT:-/cvs} co -r1.15 src/bin/mksh/setmode.c
top=$(dirname $(pwd))
topd=$(dirname $top)
topf=$(basename $top)
cd $topd
find $topf -type f | xargs chmod 644
find $topf -type f ! -path \*CVS\* | sort | cpio -oC512 -Hustar -Mdist | \
    gzip -n9 >mirmake_$version.orig.tar.gz
[ -n "$DEBUG" ] || rm -rf $wd/../src $wd/Version.sh $wd/../contrib/gnu
@


1.38
log
@adjust for miscdata.c move
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.37 2014/12/20 22:12:16 tg Exp $
d41 2
a42 2
find $topf -type f ! -path \*CVS\* | sort | cpio -oHdist \
    | gzip -n9 >mirmake-$version.cpio.gz
@


1.37
log
@oops…
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.36 2014/12/20 21:44:19 tg Exp $
d23 1
a23 1
    src/kern/c/strlfun.c \
@


1.36
log
@accomodate for files moved
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.35 2014/11/16 12:16:25 tg Exp $
a34 1
rm -r src/kern
@


1.35
log
@mydir=$(realpath "$0/..") # mksh is cool like that, no dirname needed
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.34 2013/11/30 13:45:19 tg Exp $
d13 1
a13 1
    src/bin/mksh/setmode.c \
d19 1
a19 1
    src/include/adler32.h src/include/md4.h src/include/md5.h \
d34 3
@


1.34
log
@$(dirname "$(realpath "$0")") allows users to symlink-install scripts
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.33 2009/11/09 22:40:59 tg Exp $
d4 1
a4 1
wd=$(dirname "$(realpath "$0")")
@


1.33
log
@use Snippets/arc4random.c here, too (but don’t expose uniform/buf FNs)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.32 2008/10/12 18:04:28 tg Exp $
d4 1
a4 1
wd=$(realpath $(dirname $0))
@


1.32
log
@we need libckern.h now, too
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.31 2008/10/12 17:56:25 tg Exp $
d11 1
@


1.31
log
@strlfun.c has moved
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.30 2008/10/12 17:43:50 tg Exp $
d21 1
a21 1
    src/include/whirlpool.h \
@


1.30
log
@sync list of *.mk files
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.29 2008/07/11 11:34:27 tg Exp $
d22 1
a26 1
    src/lib/libc/string/strlfun.c \
@


1.29
log
@no need to build'n'bundle readlink(1) any more
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.28 2008/04/06 22:48:19 tg Exp $
d27 6
a32 4
    src/share/mk/bsd.cfwrap.mk \
    src/share/mk/bsd.sys.mk src/share/mk/bsd.dep.mk src/share/mk/bsd.lib.mk \
    src/share/mk/bsd.man.mk src/share/mk/bsd.obj.mk src/share/mk/bsd.own.mk \
    src/share/mk/bsd.prog.mk src/share/mk/bsd.subdir.mk src/share/mk/sys.mk
@


1.28
log
@to always use UCB tools can be annoying…
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.27 2008/03/12 23:51:18 tg Exp $
d4 1
a4 1
wd=$(readlink -f $(dirname $0))
d15 1
a15 1
    src/usr.bin/readlink src/usr.bin/tsort \
@


1.27
log
@pull lndir(1), _with_ manpage
XXX to be added to Build.sh
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.26 2008/03/09 14:16:07 tg Exp $
d12 1
@


1.26
log
@provide the other hashes too (sfv, suma, whirlpool)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.25 2006/10/13 16:41:47 tg Exp $
d12 1
d14 1
a14 1
    src/usr.bin/readlink src/usr.bin/tsort src/usr.bin/xinstall \
@


1.25
log
@tiger
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.24 2006/08/26 22:46:44 tg Exp $
a14 2
    src/include/md4.h src/include/md5.h src/include/rmd160.h \
    src/include/sha1.h src/include/sha2.h src/include/tiger.h \
d16 4
@


1.24
log
@modernize, rewrite
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.23 2005/12/17 05:46:09 tg Exp $
d16 2
a17 1
    src/include/sha1.h src/include/sha2.h src/include/stdbool.h \
@


1.23
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d2 1
a2 24
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.22 2005/11/24 14:01:26 tg Exp $
#-
# Copyright (c) 2004, 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
#
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
#
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a nontrivial bug.
d16 1
a16 1
    src/include/sha1.h src/include/sha2.h \
@


1.22
log
@be nicer
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.21 2005/11/24 11:07:43 tg Exp $
d14 12
a25 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
@


1.21
log
@instead of doing weird sudo tricks, use cpio -oHdist (new)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.20 2005/11/19 12:39:19 tg Exp $
d51 1
a51 1
[ -n "$DEBUG" ] || rm -rf $wd/../src $wd/Version.sh
@


1.20
log
@chown only what gets packed
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.19 2005/11/19 12:37:00 tg Exp $
d49 1
a49 2
find $topf -type f | xargs ${SUDO-sudo} chown -R 0:0
find $topf -type f ! -path \*CVS\* | sort | cpio -oC512 \
@


1.19
log
@fix permissions and ownership for the archive automagically
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.18 2005/09/18 20:19:13 tg Exp $
d49 1
a49 1
${SUDO-sudo} chown -R 0:0 $topf
@


1.18
log
@these contributed files can now be pulled from base
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.17 2005/09/01 22:27:33 tg Exp $
d48 2
@


1.17
log
@* include GNU config.guess
* call GNU config.guess; provide appropriate ${OStriplet} default
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.16 2005/07/12 11:18:13 tg Exp $
d36 4
a39 1
    src/lib/libc/stdlib/getopt_long.c src/lib/libc/string/strlfun.c \
@


1.16
log
@no reason NOT to install <bsd.cfwrap.mk> it's cool
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.15 2005/06/09 22:12:12 tg Exp $
d29 1
@


1.15
log
@GNA, obviously,
	wd=$(dirname $0)
will yield a "." and we won't write
	wd=$(cd $(dirname $0); pwd)
because that can be a major fuckup too, so settle down at
	wd=$(readlink -f $(dirname $0))
and yes I know I could use mksh cutters for that, thanks a lot

I tend, more and more, to make realpath(3) an mksh builtin.
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.14 2005/06/09 22:06:16 tg Exp $
d36 1
@


1.14
log
@fix deleting glitch (directories, and so)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.12 2005/06/09 21:57:46 tg Exp $
d22 1
a22 1
wd=$(dirname $0)
@


1.12
log
@distribute mirmake version alongside
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.11 2005/06/09 21:51:57 tg Exp $
d22 1
d24 1
a24 1
echo version=$version >$(dirname $0)/Version.sh
d26 1
a26 1
cd $(dirname $0)/..
d45 1
a45 1
[ -n "$DEBUG" ] || rm -rf $top/src $(dirname $0)/Version.sh
@


1.11
log
@cpio(1) defaults to "The" cpio format
@
text
@d1 2
a2 2
#!/bin/mksh
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.10 2005/06/02 23:13:46 tg Exp $
d22 3
d43 2
a44 1
    | gzip -n9 >mirmake-$(date +%Y%m%d).cpio.gz
@


1.10
log
@same for mkdep(1), oopsie
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.9 2005/06/02 23:11:27 tg Exp $
d39 1
a39 1
find $topf -type f ! -path \*CVS\* | sort | cpio -oC512 -Hcpio \
@


1.9
log
@missed lorder(1) man page
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.8 2005/06/02 22:58:18 tg Exp $
d25 1
a25 1
    src/usr.bin/make src/usr.bin/mkdep/mkdep.sh src/usr.bin/lorder \
@


1.8
log
@add mktemp (from ports/infrastructure/install/) and xinstall
only used on Interix because their base is such a shit
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.7 2005/05/25 23:50:31 tg Exp $
d25 1
a25 1
    src/usr.bin/make src/usr.bin/mkdep/mkdep.sh src/usr.bin/lorder/lorder.sh \
@


1.7
log
@mksh is pretty mature; switch most of contrib/ to it
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.6 2005/05/20 23:18:34 tg Exp $
d25 2
a26 2
    src/usr.bin/make src/usr.bin/mkdep/mkdep.sh src/lib/libc/ohash \
    src/usr.bin/lorder/lorder.sh src/usr.bin/readlink src/usr.bin/tsort \
d29 2
a30 1
    src/include/sha1.h src/include/sha2.h src/lib/libc/hash \
@


1.6
log
@we also need readlink(1), it's being used
extensively recently as realpath(3) frontend
@
text
@d1 2
a2 2
#!/bin/ksh
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.5 2005/05/20 22:50:41 tg Exp $
@


1.5
log
@we need "lorder" at least on Interix
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.4 2005/04/12 10:26:38 tg Exp $
d26 1
a26 1
    src/usr.bin/lorder/lorder.sh src/usr.bin/tsort \
@


1.4
log
@Interix doesn't have <sysexits.h>
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.3 2005/02/28 21:43:15 tg Exp $
d26 2
a27 2
    src/usr.bin/tsort src/include/getopt.h src/include/ohash.h \
    src/include/sysexits.h \
@


1.3
log
@amend MirMake by tsort
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.2 2005/02/26 13:53:24 tg Exp $
d27 1
@


1.2
log
@experimental: copy the hashes, too
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/dist/scripts/Copy.sh,v 1.1.7.1 2005/02/05 02:36:15 tg Exp $
d26 1
a26 1
    src/include/getopt.h src/include/ohash.h \
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $MirOS$
d4 1
a4 1
# Copyright (c) 2004
d27 2
@


1.1.7.1
log
@All the code in the contributed section
@
text
@@
