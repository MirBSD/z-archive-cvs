head	1.44;
access;
symbols
	tg-mirmake-dev_BASE:1.23
	tg-mirmake-dev:1.23.0.2
	mirbsd:1.1.7;
locks; strict;
comment	@# @;


1.44
date	2018.07.15.13.41.23;	author tg;	state Exp;
branches;
next	1.43;
commitid	1005B4B4F0B4ECDB6D4;

1.43
date	2012.11.30.21.22.53;	author tg;	state Exp;
branches;
next	1.42;
commitid	10050B923C4079924A1;

1.42
date	2009.04.07.22.38.02;	author tg;	state Exp;
branches;
next	1.41;
commitid	10049DBD5D966171B1E;

1.41
date	2009.04.05.15.55.18;	author tg;	state Exp;
branches;
next	1.40;
commitid	10049D8D4795FBB4781;

1.40
date	2009.03.29.13.04.11;	author tg;	state Exp;
branches;
next	1.39;
commitid	10049CF71B654F9EF54;

1.39
date	2008.12.07.17.25.10;	author tg;	state Exp;
branches;
next	1.38;
commitid	100493C06DD5D7BB5E9;

1.38
date	2008.10.05.16.32.50;	author tg;	state Exp;
branches;
next	1.37;
commitid	10048E8EC3E31621378;

1.37
date	2008.07.11.11.22.15;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004877427D302D1139;

1.36
date	2008.05.08.20.22.01;	author tg;	state Exp;
branches;
next	1.35;
commitid	100482360CD4FD8D640;

1.35
date	2008.05.07.13.34.37;	author tg;	state Exp;
branches;
next	1.34;
commitid	1004821AFFA1190D23D;

1.34
date	2008.05.03.01.28.59;	author tg;	state Exp;
branches;
next	1.33;
commitid	100481BBFDD7988CB52;

1.33
date	2008.05.03.01.09.28;	author tg;	state Exp;
branches;
next	1.32;
commitid	100481BBB3B66CD6DBA;

1.32
date	2008.04.06.21.58.29;	author tg;	state Exp;
branches;
next	1.31;
commitid	10047F94786787F3E40;

1.31
date	2008.03.09.16.58.50;	author tg;	state Exp;
branches;
next	1.30;
commitid	10047D4175A0AB603BA;

1.30
date	2007.10.27.00.17.19;	author tg;	state Exp;
branches;
next	1.29;
commitid	100472283A05FFD82C8;

1.29
date	2007.10.26.22.35.18;	author tg;	state Exp;
branches;
next	1.28;
commitid	10047226BB25372D3A5;

1.28
date	2007.10.26.22.22.25;	author tg;	state Exp;
branches;
next	1.27;
commitid	1004722689D52E149CF;

1.27
date	2007.10.14.18.55.55;	author tg;	state Exp;
branches;
next	1.26;
commitid	1004712664935A6879F;

1.26
date	2007.09.11.14.42.30;	author tg;	state Exp;
branches;
next	1.25;
commitid	10046E6A95F7024A806;

1.25
date	2007.08.15.22.22.09;	author tg;	state Exp;
branches;
next	1.24;
commitid	10046C37C7D6B90415B;

1.24
date	2007.07.04.15.43.47;	author tg;	state Exp;
branches;
next	1.23;
commitid	100468BC041538AAC4A;

1.23
date	2006.08.26.23.44.55;	author tg;	state Exp;
branches;
next	1.22;
commitid	10044F0DCFE316DD14F;

1.22
date	2006.08.26.23.31.19;	author tg;	state Exp;
branches;
next	1.21;
commitid	10044F0D9D373A097BF;

1.21
date	2006.08.26.15.47.46;	author tg;	state Exp;
branches;
next	1.20;
commitid	10044F06D2C632D9EF0;

1.20
date	2006.07.30.23.14.09;	author tg;	state Exp;
branches;
next	1.19;
commitid	10044CD3D2F7163A2F1;

1.19
date	2006.03.19.21.08.42;	author tg;	state Exp;
branches;
next	1.18;
commitid	100441DC8711E1C832F;

1.18
date	2006.03.19.21.03.58;	author tg;	state Exp;
branches;
next	1.17;
commitid	100441DC7526309FFCF;

1.17
date	2006.01.13.03.49.29;	author tg;	state Exp;
branches;
next	1.16;
commitid	10043C722F46A94D38C;

1.16
date	2005.12.17.05.46.08;	author tg;	state Exp;
branches;
next	1.15;
commitid	10043A3A3E65E20A413;

1.15
date	2005.11.24.19.48.03;	author tg;	state Exp;
branches;
next	1.14;
commitid	2f10438618ff3228;

1.14
date	2005.08.20.13.06.08;	author tg;	state Exp;
branches;
next	1.13;
commitid	771143072accdeb5;

1.13
date	2005.07.07.22.17.45;	author tg;	state Exp;
branches;
next	1.12;
commitid	66fa42cdaa020b9b;

1.12
date	2005.06.09.22.00.09;	author tg;	state Exp;
branches;
next	1.11;
commitid	454742a8bbff24f3;

1.11
date	2005.06.09.21.41.47;	author tg;	state Exp;
branches;
next	1.10;
commitid	66cf42a8b74e48c3;

1.10
date	2005.06.02.23.04.52;	author tg;	state Exp;
branches;
next	1.9;
commitid	1998429f90a4f1ed;

1.9
date	2005.05.23.19.50.00;	author tg;	state Exp;
branches;
next	1.8;
commitid	6104429233e460da;

1.8
date	2005.04.12.17.23.39;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2005.04.12.17.11.55;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2005.04.12.10.56.15;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2005.04.12.10.24.45;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.12.10.22.34;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.02.23.21.40.54;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.23.21.29.42;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.02.36.15;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.02.05.02.36.15;	author tg;	state Exp;
branches;
next	;


desc
@@


1.44
log
@further limit the amount of mailto links we’re giving out
@
text
@#!/usr/bin/env sh
# $MirOS: contrib/code/mirmake/Build.sh,v 1.43 2012/11/30 21:22:53 tg Exp $
#-
# Copyright (c) 2004, 2005, 2006, 2008, 2012
#	Thorsten Glaser <tg@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.
#-
# Build MirMake. (Assumes mksh or bash)

LC_ALL=C
export LC_ALL

OSN=$1			# OStype
PFX=${2:-/usr/local}	# Installation prefix (optional)
MPT=${3:-man/cat}	# manpath (cat magic) (optional)
MKN=${4:-bmake}		# name of executable (optional)
MAC=$5			# machine (i386, macppc) (optional)
MAR=$6			# machine_arch (i386, powerpc) (optional)
MOS=$7			# machine_os (BSD, Darwin, GNU, Interix) (optional)
MKS=$8			# mirbsdksh path (optional)
BIN=$9			# binown:bingrp (optional)

OLDMAKE=${MAKE-make}	# system's own make(1) binary
export OLDMAKE		# for bootstrapping

# help
case $OSN in
-*)	OSN= ;;
esac

if [ x"$MAC" = x"" ]; then
	x=`printf 'all:\n\t@@echo unknown' | \
	    $OLDMAKE -V MACHINE -f - all 2>/dev/null || echo unknown`
	[ x"$x" != x"" ] && [ x"$x" != x"unknown" ] && MAC=$x
fi

if [ x"$MAR" = x"" ]; then
	x=`printf 'all:\n\t@@echo unknown' | \
	    $OLDMAKE -V MACHINE_ARCH -f - all 2>/dev/null || echo unknown`
	[ x"$x" != x"" ] && [ x"$x" != x"unknown" ] && MAR=$x
fi

if [ x"$MAC" = x"" ]; then
	MAC=`machine 2>/dev/null || uname -m 2>/dev/null || echo unknown`
fi

if [ x"$MAR" = x"" ]; then
	MAR=`arch -s 2>/dev/null || arch 2>/dev/null || \
	    uname -p 2>/dev/null || echo unknown`
fi

if [ x"$MOS" = x"" ]; then
	u=`uname`
	case $u in
	*Linux*|*GNU*)	MOS=GNU		;;
	*BSD*)		MOS=BSD		;;
	*Interix*)	MOS=Interix	;;
	*Darwin*)	MOS=Darwin	;;
	esac
fi

case $MOS in
Interix)
	# Okay, we know this MACHINE_OS
	[ x"$MAC" = x"x86" ] && MAC=i386
	[ x"$MAC" = x"i386" ] && MAR=i386
	[ -z "$BIN" ] && BIN=-
	;;
BSD|Darwin)
	# Okay, we know this MACHINE_OS
	;;
GNU|Linux)
	MOS=GNU
	# austriancoder's GNU/Linux has _no_ uname option to
	# display the correct machine architecture, nor some
	# kind of arch(1) utility like OpenBSD; from FreeWRT
	case $MAC in
	i[3456789]86)
		MAR=i386
		;;
	x86_64)
		MAR=amd64
		;;
	esac
	;;
*)
	echo "Error: we cannot continue with this MACHINE_OS"
	echo "value of '$MOS'. Please contact the MirOS"
	echo "development team via http://www.mirbsd.org/rss.htm#lists and"
	echo "submit your operating system information and uname -a"
	echo "output. Currently, the following values are supported:"
	echo "- BSD Darwin GNU Interix"
	echo "Your uname -a output is:"
	uname -a
	OSN=	# fall through
	;;
esac

if [ x"$MAC" = x"unknown" ] || [ x"$MAR" = x"unknown" ] || [ x"$MOS" = x"unknown" ]; then
	echo "Error: cannot guess machine or machine_arch"
	echo "Your uname -a output is:"
	uname -a
	OSN=	# fall through
fi

if [ x"$OSN" = x"" ]; then
	echo "Syntax:"
	echo " $0 <OStype> [<prefix> [<manpath> [<exename>"
	echo "	[<machine> [<machine_arch> [<machine_os>"
	echo "  [<mksh> [<binown>:<bingrp>]]]]]]]]"
	echo "OStype:  name of OS (eg. Debian)"
	echo "prefix:  installation target (default: /usr/local)"
	echo "manpath: manpath relative to <prefix> (default: man/cat)"
	echo "exename: name of executable to generate (default: bmake)"
	echo "<machine> and <machine_arch> describe the target machine"
	echo "and are guessed from machine='$MAC' and"
	echo "machine_arch='$MAR' respectively."
	echo "Possible values: (i386, i386), (macppc, powerpc), etc."
	echo "<machine_os> can currently only be: BSD Darwin GNU Interix"
	echo "If <manpath> contains the string 'cat', a catmanpage is"
	echo "generated and installed, else, an unformatted manpage"
	echo "will be installed. If <mksh> is given, it is searched"
	echo "first when determining the path of the mirbsdksh."
	echo "Default binary owner is root:bin"
	exit 1
fi

mktest=
for f in mksh mirbsdksh ksh; do
	for d in /usr/bin /usr/local/bin /bin /sw/bin; do
		mktest="${mktest}${d}/${f} "
	done
done
ms=NONE
echo "Checking for mirbsdksh..."
for s in $MKS $MKSH $mktest $SHELL; do
	echo "Trying ${s}..."
	t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(3[4-9]|[4-9][0-9]|[1-9][0-9]+([0-9]))\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then echo yes; else echo no; fi' 2>/dev/null`
	if [ x"$t" = x"yes" ]; then
		echo "Found mirbsdksh: $s"
		ms=$s
		break
	fi
done

if [ -n "$OVERRIDE_MKSH" ]; then
	if test -x "$OVERRIDE_MKSH"; then
		ms=$OVERRIDE_MKSH
	else
		for s in $MKS $mktest; do
			echo "Trying ${s} again..."
			t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ -n $KSH_VERSION || -n $BASH_VERSION ]]; then echo yes; else echo no; fi' 2>/dev/null`
			if [ x"$t" = x"yes" ]; then
				echo "Found some ksh or bash: $s"
				ms=$s
				break
			fi
		done
	fi
fi

if [ x"$ms" = x"NONE" ]; then
	echo "Error: could not find a mirbsdksh compatible shell."
	echo "Please go to <http://mirbsd.de/mksh> and install it before"
	echo "continuing. At the moment, mksh R34 or higher is required;"
	echo "using a recent one like mksh R37c is strongly recommended."
	exit 1
fi

echo "Building MirMake on $MOS/$MAC ($MAR) for $OSN"
echo "with $ms and ${CC:-gcc} to $PFX/bin/$MKN"
echo "Documentation goes to $PFX/${MPT}1/ (user ${BIN:-root:bin})"

MKSH=$ms; export MKSH
exec $ms `dirname $0`/dist/scripts/Build.sh "$OSN" "$PFX" "$MPT" "$MKN" "$MAC" "$MAR" "$MOS" $ms "$BIN"
@


1.43
log
@be more flexible: mksh R12345 will come, eventually…
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.42 2009/04/07 22:38:02 tg Exp $
d103 1
a103 1
	echo "development team at miros-discuss@@mirbsd.org and"
@


1.42
log
@mksh R37c
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.41 2009/04/05 15:55:18 tg Exp $
d4 1
a4 1
# Copyright (c) 2004, 2005, 2006, 2008
d152 1
a152 1
	t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(3[4-9]|[4-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then echo yes; else echo no; fi' 2>/dev/null`
@


1.41
log
@release mksh R37b
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.40 2009/03/29 13:04:11 tg Exp $
d180 1
a180 1
	echo "using a recent one like mksh R37b is strongly recommended."
@


1.40
log
@• take care of dbins
• #!/bin/mksh shebang, in most places
• rcsid while here
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.39 2008/12/07 17:25:10 tg Exp $
d180 1
a180 1
	echo "using a recent one like mksh R35 is highly recommended."
@


1.39
log
@ensure that the sub-script actually uses the mksh it runs with
when employing the implicit $MKSH variable, as <bsd.own.mk> only
uses ?= and does not override it
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.38 2008/10/05 16:32:50 tg Exp $
d144 1
a144 1
	for d in /usr/dbin /usr/bin /usr/local/bin /bin /sw/bin; do
@


1.38
log
@switch MACHINE_OS over: Linux → GNU
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.37 2008/07/11 11:22:15 tg Exp $
d4 2
a5 2
# Copyright (c) 2004, 2005, 2006
#	Thorsten Glaser <tg@@mirbsd.de>
d188 1
@


1.37
log
@bump mksh
@
text
@d1 2
a2 2
#!/bin/sh
# $MirOS: contrib/code/mirmake/Build.sh,v 1.36 2008/05/08 20:22:01 tg Exp $
d33 1
a33 1
MOS=$7			# machine_os (BSD, Linux) (optional)
d69 1
a69 1
	*Linux*)	MOS=Linux	;;
d86 2
a87 1
Linux)
d106 1
a106 1
	echo "- BSD Darwin Interix Linux"
d133 1
a133 1
	echo "<machine_os> can currently only be: BSD Darwin Interix Linux"
d144 1
a144 1
	for d in /bin /usr/local/bin /bin /sw/bin; do
@


1.36
log
@preparation for using MirPorts on OpenBSD/zaurus et al:
try to use $OLDMAKE for MACHINE, MACHINE_ARCH determination
(XXX what about MACHINE_OS? probably not), iff it's BSD make

tested on mirbsd, dragonfly, netbsd
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.35 2008/05/07 13:34:37 tg Exp $
d151 1
a151 1
	t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(3[3-9]|[4-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then echo yes; else echo no; fi' 2>/dev/null`
d178 2
a179 2
	echo "continuing. At the moment, mksh R33 or higher is required;"
	echo "using a recent one like mksh R33d is highly recommended."
@


1.35
log
@prepare for improved portability
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.34 2008/05/03 01:28:59 tg Exp $
d46 12
@


1.34
log
@require mksh R33d or above
‣ to the user: due to the bugfixes
‣ to us: for the features
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.33 2008/05/03 01:09:28 tg Exp $
d24 3
d37 3
@


1.33
log
@remove advertising clause for all of contrib/ except
‣ heartbeat server/client, for now
‣ stuff in jupp that’ll be regenerated before next release anyway
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $
d133 1
a133 1
	t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(2[6-9]|[3-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then echo yes; else echo no; fi' 2>/dev/null`
d160 2
a161 2
	echo "continuing. At the moment, mksh R26 or higher is required;"
	echo "using a recent one like mksh R32 is highly recommended."
@


1.32
log
@apply FreeWRT svn r3699 from n0-1: build fix for amd64 (with a tweak)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.31 2008/03/09 16:58:50 tg Exp $
d7 5
a11 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d13 8
a20 12
# Advertising materials mentioning features or use of this work must
# display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
@


1.31
log
@support -h for help (kludgy)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.30 2007/10/27 00:17:19 tg Exp $
d81 3
@


1.30
log
@apply FreeWRT trunk/tools/mirmake/patches/patch-Build_sh
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.29 2007/10/26 22:35:18 tg Exp $
d39 5
@


1.29
log
@[[ use || not -o
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.28 2007/10/26 22:22:25 tg Exp $
d65 1
a65 1
BSD|Darwin|Linux)
d68 10
@


1.28
log
@• recommend mksh R32
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.27 2007/10/14 18:55:55 tg Exp $
d134 1
a134 1
			t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ -n $KSH_VERSION -o -n $BASH_VERSION ]]; then echo yes; else echo no; fi' 2>/dev/null`
@


1.27
log
@mksh R31d is strongly recommended for its bug fixes
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.26 2007/09/11 14:42:30 tg Exp $
d148 1
a148 1
	echo "using a recent one like mksh R31d is highly recommended."
@


1.26
log
@mksh R31b, finally… took some time to make the distfiles, because I’m busy IRL
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.25 2007/08/15 22:22:09 tg Exp $
d148 1
a148 1
	echo "using a recent one like mksh R31b is highly recommended."
@


1.25
log
@allow an optional vendor-specific string separated by space from
the upstream mksh version number in these scripts

intended for integration of mksh in, e.g. MidnightBSD, in case
they like to change the code from the original
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.24 2007/07/04 15:43:47 tg Exp $
d148 1
a148 1
	echo "using mksh R28 is highly recommended."
@


1.24
log
@NetBSD® doesn't have arch(1)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.23 2006/08/26 23:44:55 tg Exp $
d120 1
a120 1
	t=`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(2[6-9]|[3-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9]) ]]; then echo yes; else echo no; fi' 2>/dev/null`
@


1.23
log
@now that this works (on Interix), recommend mksh R28 since it's almost out
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.22 2006/08/26 23:31:19 tg Exp $
d44 2
a45 1
	MAR=`arch -s 2>/dev/null || arch 2>/dev/null || echo unknown`
@


1.22
log
@don't use a shell that chokes on ${foo:-bar}
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.21 2006/08/26 15:47:46 tg Exp $
d146 2
a147 1
	echo "continuing. At the moment, mksh R26 or higher is required."
@


1.21
log
@a few lections from "portable shell",
and apply mksh(1)'s nroff for GNU fix
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.14 2006/08/09 19:35:23 tg Rel $
d30 3
a32 3
PFX=${2-/usr/local}	# Installation prefix (optional)
MPT=${3-man/cat}	# manpath (cat magic) (optional)
MKN=${4-bmake}		# name of executable (optional)
d151 2
a152 2
echo "with $ms and ${CC-gcc} to $PFX/bin/$MKN"
echo "Documentation goes to $PFX/${MPT}1/ (user ${BIN-root:bin})"
@


1.20
log
@check $MKSH and $SHELL too, idea from mirports
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.19 2006/03/19 21:08:42 tg Exp $
d14 2
a15 2
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
d25 1
a25 1
# the possibility of such damage or existence of a nontrivial bug.
d29 9
a37 9
OSN="$1"		# OStype
PFX="${2:-/usr/local}"	# Installation prefix (optional)
MPT="${3:-man/cat}"	# manpath (cat magic) (optional)
MKN="${4:-bmake}"	# name of executable (optional)
MAC="$5"		# machine (i386, macppc) (optional)
MAR="$6"		# machine_arch (i386, powerpc) (optional)
MOS="$7"		# machine_os (BSD, Linux) (optional)
MKS="$8"		# mirbsdksh path (optional)
BIN="$9"		# binown:bingrp (optional)
d40 1
a40 1
	MAC="`machine 2>/dev/null || uname -m 2>/dev/null || echo unknown`"
d44 1
a44 1
	MAR="`arch -s 2>/dev/null || arch 2>/dev/null || echo unknown`"
d48 1
a48 1
	u="`uname`"
d57 1
a57 1
case "$MOS" in
d76 1
a76 1
	OSN=""	# fall through
d84 1
a84 1
	OSN=""	# fall through
d109 1
a109 1
mktest=""
d119 1
a119 1
	t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(2[6-9]|[3-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9]) ]]; then echo yes; else echo no; fi' 2>/dev/null`"
d129 1
a129 1
		ms="$OVERRIDE_MKSH"
d133 1
a133 1
			t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ -n $KSH_VERSION -o -n $BASH_VERSION ]]; then echo yes; else echo no; fi' 2>/dev/null`"
d151 2
a152 2
echo "with $ms and ${CC:-gcc} to $PFX/bin/$MKN"
echo "Documentation goes to $PFX/${MPT}1/ (user ${BIN:-root:bin})"
@


1.19
log
@typo
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.6 2006/01/24 22:24:02 tg Rel $
d117 1
a117 1
for s in $MKS $mktest; do
@


1.18
log
@fix mksh path
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.17 2006/01/13 03:49:29 tg Exp $
d4 2
a5 2
# Copyright (c) 2004, 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d144 3
a146 3
	echo "Error: could not find mirbsdksh compatible shell."
	echo "Please go to: http://mirbsd.de/mksh and install it before"
	echo "continuing. At the moment, mksh R26 or higher is requited."
@


1.17
log
@* mirbsd.bsdadvocacy.org -> www.66h.42h.de
* mirbsd.mirsolutions.de -> www.66h.42h.de (loses SSL)
* http*/cvs.cgi/ -> cvs.mirbsd.de
* mirsolutions.de -> mirbsd.org

No complete transition yet, but this helps a lot with
the recent and upcoming(!) domain issues.

Please use only http://mirbsd.de/ as mirror redirector
and only http://cvs.mirbsd.de/ as CVSweb redirector.
Please do not use mirbsd.de for anything else save eMail.
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.16 2005/12/17 05:46:08 tg Exp $
d145 2
a146 3
	echo "Please go to: http://www.66h.42h.de/?mksh"
	echo "and install the shell before continuing."
	echo "At least mksh R26 is required currently."
@


1.16
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.15 2005/11/24 19:48:03 tg Exp $
d145 1
a145 1
	echo "Please go to: http://mirbsd.mirsolutions.de/?mksh"
@


1.15
log
@require mksh R26 (to unify)
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.14 2005/08/20 13:06:08 tg Exp $
d18 8
a25 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
@


1.14
log
@mention mksh R24 is needed
fix URL to mksh homepage
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.13 2005/07/07 22:17:45 tg Exp $
d69 1
a69 1
	echo "development team at miros-discuss@@66h.42h.de and"
d118 1
a118 1
	t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(2[4-9]|[3-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9]) ]]; then echo yes; else echo no; fi' 2>/dev/null`"
d146 1
a146 1
	echo "At least mksh R24 is required currently."
@


1.13
log
@portable mksh R24 (not yet released) is an ABSOLUTE MUST for mirmake now
native mksh R24 must be dated 2005/07/07 or newer to work correctly
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.12 2005/06/09 22:00:09 tg Exp $
d144 3
a146 2
	echo "Please go to http://wiki.mirbsd.de/MirbsdKsh and"
	echo "install the shell before continuing."
@


1.12
log
@syntax error
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.11 2005/06/09 21:41:47 tg Exp $
d118 1
a118 1
	t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)+([0-9])\ +([0-9])/+([0-9])/+([0-9]) ]]; then echo yes; else echo no; fi' 2>/dev/null`"
@


1.11
log
@add an "override mksh" mode, in which any ksh or bash which sets
the environment variable will suffice. This is not to be used by
a regular person, only MirPorts builds where we can install mksh
(a more current version even) later.

This is deliberately undocumented, since the shell found will be
hard-coded into so many places...
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.10 2005/06/02 23:04:52 tg Exp $
d140 1
a140 1
done
@


1.10
log
@refine check for new mksh versions
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.9 2005/05/23 19:50:00 tg Exp $
d126 16
@


1.9
log
@find/support mksh R21 now that it has gone gold (gamma test)
later, mksh R20 or below support will drop, so this line goes
below 200c or so again...
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.8 2005/04/12 17:23:39 tg Exp $
d118 1
a118 1
	t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R|*@@(MirOS \$Rev|MirOS R))* ]]; then echo yes; else echo no; fi' 2>/dev/null`"
@


1.8
log
@fix being loud
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.7 2005/04/12 17:11:55 tg Exp $
d118 1
a118 1
	t="`$s -c 'let a=1; (( a + 1 )) 2>/dev/null && if [[ $KSH_VERSION = *@@(MirOS \$Rev|MirOS R)* ]]; then echo yes; else echo no; fi' 2>/dev/null`"
@


1.7
log
@some more fixes and simplifications
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $
d133 3
a135 3
echo "Building MirMake on $MOS/$MAC ($MAR)"
echo "for $OSN with $MKS to $PFX/bin/$MKN"
echo "Documentation goes to $PFX/$MPT1/ (user ${BIN:-root:bin})"
@


1.6
log
@if we're ever going to auto-install this on Interix,
we need to get rid of forced -o root -g bin at install
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.5 2005/04/12 10:24:45 tg Exp $
d14 4
d39 1
a39 1
	MAC="`machine 2>/dev/null || echo unknown`"
d56 5
a60 5
if [ x"$MOS" = x"Interix" ]; then
	u="`uname -m`"
	case $MAC:$u in
	unknown:x86)	MAC=i386; MAR=i386	;;
	esac
d62 2
a63 2
elif [ x"$MOS" = x"Linux" ] || [ x"$MOS" = x"BSD" ] || [ x"$MOS" = x"Darwin" ]; then
	:
d65 2
a66 1
else
d76 2
a77 1
fi
@


1.5
log
@be more verbose
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.4 2005/04/12 10:22:34 tg Exp $
d57 1
@


1.4
log
@detect Interix/i386 automatically
XXX someone's got an Alpha?
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.3 2005/02/23 21:40:54 tg Exp $
d126 4
@


1.3
log
@allow installation as user
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.2 2005/02/23 21:29:42 tg Exp $
d52 6
a57 1
if [ x"$MOS" = x"Linux" ] || [ x"$MOS" = x"BSD" ] || [ x"$MOS" = x"Interix" ] || [ x"$MOS" = x"Darwin" ]; then
@


1.2
log
@modernise
@
text
@d2 1
a2 1
# $MirOS: contrib/code/mirmake/Build.sh,v 1.1.7.1 2005/02/05 02:36:15 tg Exp $
d32 1
d77 2
a78 1
	echo "	[<machine> [<machine_arch> [<machine_os> [<mksh>]]]]]]]"
d92 1
d121 1
a121 1
exec $ms `dirname $0`/dist/scripts/Build.sh "$OSN" "$PFX" "$MPT" "$MKN" "$MAC" "$MAR" "$MOS" $ms
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $MirOS$
d4 1
a4 1
# Copyright (c) 2004
d22 1
a22 1
# Build MirMake. (Assumes ksh or bash)
d101 1
a101 1
for s in $mktest $MKS; do
@


1.1.7.1
log
@All the code in the contributed section
@
text
@@
