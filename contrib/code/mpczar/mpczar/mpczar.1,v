head	1.16;
access;
symbols;
locks; strict;
comment	@.\" @;


1.16
date	2018.12.25.19.38.11;	author tg;	state Exp;
branches;
next	1.15;
commitid	1005C22871909EC7FE2;

1.15
date	2018.10.07.01.10.16;	author tg;	state Exp;
branches;
next	1.14;
commitid	1005BB95CA10BF418E8;

1.14
date	2016.02.11.20.12.11;	author tg;	state Exp;
branches;
next	1.13;
commitid	10056BCEAFF41919B5B;

1.13
date	2009.11.22.18.23.29;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004B0981B210A68B89;

1.12
date	2008.12.10.18.40.14;	author tg;	state Exp;
branches;
next	1.11;
commitid	10049400D213BD80DD4;

1.11
date	2008.11.01.21.28.54;	author tg;	state Exp;
branches;
next	1.10;
commitid	100490CCA26652BFC9B;

1.10
date	2008.05.03.01.09.29;	author tg;	state Exp;
branches;
next	1.9;
commitid	100481BBB3B66CD6DBA;

1.9
date	2008.04.05.16.39.35;	author tg;	state Exp;
branches;
next	1.8;
commitid	10047F7AB5A0DBF1583;

1.8
date	2006.11.19.12.49.13;	author tg;	state Exp;
branches;
next	1.7;
commitid	100456052CF42BF39C7;

1.7
date	2006.11.19.12.42.33;	author tg;	state Exp;
branches;
next	1.6;
commitid	100456051421DADFAF9;

1.6
date	2006.06.15.19.18.45;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004491B2706C2443B2;

1.5
date	2006.01.13.03.49.29;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043C722F46A94D38C;

1.4
date	2005.12.17.05.46.10;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043A3A3E65E20A413;

1.3
date	2005.11.16.22.36.48;	author tg;	state Stab;
branches;
next	1.2;
commitid	5a7a437bb48e12eb;

1.2
date	2005.11.16.21.46.15;	author tg;	state Exp;
branches;
next	1.1;
commitid	5731437ba8a924aa;

1.1
date	2005.11.16.19.56.43;	author tg;	state Exp;
branches;
next	;
commitid	4b95437b8f0a0886;


desc
@@


1.16
log
@update from contrib/samples/portmdoc,v 1.11
@
text
@.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.15 2018/10/07 01:10:16 tg Exp $
.\"-
.\" Copyright (c) 2005, 2006, 2008, 2009, 2010, 2016, 2018
.\"	mirabilos <m@@mirbsd.org>
.\"
.\" Provided that these terms and disclaimer and all copyright notices
.\" are retained or reproduced in an accompanying document, permission
.\" is granted to deal in this work without restriction, including un-
.\" limited rights to use, publicly perform, distribute, sell, modify,
.\" merge, give away, or sublicence.
.\"
.\" This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
.\" the utmost extent permitted by applicable law, neither express nor
.\" implied; without malicious intent or gross negligence. In no event
.\" may a licensor, author or contributor be held liable for indirect,
.\" direct, other damage, loss, or other issues arising in any way out
.\" of dealing in the work, even if advised of the possibility of such
.\" damage or existence of a defect, except proven that it results out
.\" of said person's immediate fault when using the work as intended.
.\"-
.\" Try to make GNU groff and AT&T nroff more compatible
.\" * ` generates ‘ in gnroff, so use \`
.\" * ' generates ’ in gnroff, \' generates ´, so use \*(aq
.\" * - generates ‐ in gnroff, \- generates −, so .tr it to -
.\"   thus use - for hyphens and \- for minus signs and option dashes
.\" * ~ is size-reduced and placed atop in groff, so use \*(TI
.\" * ^ is size-reduced and placed atop in groff, so use \*(ha
.\" * \(en does not work in nroff, so use \*(en
.\" * <>| are problematic, so redefine and use \*(Lt\*(Gt\*(Ba
.\" Also make sure to use \& *before* a punctuation char that is to not
.\" be interpreted as punctuation, and especially with two-letter words
.\" but also (after) a period that does not end a sentence (“e.g.\&”).
.\" The section after the "doc" macropackage has been loaded contains
.\" additional code to convene between the UCB mdoc macropackage (and
.\" its variant as BSD mdoc in groff) and the GNU mdoc macropackage.
.\"
.ie \n(.g \{\
.	if \*[.T]ascii .tr \-\N'45'
.	if \*[.T]latin1 .tr \-\N'45'
.	if \*[.T]utf8 .tr \-\N'45'
.	ds <= \[<=]
.	ds >= \[>=]
.	ds Rq \[rq]
.	ds Lq \[lq]
.	ds sL \(aq
.	ds sR \(aq
.	if \*[.T]utf8 .ds sL `
.	if \*[.T]ps .ds sL `
.	if \*[.T]utf8 .ds sR '
.	if \*[.T]ps .ds sR '
.	ds aq \(aq
.	ds TI \(ti
.	ds ha \(ha
.	ds en \(en
.\}
.el \{\
.	ds aq '
.	ds TI ~
.	ds ha ^
.	ds en \(em
.\}
.\"
.\" Implement .Dd with the Mdocdate RCS keyword
.\"
.rn Dd xD
.de Dd
.ie \\$1$Mdocdate: \{\
.	xD \\$2 \\$3, \\$4
.\}
.el .xD \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8
..
.\"
.\" .Dd must come before definition of .Mx, because when called
.\" with -mandoc, it might implement .Mx itself, but we want to
.\" use our own definition. And .Dd must come *first*, always.
.\"
.Dd $Mdocdate: December 25 2018 $
.\"
.\" Check which macro package we use, and do other -mdoc setup.
.\"
.ie \n(.g \{\
.	if \*[.T]utf8 .tr \[la]\*(Lt
.	if \*[.T]utf8 .tr \[ra]\*(Gt
.	ie d volume-ds-1 .ds tT gnu
.	el .ie d doc-volume-ds-1 .ds tT gnp
.	el .ds tT bsd
.\}
.el .ds tT ucb
.\"
.\" Implement .Mx (MirBSD)
.\"
.ie "\*(tT"gnu" \{\
.	eo
.	de Mx
.	nr curr-font \n[.f]
.	nr curr-size \n[.ps]
.	ds str-Mx \f[\n[curr-font]]\s[\n[curr-size]u]
.	ds str-Mx1 \*[Tn-font-size]\%MirBSD\*[str-Mx]
.	if !\n[arg-limit] \
.	if \n[.$] \{\
.	ds macro-name Mx
.	parse-args \$@@
.	\}
.	if (\n[arg-limit] > \n[arg-ptr]) \{\
.	nr arg-ptr +1
.	ie (\n[type\n[arg-ptr]] == 2) \
.	as str-Mx1 \~\*[arg\n[arg-ptr]]
.	el \
.	nr arg-ptr -1
.	\}
.	ds arg\n[arg-ptr] "\*[str-Mx1]
.	nr type\n[arg-ptr] 2
.	ds space\n[arg-ptr] "\*[space]
.	nr num-args (\n[arg-limit] - \n[arg-ptr])
.	nr arg-limit \n[arg-ptr]
.	if \n[num-args] \
.	parse-space-vector
.	print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[Tn-font-size]
.\}
.el .ie "\*(tT"gnp" \{\
.	eo
.	de Mx
.	nr doc-curr-font \n[.f]
.	nr doc-curr-size \n[.ps]
.	ds doc-str-Mx \f[\n[doc-curr-font]]\s[\n[doc-curr-size]u]
.	ds doc-str-Mx1 \*[doc-Tn-font-size]\%MirBSD\*[doc-str-Mx]
.	if !\n[doc-arg-limit] \
.	if \n[.$] \{\
.	ds doc-macro-name Mx
.	doc-parse-args \$@@
.	\}
.	if (\n[doc-arg-limit] > \n[doc-arg-ptr]) \{\
.	nr doc-arg-ptr +1
.	ie (\n[doc-type\n[doc-arg-ptr]] == 2) \
.	as doc-str-Mx1 \~\*[doc-arg\n[doc-arg-ptr]]
.	el \
.	nr doc-arg-ptr -1
.	\}
.	ds doc-arg\n[doc-arg-ptr] "\*[doc-str-Mx1]
.	nr doc-type\n[doc-arg-ptr] 2
.	ds doc-space\n[doc-arg-ptr] "\*[doc-space]
.	nr doc-num-args (\n[doc-arg-limit] - \n[doc-arg-ptr])
.	nr doc-arg-limit \n[doc-arg-ptr]
.	if \n[doc-num-args] \
.	doc-parse-space-vector
.	doc-print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[doc-Tn-font-size]
.\}
.el \{\
.	de Mx
.	nr cF \\n(.f
.	nr cZ \\n(.s
.	ds aa \&\f\\n(cF\s\\n(cZ
.	if \\n(aC==0 \{\
.		ie \\n(.$==0 \&MirBSD\\*(aa
.		el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
.	\}
.	if \\n(aC>\\n(aP \{\
.		nr aP \\n(aP+1
.		ie \\n(C\\n(aP==2 \{\
.			as b1 \&MirBSD\ #\&\\*(A\\n(aP\\*(aa
.			ie \\n(aC>\\n(aP \{\
.				nr aP \\n(aP+1
.				nR
.			\}
.			el .aZ
.		\}
.		el \{\
.			as b1 \&MirBSD\\*(aa
.			nR
.		\}
.	\}
..
.\}
.\"-
.Dt MPCZAR 1
.Os MirPorts\ Framework
.Sh NAME
.Nm mpczar
.Nd generate compressed normalised file archive
.Sh SYNOPSIS
.Nm
.Op Fl Cv
.Op Fl o Ar outfile
.Op Fl I Ar ignore ...
.Op Fl r Ar directory ...
.Op Ar
.Sh DESCRIPTION
The
.Nm
.Xr mksh 1
script takes a list of files from the command line,
adds all files found in any
.Ar directory
specified, removes all
.Ar ignore
entries found, sorts the list, creates a
.Xr cpio 1
archive in a normalised
format, compresses them using a helper program
and writes the file to
.Ar outfile Ns .mcz
(or to standard output).
.Pp
The idea is that the archive generated is the same on
every system if the set of input files is the same, like
a mathematical function.
The input files are sorted, and any file information
about ownership, inodes and modification times is discarded.
.Pp
The options are as follows:
.Bl -tag -width "-r directory"
.It Fl C
Create an old-style portable
.Em cpio
archive instead of an
.Em sv4crc
.Pq default
archive.
Use this option only for distfiles which also must be usable
on systems that do not have MirOS cpio.
.It Fl I Ar ignore
Add
.Ar ignore
to the list of expressions to exclude using
.Xr fgrep 1 .
.It Fl o Ar outfile
Write archive to
.Ar outfile .
.It Fl r Ar directory
Add
.Ar directory
to the list of entries to recursively scan for
files which are candidates for the archive.
.It Fl v
Display a list of files saved to stderr.
.It Ar file
Add
.Ar file
to the archive.
.El
.Sh FILES
.Bl -tag -compact -width /usr/libexec/mpczar.z
.It /usr/libexec/mpczar.z
Compression helper mimicking a small
.Xr compress 1
using
.Xr zopen 3 .
.El
.Sh EXAMPLES
Compress all files of a newly checked-out
.Xr jupp 1
distribution:
.Bd -literal
$ cvs \-qz9 \-d _anoncvs@@anoncvs.mirbsd.org:/cvs co \-Prjoe\-3_1jupp10 \-djupp contrib/code/jupp
$ mpczar \-o mksh27 \-I /CVS \-r mksh
.Ed
.Sh DIAGNOSTICS
.Nm
returns 1 if
.Xr cpio 1
failed, 2 if compression failed, and 0 on success.
.Sh SEE ALSO
.Xr compress 1 ,
.Xr cpio 1 ,
.Xr fgrep 1 ,
.Xr uncompress 1 ,
.Xr zcat 1 ,
.Xr zopen 3
.Sh AUTHORS
.Nm
was written by
.An Thorsten Glaser Aq tg@@mirbsd.de .
.Sh CAVEATS
File permissions are stored as-is in the archive and not normalised.
@


1.15
log
@spelling cleanup: “programme” is distinct from “program”; even in
British English, the latter is used for computer programs, while
the former serves for things like the TV programme, or a programme
to plant trees
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.14 2016/02/11 20:12:11 tg Exp $
d3 1
a3 1
.\" Copyright (c) 2005, 2006, 2008, 2009, 2010, 2016
d77 1
a77 1
.Dd $Mdocdate: February 11 2016 $
d85 1
d98 1
a98 1
.	ds str-Mx1 \*[Tn-font-size]\%MirOS\*[str-Mx]
d124 32
d162 1
a162 1
.		ie \\n(.$==0 \&MirOS\\*(aa
d168 1
a168 1
.			as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
d176 1
a176 1
.			as b1 \&MirOS\\*(aa
@


1.14
log
@merge most recent portmdoc into a̲l̲l̲ of its users; fixup .\& into \&. like
in mksh(1), for Schillix ditroff
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.12 2008/12/10 18:40:14 tg Exp $
d174 1
a174 1
format, compresses them using a helper programme
@


1.13
log
@fix more manpages
@
text
@d3 2
a4 2
.\" Copyright (c) 2005, 2006, 2008
.\"	Thorsten Glaser <tg@@mirbsd.de>
d29 4
d77 1
a77 1
.Dd $Mdocdate: November 17 2009 $
d79 1
a79 1
.\" Check which macro package we use
d82 2
@


1.12
log
@eurynome: anoncvs@@ → _anoncvs@@
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.11 2008/11/01 21:28:54 tg Exp $
d21 123
a143 1
.Dd December 10, 2008
@


1.11
log
@fix file ignoring situation
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.10 2008/05/03 01:09:29 tg Exp $
d21 1
a21 1
.Dd November 1, 2008
d98 1
a98 1
.Xr mksh 1
d101 2
a102 2
$ cvs -qz9 -d anoncvs@@anoncvs.mirbsd.org:/cvs co -Prmksh-R27 -dmksh src/bin/mksh
$ mpczar -o mksh27 -I /CVS -r mksh
@


1.10
log
@remove advertising clause for all of contrib/ except
‣ heartbeat server/client, for now
‣ stuff in jupp that’ll be regenerated before next release anyway
@
text
@d1 1
a1 1
.\" $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $
d21 1
a21 1
.Dd April 5, 2008
d102 1
a102 1
$ mpczar -o mksh27 -I CVS -r mksh
d119 1
a119 1
.An Thorsten Glaser Aq tg@@66h.42h.de .
@


1.9
log
@sync licence; fix typo
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.8 2006/11/19 12:49:13 tg Exp $
a11 4
.\" Advertising materials mentioning features or use of this work must
.\" display the following acknowledgement:
.\"	This product includes material provided by Thorsten Glaser.
.\"
@


1.8
log
@add a caveat about chmod 755/644 vs 775/664 generating different output
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.7 2006/11/19 12:42:33 tg Exp $
d3 1
a3 1
.\" Copyright (c) 2005, 2006
d6 5
a10 6
.\" Licensee is hereby permitted to deal in this work without restric-
.\" tion, including unlimited rights to use, publicly perform, modify,
.\" merge, distribute, sell, give away or sublicence, provided all co-
.\" pyright notices above, these terms and the disclaimer are retained
.\" in all redistributions or reproduced in accompanying documentation
.\" or other materials provided with binary redistributions.
d16 8
a23 8
.\" Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
.\" express, or implied, to the maximum extent permitted by applicable
.\" law, without malicious intent or gross negligence; in no event may
.\" licensor, an author or contributor be held liable for any indirect
.\" or other damage, or direct damage except proven a consequence of a
.\" direct error of said person and intended use of this work, loss or
.\" other issues arising in any way out of its use, even if advised of
.\" the possibility of such damage or existence of a defect.
d25 1
a25 1
.Dd November 19, 2006
d106 1
a106 1
$ mpshar -o mksh27 -I CVS -r mksh
@


1.7
log
@add new option -C to generate a cpio distfile instead of sv4crc
@
text
@d1 1
a1 1
.\" $MirOS: src/share/misc/licence.template,v 1.14 2006/08/09 19:35:23 tg Rel $
d125 2
@


1.6
log
@mirbsd.org, 66h.42h.de, bsdadvocacy.org, and whatnot
we changed that too often, try to clean up the mess
mostly outside the www/ module which is dead anyway.
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.5 2006/01/13 03:49:29 tg Exp $
d3 2
a4 2
.\" Copyright (c) 2005
.\"	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d13 2
a14 2
.\" All advertising materials mentioning features or use of this soft-
.\" ware must display the following acknowledgement:
d24 1
a24 1
.\" the possibility of such damage or existence of a nontrivial bug.
d26 1
a26 1
.Dd November 16, 2005
d34 1
a34 1
.Op Fl v
d50 1
a50 2
archive in the
.Em v4norm
d64 9
d118 2
@


1.5
log
@* mirbsd.bsdadvocacy.org -> www.66h.42h.de
* mirbsd.mirsolutions.de -> www.66h.42h.de (loses SSL)
* http*/cvs.cgi/ -> cvs.mirbsd.de
* mirsolutions.de -> mirbsd.org

No complete transition yet, but this helps a lot with
the recent and upcoming(!) domain issues.

Please use only http://mirbsd.de/ as mirror redirector
and only http://cvs.mirbsd.de/ as CVSweb redirector.
Please do not use mirbsd.de for anything else save eMail.
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.4 2005/12/17 05:46:10 tg Exp $
d98 2
a99 2
$ cvs -qz9 -d _anoncvs@@mirbsd.org:/cvs co -Prmksh-R25 -dmksh src/bin/mksh
$ mpshar -o mksh25 -I CVS -r mksh
@


1.4
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.3 2005/11/16 22:36:48 tg Stab $
d98 1
a98 1
$ cvs -qz9 -d _anoncvs@@mirsolutions.de:/cvs co -Prmksh-R25 -dmksh src/bin/mksh
@


1.3
log
@spelling fixes, from Han Boetes via IRC #UnixNL
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.2 2005/11/16 21:46:15 tg Exp $
d17 8
a24 7
.\" Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
.\" any kind, expressed or implied, to the maximum extent permitted by
.\" applicable law, but with the warranty of being written without ma-
.\" licious intent or gross negligence; in no event shall licensor, an
.\" author or contributor be held liable for any damage, direct, indi-
.\" rect or other, however caused, arising in any way out of the usage
.\" of this work, even if advised of the possibility of such damage.
@


1.2
log
@re-vamp co-process handling (yeah, we do need this mksh feature)
now both scenarios work
@
text
@d1 1
a1 1
.\" $MirOS: contrib/code/mpczar/mpczar/mpczar.1,v 1.1 2005/11/16 19:56:43 tg Exp $
d104 1
a104 1
failed, 2 if compression failed, and 0 to indicate no error occured.
@


1.1
log
@write the script itself and its manual page
@
text
@d1 1
a1 1
.\" $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $
d100 5
@

