head	1.18;
access;
symbols
	joe-3_1jupp38:1.18
	joe-3_1jupp37:1.18
	joe-3_1jupp36:1.17
	joe-3_1jupp35:1.16
	joe-3_1jupp34:1.16
	joe-3_1jupp33:1.16
	joe-3_1jupp32:1.16
	joe-3_1jupp31:1.10
	joe-3_1jupp30:1.9
	joe-3_1jupp29:1.9
	joe-3_1jupp28:1.2
	joe-3_1jupp27:1.2
	joe-3_1jupp26:1.1
	joe-3_1jupp25:1.1;
locks; strict;
comment	@# @;


1.18
date	2018.10.20.15.43.58;	author tg;	state Exp;
branches;
next	1.17;
commitid	1005BCB4D547ED8E797;

1.17
date	2018.03.15.23.15.40;	author tg;	state Exp;
branches;
next	1.16;
commitid	1005AAAFEB6725E6DA6;

1.16
date	2017.12.07.01.00.30;	author tg;	state Exp;
branches;
next	1.15;
commitid	1005A2892BB042F2F1F;

1.15
date	2017.12.06.21.46.54;	author tg;	state Exp;
branches;
next	1.14;
commitid	1005A28655C5188FF08;

1.14
date	2017.12.03.01.49.12;	author tg;	state Exp;
branches;
next	1.13;
commitid	1005A23582F51069482;

1.13
date	2017.12.03.01.43.50;	author tg;	state Exp;
branches;
next	1.12;
commitid	1005A2356EC4C92E058;

1.12
date	2017.12.02.18.50.01;	author tg;	state Exp;
branches;
next	1.11;
commitid	1005A22F5E2328F5222;

1.11
date	2017.12.02.04.33.47;	author tg;	state Exp;
branches;
next	1.10;
commitid	1005A222D3D42B46C90;

1.10
date	2017.07.08.15.38.43;	author tg;	state Exp;
branches;
next	1.9;
commitid	1005960FC9E19ACFF98;

1.9
date	2016.10.30.00.04.18;	author tg;	state Exp;
branches;
next	1.8;
commitid	10058153918207AD64D;

1.8
date	2016.10.29.23.51.23;	author tg;	state Exp;
branches;
next	1.7;
commitid	1005815360D5C4C4383;

1.7
date	2016.10.29.23.44.44;	author tg;	state Exp;
branches;
next	1.6;
commitid	1005815347F236258ED;

1.6
date	2016.10.29.22.41.10;	author tg;	state Exp;
branches;
next	1.5;
commitid	1005815259C4795AA21;

1.5
date	2016.10.08.17.44.17;	author tg;	state Exp;
branches;
next	1.4;
commitid	10057F9303837FBF229;

1.4
date	2016.03.06.18.52.28;	author tg;	state Exp;
branches;
next	1.3;
commitid	10056DC7C865C8D26A3;

1.3
date	2016.03.04.15.00.32;	author tg;	state Exp;
branches;
next	1.2;
commitid	10056D9A31B38FA89F8;

1.2
date	2013.11.07.22.22.50;	author tg;	state Exp;
branches;
next	1.1;
commitid	100527C12D35F1CDB06;

1.1
date	2013.08.19.17.40.16;	author tg;	state Exp;
branches;
next	;
commitid	1005212589811082912;


desc
@@


1.18
log
@add easy checkout command helper for me
@
text
@# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.16 2017/12/07 01:00:30 tg Exp $
#-
# make -f Makefile.bsd-wrapper CFPREFIX=/usr/mpkg sysconfjoesubdir=/joe

MAN=		joe.1
INST_TARGET=	INSTALL_MAN= install
CLEANFILES+=	.deps charmap charmaps i18n syntax joe.txt{,~} jupp

CFPREFIX?=	/usr/local
.if ${CFPREFIX} == "/usr"
CFMANDIR?=	/usr/share/man
.endif
CFMANDIR?=	${CFPREFIX}/man
CFETC?=		/etc

sysconfjoesubdir?=/jupp

CFARGS+=	--prefix=${CFPREFIX:Q} \
		--bindir=${CFPREFIX:Q}/bin \
		--mandir=${CFMANDIR:Q} \
		--sysconfdir=${CFETC:Q} \
		${GCFARGS} \
		--enable-sysconfjoesubdir=${sysconfjoesubdir:Q}

.ifmake winman
CFARGS+=	--enable-win32reloc
.endif

.include <bsd.own.mk>
FSFISLIB=	No

.ifdef __CRAZY
COPTS+=		-Wno-unused-parameter -Wno-cast-qual
.  if exists(/usr/include/jupp.tmp.h) && !defined(wnostrict)
CPPFLAGS+=	-DGCC_Wstrict_prototypes
.  else
COPTS+=		-Wno-strict-prototypes
.  endif
.endif

joe.1: config.status
	cd ${FSFOBJDIR} && ${FSFMAKE} $@@

all: jupplink
jupplink: config.status
	@@ln -sf joe jupp

winman: joe.1
	nrcon -mandoc joe.1 | col -bx >joe.txt~
	print '$$-3,$$d\n,g/^MirOS BSD/.-3,.+10d\nwq' | ed -s joe.txt~
	cat -s joe.txt~ | sed \
	    -e 's/\(jupp\)\( .global-options\)/\132\2/' \
	    -e '1d' -e '$$d' -e $$'s/$$/\r/' >joe.txt


.ifmake cats
V_GROFF!=	pkg_info -e 'groff-*'
V_GHOSTSCRIPT!=	pkg_info -e 'ghostscript-*'
.  if empty(V_GROFF) || empty(V_GHOSTSCRIPT)
.    error empty V_GROFF=${V_GROFF} or V_GHOSTSCRIPT=${V_GHOSTSCRIPT}
.  endif
.endif

CLEANFILES+=	joe.htm joe.ps1 joe.pdf
CATS_KW=	jmacs, joe, jpico, jstar, jupp, rjoe
CATS_TITLE_joe_1=joe - Joe's Own Editor
cats: joe.cat1 joe.ps1
	set -e; . ${BSDSRCDIR:Q}/scripts/roff2htm; set_target_absolute; \
	    do_conversion_verbose joe 1 joe.cat1 joe.htm
	x=$$(ident joe.1 | \
	    awk '/Mir''OS:/ { print $$4$$5; }' | \
	    tr -dc 0-9); (( $${#x} == 14 )) || exit 1; exec \
	    ${MKSH} ${BSDSRCDIR:Q}/contrib/hosted/tg/ps2pdfmir -p pa4 -c \
	    -o joe.pdf '[' /Author '(The MirOS Project)' \
	    /Title '('${CATS_TITLE_joe_1:Q}')' \
	    /Subject '(BSD Reference Manual)' /ModDate "(D:$$x)" \
	    /Creator '(GNU groff version ${V_GROFF:S/groff-//} \(MirPorts\))' \
	    /Producer '(Artifex Ghostscript ${V_GHOSTSCRIPT:S/ghostscript-//:S/-artifex//} \(MirPorts\))' \
	    /Keywords '('${CATS_KW:Q}')' /DOCINFO pdfmark \
	    -f joe.ps1

alljupps:
	cd ${.CURDIR:Q} && r=$$(<CVS/Root) && cd .. && rm -rf j28 j37 j44 && \
	    cvs -Rqd "$$r" co -d j28 -r joe-2_8-msdos jupp && \
	    cvs -Rqd "$$r" co -d j37 -r jupprc-for-joe-3_7 jupp && \
	    cvs -Rqd "$$r" co -d j44 -r jupprc-for-joe-4_4 jupp && \
	    cd jupp && exec cvs -Rqd "$$r" up -PAd

.include <bsd.cfwrap.mk>
@


1.17
log
@update accordingly
@
text
@d82 7
@


1.16
log
@unfortunately, the polymorphic problems are not yet solved
@
text
@d1 1
a1 1
# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.15 2017/12/06 21:46:54 tg Exp $
d7 1
a7 1
CLEANFILES+=	.deps charmap charmaps i18n syntax joe.1 joe.txt{,~} jupp
@


1.15
log
@the code should now be able to cope with this

offenders will be patched away
@
text
@d1 1
a1 1
# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.10 2017/07/08 15:38:43 tg Exp $
d34 5
@


1.14
log
@make cats, not war
@
text
@d33 1
a33 4
COPTS+=		-Wno-old-style-definition \
		-Wno-unused-parameter -Wno-strict-prototypes \
		-Wno-cast-qual \
		-Wno-missing-prototypes -Wno-missing-declarations
@


1.13
log
@update
@
text
@d54 1
a54 1
.ifmake joe.pdf
d65 1
a65 1
joe.htm: joe.cat1
a67 1
joe.pdf: joe.ps1
@


1.12
log
@get rid of -Wmissing-field-initialisers, as Cygwin GCC forces my hand
@
text
@d33 2
a34 2
COPTS+=		-Wno-unused-parameter \
		-Wno-old-style-definition -Wno-strict-prototypes \
@


1.11
log
@allow passing extra configure args easily for testing
@
text
@a33 1
		-Wno-missing-field-initializers \
@


1.10
log
@clean up i18n.c -DTEST program
@
text
@d1 1
a1 1
# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.6 2016/10/29 22:41:10 tg Exp $
d22 1
@


1.9
log
@joe.1 is now in CLEANFILES
@
text
@d7 1
a7 1
CLEANFILES+=	.deps charmap charmaps syntax joe.1 joe.txt{,~} jupp
@


1.8
log
@generating the manpage is make’s job now
@
text
@d7 1
a7 1
CLEANFILES+=	.deps charmap charmaps syntax joe.txt{,~} jupp
@


1.7
log
@first cut at win32 self-relocation
@
text
@d40 1
@


1.6
log
@small improvements that count
@
text
@d1 1
a1 1
# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.3 2016/03/04 15:00:32 tg Exp $
d25 1
a25 1
CFARGS+=	--enable-win32reloc=old
@


1.5
log
@use autoconf to DTRT, bump to ~pre1, prepare things yet to come
@
text
@d7 1
a7 1
CLEANFILES+=	.deps charmaps syntax joe.txt{,~}
d41 4
@


1.4
log
@HTML manpage for cats
@
text
@d7 1
a7 1
CLEANFILES+=	.deps charmaps syntax
d21 6
a26 2
		--sysconfdir=${CFETC:Q}
XARGS+=		sysconfjoesubdir=${sysconfjoesubdir:Q}
d41 7
@


1.3
log
@fix the worst manpage lies; joe.1 generation is really not configure.ac’s job
@
text
@d1 1
a1 1
# $MirOS: contrib/code/jupp/Makefile.bsd-wrapper,v 1.1 2013/08/19 17:40:16 tg Exp $
d7 1
a7 1
CLEANFILES+=	charmaps syntax
d46 1
a46 1
CLEANFILES+=	joe.ps1 joe.pdf
d49 3
@


1.2
log
@add build command example for ports override
@
text
@d19 1
d37 25
@


1.1
log
@convenience mirmakefile
@
text
@d1 3
a3 1
# $MirOS$
@

