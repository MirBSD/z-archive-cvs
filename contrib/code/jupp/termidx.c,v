head	1.7;
access;
symbols
	joe-3_1jupp38:1.7
	joe-3_1jupp37:1.7
	joe-3_1jupp36:1.7
	joe-3_1jupp35:1.7
	joe-3_1jupp34:1.7
	joe-3_1jupp33:1.7
	joe-3_1jupp32:1.7
	joe-2_8jupp3:1.1.21.1
	joe-3_1jupp31:1.5
	joe-3_1jupp30:1.5
	joe-3_1jupp29:1.5
	joe-3_1jupp28:1.5
	joe-3_1jupp27:1.5
	joe-3_1jupp26:1.4
	joe-3_1jupp25:1.4
	joe-3_1jupp24:1.4
	joe-3_1jupp23:1.4
	joe-3_1jupp22:1.4
	joe-3_1jupp21:1.4
	joe-3_1jupp20:1.4
	joe-3_1jupp19:1.3
	joe-3_1jupp18:1.3
	joe-3_1jupp17:1.3
	joe-2_8jupp2:1.1.21.1
	joe-3_1jupp16:1.3
	joe-3_1jupp15:1.3
	joe-3_1jupp14:1.3
	joe-3_1jupp12:1.3
	joe-3_1jupp11:1.2
	joe-2_8jupp1:1.1.21.1
	joe-3_1jupp10:1.2
	joe-3_1jupp9:1.2
	joe-3_1jupp8:1.1.201.1
	joe-3_1jupp7:1.1.201.1
	joe-3_1jupp6:1.1.201.1
	joe-3_1jupp5:1.1.201.1
	joe-3_1jupp4:1.1.201.1
	joe-2_8-msdos:1.1.21.1.0.2
	joe-2_8:1.1.21.1
	joe28:1.1.21
	joe-3_1:1.1.201.1
	tg:1.1.201;
locks; strict;
comment	@ * @;


1.7
date	2017.12.08.02.28.06;	author tg;	state Exp;
branches;
next	1.6;
commitid	1005A29F8C708B176AB;

1.6
date	2017.12.02.02.07.33;	author tg;	state Exp;
branches;
next	1.5;
commitid	1005A220AD65C90E687;

1.5
date	2014.03.04.23.04.12;	author tg;	state Exp;
branches;
next	1.4;
commitid	10053165C030FE8B28B;

1.4
date	2012.06.08.17.05.12;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004FD230DF587015A2;

1.3
date	2009.10.18.16.06.30;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004ADB3D195604AD30;

1.2
date	2008.05.13.13.08.26;	author tg;	state Exp;
branches;
next	1.1;
commitid	100482992BC01EE89A1;

1.1
date	2005.02.05.00.37.28;	author tg;	state Exp;
branches
	1.1.21.1
	1.1.201.1;
next	;

1.1.21.1
date	2005.02.12.15.40.23;	author tg;	state Exp;
branches;
next	;

1.1.201.1
date	2005.02.05.00.37.28;	author tg;	state Exp;
branches;
next	;


desc
@@


1.7
log
@label indent; small tweaks while here
@
text
@/*
 *	Program to generate termcap index file
 *	Copyright
 *		(C) 1992 Joseph H. Allen
 *
 * This file is part of JOE (Joe's Own Editor)
 */
#define EXTERN
#include "config.h"
#include "types.h"

__RCSID("$MirOS: contrib/code/jupp/termidx.c,v 1.6 2017/12/02 02:07:33 tg Exp $");

#include <string.h>

static void gen(unsigned char *s, FILE *fd)
{
	int c, x;
	off_t addr = 0, oaddr;

 loop:
	while (c = getc(fd), c == ' ' || c == '\t' || c == '#')
		do {
			c = getc(fd);
		} while (!(c == -1 || c == '\n'));
	if (c == -1)
		return;
	if (c == '\n')
		goto loop;
	oaddr = addr;
#ifdef HAVE_FSEEKO
	addr = ftello(fd) - 1;
#else
	/* well, SOL */
	addr = ftell(fd) - 1;
#endif
	ungetc(c, fd);
	s[x = 0] = 0;
	while (1) {
		c = getc(fd);
		if (c == -1 || c == '\n') {
			if (x != 0 && s[x - 1] == '\\')
				--x;
			if (x) {
				int y, z, flg;

				s[x] = 0;
				z = 0;
				flg = 0;
				do {
					for (y = z; s[y] && s[y] != '|' && s[y] != ':'; ++y) ;
					c = s[y];
					s[y] = 0;
					if (strlen((char *)(s + z)) > 2 && !strchr((char *)(s + z), ' ') && !strchr((char *)(s + z), '\t')) {
						if(flg)
							putchar(' ');
						fputs((char *)(s + z), stdout);
						flg = 1;
					}
					s[y] = c;
					z = y + 1;
				} while (c && c != ':');
				if (flg)
					printf(" %lX\n",
					    (unsigned long)(addr - oaddr));
			}
			goto loop;
		} else if (c == '\r')
			/* do nothing */ ;
		else
			s[x++] = c;
	}
}

int main(int argc, char *argv[])
{
	unsigned char array[65536];

	gen(array, stdin);
	return(0);
}
@


1.6
log
@overhaul the way includes work; give jupp proper RCS IDs

(after all, empty source files are UB; win32.c is likely)
@
text
@d12 1
a12 1
__RCSID("$MirOS$");
d21 1
a21 1
      loop:
@


1.5
log
@fix compilation on SuSE Linux 1.0
@
text
@a0 1
/* $MirOS: contrib/code/jupp/termidx.c,v 1.4 2012/06/08 17:05:12 tg Exp $ */
d8 1
d12 2
a13 1
#include <stdio.h>
@


1.4
log
@enable Large File Support
@
text
@d1 1
a1 1
/* $MirOS: contrib/code/jupp/termidx.c,v 1.3 2009/10/18 16:06:30 tg Exp $ */
d30 1
d32 4
@


1.3
log
@hex is uppercase!
@
text
@d1 1
a1 1
/* $MirOS: contrib/code/jupp/termidx.c,v 1.2 2008/05/13 13:08:26 tg Exp $ */
d18 1
a18 1
	long addr = 0, oaddr;
d30 1
a30 1
	addr = ftell(fd) - 1;
d58 2
a59 1
					printf(" %lX\n", addr - oaddr);
@


1.2
log
@prepare for joe-3.1jupp9:
* sync NEWS
* bump vsn in configure.ac
* tag all files with RCS ID
* sync licence template
@
text
@d1 1
a1 1
/* $MirOS$ */
d58 1
a58 1
					printf(" %lx\n", addr - oaddr);
@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.21.1
log
@Import joe-2.8 sources into vendor branch so it doesn't get lost
@
text
@d1 9
a9 17
/* Program to generate termcap index file
   Copyright (C) 1992 Joseph H. Allen

This file is part of JOE (Joe's Own Editor)

JOE is free software; you can redistribute it and/or modify it under the 
terms of the GNU General Public License as published by the Free Software 
Foundation; either version 1, or (at your option) any later version.  

JOE is distributed in the hope that it will be useful, but WITHOUT ANY 
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS 
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more 
details.  

You should have received a copy of the GNU General Public License along with 
JOE; see the file COPYING.  If not, write to the Free Software Foundation, 
675 Mass Ave, Cambridge, MA 02139, USA.  */ 
d12 1
d14 1
a14 3
gen(s,fd)
char *s;
FILE *fd;
d16 49
a64 38
int c,x;
long addr=0, oaddr;
loop:
while(c=getc(fd), c==' ' || c=='\t' || c=='#')
 do c=getc(fd); while(!(c== -1 || c=='\n'));
if(c== -1) return;
if(c=='\n') goto loop;
oaddr=addr;
addr=ftell(fd)-1;
ungetc(c,fd);
s[x=0]=0;
while(1)
 {
 c=getc(fd);
 if(c== -1 || c=='\n')
  {
  if(x!=0 && s[x-1]=='\\') --x;
  if(x)
   {
   int y,z,flg;
   s[x]=0; z=0; flg=0;
   do
    {
    for(y=z;s[y] && s[y]!='|' && s[y]!=':';++y);
    c=s[y]; s[y]=0;
    if(strlen(s+z)>2 && !strchr(s+z,' ') &&
       !strchr(s+z,'\t')) (flg && putchar(' ')), fputs(s+z,stdout), flg=1;
    s[y]=c;
    z=y+1;
    }
    while(c && c!=':');
   if(flg) printf(" %x\n",addr-oaddr);
   }
  goto loop;
  }
 else if(c=='\r') ;
 else s[x++]=c;
 }
d67 1
a67 1
main()
d69 4
a72 2
char array[65536];
gen(array,stdin);
@


1.1.201.1
log
@JOE's Own Editor 3.1
@
text
@@
