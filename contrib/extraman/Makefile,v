head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2016.03.04.15.00.33;	author tg;	state Exp;
branches;
next	1.5;
commitid	10056D9A31B38FA89F8;

1.5
date	2015.10.16.14.50.54;	author tg;	state Exp;
branches;
next	1.4;
commitid	10056210ED9045E511A;

1.4
date	2015.10.13.20.51.44;	author tg;	state Exp;
branches;
next	1.3;
commitid	100561D6EF014623BC3;

1.3
date	2015.10.13.20.50.57;	author tg;	state Exp;
branches;
next	1.2;
commitid	100561D6EC9583DF1E4;

1.2
date	2015.10.13.19.22.06;	author tg;	state Exp;
branches;
next	1.1;
commitid	100561D59F21AD4D713;

1.1
date	2015.04.12.21.56.00;	author tg;	state Exp;
branches;
next	;
commitid	100552AE9FB737C39D6;


desc
@@


1.6
log
@fix the worst manpage lies; joe.1 generation is really not configure.acâ€™s job
@
text
@# $MirOS: contrib/extraman/Makefile,v 1.5 2015/10/16 14:50:54 tg Exp $

all:
CLEANFILES+=	htmxtr10.ngz

.include <bsd.own.mk>

.ifndef PORTSDIR
PORTSDIR!=	x=$$(echo '.include <mirports.sys.mk>' | env -i "PATH=$$PATH" \
		    mmake -f - ___DISPLAY_MAKEVARS=PORTSDIR \
		    2>/dev/null) || x=; print -nr -- $$x
.endif

.if "${PORTSDIR}" == ""
. error PORTSDIR is empty
.endif

.if !exists(${PORTSDIR}/infrastructure/mk/mirports.bsd.mk)
. error PORTSDIR ${PORTSDIR} incorrect
.endif

.if !exists(${PORTSDIR}/games/bsdgames/Makefile)
. error PORTSDIR ${PORTSDIR} lacking bsdgames port
.endif

.if !exists(${PORTSDIR}/shells/csh/Makefile)
. error PORTSDIR ${PORTSDIR} lacking csh port
.endif

CLEANFILES+=	stamp_portmans
all: stamp_portmans
stamp_portmans:
	rm -rf portmans
	mkdir -p portmans/cat{1,2,3,3p,4,5,6,7,8,9}
	cd ${PORTSDIR:Q}/games/bsdgames && mmake clean && mmake MAN_ONLY=1 \
	    ALL_TARGET=__MANALL INSTALL_TARGET=__MANINSTALL fake
	cd ${PORTSDIR:Q}/shells/csh && mmake clean && mmake \
	    ALL_TARGET=__MANALL INSTALL_TARGET=__MANINSTALL fake
	set -o pipefail && cd $$(cd ${PORTSDIR:Q}/games/bsdgames && \
	    mmake show=WRKINST)/usr/share/man && find cat* -name \*.0 | \
	    cpio -pdluv ${.OBJDIR:Q}/portmans/
	set -o pipefail && cd $$(cd ${PORTSDIR:Q}/shells/csh && \
	    mmake show=WRKINST)/usr/mpkg/man && find cat* -name \*.0 | \
	    cpio -pdluv ${.OBJDIR:Q}/portmans/
	cd ${PORTSDIR:Q}/games/bsdgames && mmake clean
	cd ${PORTSDIR:Q}/shells/csh && mmake clean
	@@:>$@@

MAN+=		cprng.8
MAN+=		tcpdump.8

MAN+=		bjoe/joe.1
MLINKS+=	joe.1 jmacs.1
MLINKS+=	joe.1 jpico.1
MLINKS+=	joe.1 jstar.1
MLINKS+=	joe.1 jupp.1
MLINKS+=	joe.1 rjoe.1
bjoe/joe.1:
	-rm -rf bjoe
	mkdir bjoe
	cd bjoe && lndir ${BSDSRCDIR:Q}/contrib/code/jupp
	cd bjoe && rm -rf obj
	cd bjoe && ${MAKE} -f Makefile.bsd-wrapper joe.1

RxMANS+=	contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1
RxMANS+=	contrib/hosted/tg/code/kwalletcli/kwalletcli.1
RxMANS+=	contrib/hosted/tg/code/kwalletcli/kwalletcli_getpin.1
RxMANS+=	contrib/hosted/tg/code/kwalletcli/pinentry-kwallet.1
RxMANS+=	gnu/usr.bin/cvs/contrib/rcs2log.1

.for _i in ${RxMANS}
MAN+=		${_i:T}
CLEANFILES+=	${_i:T}
${_i:T}: ${BSDSRCDIR}/${_i}
	cp $> $@@
.endfor

RxGNAT+=	${.CURDIR}/gnat_ugn_unw
RxGNAT+=	${BSDSRCDIR}/gcc/gcc/ada/gnat_rm
RxGNAT+=	${BSDSRCDIR}/gcc/gcc/ada/gnat-style

.for _i in ${RxGNAT}
CLEANFILES+=	${_i:T}.html
all: ${_i:T}.html
${_i:T}.html: ${_i}.texi
	makeinfo --no-split --html \
	    -I ${BSDSRCDIR}/gcc/gcc/doc/include \
	    -I ${BSDSRCDIR}/gcc/gcc/ada \
	    $>
.endfor

CLEANFILES+=	stamp_xmans
all: stamp_xmans
stamp_xmans:
	rm -rf bxmans
	mkdir bxmans
	cd bxmans && lndir ${BSDSRCDIR:Q}/X11/xc/doc/man/GLU
	cd bxmans && xmkmf -a && exec ${MAKE}
	@@:>$@@

clean:
	rm -rf bjoe bxmans dst portmans
	rm -f a.out [Ee]rrs mklog core *.core ${CLEANFILES}

lint:
install:
	rm -rf dst
	mkdir -p dst/cat{1,2,3,3p,4,5,6,7,8,9}
	cd portmans && pax -rw -l -pe -v cat*/*.0 ../dst/
	cd bxmans && ${MAKE} MANPATH=${.OBJDIR:Q}/dst install.man
	cd ${.CURDIR:Q} && ${MAKE} MANDIR=${.OBJDIR:Q}/dst/cat \
	    MANOWN="$$(id -un)" MANGRP="$$(id -gn)" maninstall
	(. ${BSDSRCDIR:Q}/scripts/roff2htm; convert_all \
	    ${.OBJDIR:Q}/dst ${.OBJDIR:Q}/dst)
	mkdir -p dst/manINFO
.for _i in ${RxGNAT}
	cp ${_i:T}.html dst/manINFO/
.endfor
	cd dst && find man* -type f -print0 | xargs -0r chmod 644
	ln -s ../man8/praliases.htm dst/man1/praliases.htm
	ln -s add_auvis_randomness.htm dst/man9/add_audio_randomness.htm
	cd dst && find man* \( -name \*.htm -o -name \*.html \) -print0 | \
	    sort -R '' | cpio -o0vC512 -Hsv4cpio -Mdist | \
	    gzip -n9 >../htmxtr10.ngz
	rm -rf dst
	ls -la htmxtr10.ngz
.if defined(RELEASEDIR) && !empty(RELEASEDIR)
	mv -f htmxtr10.ngz ${RELEASEDIR:Q}/
.endif

.include <bsd.prog.mk>
@


1.5
log
@making __MAN{,INST}ALL always recurse has unwanted side effects; revert
@
text
@d1 1
a1 1
# $MirOS: contrib/extraman/Makefile,v 1.4 2015/10/13 20:51:44 tg Exp $
d61 3
a63 2
	cd bjoe && CC=${CC:Q} CFLAGS=${CFLAGS:Q} GCC_NO_WERROR=1 \
	    ${MKSH} ${BSDSRCDIR:Q}/contrib/code/jupp/configure
@


1.4
log
@revert verbosity removal: pax is now fixed
@
text
@d1 1
a1 1
# $MirOS: contrib/extraman/Makefile,v 1.1 2015/04/12 21:56:00 tg Exp $
d35 2
a36 3
	cd ${PORTSDIR:Q}/games/bsdgames && mmake clean && mmake \
	    MANPAGES_ONLY=1 ALL_TARGET=__MANALL \
	    INSTALL_TARGET=__MANINSTALL fake
d38 1
a38 2
	    MANPAGES_ONLY=1 ALL_TARGET=__MANALL \
	    INSTALL_TARGET=__MANINSTALL fake
@


1.3
log
@unbreak
@
text
@d43 1
a43 1
	    cpio -pdlu ${.OBJDIR:Q}/portmans/
d46 1
a46 1
	    cpio -pdlu ${.OBJDIR:Q}/portmans/
d110 1
a110 1
	cd portmans && pax -rw -l -pe cat*/*.0 ../dst/
d124 1
a124 1
	    sort -R '' | cpio -o0C512 -Hsv4cpio -Mdist | \
@


1.2
log
@add bsdgames and csh manpages
@
text
@d34 1
a34 1
	mkdir -p portmans
@


1.1
log
@generate stuff (luckily, currently, mi only) no longer in ht*.ngz
@
text
@d1 1
a1 1
# $MirOS$
d4 1
a4 1
CLEANFILES+=	extrahtmi10.ngz
d8 43
d103 1
a103 1
	rm -rf bjoe bxmans dst
d110 1
d125 1
a125 1
	    gzip -n9 >../extrahtmi10.ngz
d127 1
a127 1
	ls -la extrahtmi10.ngz
d129 1
a129 1
	mv -f extrahtmi10.ngz ${RELEASEDIR:Q}/
@

