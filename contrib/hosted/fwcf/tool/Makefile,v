head	1.5;
access;
symbols
	FWCF_1_06:1.5
	FWCF_1_05:1.5
	FWCF_1_04:1.5
	FWCF_1_03:1.5
	FWCF_1_01:1.4
	FWCF_1_00:1.4;
locks; strict;
comment	@# @;


1.5
date	2007.02.28.22.59.38;	author tg;	state Exp;
branches;
next	1.4;
commitid	10045E6092C23C8F114;

1.4
date	2006.09.26.10.25.06;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004518FFF55AB578D0;

1.3
date	2006.09.24.21.51.27;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004516FDB62809CB5C;

1.2
date	2006.09.24.21.46.17;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004516FCB12AEB461A;

1.1
date	2006.09.24.20.35.00;	author tg;	state Exp;
branches;
next	;
commitid	1004516EBC4399F582B;


desc
@@


1.5
log
@* new option -D for dumping and restoring the fwcf filesystem in a somewhat
  more portable way (i.e. without the compression, and with only parts of
  the outer header, forced to little-endianness)
* tool.c: mkfwcf() is only needed #ifndef SMALL
@
text
@# $MirOS: contrib/hosted/fwcf/tool/Makefile,v 1.4 2006/09/26 10:25:06 tg Exp $
#-
# This file is part of the FreeWRT project. FreeWRT is copyrighted
# material, please see the LICENCE file in the top-level directory
# or at http://www.freewrt.org/licence for details.

PROG=		fwcf_tool
SRCS=		tool.c ${COMPRESSORS} sys_bsd.c
NOMAN=		yes
DPADD+=		${LIBZ}
LDADD+=		-lz
CLEANFILES+=	${.CURDIR}/test_c.out ${.CURDIR}/tesz_c.out ${.CURDIR}/tesL_c.out \
		${.CURDIR}/test_c.nil ${.CURDIR}/tesz_c.nil ${.CURDIR}/tesL_c.nil \
		${.CURDIR}/test_d.out ${.CURDIR}/tesz_d.out ${.CURDIR}/tesL_d.out \
		${.CURDIR}/test_d.nil ${.CURDIR}/tesz_d.nil ${.CURDIR}/tesL_d.nil \
		${.CURDIR}/test_r.out ${.CURDIR}/tesz_r.out ${.CURDIR}/tesL_r.out \
		${.CURDIR}/test_r.nil ${.CURDIR}/tesz_r.nil ${.CURDIR}/tesL_r.nil \
		${.CURDIR}/dtest_d.out ${.CURDIR}/dtesz_d.out ${.CURDIR}/dtesL_d.out \
		${.CURDIR}/dtest_d.nil ${.CURDIR}/dtesz_d.nil ${.CURDIR}/dtesL_d.nil \
		${.CURDIR}/test_D.out ${.CURDIR}/test_D.cz

test: ${PROG}
	./${PROG} -Mo ${.CURDIR}/test_c.out ${.CURDIR}/../mkfwcf/CVS
	./${PROG} -MC 1 -o ${.CURDIR}/tesz_c.out ${.CURDIR}/../mkfwcf/CVS
	./${PROG} -MC 0x10 -o ${.CURDIR}/tesL_c.out ${.CURDIR}/../mkfwcf/CVS
	./${PROG} -Meo ${.CURDIR}/test_c.nil
	./${PROG} -MeC 1 -o ${.CURDIR}/tesz_c.nil
	./${PROG} -MeC 16 -o ${.CURDIR}/tesL_c.nil
	./${PROG} -Ud <${.CURDIR}/test_c.out >${.CURDIR}/dtest_d.out
	./${PROG} -Ud <${.CURDIR}/tesz_c.out >${.CURDIR}/dtesz_d.out
	./${PROG} -Ud <${.CURDIR}/tesL_c.out >${.CURDIR}/dtesL_d.out
	./${PROG} -Ud <${.CURDIR}/test_c.nil >${.CURDIR}/dtest_d.nil
	./${PROG} -Ud <${.CURDIR}/tesz_c.nil >${.CURDIR}/dtesz_d.nil
	./${PROG} -Ud <${.CURDIR}/tesL_c.nil >${.CURDIR}/dtesL_d.nil
	./${PROG} -Ui ${.CURDIR}/test_c.out out.test
	./${PROG} -Ui ${.CURDIR}/tesz_c.out out.tesz
	./${PROG} -Ui ${.CURDIR}/tesL_c.out out.tesL
.ifndef notyet
	./${PROG} -Ri ${.CURDIR}/tesz_c.out -o ${.CURDIR}/test_r.out
	./${PROG} -Ri ${.CURDIR}/tesz_c.nil -o ${.CURDIR}/test_r.nil
	./${PROG} -Rci ${.CURDIR}/test_c.out -o ${.CURDIR}/tesz_r.out
	./${PROG} -Rci ${.CURDIR}/test_c.nil -o ${.CURDIR}/tesz_r.nil
	./${PROG} -RC 0x10 -i ${.CURDIR}/tesz_c.out -o ${.CURDIR}/tesL_r.out
	./${PROG} -RC 16 -i ${.CURDIR}/test_c.nil -o ${.CURDIR}/tesL_r.nil
.else
	./${PROG} -Ri ${.CURDIR}/test_c.out -o ${.CURDIR}/test_r.out
	./${PROG} -Ri ${.CURDIR}/test_c.nil -o ${.CURDIR}/test_r.nil
	./${PROG} -Rci ${.CURDIR}/tesz_c.out -o ${.CURDIR}/tesz_r.out
	./${PROG} -Rci ${.CURDIR}/tesz_c.nil -o ${.CURDIR}/tesz_r.nil
.endif
	./${PROG} -UD ${.CURDIR}/test_D.out <${.CURDIR}/tesL_c.out
	./${PROG} -McD ${.CURDIR}/test_D.out >${.CURDIR}/test_D.cz

.include <bsd.prog.mk>

clean cleandir: clean-local

clean-local:
	-rm -rf out.test out.tesz out.tesL
@


1.4
log
@* fix missing includes
* cast a little more, for systems other than MirOS #9-current
* spelling
* build fwcf.helper correctly without libz
@
text
@d1 1
a1 1
# $MirOS: contrib/hosted/fwcf/tool/Makefile,v 1.3 2006/09/24 21:51:27 tg Exp $
d19 2
a20 1
		${.CURDIR}/dtest_d.nil ${.CURDIR}/dtesz_d.nil ${.CURDIR}/dtesL_d.nil
d51 2
@


1.3
log
@* switch fwcf.helper (uClibc target) to use LZO1X-1 compression
  instead of deflate compression
  On the BSD i386 host, this costs 4754 Bytes in the executable,
  but on the other hand, we can get rid of linking in libz which
  is much more heavy-weight.
* fix 'cleandir' target (BSD host)
@
text
@d1 1
a1 1
# $MirOS: contrib/hosted/fwcf/tool/Makefile,v 1.2 2006/09/24 21:46:17 tg Exp $
d5 1
a5 1
# or at http://www.freewrt.org/license for details.
@


1.2
log
@implement LZO1X-1 compression via MiniLZO (GPL'd)
@
text
@d1 1
a1 1
# $MirOS: contrib/hosted/fwcf/tool/Makefile,v 1.1 2006/09/24 20:35:00 tg Exp $
d53 1
a53 1
clean: clean-local
@


1.1
log
@* join mkfwcf.c, unfwcf.c, fwcf.helper.c into a single file tool.c
  which builds a combinded mkfwcf+unfwcf for the host normally, and
  a stripped-down tool for the target #ifdef SMALL (code sharing ;)
* enhance the tool by recompress functionality

Note: mkfwcf and unfwcf are kept for now
@
text
@d1 1
a1 1
# $MirOS: contrib/hosted/fwcf/mkfwcf/Makefile,v 1.12 2006/09/23 23:04:16 tg Exp $
d12 8
a19 6
CLEANFILES+=	${.CURDIR}/test_c.out ${.CURDIR}/tesz_c.out \
		${.CURDIR}/test_c.nil ${.CURDIR}/tesz_c.nil \
		${.CURDIR}/test_d.out ${.CURDIR}/tesz_d.out \
		${.CURDIR}/test_d.nil ${.CURDIR}/tesz_d.nil \
		${.CURDIR}/test_r.out ${.CURDIR}/tesz_r.out \
		${.CURDIR}/test_r.nil ${.CURDIR}/tesz_r.nil
d24 1
d27 7
a33 4
	./${PROG} -Ud <${.CURDIR}/test_c.out >${.CURDIR}/test_d.out
	./${PROG} -Ud <${.CURDIR}/tesz_c.out >${.CURDIR}/tesz_d.out
	./${PROG} -Ud <${.CURDIR}/test_c.nil >${.CURDIR}/test_d.nil
	./${PROG} -Ud <${.CURDIR}/tesz_c.nil >${.CURDIR}/tesz_d.nil
d36 1
d42 2
d56 1
a56 1
	-rm -rf out.test out.tesz
@

