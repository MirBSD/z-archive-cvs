head	1.12;
access;
symbols
	kwalletcli-3_02:1.12
	kwalletcli-3_01:1.10
	kwalletcli-3_00:1.10
	kwalletcli-2_12:1.7
	kwalletcli-2_11:1.7
	kwalletcli-2_10:1.7
	kwalletcli-2_03:1.5
	kwalletcli-2_02:1.3
	kwalletcli-2_01:1.3
	kwalletcli-2_00:1.3
	kwalletcli-1_00:1.2;
locks; strict;
comment	@.\" @;


1.12
date	2018.12.25.19.38.12;	author tg;	state Exp;
branches;
next	1.11;
commitid	1005C22871909EC7FE2;

1.11
date	2018.10.07.01.10.17;	author tg;	state Exp;
branches;
next	1.10;
commitid	1005BB95CA10BF418E8;

1.10
date	2016.08.30.18.26.43;	author tg;	state Exp;
branches;
next	1.9;
commitid	10057C5CFF84BB87412;

1.9
date	2016.08.30.17.37.57;	author tg;	state Exp;
branches;
next	1.8;
commitid	10057C5C48D23D151BB;

1.8
date	2016.02.11.20.12.12;	author tg;	state Exp;
branches;
next	1.7;
commitid	10056BCEAFF41919B5B;

1.7
date	2011.04.09.20.21.15;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004DA0BFBF055EFBCA;

1.6
date	2011.04.09.20.03.48;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004DA0BB9C16060951;

1.5
date	2010.11.16.09.16.08;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004CE24BEA01DBDB3D;

1.4
date	2010.11.16.09.11.15;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004CE24AB21232A3D6;

1.3
date	2009.11.22.18.23.30;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004B0981B210A68B89;

1.2
date	2009.07.08.12.34.20;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004A54925F1DFDC97E;

1.1
date	2009.06.10.19.18.23;	author tg;	state Exp;
branches;
next	;
commitid	1004A300713445F812D;


desc
@@


1.12
log
@update from contrib/samples/portmdoc,v 1.11
@
text
@.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.11 2018/10/07 01:10:17 tg Exp $
.\"-
.\" Copyright © 2009, 2010, 2011, 2016, 2018
.\"	mirabilos <m@@mirbsd.org>
.\"
.\" Provided that these terms and disclaimer and all copyright notices
.\" are retained or reproduced in an accompanying document, permission
.\" is granted to deal in this work without restriction, including un‐
.\" limited rights to use, publicly perform, distribute, sell, modify,
.\" merge, give away, or sublicence.
.\"
.\" This work is provided “AS IS” and WITHOUT WARRANTY of any kind, to
.\" the utmost extent permitted by applicable law, neither express nor
.\" implied; without malicious intent or gross negligence. In no event
.\" may a licensor, author or contributor be held liable for indirect,
.\" direct, other damage, loss, or other issues arising in any way out
.\" of dealing in the work, even if advised of the possibility of such
.\" damage or existence of a defect, except proven that it results out
.\" of said person’s immediate fault when using the work as intended.
.\"-
.\" Try to make GNU groff and AT&T nroff more compatible
.\" * ` generates ‘ in gnroff, so use \`
.\" * ' generates ’ in gnroff, \' generates ´, so use \*(aq
.\" * - generates ‐ in gnroff, \- generates −, so .tr it to -
.\"   thus use - for hyphens and \- for minus signs and option dashes
.\" * ~ is size-reduced and placed atop in groff, so use \*(TI
.\" * ^ is size-reduced and placed atop in groff, so use \*(ha
.\" * \(en does not work in nroff, so use \*(en
.\" * <>| are problematic, so redefine and use \*(Lt\*(Gt\*(Ba
.\" Also make sure to use \& *before* a punctuation char that is to not
.\" be interpreted as punctuation, and especially with two-letter words
.\" but also (after) a period that does not end a sentence (“e.g.\&”).
.\" The section after the "doc" macropackage has been loaded contains
.\" additional code to convene between the UCB mdoc macropackage (and
.\" its variant as BSD mdoc in groff) and the GNU mdoc macropackage.
.\"
.ie \n(.g \{\
.	if \*[.T]ascii .tr \-\N'45'
.	if \*[.T]latin1 .tr \-\N'45'
.	if \*[.T]utf8 .tr \-\N'45'
.	ds <= \[<=]
.	ds >= \[>=]
.	ds Rq \[rq]
.	ds Lq \[lq]
.	ds sL \(aq
.	ds sR \(aq
.	if \*[.T]utf8 .ds sL `
.	if \*[.T]ps .ds sL `
.	if \*[.T]utf8 .ds sR '
.	if \*[.T]ps .ds sR '
.	ds aq \(aq
.	ds TI \(ti
.	ds ha \(ha
.	ds en \(en
.\}
.el \{\
.	ds aq '
.	ds TI ~
.	ds ha ^
.	ds en \(em
.\}
.\"
.\" Implement .Dd with the Mdocdate RCS keyword
.\"
.rn Dd xD
.de Dd
.ie \\$1$Mdocdate: \{\
.	xD \\$2 \\$3, \\$4
.\}
.el .xD \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8
..
.\"
.\" .Dd must come before definition of .Mx, because when called
.\" with -mandoc, it might implement .Mx itself, but we want to
.\" use our own definition. And .Dd must come *first*, always.
.\"
.Dd $Mdocdate: December 25 2018 $
.\"
.\" Check which macro package we use, and do other -mdoc setup.
.\"
.ie \n(.g \{\
.	if \*[.T]utf8 .tr \[la]\*(Lt
.	if \*[.T]utf8 .tr \[ra]\*(Gt
.	ie d volume-ds-1 .ds tT gnu
.	el .ie d doc-volume-ds-1 .ds tT gnp
.	el .ds tT bsd
.\}
.el .ds tT ucb
.\"
.\" Implement .Mx (MirBSD)
.\"
.ie "\*(tT"gnu" \{\
.	eo
.	de Mx
.	nr curr-font \n[.f]
.	nr curr-size \n[.ps]
.	ds str-Mx \f[\n[curr-font]]\s[\n[curr-size]u]
.	ds str-Mx1 \*[Tn-font-size]\%MirBSD\*[str-Mx]
.	if !\n[arg-limit] \
.	if \n[.$] \{\
.	ds macro-name Mx
.	parse-args \$@@
.	\}
.	if (\n[arg-limit] > \n[arg-ptr]) \{\
.	nr arg-ptr +1
.	ie (\n[type\n[arg-ptr]] == 2) \
.	as str-Mx1 \~\*[arg\n[arg-ptr]]
.	el \
.	nr arg-ptr -1
.	\}
.	ds arg\n[arg-ptr] "\*[str-Mx1]
.	nr type\n[arg-ptr] 2
.	ds space\n[arg-ptr] "\*[space]
.	nr num-args (\n[arg-limit] - \n[arg-ptr])
.	nr arg-limit \n[arg-ptr]
.	if \n[num-args] \
.	parse-space-vector
.	print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[Tn-font-size]
.\}
.el .ie "\*(tT"gnp" \{\
.	eo
.	de Mx
.	nr doc-curr-font \n[.f]
.	nr doc-curr-size \n[.ps]
.	ds doc-str-Mx \f[\n[doc-curr-font]]\s[\n[doc-curr-size]u]
.	ds doc-str-Mx1 \*[doc-Tn-font-size]\%MirBSD\*[doc-str-Mx]
.	if !\n[doc-arg-limit] \
.	if \n[.$] \{\
.	ds doc-macro-name Mx
.	doc-parse-args \$@@
.	\}
.	if (\n[doc-arg-limit] > \n[doc-arg-ptr]) \{\
.	nr doc-arg-ptr +1
.	ie (\n[doc-type\n[doc-arg-ptr]] == 2) \
.	as doc-str-Mx1 \~\*[doc-arg\n[doc-arg-ptr]]
.	el \
.	nr doc-arg-ptr -1
.	\}
.	ds doc-arg\n[doc-arg-ptr] "\*[doc-str-Mx1]
.	nr doc-type\n[doc-arg-ptr] 2
.	ds doc-space\n[doc-arg-ptr] "\*[doc-space]
.	nr doc-num-args (\n[doc-arg-limit] - \n[doc-arg-ptr])
.	nr doc-arg-limit \n[doc-arg-ptr]
.	if \n[doc-num-args] \
.	doc-parse-space-vector
.	doc-print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[doc-Tn-font-size]
.\}
.el \{\
.	de Mx
.	nr cF \\n(.f
.	nr cZ \\n(.s
.	ds aa \&\f\\n(cF\s\\n(cZ
.	if \\n(aC==0 \{\
.		ie \\n(.$==0 \&MirBSD\\*(aa
.		el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
.	\}
.	if \\n(aC>\\n(aP \{\
.		nr aP \\n(aP+1
.		ie \\n(C\\n(aP==2 \{\
.			as b1 \&MirBSD\ #\&\\*(A\\n(aP\\*(aa
.			ie \\n(aC>\\n(aP \{\
.				nr aP \\n(aP+1
.				nR
.			\}
.			el .aZ
.		\}
.		el \{\
.			as b1 \&MirBSD\\*(aa
.			nR
.		\}
.	\}
..
.\}
.\"-
.Dt KWALLETASKPASS 1
.Os
.Sh NAME
.Nm kwalletaskpass
.Nd kwallet-based pass-phrase dialog for use with OpenSSH
.Sh SYNOPSIS
.Nm
.Op Ar options
.Ar label
.Sh DESCRIPTION
.Nm
is a kwallet- and pinentry-based pass-phrase dialog for use with OpenSSH.
It is intended to be called from the
.Xr ssh\-add 1
program and not invoked directly.
.Pp
If a passphrase is requested,
.Nm
works by first looking up the passphrase in the KWallet by means of
.Xr kwalletcli 1 ;
using it if found, then calling
.Xr kwalletcli_getpin 1
to interactively retrieve an answer from the user via
.Nm pinentry
otherwise.
If the user specifies a passphrase,
.Xr kwalletcli_getpin 1
is run again to ask if the passphrase should be stored in the KWallet.
Negative answers will be stored in the KWallet to avoid being asked each time.
.Nm
uses the KWallet folders
.Ic kwalletaskpass
and
.Ic kwalletaskpass\-blacklist
with matching entry names.
.Pp
If anything other than a key passphrase is requested, it is merely relayed to
.Xr kwalletcli_getpin 1 .
Some requests are known to require a boolean answer and are relayed
using the boolean query flag; all others are relayed using a PIN query.
.Xr ssh 1
accepts either the literal word
.Dq yes
.Pq case-insensitively matched
or an empty answer (both only when using the OK button) as confirmation.
.Pp
There are currently no options.
.Sh RETURN VALUES
.Nm
exits 0 on success, 1 if the user cancelled the dialogue,
or \*(Gt1 if an error occurred.
.Sh ENVIRONMENT
.Bl -tag -width PINENTRY
.It Ev DISPLAY
The X11 display to use for child processes.
If this is unset or empty,
.Nm kwalletcli
will not be called.
.It Ev PINENTRY
The
.Nm pinentry
program to use.
The default is inherited from
.Xr kwalletcli_getpin 1 .
.El
.Sh SEE ALSO
.Xr kwalletcli 1 ,
.Xr kwalletcli_getpin 1 ,
.Xr ssh\-add 1 ,
.Xr ssh\-askpass 1
.Sh AUTHORS
.Nm
was written by
.An mirabilos Aq m@@mirbsd.org
mostly for tarent solutions GmbH.
The idea came from an
.Pa askpass.C
file found somewhere on the 'net, with no author information.
Since it was licenced less freely, this is a rewrite from scratch;
modular and with more functionality, too.
@


1.11
log
@spelling cleanup: “programme” is distinct from “program”; even in
British English, the latter is used for computer programs, while
the former serves for things like the TV programme, or a programme
to plant trees
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.10 2016/08/30 18:26:43 tg Exp $
d3 1
a3 1
.\" Copyright © 2009, 2010, 2011, 2016
d77 1
a77 1
.Dd $Mdocdate: August 30 2016 $
d85 1
d98 1
a98 1
.	ds str-Mx1 \*[Tn-font-size]\%MirOS\*[str-Mx]
d124 32
d162 1
a162 1
.		ie \\n(.$==0 \&MirOS\\*(aa
d168 1
a168 1
.			as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
d176 1
a176 1
.			as b1 \&MirOS\\*(aa
@


1.10
log
@lintian’s spell checker
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.9 2016/08/30 17:37:57 tg Exp $
d164 1
a164 1
programme and not invoked directly.
d211 1
a211 1
programme to use.
@


1.9
log
@governance
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.8 2016/02/11 20:12:12 tg Exp $
d77 1
a77 1
.Dd $Mdocdate: February 11 2016 $
d200 1
a200 1
or \*(Gt1 if an error occured.
@


1.8
log
@merge most recent portmdoc into a̲l̲l̲ of its users; fixup .\& into \&. like
in mksh(1), for Schillix ditroff
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.6 2011/04/09 20:03:48 tg Exp $
d77 1
a77 1
.Dd $Mdocdate: April 9 2011 $
d223 2
a224 2
.An Thorsten Glaser Aq tg@@mirbsd.org
mostly for tarent GmbH.
@


1.7
log
@store negative answes to the “do you want to store X in the KDE Wallet?”
in the wallet to avoid asking the user each time
@
text
@d3 2
a4 2
.\" Copyright © 2009, 2010, 2011
.\"	Thorsten Glaser <tg@@mirbsd.org>
d29 8
d38 13
d62 1
d64 1
d72 77
a149 1
.Dd $Mdocdate: April 9 2011 $
@


1.6
log
@hrm, Debian #608476 “should” already work… but pimp the docs and
whitelist some boolean queries reading openssh-current source anyway
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.5 2010/11/16 09:16:08 tg Exp $
d50 1
a50 1
.Dd $Mdocdate: November 16 2010 $
d79 8
@


1.5
log
@improve documentation re. $DISPLAY
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.4 2010/11/16 09:11:15 tg Exp $
d3 1
a3 1
.\" Copyright © 2009, 2010
d79 1
a79 1
If a confirmation instead of a passphrase is requested, it is merely relayed to
d81 7
@


1.4
log
@don’t attempt to call kwalletcli if $DISPLAY is unset or empty
e.g. ssh without X forwarding, gpg-agent
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.3 2009/11/22 18:23:30 tg Exp $
d50 1
a50 1
.Dd $Mdocdate: November 22 2009 $
d90 2
a91 2
The X11 server to use.
If this is unset or empty, calling
d93 1
a93 1
is not attempted, because the KDE Wallet needs X11.
@


1.3
log
@fix more manpages
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.2 2009/07/08 12:34:20 tg Exp $
d3 1
a3 1
.\" Copyright © 2009
d50 1
a50 1
.Dd $Mdocdate: July 8 2009 $
d89 5
@


1.2
log
@+kwalletaskpass
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletaskpass.1,v 1.1 2009/06/10 19:18:23 tg Exp $
d22 3
a24 3
.\" * ` generates ‘ in groff, so use \`
.\" * ' generates ’ in groff, \' generates ´, so use \*(aq
.\" * - generates ‐ in groff, \- generates −, fixed in tmac/mdoc/doc-groff
d50 1
a50 1
.Dd $Mdocdate: June 10 2009 $
d64 1
a64 1
.Xr ssh-add 1
d86 1
a86 1
or >1 if an error occured.
d99 2
a100 2
.Xr ssh-add 1 ,
.Xr ssh-askpass 1
@


1.1
log
@add more stubs
@
text
@d1 1
a1 1
.\" $MirOS: contrib/hosted/tg/code/kwalletcli/kwalletcli.1,v 1.2 2009/06/10 19:15:55 tg Exp $
d55 56
@

