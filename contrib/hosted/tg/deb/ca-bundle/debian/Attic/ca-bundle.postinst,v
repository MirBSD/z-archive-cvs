head	1.6;
access;
symbols
	ca-bundle-20170309:1.5
	ca-bundle-20140329:1.5
	ca-bundle-20120530:1.5
	ca-bundle_20110214:1.2.0.2;
locks; strict;
comment	@# @;


1.6
date	2017.07.31.17.44.56;	author tg;	state dead;
branches;
next	1.5;
commitid	100597F6CAF754E3CF3;

1.5
date	2012.05.30.19.42.00;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004FC6780B05ACF8E9;

1.4
date	2011.09.06.20.18.40;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004E66803860B3D4BE;

1.3
date	2011.03.30.10.45.25;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004D9309D336C5458B;

1.2
date	2009.11.23.14.21.29;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004B0A9A797B2E490E;

1.1
date	2009.11.22.22.08.44;	author tg;	state Exp;
branches;
next	;
commitid	1004B09B67E4C994FE3;


desc
@@


1.6
log
@stop tracking this in CVS
@
text
@#!/bin/sh
# $MirOS: contrib/hosted/tg/deb/ca-bundle/debian/ca-bundle.postinst,v 1.5 2012/05/30 19:42:00 tg Exp $

set -e

# This maintainer script can be called the following ways:
#
# * new-postinst "configure" [$most_recently_configured_version]
# The package is unpacked; all dependencies are unpacked and, when there
# are no circular dependencies, configured.
#
# * old-postinst "abort-upgrade" $new_version
# * conflictors-postinst "abort-remove" "in-favour" $package
#	$new_version
# * postinst "abort-remove"
# * deconfigureds-postinst "abort-deconfigure" "in-favour"
#	$failed_install_package $fip_version ["removing"
#	$conflicting_package $cp_version]
# The package is unpacked; all dependencies are at least Half-Installed,
# previously been configured, and not removed. In some error situations,
# dependencies may not be even fully unpacked.
#
# * postinst "triggered" "${triggers[*]}"
# For trigger-only calls, i.e. if "configure" is not called.

trigger_gcj_keystore() {
	# sharing a conffile with libgcj-common is impossible,
	# no matter whether we depend on it or not, so we must
	# ditch strict Policy here and ship ours, always
	mkdir -p /etc/java
	rm -f /etc/java/cacerts-gcj
	cp /usr/share/ca-bundle/keystore.gcj /etc/java/cacerts-gcj
}

case $1 in
configure)
	# on first installation
	if test -z "$2"; then
		rm -f /etc/ssl/certs/ca-certificates.crt* \
		    /etc/ssl/certs/java/cacerts
	fi

	# upgrade from ca-certificates-java package
	if [ -e /etc/ca-certificates/update.d/jks-keystore ]; then
		rm -f /etc/ca-certificates/update.d/jks-keystore
		rm -rf /etc/ssl/certs/java
	fi

	# create necessary directories
	mkdir -p /etc/ssl/certs/java

	# drop all broken symbolic links
	find /etc/ssl/certs -type l -print | while read f; do
		test -f "$f" || rm -f "$f"
	done

	# install the PEM certificate files (for OpenSSL)
	(cd /usr/share/ca-bundle/certs; for f in *; do
		if test -h /etc/ssl/certs/$f; then
			# drop any symlink to old packages
			r=$(readlink /etc/ssl/certs/$f)
			case $r in
			/usr/share/ca-bundle/*)
				rm -f /etc/ssl/certs/$f
				;;
			/usr/share/ca-certificates/*)
				rm -f /etc/ssl/certs/$f
				;;
			/usr/share/ca-certificates-java/*)
				rm -f /etc/ssl/certs/$f
				;;
			esac
			# keep any non-broken symlinks...
			if test -f /etc/ssl/certs/$f; then
				# ... to stuff not ours
				continue
			else
				rm -f /etc/ssl/certs/$f
			fi
		elif test -f /etc/ssl/certs/$f; then
			# keep any non-symlink files
			continue
		elif test -d /etc/ssl/certs/$f; then
			# keep any non-symlink dirs (oO?)
			continue
		fi
		ln -sf /usr/share/ca-bundle/certs/$f /etc/ssl/certs/$f
	done)

	# install the PEM certificate bundle (for GnuTLS)
	test -f /etc/ssl/certs/ca-certificates.crt || {
		rm -f /etc/ssl/certs/ca-certificates.crt*
		cp /usr/share/ca-bundle/ca-certificates.crt /etc/ssl/certs/
	}

	# install the JKS keystore if it did not exist (or first install)
	if test \! -s /etc/ssl/certs/java/cacerts; then
		rm -f /etc/ssl/certs/java/cacerts
		cp /usr/share/ca-bundle/keystore.jks /etc/ssl/certs/java/cacerts
	fi

	# handle the GCJ keystore
	trigger_gcj_keystore
	;;

abort-upgrade|abort-remove|abort-deconfigure)
	;;

triggered)
	# someone upgraded libgcj-common, time to put ours back
	trigger_gcj_keystore
	;;

*)
	echo >&2 "postinst called with unknown subcommand '$1'"
	exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
@


1.5
log
@merge rest of tarent packaging improvements: gcj, conflicts,
move the update-ca-certificates script back to /usr/sbin
@
text
@d2 1
a2 1
# $MirOS: contrib/hosted/tg/deb/ca-bundle/debian/ca-bundle.postinst,v 1.4 2011/09/06 20:18:40 tg Exp $
@


1.4
log
@Fix maintainer scripts and drop dh_installdirs
@
text
@d2 1
a2 1
# $MirOS: contrib/hosted/tg/deb/jupp/debian/jupp.postinst,v 1.10 2011/09/06 20:07:39 tg Exp $
d26 9
d101 3
d110 2
@


1.3
log
@part 4/4: prepare upload of a new package
@
text
@d2 1
a2 1
# $MirOS: contrib/hosted/tg/deb/ca-bundle/debian/ca-bundle.postinst,v 1.2 2009/11/23 14:21:29 tg Exp $
d6 20
d29 1
a29 1
	if [ -z "$2" ]; then
d97 3
d101 1
a101 1
	echo "postinst called with unknown argument '$1'" >&2
@


1.2
log
@upgrade and tweak
@
text
@d2 1
a2 1
# $MirOS$
d23 5
d31 14
d46 1
d52 4
@


1.1
log
@dump almost all of the MirDebian “WTF” Repository in here
for further improvements, backups, collaboration possibilities, etc.
CVS: ----------------------------------------------------------------------
CVS: ATTENTION: read-only mode selected!
CVS: Enter Log.  Lines beginning with `CVS:' are removed automatically
CVS:
CVS: Committing in .
CVS:
CVS: Added Files:
CVS: 	ca-bundle/bsd/certdata.txt ca-bundle/bsd/keystore.jks
CVS: 	ca-bundle/bsd/ksslcalist ca-bundle/bsd/ssl.certs.shar
CVS: 	ca-bundle/debian/ca-bundle.install
CVS: 	ca-bundle/debian/ca-bundle.links
CVS: 	ca-bundle/debian/ca-bundle.manpages
CVS: 	ca-bundle/debian/ca-bundle.postinst
CVS: 	ca-bundle/debian/ca-bundle.postrm ca-bundle/debian/changelog
CVS: 	ca-bundle/debian/compat ca-bundle/debian/control
CVS: 	ca-bundle/debian/copyright ca-bundle/debian/rules
CVS: 	ca-bundle/debian/source.lintian-overrides
CVS: 	ca-bundle/debian/lintian/ca-bundle
CVS: 	ca-bundle/sbin/update-ca-certificates
CVS: 	ca-bundle/sbin/update-ca-certificates.8
CVS: 	mbsd-bug/debian/NOTE.crtstuff mbsd-bug/debian/NOTE.sysroot
CVS: 	mbsd-bug/debian/PKG.install
CVS: 	mbsd-bug/debian/PKG.lintian-overrides
CVS: 	mbsd-bug/debian/changelog mbsd-bug/debian/compat
CVS: 	mbsd-bug/debian/control mbsd-bug/debian/copyright
CVS: 	mbsd-bug/debian/mirdefs.h mbsd-bug/debian/rules
CVS: 	mbsd-bug/debian/source.lintian-overrides
CVS: 	mircpio/debian/changelog mircpio/debian/compat
CVS: 	mircpio/debian/control mircpio/debian/copyright
CVS: 	mircpio/debian/install mircpio/debian/manpages
CVS: 	mircpio/debian/rules mircpio/debian/watch
CVS: 	mircpio/debian/diffs/extern.h.diff mirmake/debian/changelog
CVS: 	mirmake/debian/compat mirmake/debian/control
CVS: 	mirmake/debian/copyright mirmake/debian/instnames.ed
CVS: 	mirmake/debian/mirmake.install mirmake/debian/mirmake.manpages
CVS: 	mirmake/debian/rules mirmake/debian/watch
CVS: 	openntpd/debian/changelog openntpd/debian/compat
CVS: 	openntpd/debian/control openntpd/debian/copyright
CVS: 	openntpd/debian/ntp.conf openntpd/debian/ntp.cron.daily
CVS: 	openntpd/debian/ntp.default openntpd/debian/ntp.dhcp
CVS: 	openntpd/debian/ntp.init openntpd/debian/ntpdate.default
CVS: 	openntpd/debian/ntpdate.dhcp openntpd/debian/ntpdate.if-up
CVS: 	openntpd/debian/openntpd.default openntpd/debian/openntpd.docs
CVS: 	openntpd/debian/openntpd.init
CVS: 	openntpd/debian/openntpd.postinst
CVS: 	openntpd/debian/openntpd.postrm openntpd/debian/openntpd.prerm
CVS: 	openntpd/debian/rules openntpd/debian/source.lintian-overrides
CVS: 	openntpd/debian/watch openntpd/debian/patches/00list
CVS: 	openntpd/debian/patches/01-config.dpatch
CVS: 	openntpd/debian/patches/02-reconnect.dpatch
CVS: 	openntpd/debian/patches/03-ipv4only.patch
CVS: 	openntpd/debian/patches/04-backslash.patch
CVS: 	openntpd/debian/patches/05-mirtropy.dpatch
CVS: 	openntpd/debian/patches/06-libbsd.dpatch
CVS: 	openntpd/debian/patches/07-fixsympas.dpatch
CVS: 	openntpd/debian/patches/openntpd-3.9p1-linux-adjtimex.diff
CVS: 	openntpd/debian/script/openntpd php-perl/debian/changelog
CVS: 	php-perl/debian/changelog.xsl php-perl/debian/compat
CVS: 	php-perl/debian/control php-perl/debian/copyright
CVS: 	php-perl/debian/docs php-perl/debian/pecl
CVS: 	php-perl/debian/perl.ini php-perl/debian/php5-perl.dirs
CVS: 	php-perl/debian/rules php-perl/debian/watch
CVS: 	wtf-debian-keyring/debian/changelog
CVS: 	wtf-debian-keyring/debian/control
CVS: 	wtf-debian-keyring/debian/copyright
CVS: 	wtf-debian-keyring/debian/postinst
CVS: 	wtf-debian-keyring/debian/prerm
CVS: 	wtf-debian-keyring/debian/rules
CVS: 	wtf-debian-keyring/keyrings/wtf-debian-keyring.gpg
CVS: 	wtf-debian-keyring/keyrings/wtf-debian-removed-keys.gpg
CVS: ----------------------------------------------------------------------
@
text
@d2 1
@

