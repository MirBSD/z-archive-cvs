head	1.6;
access;
symbols
	MIRBSD_10:1.4.0.2
	MIRBSD_10_BASE:1.4
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.1.1.2.0.2
	MIRBSD_8_BASE:1.1.1.2
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.6
date	2019.08.25.21.26.00;	author tg;	state Exp;
branches;
next	1.5;
commitid	1005D62FCDC7F4EA8E0;

1.5
date	2017.08.07.20.18.03;	author tg;	state Exp;
branches;
next	1.4;
commitid	1005988C69344442E37;

1.4
date	2007.02.02.16.45.12;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045C36A7B5DB2058E;

1.3
date	2006.05.07.06.54.49;	author tg;	state Exp;
branches;
next	1.2;
commitid	100445D99B5084761F0;

1.2
date	2006.01.22.01.29.48;	author tg;	state Exp;
branches;
next	1.1;
commitid	10043D2DF987DB6621F;

1.1
date	2005.02.05.17.27.07;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.07;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.21.20.58.26;	author tg;	state Exp;
branches;
next	;
commitid	560042e0092f571e;


desc
@@


1.6
log
@allow init(8) write+stir access to arandom(4) in high securelevels,
for system shutdown; correct and update related info in manpage
@
text
@.\" $MirOS$
.\" $OpenBSD: securelevel.7,v 1.17 2005/05/12 08:16:06 jmc Exp $
.\"
.\" Copyright (c) 2000 Hugh Graham
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED
.\" WARRANTIES, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate$
.Dt SECURELEVEL 7
.Os
.Sh NAME
.Nm securelevel
.Nd securelevel and its effects
.Sh SYNOPSIS
The
.Ox
kernel provides four levels of system security:
.Bl -tag -width flag
.It \&-1 Em Permanently insecure mode
.Bl -hyphen -compact
.It
.Xr init 8
will not attempt to raise the securelevel
.It
may only be set with
.Xr sysctl 8
while the system is insecure
.It
otherwise identical to securelevel 0
.El
.It \ 0 Em Insecure mode
.Bl -hyphen -compact
.It
used during bootstrapping and while the system is single-user
.It
all devices may be read or written subject to their permissions
.It
system file flags may be cleared
.El
.It \ 1 Em Secure mode
.Bl -hyphen -compact
.It
default mode when system is multi-user
.It
securelevel may no longer be lowered except by init
.It
.Pa /dev/mem
and
.Pa /dev/kmem
may not be written to
.It
raw disk devices of mounted filesystems are read-only
.It
system immutable and append-only file flags may not be removed
.It
kernel modules may not be loaded or unloaded
.It
the
.Va fs.posix.setuid
.Xr sysctl 8
variable may not be changed
.It
the
.Va net.inet.ip.sourceroute
.Xr sysctl 8
variable may not be changed
.It
the
.Va machdep.kbdreset
.Xr sysctl 8
variable may not be changed
.El
.It \ 2 Em Highly secure mode
.Bl -hyphen -compact
.It
all effects of securelevel 1
.It
raw disk devices are always read-only whether mounted or not
.It
.Xr settimeofday 2
and
.Xr clock_settime 2
may not set the time backwards or close to overflow
.It
.Xr pf 4
filter and NAT rules may not be altered
.It
the
.Va ddb.console
and
.Va ddb.panic
.Xr sysctl 8
variables may not be raised
.It
Filesystems may neither be mounted nor umounted.
(Maybe other operations should be denied, too.)
.It
Writes to the random number generator devices, namely
.Pa /dev/srandom ,
.Pa /dev/urandom
and
.Pa /dev/arandom ,
are prohibited, as well as several IOCTLs.
The addpool is still processed (there is an extra sysctl to disable
it) and can be filled from userland by writing to the KERN_ARND sysctl;
.Xr init 8
is permitted to add to arandom and restir.
.El
.El
.Sh DESCRIPTION
Securelevel provides convenient means of
.Dq locking down
a system to a degree suited to its environment.
It is normally set at boot via the
.Xr rc.securelevel 8
script, or the superuser may raise securelevel at any time by modifying the
.Va kern.securelevel
.Xr sysctl 8
variable.
However, only
.Xr init 8
may lower it once the system has entered secure mode.
A kernel built with
.Cm option INSECURE
in the config file will default to permanently insecure mode.
(Setting the securelevel to -1 in
.Pa /etc/rc.securelevel
has the same effect.)
.Pp
Highly secure mode may seem Draconian, but is intended as a last line of
defence should the superuser account be compromised.
Its effects preclude
circumvention of file flags by direct modification of a raw disk device,
or erasure of a filesystem by means of
.Xr newfs 8 .
Further, it can limit the potential damage of a compromised
.Dq firewall
by prohibiting the modification of packet filter rules.
Preventing
the system clock from being set backwards aids in post-mortem analysis
and helps ensure the integrity of logs.
Precision timekeeping is not
affected because the clock may still be slowed.
.Pp
Because securelevel can be modified with the in-kernel debugger
.Xr ddb 4 ,
a convenient means of locking it off (if present) is provided
on highly secure systems.
This is accomplished by setting
.Va ddb.console
and
.Va ddb.panic
to 0 with the
.Xr sysctl 8
utility.
.Sh FILES
.Bl -tag -width /etc/rc.securelevel -compact
.It Pa /etc/rc.securelevel
commands that run before the security level changes
.El
.Sh SEE ALSO
.Xr chflags 2 ,
.Xr settimeofday 2 ,
.Xr mem 4 ,
.Xr options 4 ,
.Xr init 8 ,
.Xr rc 8 ,
.Xr sysctl 8
.Sh HISTORY
The
.Nm
manual page first appeared in
.Ox 2.6 .
.Pp
Mounting was disallowed in highly secure mode in
.Mx 9 .
.Sh CAVEATS
Securelevels defend against a compromisal of the root account.
The 4\.4BSD kernel however is not designed for such thing,
thus, securelevels should only be used as a tool for convenience,
not be seen as an actual security measure.
.Sh BUGS
The list of securelevel's effects may not be comprehensive.
@


1.5
log
@filesystem
@
text
@d1 2
a2 1
.\"     $OpenBSD: securelevel.7,v 1.17 2005/05/12 08:16:06 jmc Exp $
d27 1
a27 1
.Dd January 4, 2000
d119 2
a120 1
.Pa /dev/urandom ,
a121 3
.Pa /dev/wrandom ,
and
.Pa /dev/prandom ,
d123 4
a126 3
The addpool is still processed (there is an extra
sysctl to disable it) but can be filled from userland
only by writing to the KERN_ARND sysctl.
@


1.4
log
@make /dev/wrandom as alias for /dev/prandom but allow it to
be written to - I plan to emulate our entropy suite on other
OSes where /dev/prandom may be read-only emulated by pipes
or similar means
@
text
@d70 1
a70 1
raw disk devices of mounted file systems are read-only
d153 1
a153 1
or erasure of a file system by means of
@


1.3
log
@disallow some writing/flushing operations on the rnd device
when the system is in "highly secure mode", inspired by gecko2
@
text
@d120 1
@


1.2
log
@while I don't think "securelevels" are a security measure,
only a convenience thing helping if root is compromised(*)
to control damage, disallow the mount(2) and umount(2) sy-
stem calls in highly secure mode.

Not recommended for MFC.
Fixes: http://www.redteam-pentesting.de/advisories/rt-sa-2005-15.txt
@
text
@d115 11
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.15 2004/01/08 10:56:07 jmc Exp $
d79 1
a79 1
variable may not be raised
d84 6
a89 1
variable may not be raised
d103 2
a104 2
.Xr pfctl 8
may no longer alter filter or nat rules
d112 3
d133 3
d181 8
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.17 2005/05/12 08:16:06 jmc Exp $
d79 1
a79 1
variable may not be changed
d84 1
a84 6
variable may not be changed
.It
the
.Va machdep.kbdreset
.Xr sysctl 8
variable may not be changed
d98 2
a99 2
.Xr pf 4
filter and NAT rules may not be altered
@

