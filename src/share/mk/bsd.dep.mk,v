head	1.14;
access;
symbols
	MIRBSD_10:1.12.0.2
	MIRBSD_10_BASE:1.12
	MIRBSD_9_BASE:1.11
	MIRBSD_8:1.8.0.2
	MIRBSD_8_BASE:1.8
	cvs-200507211800:1.1.1.1
	cvs-200507040220:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.14
date	2008.04.10.14.07.45;	author tg;	state Exp;
branches;
next	1.13;
commitid	10047FE1F455D192B1C;

1.13
date	2008.04.10.13.55.55;	author tg;	state Exp;
branches;
next	1.12;
commitid	10047FE1C7755F47616;

1.12
date	2007.04.28.00.12.46;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004632918E6CE6474D;

1.11
date	2006.03.27.09.24.51;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004427AF6B36CCBFD4;

1.10
date	2006.01.31.13.37.26;	author tg;	state Exp;
branches;
next	1.9;
commitid	10043DF681A0448C0CA;

1.9
date	2006.01.31.13.26.17;	author tg;	state Exp;
branches;
next	1.8;
commitid	10043DF658519E50F9C;

1.8
date	2005.12.15.01.13.44;	author tg;	state Exp;
branches;
next	1.7;
commitid	10043A0C35615265D50;

1.7
date	2005.11.24.14.08.35;	author tg;	state Exp;
branches;
next	1.6;
commitid	af4385c9756c7e;

1.6
date	2005.06.14.13.47.38;	author tg;	state Exp;
branches;
next	1.5;
commitid	7c9942aedfb6942d;

1.5
date	2005.04.10.20.27.46;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.03.14.22.23.55;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.05.12.02.29;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.14.18.57.46;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.27.17;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.17;	author tg;	state Exp;
branches;
next	;


desc
@@


1.14
log
@optimise
@
text
@# $MirOS: src/share/mk/bsd.dep.mk,v 1.13 2008/04/10 13:55:55 tg Exp $
# $OpenBSD: bsd.dep.mk,v 1.5 2003/08/07 11:24:03 espie Exp $
# $NetBSD: bsd.dep.mk,v 1.12 1995/09/27 01:15:09 christos Exp $

.if !defined(BSD_DEP_MK)
BSD_DEP_MK=1

# some of the rules involve .h sources, so remove them from mkdep line
# add them to the beforedepend target
.if !target(depend)
depend: beforedepend .depend _SUBDIRUSE afterdepend
.  if defined(SRCS)
.depend: ${SRCS:S/.l$/.c/:S/.y$/.c/}
	@@rm -f .depend
	@@files="${.ALLSRC:M*.s} ${.ALLSRC:M*.S}"; \
	if [[ $$files != *( ) ]]; then \
		print -r -- ${MKDEP_SH} -a ${MKDEP} -D_ASM_SOURCE \
		    ${AFLAGS:M-[ID]*} ${CPPFLAGS} ${AINC} $$files; \
		CC=${CC:Q} ${MKDEP_SH} -a ${MKDEP} -D_ASM_SOURCE \
		    ${AFLAGS:M-[ID]*} ${CPPFLAGS} ${AINC} $$files; \
	fi
	@@files="${.ALLSRC:M*.c} ${.ALLSRC:M*.m}"; \
	if [[ $$files != *( ) ]]; then \
		print -r -- ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
		    ${CPPFLAGS} $$files; \
		CC=${CC:Q} ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
		    ${CPPFLAGS} $$files; \
	fi
	@@files="${.ALLSRC:M*.cc} ${.ALLSRC:M*.C} ${.ALLSRC:M*.cxx} ${.ALLSRC:M*.cpp}"; \
	if [[ $$files != *( ) ]]; then \
		print -r -- ${MKDEP_SH} -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
		    ${CPPFLAGS} $$files; \
		CC=${CXX:Q} ${MKDEP_SH} -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
		    ${CPPFLAGS} $$files; \
	fi
.  else
.depend:
.  endif
.  if !target(beforedepend)
beforedepend:
.  endif
.  if !target(afterdepend)
afterdepend:
.  endif
.endif	# not target depend

.if !target(tags)
.  if defined(SRCS)
tags: ${SRCS} _SUBDIRUSE
	-cd ${.CURDIR} && ${CTAGS} -f /dev/stdout ${.ALLSRC:N*.h} | \
	    sed 's${.CURDIR}/' >tags
.  else
tags:
.  endif
.endif

.if defined(SRCS)
cleandir: cleandepend
cleandepend:
	rm -f .depend ${.CURDIR}/tags
.endif

.if exists(${.CURDIR}/Makefile.bsd-wrapper)
.depend: ${.CURDIR}/Makefile.bsd-wrapper
.elif exists(${.CURDIR}/BSDmakefile)
.depend: ${.CURDIR}/BSDmakefile
.elif exists(${.CURDIR}/makefile)
.depend: ${.CURDIR}/makefile
.elif exists(${.CURDIR}/Makefile)
.depend: ${.CURDIR}/Makefile
.endif

.PHONY: beforedepend depend afterdepend cleandepend

.endif
@


1.13
log
@fix C++ support: Iâ€™ve seen distfiles with *.cpp and *.C files now
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.12 2007/04/28 00:12:46 tg Exp $
d16 2
a17 2
	if [[ $$files != " " ]]; then \
		echo ${MKDEP_SH} -a ${MKDEP} -D_ASM_SOURCE \
d23 2
a24 2
	if [[ $$files != " " ]]; then \
		echo ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d30 2
a31 2
	if [[ $$files != "   " ]]; then \
		echo ${MKDEP_SH} -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
d51 1
a51 1
	    sed "s;\${.CURDIR}/;;" >tags
@


1.12
log
@more lex/yacc overhaul, tentatively
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.11 2006/03/27 09:24:51 tg Exp $
d29 2
a30 2
	@@files="${.ALLSRC:M*.cc} ${.ALLSRC:M*.C} ${.ALLSRC:M*.cxx}"; \
	if [[ $$files != "  " ]]; then \
@


1.11
log
@fix dependencies for assembly files:
* use AFLAGS not CFLAGS
* add -D_ASM_SOURCE
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.10 2006/01/31 13:37:26 tg Exp $
d13 1
a13 1
.depend: ${SRCS}
@


1.10
log
@only check in the language frontend, after preprocessing finished
better is.
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.8 2005/12/15 01:13:44 tg Exp $
d17 4
a20 4
		echo ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
		    ${CPPFLAGS} ${AINC} $$files; \
		CC=${CC:Q} ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
		    ${CPPFLAGS} ${AINC} $$files; \
@


1.9
log
@mkdep(1) uses CC, so GCC_HONOUR_COPTS=0
@
text
@d26 1
a26 2
		GCC_HONOUR_COPTS=0 CC=${CC:Q} \
		    ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
@


1.8
log
@use the :Q modifier instead of shell quotes
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.7 2005/11/24 14:08:35 tg Exp $
d26 2
a27 1
		CC=${CC:Q} ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
@


1.7
log
@variablise mkdep
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.6 2005/06/14 13:47:38 tg Exp $
d19 1
a19 1
		CC="${CC}" ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d26 1
a26 1
		CC="${CC}" ${MKDEP_SH} -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d33 1
a33 1
		CC="${CXX}" ${MKDEP_SH} -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
@


1.6
log
@* use ${LINKER} not ${CC} in <bsd.lib.mk>, like <bsd.prog.mk>
* set LINKER to ${CXX} if ${SRCS} contains a C++ file
  (unused within MirOS source tree though)
  XXX could we add -lobjc to LDADD if SRCS contain an ObjC/ObjC++ file?
* enable DEBUGLIBS to show off that it isn't broken ;)
* bump patchlevel
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.5 2005/04/10 20:27:46 tg Exp $
d17 1
a17 1
		echo mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d19 1
a19 1
		CC="${CC}" mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d24 1
a24 1
		echo mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d26 1
a26 1
		CC="${CC}" mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} \
d31 1
a31 1
		echo mkdep -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
d33 1
a33 1
		CC="${CXX}" mkdep -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
@


1.5
log
@C++ files should be depended with the C++ compiler.

XXX What about Objective-C++ ?
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.4 2005/03/14 22:23:55 tg Exp $
d50 1
a50 1
	-cd ${.CURDIR}; ${CTAGS} -f /dev/stdout ${.ALLSRC:N*.h} | \
@


1.4
log
@fix depending CC invocation after recent Objective-C fix
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.3 2005/03/05 12:02:29 tg Exp $
d33 1
a33 1
		CC="${CC}" mkdep -a ${MKDEP} ${CXXFLAGS:M-[ID]*} \
@


1.3
log
@++Objective-C;
@
text
@d1 1
a1 1
# $MirOS: src/share/mk/bsd.dep.mk,v 1.2 2005/02/14 18:57:46 tg Exp $
d23 1
a23 1
	if [[ $$files != "" ]]; then \
@


1.2
log
@merge these from ncvs 1
@
text
@d1 1
a1 1
# $MirOS$
d22 1
a22 1
	@@files="${.ALLSRC:M*.c}"; \
@


1.1
log
@Initial revision
@
text
@d1 6
a6 2
#	$OpenBSD: bsd.dep.mk,v 1.5 2003/08/07 11:24:03 espie Exp $
#	$NetBSD: bsd.dep.mk,v 1.12 1995/09/27 01:15:09 christos Exp $
d9 1
d16 5
a20 3
	if [ "$$files" != " " ]; then \
	  echo mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} ${CPPFLAGS} ${AINC} $$files;\
	  mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} ${CPPFLAGS} ${AINC} $$files; \
d23 5
a27 3
	if [ "$$files" != "" ]; then \
	  echo mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} ${CPPFLAGS} $$files; \
	  mkdep -a ${MKDEP} ${CFLAGS:M-[ID]*} ${CPPFLAGS} $$files; \
d30 5
a34 3
	if [ "$$files" != "  " ]; then \
	  echo mkdep -a ${MKDEP} ${CXXFLAGS:M-[ID]*} ${CPPFLAGS} $$files; \
	  mkdep -a ${MKDEP} ${CXXFLAGS:M-[ID]*} ${CPPFLAGS} $$files; \
d45 1
a45 1
.endif
d51 1
a51 1
	    sed "s;\${.CURDIR}/;;" > tags
d63 10
d74 2
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
