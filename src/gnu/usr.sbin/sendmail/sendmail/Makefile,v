head	1.7;
access;
symbols
	sendmail-8_14_5-ERRATA-1:1.1.127.1
	mbsd-20101220_mergebase:1.7
	sendmail-8_14_5:1.1.127.1
	cvs-201107021500:1.1.1.2
	cvs-20101220:1.1.1.2
	mbsd-20101220:1.7.0.2
	cvs-201012191730:1.1.1.2
	sendmail-8_14_5_Beta0:1.1.127.1
	sendmail-8_14_3:1.1.127.1
	sendmail:1.1.127
	cvs-200812170000:1.1.1.2
	cvs-200805071200:1.1.1.1
	MIRBSD_10:1.5.0.2
	MIRBSD_10_BASE:1.5
	cvs-200803022030:1.1.1.1
	cvs-200707152000:1.1.1.1
	cvs-200704292000:1.1.1.1
	cvs-200702051700:1.1.1.1
	cvs-200609121900:1.1.1.1
	MIRBSD_9_BASE:1.5
	cvs-200606151800:1.1.1.1
	cvs-200603231300:1.1.1.1
	MIRBSD_8:1.4.0.2
	MIRBSD_8_BASE:1.4
	cvs-200507211800:1.1.1.1
	cvs-200504262050:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2008.12.17.00.42.56;	author tg;	state Exp;
branches;
next	1.6;
commitid	10049484B253D8462E0;

1.6
date	2008.05.07.13.15.24;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004821AB7510EE48FB;

1.5
date	2006.03.23.14.00.19;	author tg;	state Exp;
branches
	1.5.2.1;
next	1.4;
commitid	1004422AA062A391155;

1.4
date	2005.10.21.10.46.30;	author tg;	state Exp;
branches
	1.4.2.1;
next	1.3;
commitid	18994358c6e48907;

1.3
date	2005.03.29.02.19.37;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.13.15.11.51;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.24.28;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.127.1;
next	;

1.5.2.1
date	2008.05.17.19.12.01;	author tg;	state Exp;
branches;
next	;
commitid	100482F2DC168C89AEA;

1.4.2.1
date	2006.03.30.19.27.51;	author tg;	state Exp;
branches;
next	;
commitid	100442C309C7183FA09;

1.1.1.1
date	2005.02.05.17.24.28;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2008.12.17.00.31.19;	author tg;	state Exp;
branches;
next	;
commitid	1004948485811951994;

1.1.127.1
date	2010.12.19.14.45.43;	author tg;	state Exp;
branches;
next	;
commitid	1004D0E1A94384778FD;


desc
@@


1.7
log
@merge
@
text
@# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.6 2008/05/07 13:15:24 tg Exp $
# $OpenBSD: Makefile,v 1.28 2008/08/20 22:19:49 dlg Exp $

PROG=	sendmail

.include <bsd.own.mk>
SENDMAIL_WANT_SASL?=	No
LOCALBASE?=		/usr/mpkg

WANT_LIBSM=1
WANT_LIBSMUTIL=1

# For TLS/SSL support
ENVDEF+= -DSTARTTLS
LDADD+= -lssl -lcrypto
DPADD=	${LIBSSL} ${LIBCRYPTO}

.if ${SENDMAIL_WANT_SASL:L} == "yes"
ENVDEF+=	-DSASL=2
LDADD+= -lsasl2
CPPFLAGS+=	-I${LOCALBASE}/include
LDFLAGS+=	-L${LOCALBASE}/lib
.endif

# Compile with milter support.
ENVDEF+= -DMILTER

# Compile with socket map support.
ENVDEF+= -DSOCKETMAP

# Since we have random PIDs we need to be careful to avoid filename collisions
ENVDEF+= -DFAST_PID_RECYCLE

# We want sendmail to call setlogin() when running commands as a non-root user
ENVDEF+= -D_FFR_USE_SETLOGIN

SRCS=	main.c alias.c arpadate.c bf.c collect.c conf.c control.c convtime.c \
	daemon.c deliver.c domain.c envelope.c err.c headers.c macro.c map.c \
	mci.c milter.c mime.c parseaddr.c queue.c ratectrl.c readcf.c \
	recipient.c sasl.c savemail.c sfsasl.c shmticklib.c sm_resolve.c \
	srvrsmtp.c stab.c stats.c sysexits.c timers.c tls.c trace.c udb.c \
	usersmtp.c util.c version.c
MAN=	aliases.5 mailq.8 newaliases.8 sendmail.8
MLINKS=	sendmail.8 hoststat.1 sendmail.8 purgestat.1
BINDIR=	/usr/libexec/sendmail
BINOWN=	root
BINGRP=	smmsp
BINMODE=2555

beforeinstall:
	# Force user to make the world sane for us
	@@if [ -f /etc/sendmail.cf ]; then \
		if [ ! -f /etc/mail/sendmail.cf ]; then \
			echo "Error: /etc/sendmail.cf exists but /etc/mail/sendmail.cf does not.  Please move /etc/sendmail.cf to /etc/mail/sendmail.cf."; \
			false; \
		else \
			echo "Warning: both /etc/mail/sendmail.cf and /etc/sendmail.cf exist.  Sendmail will use /etc/mail/sendmail.cf."; \
		fi ; \
	fi
	@@if test -f /etc/rc && grep -q /etc/sendmail.cf /etc/rc; \
	    then echo "Error: /etc/rc must check for /etc/mail/sendmail.cf, not /etc/sendmail.cf"; \
	    false; \
	fi
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g wheel -m 444 \
	    ${.CURDIR}/helpfile ${DESTDIR}/etc/mail/helpfile

afterinstall:
	cmp -s ${.CURDIR}/TUNING ${DESTDIR}${SHAREDIR}/sendmail/TUNING || \
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} \
	    -m 444  ${.CURDIR}/TUNING ${DESTDIR}${SHAREDIR}/sendmail/TUNING ; \

.include <bsd.prog.mk>
@


1.6
log
@merge and reduce diffs against upstream
@
text
@d1 2
a2 2
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.5 2006/03/23 14:00:19 tg Exp $
#	$OpenBSD: Makefile,v 1.26 2005/01/12 18:15:46 millert Exp $
d28 3
@


1.5
log
@${LOCALBASE} here, too
@
text
@d1 2
a2 2
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.4 2005/10/21 10:46:30 tg Exp $
# $OpenBSD: Makefile,v 1.26 2005/01/12 18:15:46 millert Exp $
d14 3
a16 3
ENVDEF+=	-DSTARTTLS
LDADD+=		-lssl -lcrypto
DPADD=		${LIBSSL} ${LIBCRYPTO}
d20 1
a20 1
LDADD+=		-lsasl2
@


1.5.2.1
log
@MFC sendmail update to 8.14.3

agreed bsiegert@@
@
text
@d1 2
a2 2
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.6 2008/05/07 13:15:24 tg Exp $
#	$OpenBSD: Makefile,v 1.26 2005/01/12 18:15:46 millert Exp $
d14 3
a16 3
ENVDEF+= -DSTARTTLS
LDADD+= -lssl -lcrypto
DPADD=	${LIBSSL} ${LIBCRYPTO}
d20 1
a20 1
LDADD+= -lsasl2
@


1.4
log
@* perl, sendmail: merge OpenBSD import
* perl: fix DEBUG{LIBS,PROGS} by disabling
* all: fix use of CDIAGFLAGS+=, CFLAGS+= and COPTS+= [...]
@
text
@d1 1
a1 1
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.3 2005/03/29 02:19:37 tg Exp $
d8 1
d21 2
a22 2
CPPFLAGS+=	-I/usr/local/include
LDFLAGS+=	-L/usr/local/lib
@


1.4.2.1
log
@MFC most of the recent sendmail updates to MirOS #8-stable
agreed bsiegert@@

This also changes the LOCALBASE stuff, links libmilter not
against LDAP, etc. but doesn't install the FreeBSD 6 confs
nor a shared libmilter in order to pass a no-files-diff:

tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo find / -ls | sort -k11 >~/x1
tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo make install
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo make distribution
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo find / -ls | sort -k11 | diff -u ~/x1 - | less

Note: files in /etc/mail/ are also changed, this affects the etc8.ngz set
on fresh installs and cannot(!) be automatically upgraded!
@
text
@d1 1
a1 1
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.5 2006/03/23 14:00:19 tg Exp $
a7 1
LOCALBASE?=		/usr/mpkg
d20 2
a21 2
CPPFLAGS+=	-I${LOCALBASE}/include
LDFLAGS+=	-L${LOCALBASE}/lib
@


1.3
log
@time to die for a feature which has been disabled in MirOS
for a good two years, maybe longer, with nobody complaining

pf can do this functionality equally well, I think
@
text
@d1 1
a1 1
# $MirOS: src/gnu/usr.sbin/sendmail/sendmail/Makefile,v 1.2 2005/03/13 15:11:51 tg Exp $
d20 1
a20 1
CFLAGS+=	-I/usr/local/include
@


1.2
log
@merge sendmail diff against OpenBSD's idea of sendmail port
@
text
@d1 1
a1 1
# $MirOS$
a8 1
WANT_LIBWRAP=1
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile,v 1.26 2005/01/12 18:15:46 millert Exp $
d7 1
d14 9
a22 10
ENVDEF+= -DSTARTTLS
LDADD+= -lssl -lcrypto
DPADD=	${LIBSSL} ${LIBCRYPTO}

# To build with SASL support define WANT_SMTPAUTH in /etc/mk.conf (unsupported)
.if defined(WANT_SMTPAUTH)
ENVDEF+= -DSASL
CFLAGS+= -I/usr/local/include/sasl
LDADD+= -lsasl2
LDFLAGS+=-L/usr/local/lib
a68 2

.include "../../Makefile.inc"
@


1.1.127.1
log
@Import Sendmail 8.14.3, suitably stripped down by the not yet committed
contrib/samples/import-3rdpty,v 1.35; we have some new and renamed files
@
text
@d1 1
a1 1
#       $Id: Makefile,v 8.12 2006/08/29 22:00:11 ca Exp $
d3 1
a3 12
SHELL= /bin/sh
BUILD=   ./Build
OPTIONS= $(CONFIG) $(FLAGS)

all: FRC
	$(SHELL) $(BUILD) $(OPTIONS) $@@
check: FRC
	$(SHELL) $(BUILD) $(OPTIONS) $@@
clean: FRC
	$(SHELL) $(BUILD) $(OPTIONS) $@@
install: FRC
	$(SHELL) $(BUILD) $(OPTIONS) $@@
d5 1
a5 2
fresh: FRC
	$(SHELL) $(BUILD) $(OPTIONS) -c
d7 64
a70 1
FRC:
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@OpenBSD-current sendmail (while it lasts)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.28 2008/08/20 22:19:49 dlg Exp $
a26 3
# Compile with socket map support.
ENVDEF+= -DSOCKETMAP

@

