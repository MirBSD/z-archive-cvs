head	1.3;
access;
symbols
	sendmail-8_14_9:1.1.127.2
	sendmail-8_14_7:1.1.127.1
	sendmail-8_14_6:1.1.127.1
	sendmail-8_14_5-ERRATA-1:1.1.127.1
	mbsd-20101220_mergebase:1.1.1.2.4.1
	sendmail-8_14_5:1.1.127.1
	cvs-201107021500:1.1.1.3
	cvs-20101220:1.1.1.3
	mbsd-20101220:1.1.1.2.0.4
	cvs-201012191730:1.1.1.2
	sendmail-8_14_5_Beta0:1.1.127.1
	sendmail-8_14_3:1.1.127.1
	sendmail:1.1.127
	cvs-200812170000:1.1.1.2
	cvs-200805071200:1.1.1.2
	MIRBSD_10:1.1.1.2.0.2
	MIRBSD_10_BASE:1.1.1.2
	cvs-200803022030:1.1.1.2
	cvs-200707152000:1.1.1.2
	cvs-200704292000:1.1.1.2
	cvs-200702051700:1.1.1.2
	cvs-200609121900:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	cvs-200606151800:1.1.1.1
	cvs-200603231300:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	cvs-200504262050:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2014.06.09.15.17.19;	author tg;	state Exp;
branches;
next	1.2;
commitid	1005395CFC65E5646F1;

1.2
date	2011.07.02.15.03.45;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004E0F31C5496AB95F;

1.1
date	2005.02.05.17.24.22;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.127.1;
next	;

1.1.1.1
date	2005.02.05.17.24.22;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2007.02.05.17.05.56;	author tg;	state Exp;
branches
	1.1.1.2.4.1;
next	1.1.1.3;
commitid	10045C763C551AABAF7;

1.1.1.3
date	2011.07.02.14.59.55;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F31C5496AB95F;

1.1.1.2.4.1
date	2011.07.02.15.02.15;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F31C5496AB95F;

1.1.127.1
date	2010.12.19.14.45.53;	author tg;	state Exp;
branches;
next	1.1.127.2;
commitid	1004D0E1A94384778FD;

1.1.127.2
date	2014.06.09.14.29.25;	author tg;	state Exp;
branches;
next	;
commitid	1005395C4CC1A6DB9EE;


desc
@@


1.3
log
@merge
@
text
@<HTML>
<HEAD><TITLE>smfi_setmlreply</TITLE></HEAD>
<BODY>
<!--
$Id: smfi_setmlreply.html,v 1.5 2013-11-22 20:51:39 ca Exp $
-->
<H1>smfi_setmlreply</H1>

<TABLE border="0" cellspacing=4 cellpadding=4>
<!---------- Synopsis ----------->
<TR><TH valign="top" align=left width=100>SYNOPSIS</TH><TD>
<PRE>
#include &lt;libmilter/mfapi.h&gt;
int smfi_setmlreply(
	SMFICTX *ctx,
	char *rcode,
	char *xcode,
	...
);
</PRE>
Set the default SMTP error reply code to a multi-line response.  Only 4XX
and 5XX replies are accepted.
</TD></TR>

<!----------- Description ---------->
<TR><TH valign="top" align=left>DESCRIPTION</TH><TD>
<TABLE border="1" cellspacing=1 cellpadding=4>
<TR align="left" valign=top>
<TH width="80">Called When</TH>
<TD>smfi_setmlreply may be called from any of the xxfi_ callbacks
other than xxfi_connect.</TD>
</TR>
<TR align="left" valign=top>
<TH width="80">Effects</TH>
<TD>Directly set the SMTP error reply code for this connection to the given
lines after the xcode.  The list of arguments must be NULL terminated.
This code  will be used on subsequent error replies resulting from actions
taken by this filter.</TD>
</TR>
</TABLE>

<!----------- Arguments ---------->
<TR><TH valign="top" align=left>ARGUMENTS</TH><TD>
    <TABLE border="1" cellspacing=0>
    <TR bgcolor="#dddddd"><TH>Argument</TH><TH>Description</TH></TR>
    <TR valign="top"><TD>ctx</TD>
	<TD>Opaque context structure.
	</TD></TR>
    <TR valign="top"><TD>rcode</TD>
	<TD>The three-digit (RFC 821/2821) SMTP reply code, as a
	null-terminated string.  rcode cannot be NULL, and must be a valid
	4XX or 5XX reply code.
        </TD></TR>
    <TR valign="top"><TD>xcode</TD>
	<TD>The extended (RFC 1893/2034) reply code.  If xcode is NULL, no
	extended code is used.  Otherwise, xcode must conform to RFC 1893/2034.
	</TD></TR>
    <TR valign="top"><TD>...</TD>
	<TD>The remainder of the arguments are single lines of text, up to
	32 arguments, which will be used as the text part of the SMTP
	reply.  The list must be NULL terminated.
	</TD></TR>
    </TABLE>
</TD></TR>

<!----------- Example ---------->
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 
<TD>
For example, the code:<BR>
<PRE>
	ret = smfi_setmlreply(ctx, "550", "5.7.0",
			      "Spammer access rejected",
			      "Please see our policy at:",
			      "http://www.example.com/spampolicy.html",
			      NULL);
</PRE>
<BR>would give the SMTP response:<BR>
<PRE>
550-5.7.0 Spammer access rejected
550-5.7.0 Please see our policy at:
550 5.7.0 http://www.example.com/spampolicy.html
</PRE>
</TD>
</TR>

<!----------- Return values ---------->
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 

<TD>smfi_setmlreply will fail and return MI_FAILURE if:
<UL>
    <LI>The rcode or xcode argument is invalid.
    <LI>A memory-allocation failure occurs.
    <LI>If any text line contains a carraige return or line feed.
    <LI>The length of any text line is more than MAXREPLYLEN (980).
    <LI>More than 32 lines of text replies are given.
</UL>
Otherwise, it return MI_SUCCESS.
</TD>
</TR>

<!----------- Notes ---------->
<TR align="left" valign=top>
<TH>NOTES</TH> 
<TD>
<UL>
<LI>Values passed to smfi_setmlreply are not checked for standards compliance.
<LI>The message parameter should contain only printable characters,
other characters may lead to undefined behavior.
For example, CR or LF will cause the call to fail,
single '%' characters will cause the text to be ignored
(if there really should be a '%' in the string,
use '%%' just like for <TT>printf(3)</TT>).
<LI>For details about reply codes and their meanings, please see RFC's 
<A href="http://www.rfc-editor.org/rfc/rfc821.txt">821</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2821.txt">2821</A>
and
<A href="http://www.rfc-editor.org/rfc/rfc1893.txt">1893</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2034.txt">2034</A>.
<LI>If the reply code (rcode) given is a '4XX' code but SMFI_REJECT is used
for the message, the custom reply is not used.
<LI>Similarly, if the reply code (rcode) given is a '5XX' code but
SMFI_TEMPFAIL is used for the message, the custom reply is not used.
<BR>
Note: in neither of the last two cases an error is returned to the milter,
libmilter silently ignores the reply code.
<LI>If the milter returns SMFI_TEMPFAIL and sets the reply code to '421',
then the SMTP server will terminate the SMTP session with a 421 error code.
</UL>
</TD>
</TR>

</TABLE>

<HR size="1">
<FONT size="-1">
Copyright (c) 2000, 2002-2003 Proofpoint, Inc. and its suppliers.
All rights reserved.
<BR>
By using this file, you agree to the terms and conditions set
forth in the LICENSE.
</FONT>
</BODY>
</HTML>
@


1.2
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d5 1
a5 1
$Id: smfi_setmlreply.html,v 1.4 2006/12/21 18:30:35 ca Exp $
d138 1
a138 1
Copyright (c) 2000, 2002-2003 Sendmail, Inc. and its suppliers.
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
<html>
<head><title>smfi_setmlreply</title></head>
<body>
d5 1
a5 1
$Sendmail: smfi_setmlreply.html,v 1.1 2004/01/01 00:32:45 gshapiro Exp $
d7 1
a7 1
<h1>smfi_setmlreply</h1>
d9 1
a9 1
<table border="0" cellspacing=4 cellpadding=4>
d11 2
a12 2
<tr><th valign="top" align=left width=150>SYNOPSIS</th><td>
<pre>
d20 1
a20 1
</pre>
d23 1
a23 1
</td></tr>
d26 10
a35 10
<tr><th valign="top" align=left>DESCRIPTION</th><td>
<table border="1" cellspacing=1 cellpadding=4>
<tr align="left" valign=top>
<th width="80">Called When</th>
<td>smfi_setmlreply may be called from any of the xxfi_ callbacks
other than xxfi_connect.</td>
</tr>
<tr align="left" valign=top>
<th width="80">Effects</th>
<td>Directly set the SMTP error reply code for this connection to the given
d38 3
a40 3
taken by this filter.</td>
</tr>
</table>
d43 8
a50 8
<tr><th valign="top" align=left>ARGUMENTS</th><td>
    <table border="1" cellspacing=0>
    <tr bgcolor="#dddddd"><th>Argument</th><th>Description</th></tr>
    <tr valign="top"><td>ctx</td>
	<td>Opaque context structure.
	</td></tr>
    <tr valign="top"><td>rcode</td>
	<td>The three-digit (RFC 821/2821) SMTP reply code, as a
d53 3
a55 3
        </td></tr>
    <tr valign="top"><td>xcode</td>
	<td>The extended (RFC 1893/2034) reply code.  If xcode is NULL, no
d57 3
a59 3
	</td></tr>
    <tr valign="top"><td>...</td>
	<td>The remainder of the arguments are single lines of text, up to
d62 3
a64 3
	</td></tr>
    </table>
</td></tr>
d67 3
a69 3
<tr>
<th valign="top" align=left>RETURN VALUES</th> 
<td>
d71 1
a71 1
<pre>
d77 1
a77 1
</pre>
d79 1
a79 1
<pre>
d83 3
a85 2
</td>
</tr>
d88 2
a89 2
<tr>
<th valign="top" align=left>RETURN VALUES</th> 
d91 8
a98 8
<td>smfi_setmlreply will fail and return MI_FAILURE if:
<ul>
    <li>The rcode or xcode argument is invalid.
    <li>A memory-allocation failure occurs.
    <li>If any text line contains a carraige return or line feed.
    <li>The length of any text line is more than MAXREPLYLEN (980).
    <li>More than 32 lines of text replies are given.
</ul>
d100 2
a101 2
</td>
</tr>
d104 6
a109 6
<tr align="left" valign=top>
<th>NOTES</th> 
<td>
<ul>
<li>Values passed to smfi_setmlreply are not checked for standards compliance.
<li>The message parameter should contain only printable characters,
d114 4
a117 4
use '%%' just like for <tt>printf(3)</tt>).
<li>For details about reply codes and their meanings, please see RFC's 
<a href="http://www.rfc-editor.org/rfc/rfc821.txt">821</a>/
<a href="http://www.rfc-editor.org/rfc/rfc2821.txt">2821</a>
d119 3
a121 3
<a href="http://www.rfc-editor.org/rfc/rfc1893.txt">1893</a>/
<a href="http://www.rfc-editor.org/rfc/rfc2034.txt">2034</a>.
<li>If the reply code (rcode) given is a '4XX' code but SMFI_REJECT is used
d123 1
a123 1
<li>Similarly, if the reply code (rcode) given is a '5XX' code but
d128 5
a132 8
<li>
If the milter returns SMFI_TEMPFAIL
and sets the reply code to '421',
then the SMTP server will terminate the SMTP session with a 421
error code.
</ul>
</td>
</tr>
d134 1
a134 1
</table>
d136 2
a137 2
<hr size="1">
<font size="-1">
d140 1
a140 1
<br>
d143 3
a145 3
</font>
</body>
</html>
@


1.1.127.1
log
@Import Sendmail 8.14.3, suitably stripped down by the not yet committed
contrib/samples/import-3rdpty,v 1.35; we have some new and renamed files
@
text
@d1 3
a3 3
<HTML>
<HEAD><TITLE>smfi_setmlreply</TITLE></HEAD>
<BODY>
d5 1
a5 1
$Id: smfi_setmlreply.html,v 1.4 2006/12/21 18:30:35 ca Exp $
d7 1
a7 1
<H1>smfi_setmlreply</H1>
d9 1
a9 1
<TABLE border="0" cellspacing=4 cellpadding=4>
d11 2
a12 2
<TR><TH valign="top" align=left width=100>SYNOPSIS</TH><TD>
<PRE>
d20 1
a20 1
</PRE>
d23 1
a23 1
</TD></TR>
d26 10
a35 10
<TR><TH valign="top" align=left>DESCRIPTION</TH><TD>
<TABLE border="1" cellspacing=1 cellpadding=4>
<TR align="left" valign=top>
<TH width="80">Called When</TH>
<TD>smfi_setmlreply may be called from any of the xxfi_ callbacks
other than xxfi_connect.</TD>
</TR>
<TR align="left" valign=top>
<TH width="80">Effects</TH>
<TD>Directly set the SMTP error reply code for this connection to the given
d38 3
a40 3
taken by this filter.</TD>
</TR>
</TABLE>
d43 8
a50 8
<TR><TH valign="top" align=left>ARGUMENTS</TH><TD>
    <TABLE border="1" cellspacing=0>
    <TR bgcolor="#dddddd"><TH>Argument</TH><TH>Description</TH></TR>
    <TR valign="top"><TD>ctx</TD>
	<TD>Opaque context structure.
	</TD></TR>
    <TR valign="top"><TD>rcode</TD>
	<TD>The three-digit (RFC 821/2821) SMTP reply code, as a
d53 3
a55 3
        </TD></TR>
    <TR valign="top"><TD>xcode</TD>
	<TD>The extended (RFC 1893/2034) reply code.  If xcode is NULL, no
d57 3
a59 3
	</TD></TR>
    <TR valign="top"><TD>...</TD>
	<TD>The remainder of the arguments are single lines of text, up to
d62 3
a64 3
	</TD></TR>
    </TABLE>
</TD></TR>
d67 3
a69 3
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 
<TD>
d71 1
a71 1
<PRE>
d77 1
a77 1
</PRE>
d79 1
a79 1
<PRE>
d83 2
a84 3
</PRE>
</TD>
</TR>
d87 2
a88 2
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 
d90 8
a97 8
<TD>smfi_setmlreply will fail and return MI_FAILURE if:
<UL>
    <LI>The rcode or xcode argument is invalid.
    <LI>A memory-allocation failure occurs.
    <LI>If any text line contains a carraige return or line feed.
    <LI>The length of any text line is more than MAXREPLYLEN (980).
    <LI>More than 32 lines of text replies are given.
</UL>
d99 2
a100 2
</TD>
</TR>
d103 6
a108 6
<TR align="left" valign=top>
<TH>NOTES</TH> 
<TD>
<UL>
<LI>Values passed to smfi_setmlreply are not checked for standards compliance.
<LI>The message parameter should contain only printable characters,
d113 4
a116 4
use '%%' just like for <TT>printf(3)</TT>).
<LI>For details about reply codes and their meanings, please see RFC's 
<A href="http://www.rfc-editor.org/rfc/rfc821.txt">821</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2821.txt">2821</A>
d118 3
a120 3
<A href="http://www.rfc-editor.org/rfc/rfc1893.txt">1893</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2034.txt">2034</A>.
<LI>If the reply code (rcode) given is a '4XX' code but SMFI_REJECT is used
d122 1
a122 1
<LI>Similarly, if the reply code (rcode) given is a '5XX' code but
d127 8
a134 5
<LI>If the milter returns SMFI_TEMPFAIL and sets the reply code to '421',
then the SMTP server will terminate the SMTP session with a 421 error code.
</UL>
</TD>
</TR>
d136 1
a136 1
</TABLE>
d138 2
a139 2
<HR size="1">
<FONT size="-1">
d142 1
a142 1
<BR>
d145 3
a147 3
</FONT>
</BODY>
</HTML>
@


1.1.127.2
log
@Import sendmail 8.14.9
@
text
@d5 1
a5 1
$Id: smfi_setmlreply.html,v 1.5 2013-11-22 20:51:39 ca Exp $
d138 1
a138 1
Copyright (c) 2000, 2002-2003 Proofpoint, Inc. and its suppliers.
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import Sendmail 8.14.0 via OpenBSD
@
text
@d1 3
a3 3
<HTML>
<HEAD><TITLE>smfi_setmlreply</TITLE></HEAD>
<BODY>
d5 1
a5 1
$Sendmail: smfi_setmlreply.html,v 1.4 2006/12/21 18:30:35 ca Exp $
d7 1
a7 1
<H1>smfi_setmlreply</H1>
d9 1
a9 1
<TABLE border="0" cellspacing=4 cellpadding=4>
d11 2
a12 2
<TR><TH valign="top" align=left width=100>SYNOPSIS</TH><TD>
<PRE>
d20 1
a20 1
</PRE>
d23 1
a23 1
</TD></TR>
d26 10
a35 10
<TR><TH valign="top" align=left>DESCRIPTION</TH><TD>
<TABLE border="1" cellspacing=1 cellpadding=4>
<TR align="left" valign=top>
<TH width="80">Called When</TH>
<TD>smfi_setmlreply may be called from any of the xxfi_ callbacks
other than xxfi_connect.</TD>
</TR>
<TR align="left" valign=top>
<TH width="80">Effects</TH>
<TD>Directly set the SMTP error reply code for this connection to the given
d38 3
a40 3
taken by this filter.</TD>
</TR>
</TABLE>
d43 8
a50 8
<TR><TH valign="top" align=left>ARGUMENTS</TH><TD>
    <TABLE border="1" cellspacing=0>
    <TR bgcolor="#dddddd"><TH>Argument</TH><TH>Description</TH></TR>
    <TR valign="top"><TD>ctx</TD>
	<TD>Opaque context structure.
	</TD></TR>
    <TR valign="top"><TD>rcode</TD>
	<TD>The three-digit (RFC 821/2821) SMTP reply code, as a
d53 3
a55 3
        </TD></TR>
    <TR valign="top"><TD>xcode</TD>
	<TD>The extended (RFC 1893/2034) reply code.  If xcode is NULL, no
d57 3
a59 3
	</TD></TR>
    <TR valign="top"><TD>...</TD>
	<TD>The remainder of the arguments are single lines of text, up to
d62 3
a64 3
	</TD></TR>
    </TABLE>
</TD></TR>
d67 3
a69 3
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 
<TD>
d71 1
a71 1
<PRE>
d77 1
a77 1
</PRE>
d79 1
a79 1
<PRE>
d83 2
a84 3
</PRE>
</TD>
</TR>
d87 2
a88 2
<TR>
<TH valign="top" align=left>RETURN VALUES</TH> 
d90 8
a97 8
<TD>smfi_setmlreply will fail and return MI_FAILURE if:
<UL>
    <LI>The rcode or xcode argument is invalid.
    <LI>A memory-allocation failure occurs.
    <LI>If any text line contains a carraige return or line feed.
    <LI>The length of any text line is more than MAXREPLYLEN (980).
    <LI>More than 32 lines of text replies are given.
</UL>
d99 2
a100 2
</TD>
</TR>
d103 6
a108 6
<TR align="left" valign=top>
<TH>NOTES</TH> 
<TD>
<UL>
<LI>Values passed to smfi_setmlreply are not checked for standards compliance.
<LI>The message parameter should contain only printable characters,
d113 4
a116 4
use '%%' just like for <TT>printf(3)</TT>).
<LI>For details about reply codes and their meanings, please see RFC's 
<A href="http://www.rfc-editor.org/rfc/rfc821.txt">821</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2821.txt">2821</A>
d118 3
a120 3
<A href="http://www.rfc-editor.org/rfc/rfc1893.txt">1893</A>/
<A href="http://www.rfc-editor.org/rfc/rfc2034.txt">2034</A>.
<LI>If the reply code (rcode) given is a '4XX' code but SMFI_REJECT is used
d122 1
a122 1
<LI>Similarly, if the reply code (rcode) given is a '5XX' code but
d127 8
a134 5
<LI>If the milter returns SMFI_TEMPFAIL and sets the reply code to '421',
then the SMTP server will terminate the SMTP session with a 421 error code.
</UL>
</TD>
</TR>
d136 1
a136 1
</TABLE>
d138 2
a139 2
<HR size="1">
<FONT size="-1">
d142 1
a142 1
<BR>
d145 3
a147 3
</FONT>
</BODY>
</HTML>
@


1.1.1.2.4.1
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d5 1
a5 1
$Id: smfi_setmlreply.html,v 1.4 2006/12/21 18:30:35 ca Exp $
@


1.1.1.3
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d5 1
a5 1
$Id: smfi_setmlreply.html,v 1.4 2006/12/21 18:30:35 ca Exp $
@


