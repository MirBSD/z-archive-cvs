head	1.3;
access;
symbols
	sendmail-8_14_9:1.1.127.2
	sendmail-8_14_7:1.1.127.1
	sendmail-8_14_6:1.1.127.1
	sendmail-8_14_5-ERRATA-1:1.1.127.1
	mbsd-20101220_mergebase:1.1.1.4.4.1
	sendmail-8_14_5:1.1.127.1
	cvs-201107021500:1.1.1.5
	cvs-20101220:1.1.1.5
	mbsd-20101220:1.1.1.4.0.4
	cvs-201012191730:1.1.1.4
	sendmail-8_14_5_Beta0:1.1.127.1
	sendmail-8_14_3:1.1.127.1
	sendmail:1.1.127
	cvs-200812170000:1.1.1.4
	cvs-200805071200:1.1.1.4
	MIRBSD_10:1.1.1.4.0.2
	MIRBSD_10_BASE:1.1.1.4
	cvs-200803022030:1.1.1.4
	cvs-200707152000:1.1.1.4
	cvs-200704292000:1.1.1.4
	cvs-200702051700:1.1.1.3
	cvs-200609121900:1.1.1.2
	MIRBSD_9_BASE:1.1.1.1
	cvs-200606151800:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	cvs-200603231300:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.3
date	2014.06.09.15.17.32;	author tg;	state Exp;
branches;
next	1.2;
commitid	1005395CFC65E5646F1;

1.2
date	2011.07.02.15.03.59;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004E0F31C5496AB95F;

1.1
date	2006.03.23.13.09.40;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.127.1;
next	;
commitid	10044229DEA33D36552;

1.1.1.1
date	2006.03.23.13.09.40;	author tg;	state Exp;
branches
	1.1.1.1.2.1;
next	1.1.1.2;
commitid	10044229DEA33D36552;

1.1.1.2
date	2006.09.12.19.22.11;	author tg;	state Exp;
branches;
next	1.1.1.3;
commitid	100450708CE5C63A8F5;

1.1.1.3
date	2007.02.05.17.06.12;	author tg;	state Exp;
branches;
next	1.1.1.4;
commitid	10045C763C551AABAF7;

1.1.1.4
date	2007.04.29.20.07.09;	author tg;	state Exp;
branches
	1.1.1.4.4.1;
next	1.1.1.5;
commitid	1004634FAED5BC54DF0;

1.1.1.5
date	2011.07.02.15.00.18;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F31C5496AB95F;

1.1.1.1.2.1
date	2006.03.23.13.09.40;	author tg;	state dead;
branches;
next	1.1.1.1.2.2;
commitid	100442C309C7183FA09;

1.1.1.1.2.2
date	2006.03.30.19.27.49;	author tg;	state Exp;
branches;
next	;
commitid	100442C309C7183FA09;

1.1.1.4.4.1
date	2011.07.02.15.02.42;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F31C5496AB95F;

1.1.127.1
date	2010.12.19.14.45.49;	author tg;	state Exp;
branches;
next	1.1.127.2;
commitid	1004D0E1A94384778FD;

1.1.127.2
date	2014.06.09.14.29.21;	author tg;	state Exp;
branches;
next	;
commitid	1005395C4CC1A6DB9EE;


desc
@@


1.3
log
@merge
@
text
@/*
 * Copyright (c) 2005-2007 Proofpoint, Inc. and its suppliers.
 *      All rights reserved.
 *
 * By using this file, you agree to the terms and conditions set
 * forth in the LICENSE file which can be found at the top level of
 * the sendmail distribution.
 */

#include <sm/gen.h>
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.11 2013-11-22 20:51:43 ca Exp $")

#include <sm/misc.h>

/*
**  Simple test program for memstat
*/

#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <strings.h>
#include <string.h>

extern char *optarg;
extern int optind;

void
usage(prg)
	char *prg;
{
	fprintf(stderr, "usage: %s [options]\n", prg);
	fprintf(stderr, "options:\n");
	fprintf(stderr, "-l n    loop n times\n");
	fprintf(stderr, "-m n    allocate n bytes per iteration\n");
	fprintf(stderr, "-r name use name as resource to query\n");
	fprintf(stderr, "-s n    sleep n seconds per iteration\n");
}

int
main(argc, argv)
	int argc;
	char **argv;
{
	int r, r2, i, l, slp, sz;
	long v;
	char *resource;

	l = 1;
	sz = slp = 0;
	resource = NULL;
	while ((r = getopt(argc, argv, "l:m:r:s:")) != -1)
	{
		switch ((char) r)
		{
		  case 'l':
			l = strtol(optarg, NULL, 0);
			break;

		  case 'm':
			sz = strtol(optarg, NULL, 0);
			break;

		  case 'r':
			resource = strdup(optarg);
			if (resource == NULL)
			{
				fprintf(stderr, "strdup(%s) failed\n",
					optarg);
				exit(1);
			}
			break;

		  case 's':
			slp = strtol(optarg, NULL, 0);
			break;

		  default:
			usage(argv[0]);
			exit(1);
		}
	}

	r = sm_memstat_open();
	r2 = -1;
	for (i = 0; i < l; i++)
	{
		char *mem;

		r2 = sm_memstat_get(resource, &v);
		if (slp > 0 && i + 1 < l && 0 == r)
		{
			printf("open=%d, memstat=%d, %s=%ld\n", r, r2,
				resource != NULL ? resource : "default-value",
				v);
			sleep(slp);
			if (sz > 0)
			{
				/*
				**  Just allocate some memory to test the
				**  values that are returned.
				**  Note: this is a memory leak, but that
				**  doesn't matter here.
				*/

				mem = malloc(sz);
				if (NULL == mem)
					printf("malloc(%d) failed\n", sz);
			}
		}
	}
	printf("open=%d, memstat=%d, %s=%ld\n", r, r2,
		resource != NULL ? resource : "default-value", v);
	r = sm_memstat_close();
	return r;
}
@


1.2
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d2 1
a2 1
 * Copyright (c) 2005-2007 Sendmail, Inc. and its suppliers.
d11 1
a11 1
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.9 2007/03/14 21:41:09 ca Exp $")
d66 6
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
 * Copyright (c) 2005 Sendmail, Inc. and its suppliers.
d11 3
a13 1
SM_IDSTR(id, "@@(#)$Sendmail: t-memstat.c,v 1.5 2005/12/22 19:05:42 ca Exp $")
d16 1
a16 1
** Simple test program for memstat
d23 16
d73 2
a74 1
			break;
@


1.1.127.1
log
@Import Sendmail 8.14.3, suitably stripped down by the not yet committed
contrib/samples/import-3rdpty,v 1.35; we have some new and renamed files
@
text
@d2 1
a2 1
 * Copyright (c) 2005-2007 Sendmail, Inc. and its suppliers.
d11 1
a11 3
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.9 2007/03/14 21:41:09 ca Exp $")

#include <sm/misc.h>
d14 1
a14 1
**  Simple test program for memstat
a20 16
#include <string.h>

extern char *optarg;
extern int optind;

void
usage(prg)
	char *prg;
{
	fprintf(stderr, "usage: %s [options]\n", prg);
	fprintf(stderr, "options:\n");
	fprintf(stderr, "-l n    loop n times\n");
	fprintf(stderr, "-m n    allocate n bytes per iteration\n");
	fprintf(stderr, "-r name use name as resource to query\n");
	fprintf(stderr, "-s n    sleep n seconds per iteration\n");
}
d55 1
a55 2
			usage(argv[0]);
			exit(1);
@


1.1.127.2
log
@Import sendmail 8.14.9
@
text
@d2 1
a2 1
 * Copyright (c) 2005-2007 Proofpoint, Inc. and its suppliers.
d11 1
a11 1
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.11 2013-11-22 20:51:43 ca Exp $")
a65 6
			if (resource == NULL)
			{
				fprintf(stderr, "strdup(%s) failed\n",
					optarg);
				exit(1);
			}
@


1.1.1.1
log
@Update to Sendmail 8.13.6
@
text
@@


1.1.1.2
log
@Import latest Sendmail
@
text
@d2 1
a2 1
 * Copyright (c) 2005, 2006 Sendmail, Inc. and its suppliers.
d11 1
a11 1
SM_IDSTR(id, "@@(#)$Sendmail: t-memstat.c,v 1.6 2006/03/27 22:34:47 ca Exp $")
d14 1
a14 1
**  Simple test program for memstat
a20 4
#include <string.h>

extern char *optarg;
extern int optind;
@


1.1.1.3
log
@Import Sendmail 8.14.0 via OpenBSD
@
text
@d11 1
a11 3
SM_IDSTR(id, "@@(#)$Sendmail: t-memstat.c,v 1.7 2006/06/28 23:57:59 ca Exp $")

#include <sm/misc.h>
@


1.1.1.4
log
@import openbsd compress, ssh, perl, sendmail for minor bugfixes
@
text
@d2 1
a2 1
 * Copyright (c) 2005-2007 Sendmail, Inc. and its suppliers.
d11 1
a11 1
SM_IDSTR(id, "@@(#)$Sendmail: t-memstat.c,v 1.9 2007/03/14 21:41:09 ca Exp $")
a27 12
void
usage(prg)
	char *prg;
{
	fprintf(stderr, "usage: %s [options]\n", prg);
	fprintf(stderr, "options:\n");
	fprintf(stderr, "-l n    loop n times\n");
	fprintf(stderr, "-m n    allocate n bytes per iteration\n");
	fprintf(stderr, "-r name use name as resource to query\n");
	fprintf(stderr, "-s n    sleep n seconds per iteration\n");
}

d61 1
a61 2
			usage(argv[0]);
			exit(1);
@


1.1.1.4.4.1
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d11 1
a11 1
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.9 2007/03/14 21:41:09 ca Exp $")
@


1.1.1.5
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d11 1
a11 1
SM_IDSTR(id, "@@(#)$Id: t-memstat.c,v 1.9 2007/03/14 21:41:09 ca Exp $")
@


1.1.1.1.2.1
log
@file t-memstat.c was added on branch MIRBSD_8 on 2006-03-30 19:27:49 +0000
@
text
@d1 91
@


1.1.1.1.2.2
log
@MFC most of the recent sendmail updates to MirOS #8-stable
agreed bsiegert@@

This also changes the LOCALBASE stuff, links libmilter not
against LDAP, etc. but doesn't install the FreeBSD 6 confs
nor a shared libmilter in order to pass a no-files-diff:

tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo find / -ls | sort -k11 >~/x1
tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo make install
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo make distribution
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo find / -ls | sort -k11 | diff -u ~/x1 - | less

Note: files in /etc/mail/ are also changed, this affects the etc8.ngz set
on fresh installs and cannot(!) be automatically upgraded!
@
text
@a0 91
/*
 * Copyright (c) 2005 Sendmail, Inc. and its suppliers.
 *      All rights reserved.
 *
 * By using this file, you agree to the terms and conditions set
 * forth in the LICENSE file which can be found at the top level of
 * the sendmail distribution.
 */

#include <sm/gen.h>
SM_IDSTR(id, "@@(#)$Sendmail: t-memstat.c,v 1.5 2005/12/22 19:05:42 ca Exp $")

/*
** Simple test program for memstat
*/

#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <strings.h>

int
main(argc, argv)
	int argc;
	char **argv;
{
	int r, r2, i, l, slp, sz;
	long v;
	char *resource;

	l = 1;
	sz = slp = 0;
	resource = NULL;
	while ((r = getopt(argc, argv, "l:m:r:s:")) != -1)
	{
		switch ((char) r)
		{
		  case 'l':
			l = strtol(optarg, NULL, 0);
			break;

		  case 'm':
			sz = strtol(optarg, NULL, 0);
			break;

		  case 'r':
			resource = strdup(optarg);
			break;

		  case 's':
			slp = strtol(optarg, NULL, 0);
			break;

		  default:
			break;
		}
	}

	r = sm_memstat_open();
	r2 = -1;
	for (i = 0; i < l; i++)
	{
		char *mem;

		r2 = sm_memstat_get(resource, &v);
		if (slp > 0 && i + 1 < l && 0 == r)
		{
			printf("open=%d, memstat=%d, %s=%ld\n", r, r2,
				resource != NULL ? resource : "default-value",
				v);
			sleep(slp);
			if (sz > 0)
			{
				/*
				**  Just allocate some memory to test the
				**  values that are returned.
				**  Note: this is a memory leak, but that
				**  doesn't matter here.
				*/

				mem = malloc(sz);
				if (NULL == mem)
					printf("malloc(%d) failed\n", sz);
			}
		}
	}
	printf("open=%d, memstat=%d, %s=%ld\n", r, r2,
		resource != NULL ? resource : "default-value", v);
	r = sm_memstat_close();
	return r;
}
@


