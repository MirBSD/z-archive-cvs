head	1.18;
access;
symbols
	mbsd-20101220_mergebase:1.9
	cvs-201107021500:1.1.1.3
	cvs-20101220:1.1.1.2
	mbsd-20101220:1.9.0.2
	cvs-201012191730:1.1.1.2
	cvs-200812170000:1.1.1.2
	cvs-200805071200:1.1.1.2
	MIRBSD_10:1.6.0.2
	MIRBSD_10_BASE:1.6
	cvs-200803022030:1.1.1.2
	cvs-200707152000:1.1.1.2
	cvs-200704292000:1.1.1.2
	cvs-200702051700:1.1.1.2
	cvs-200609121900:1.1.1.2
	MIRBSD_9_BASE:1.5
	cvs-200606151800:1.1.1.2
	cvs-200603231300:1.1.1.2
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.1
	cvs-200504262050:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.18
date	2019.02.19.03.30.39;	author tg;	state Exp;
branches;
next	1.17;
commitid	1005C6B786D306CADA4;

1.17
date	2015.07.19.01.04.08;	author tg;	state Exp;
branches;
next	1.16;
commitid	10055AAF79C33376588;

1.16
date	2015.06.03.14.40.13;	author tg;	state Exp;
branches;
next	1.15;
commitid	100556F11BB7A305911;

1.15
date	2015.05.25.15.06.41;	author tg;	state Exp;
branches;
next	1.14;
commitid	10055633A8C2719746E;

1.14
date	2015.05.25.14.58.42;	author tg;	state Exp;
branches;
next	1.13;
commitid	1005563385962E5FCD6;

1.13
date	2015.05.25.14.56.02;	author tg;	state Exp;
branches;
next	1.12;
commitid	100556337E30F67C961;

1.12
date	2011.11.20.05.07.10;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004EC88AF448439B95;

1.11
date	2011.07.02.19.35.41;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004E0F73155335F685;

1.10
date	2011.07.02.18.53.07;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004E0F691F4FCE39B3;

1.9
date	2009.09.24.17.02.08;	author tg;	state Exp;
branches
	1.9.2.1;
next	1.8;
commitid	1004ABBA61E2854BC20;

1.8
date	2008.11.11.19.00.33;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004919D6517ECF837F;

1.7
date	2008.05.07.13.15.16;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004821AB7510EE48FB;

1.6
date	2007.02.05.17.29.27;	author tg;	state Exp;
branches
	1.6.2.1;
next	1.5;
commitid	10045C76986397CCCA5;

1.5
date	2006.06.15.19.18.47;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004491B2706C2443B2;

1.4
date	2006.03.23.13.20.21;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004422A0AB5336630E;

1.3
date	2005.04.26.21.04.38;	author tg;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2005.03.13.15.11.42;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.24.18;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.9.2.1
date	2011.07.02.16.04.46;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F418C2E526E32;

1.6.2.1
date	2008.05.17.19.11.42;	author tg;	state Exp;
branches;
next	;
commitid	100482F2DC168C89AEA;

1.3.2.1
date	2006.03.30.19.27.35;	author tg;	state Exp;
branches;
next	;
commitid	100442C309C7183FA09;

1.1.1.1
date	2005.02.05.17.24.18;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2006.03.23.13.08.51;	author tg;	state Exp;
branches;
next	1.1.1.3;
commitid	10044229DEA33D36552;

1.1.1.3
date	2011.07.02.15.17.35;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F36A10B5CA95B;


desc
@@


1.18
log
@we’re transitioning to 0640 root:ssl-cert on default.key, so allow that
@
text
@divert(-1)dnl
#
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.16 2015/06/03 14:40:13 tg Exp $
# @@(#)openbsd-proto.mc $Revision: 1.12 $
#
# Copyright (c) 2002, 2003, 2004, 2005, 2007, 2008, 2011, 2015, 2019
#	mirabilos <m@@mirbsd.org>
# Copyright (c) 1998 Sendmail, Inc.  All rights reserved.
# Copyright (c) 1983 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.

#
#  This is the prototype file for a standard MirOS installation on
#  systems accepting eMail from the internet.
#

divert(0)dnl
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.16 2015/06/03 14:40:13 tg Exp $')dnl
OSTYPE(openbsd)dnl
dnl
dnl
dnl If you have only a non-static IP address you may wish to forward
dnl outgoing mail through your ISP's mail server to prevent matching
dnl one of the dial-up DNS black holes. Just uncomment the following
dnl line and replace mail.myisp.net with the hostname of your ISP's
dnl mail server.
dnl
dnl define(`SMART_HOST', `[mail.myisp.net]')dnl
dnl
dnl
dnl Disable EXPN and VRFY to help thwart address harvesters and
dnl require senders to say hello.
dnl
define(`confPRIVACY_FLAGS',
  `authwarnings,needmailhelo,noexpn,novrfy,nobodyreturn')dnl
dnl
dnl
dnl We wish to make the existence of the local-host-names and
dnl trusted-users files optional, hence the "-o" below.
dnl
define(`confCW_FILE', `-o MAIL_SETTINGS_DIR`'local-host-names')dnl
define(`confCT_FILE', `-o MAIL_SETTINGS_DIR`'trusted-users')dnl
dnl
dnl
dnl Use of UUCP-style addresses in the modern internet are generally
dnl an error (and sometimes used by spammers) so disable support for
dnl them. To simply treat '!' as a normal character, change `reject'
dnl to `nospecial'.
dnl
FEATURE(`nouucp', `reject')dnl
dnl
dnl
dnl The access database allows for certain actions to be taken
dnl based on the source or destination address.
dnl The access database file should be considered optional.
dnl
FEATURE(`access_db', `hash -o -T<TMPF> MAIL_SETTINGS_DIR`'access',
  `relaytofulladdress')dnl
FEATURE(`blacklist_recipients')dnl
dnl
dnl
dnl Enable support for /etc/mail/local-host-names.
dnl Contains hostnames that should be considered local.
dnl
FEATURE(`use_cw_file')dnl
dnl
dnl
dnl Enable support for /etc/mail/mailertable.
dnl
FEATURE(`mailertable', `hash -o MAIL_SETTINGS_DIR`'mailertable')dnl
dnl
dnl
dnl Enable support for /etc/mail/trusted-users.
dnl Users listed herein may spoof mail from other users.
dnl
FEATURE(`use_ct_file')dnl
dnl
dnl
dnl Enable support for /etc/mail/virtusertable.
dnl Used to do N -> N address mapping.
dnl
FEATURE(`virtusertable', `hash -o MAIL_SETTINGS_DIR`'virtusertable')dnl
dnl
dnl
dnl Rewrite (unqualified) outgoing email addresses using the
dnl mapping listed in /etc/mail/genericstable
dnl
FEATURE(`genericstable', `hash -o MAIL_SETTINGS_DIR`'genericstable')dnl
dnl
dnl
dnl Normally only local addresses are rewritten.  By using
dnl generics_entire_domain and either GENERICS_DOMAIN
dnl or GENERICS_DOMAIN_FILE addresses from hosts in the
dnl specified domain(s) will be rewritten too.
dnl
dnl FEATURE(`generics_entire_domain')dnl
dnl GENERICS_DOMAIN(`othercompany.com')dnl
dnl GENERICS_DOMAIN_FILE(`MAIL_SETTINGS_DIR`'generics-domains')dnl
dnl
dnl
dnl Include the local host domain even on locally delivered mail
dnl (which would otherwise contain only the username).
dnl
FEATURE(`always_add_domain')dnl
dnl
dnl
dnl Bounce messages addressed to "address.REDIRECT". This allows the
dnl admin to alias a user who has moved to "new_address.REDIRECT" so
dnl that senders will know the user's new address.
dnl
FEATURE(`redirect')dnl
dnl
dnl
dnl Reject envelope sender addresses whose domain part resolves to
dnl a "bad" MX record (loopback, etc.)
dnl
FEATURE(`badmx')dnl
dnl
dnl
dnl Configuration of MTA/MSA addresses:
dnl
FEATURE(`no_default_msa')dnl
dnl
dnl Accept incoming connections on any IPv4 or IPv6 interface,
dnl but only on port 25 (SMTP).
dnl
DAEMON_OPTIONS(`Family=inet, Address=0.0.0.0, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::, Name=MTA6, M=O')dnl
dnl
dnl Do not configure an MSA by default, due to our rather
dnl restrictively enforced 7-bit security checks. Submissions
dnl should go by openbsd-submit.mc instead; we talk SMTP only
dnl as MTA. Separate MSA configurations should be as liberal
dnl in acceptance as openbsd-submit.mc is.
dnl
dnl DAEMON_OPTIONS(`Family=inet, Address=0.0.0.0, Port=587, Name=MSA, M=E')dnl
dnl DAEMON_OPTIONS(`Family=inet6, Address=::, Port=587, Name=MSA6, M=O, M=E')dnl
dnl
dnl Use either IPv4 or IPv6 for outgoing connections.
dnl
CLIENT_OPTIONS(`Family=inet, Address=0.0.0.0')dnl
CLIENT_OPTIONS(`Family=inet6, Address=::')dnl
dnl
dnl
dnl Some broken nameservers will return SERVFAIL (a temporary failure)
dnl on T_AAAA (IPv6) lookups.
dnl
define(`confBIND_OPTS', `WorkAroundBrokenAAAA')dnl
dnl
dnl
dnl Needed to make /etc/ssl/private/*.key 0640 root:ssl-cert possible.
dnl
define(`confDONT_BLAME_SENDMAIL', `GroupReadableKeyFile')dnl
dnl
dnl
dnl TLS/SSL support; read starttls(8) to use.
dnl
dnl MirOS speaks STARTTLS by default; the certificate is
dnl built during first bootup and self-signed.
dnl You should get a real certificate as soon as possible.
dnl
define(`confCACERT_PATH',	`/etc/ssl/certs')dnl
define(`confCACERT',		`/etc/ssl/deflt-ca.cer')dnl
define(`confSERVER_CERT',	`/etc/ssl/default.cer')dnl
define(`confCLIENT_CERT',	`/etc/ssl/default.cer')dnl
define(`confSERVER_KEY',	`/etc/ssl/private/default.key')dnl
define(`confCLIENT_KEY',	`/etc/ssl/private/default.key')dnl
define(`confCIPHER_LIST',	`kEECDH+aRSA:kEDH+aRSA:!COMPLEMENTOFDEFAULT:!ADH:!AECDH:-MEDIUM:!LOW:!EXPORT:!aNULL:!eNULL:!PSK:!aECDH:!aDSS:!DES:!MD5')dnl
dnl define(`confDH_PARAMETERS',	`/etc/ssl/dhparams.pem')dnl
define(`confRAND_FILE',		`/dev/arandom')dnl
dnl
dnl
dnl Masquerading -- rewriting the From address to a specific domain.
dnl Please see the "MASQUERADING AND RELAYING" section of
dnl /usr/share/sendmail/README for details.
dnl
dnl MASQUERADE_AS(`mycompany.com')dnl
dnl
dnl Masquerade the envelope From in addition to the From: header.
dnl
dnl FEATURE(masquerade_envelope)dnl
dnl
dnl Masquerade host.sub.dom.ain as well as host.dom.ain.
dnl
dnl FEATURE(masquerade_entire_domain)dnl
dnl
dnl Only masquerade messages going outside the local domain.
dnl
dnl FEATURE(local_no_masquerade)dnl
dnl
dnl Rewrite addresses from user@@othercompany.com when relayed in
dnl addition to locally-generated messages.
dnl
dnl MASQUERADE_DOMAIN(`othercompany.com')dnl
dnl
dnl Specific hosts that should be excepted from MASQUERADE_DOMAIN.
dnl
dnl MASQUERADE_EXCEPTION(`host.othercompany.com')dnl
dnl
dnl Only masquerade for hosts listed by MASQUERADE_DOMAIN
dnl (normally any host considered local is also masqueraded).
dnl
dnl FEATURE(limited_masquerade)dnl
dnl
dnl Specific users that should be excepted from masquerading.
dnl
dnl EXPOSED_USER(`root')dnl
dnl EXPOSED_USER(`daemon')dnl
dnl EXPOSED_USER_FILE(`MAIL_SETTINGS_DIR`'exposed-users')dnl
dnl
dnl End of masquerading section.
dnl
dnl
dnl MirOS enables special handling of eMail by default in order
dnl to be compatible to most of the internet mail servers.
dnl
dnl Handling of unescaped 8-bit messages
dnl
dnl - Strip the eigth bit (done when listening to the 'net)
dnl
define(`confSEVEN_BIT_INPUT', `True')dnl
dnl
dnl if confSEVEN_BIT_INPUT==False AND MIME8TO7 not =0 in Makefile
dnl - Convert them to valid MIME data (done in submit.mc)
dnl
dnl define(`confEIGHT_BIT_HANDLING', `mimefy')dnl
dnl
dnl
dnl Sanitise default mailer flags
dnl Escape lines starting with unescaped "From "
dnl
define(`_DEF_LOCAL_MAILER_FLAGS', `LlsDFMAw5:/|@@q')dnl
define(`LOCAL_MAILER_FLAGS', `rmnS67E')dnl
define(`_DEF_LOCAL_SHELL_FLAGS', `LlsDFMoq')dnl
define(`LOCAL_SHELL_FLAGS', `eu67E')dnl
define(`_DEF_SMTP_MAILER_FLAGS', `LmDFMuX')dnl
define(`SMTP_MAILER_FLAGS', `67E')dnl
dnl
dnl
dnl Adhere to ~/.etc standard of MirOS
dnl
define(`confFORWARD_PATH',
  `$z/.etc/forward.$w:$z/.etc/forward:$z/.forward.$w:$z/.forward')dnl
dnl
dnl Say hello to our friendly user
dnl
define(`confSMTP_LOGIN_MSG',
  `$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
dnl
dnl Raise some pool sizes and timeouts
dnl
define(`confMCI_CACHE_SIZE', `32')dnl
define(`confTO_QUEUERETURN', `14d')dnl
dnl
dnl
dnl That's all, folks.
dnl
dnl
MAILER(`local')dnl
MAILER(`smtp')dnl
dnl
dnl
LOCAL_RULESETS
dnl
dnl
dnl Enforce valid Message-Id to help stop spammers
dnl
HMessage-Id: $>CheckMessageId

SCheckMessageId
R< $+ @@ $+ >		$@@ OK
R$*			$#error $: 553 Header Error

dnl
dnl
dnl Enable to play "Towers of Hanoi"
dnl
############################################
###  Ruleset 49 -- a.s.r Towers of Hanoi ###
############################################
S49
RHANOI:$+	$:1 2 3$1
R$-$-$-$*[$+]	$:$1$2$3$4
R$-$-$-		$@@$1$2$3
R$-$-$-@@$*	$:$>49 $1$3$2$4
R$-$-$-$*	$:$>49 $2$3$1$4[Move top disc of peg $1 to peg $3]
R$-$-$-$*	$:$3$2$1@@$4

# Usage:
#   echo '49 HANOI:@@@@@@@@' | sendmail -bt -d21
dnl
dnl
dnl End of file.
dnl
@


1.17
log
@RC4 NOMORE
@
text
@d6 2
a7 2
# Copyright (c) 2002, 2003, 2004, 2005, 2007, 2008, 2011, 2015
#	Thorsten "mirabilos" Glaser <tg@@mirbsd.org>
d156 5
@


1.16
log
@drop aDSS, both from EvolvisForge and by Apache httpd/mod_ssl suggestion;
add comment about RC4 removal forcing PFS and, unless that’s the goal, it
isn’t necessary for sendmail(8) – currently not 100% true, patches coming
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.15 2015/05/25 15:06:41 tg Exp $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.15 2015/05/25 15:06:41 tg Exp $')dnl
d168 1
a168 1
define(`confCIPHER_LIST',	`kEECDH+aRSA:kEDH+aRSA:!COMPLEMENTOFDEFAULT:!ADH:!AECDH:-MEDIUM:!LOW:!EXPORT:!aNULL:!eNULL:!PSK:!aECDH:!aDSS:!DES:!MD5:ECDHE-RSA-RC4-SHA:RC4-SHA')dnl
@


1.15
log
@add a few more !foo here, no change in current openssl but good practice
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.14 2015/05/25 14:58:42 tg Exp $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.14 2015/05/25 14:58:42 tg Exp $')dnl
d168 1
a168 1
define(`confCIPHER_LIST',	`kEECDH+aRSA:kEDH+aRSA:!COMPLEMENTOFDEFAULT:!ADH:!AECDH:-MEDIUM:!LOW:!EXPORT:!aNULL:!eNULL:!PSK:!aECDH:!DES:!MD5:EDH-DSS-DES-CBC3-SHA:ECDHE-RSA-RC4-SHA:RC4-SHA')dnl
@


1.14
log
@add (commented out) DHParameters; we need to generate them from rc.once
first… or possibly ship them, generation of 2048-bit ones takes over 40
minutes (!) on a Celeron 2G4Hz…
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.12 2011/11/20 05:07:10 tg Exp $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.12 2011/11/20 05:07:10 tg Exp $')dnl
d168 1
a168 1
define(`confCIPHER_LIST',	`kEECDH+aRSA:kEDH+aRSA:!COMPLEMENTOFDEFAULT:!ADH:!AECDH:-MEDIUM:!LOW:!EXPORT:!aNULL:!eNULL:EDH-DSS-DES-CBC3-SHA:ECDHE-RSA-RC4-SHA:RC4-SHA')dnl
@


1.13
log
@add the same cipher list we use in httpd, except without the comment
about dropping RC4 as it’s probably ok for SMTP

XXX add some randomness to the ESMTP greeting to counteract it more?

From MirOS: src/usr.sbin/httpd/conf/httpd.conf,v 1.24 2014/10/16 19:50:36 tg Exp $
@
text
@d169 1
@


1.12
log
@raise connection pool size (helps when sending multiple mails to recips
on the same hoster) and return timeout (a fortnight is better)
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.11 2011/07/02 19:35:41 tg Exp $
d6 1
a6 1
# Copyright (c) 2002, 2003, 2004, 2005, 2007, 2008, 2011
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.11 2011/07/02 19:35:41 tg Exp $')dnl
d168 1
@


1.11
log
@turns out define/include did NOT work… grml… these openbsd people…
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.10 2011/07/02 18:53:07 tg Exp $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.10 2011/07/02 18:53:07 tg Exp $')dnl
d248 5
@


1.10
log
@take care of merging cf-related changes and work on them a bit more
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.9 2009/09/24 17:02:08 tg Exp $
a17 5
ifdef(`LOCAL_CF', `
#  This configuration only runs sendmail on the localhost interface.
#  This allows mail on the local host to work without accepting
#  connections from the net at large.
',`
a19 1
')dnl
d23 1
a23 6
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.9 2009/09/24 17:02:08 tg Exp $')dnl
ifdef(`LOCAL_CF', `
#####  expanded proto configuration for LOCAL_CF
',`
#####  standard proto configuration
')dnl
a111 11
ifdef(`LOCAL_CF', `
dnl ======= This part is only run for openbsd-localhost.cf =======
dnl
dnl
FEATURE(`accept_unresolvable_domains')dnl
dnl
dnl
',`
dnl ======= This part is only run for openbsd-proto.cf =======
dnl
dnl
a124 4
')dnl
dnl ======= This part is common to openbsd-{localhost,proto}.cf =======
dnl
dnl
a128 15
ifdef(`LOCAL_CF', `
dnl ======= This part is only run for openbsd-localhost.cf =======
dnl
dnl
dnl Accept incoming connections on IPv4 and IPv6 loopback,
dnl both port 25 (SMTP) and port 587 (MSA).
dnl
DAEMON_OPTIONS(`Family=inet, Address=127.0.0.1, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::1, Name=MTA6, M=O')dnl
DAEMON_OPTIONS(`Family=inet, Address=127.0.0.1, Port=587, Name=MSA, M=E')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::1, Port=587, Name=MSA6, M=O, M=E')dnl
',`
dnl ======= This part is only run for openbsd-proto.cf =======
dnl
dnl
a134 1
dnl
a143 4
')dnl
dnl ======= This part is common to openbsd-{localhost,proto}.cf =======
dnl
dnl
a170 4
ifdef(`LOCAL_CF', `', `
dnl ======= This part is only run for openbsd-proto.cf =======
dnl
dnl
a211 4
')dnl
dnl ======= This part is common to openbsd-{localhost,proto}.cf =======
dnl
dnl
a258 4
ifdef(`LOCAL_CF', `', `
dnl ======= This part is only run for openbsd-proto.cf =======
dnl
dnl
a268 4
')dnl
dnl ======= This part is common to openbsd-{localhost,proto}.cf =======
dnl
dnl
@


1.9
log
@don't configure an MSA by default; see diff for rationale
@
text
@d3 2
a4 2
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.8 2008/11/11 19:00:33 tg Exp $
# @@(#)openbsd-proto.mc $Revision: 1.11 $
d6 1
a6 1
# Copyright (c) 2002, 2003, 2004, 2005, 2007, 2008
d18 5
d25 1
d29 6
a34 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.8 2008/11/11 19:00:33 tg Exp $')dnl
a36 4
dnl If you have a non-static IP address you may wish to forward outgoing mail
dnl through your ISP's mail server to prevent matching one of the dialup
dnl DNS black holes.  Just uncomment the following line and replace
dnl mail.myisp.net with the hostname of your ISP's mail server.
d38 5
a42 1
dnl define(`SMART_HOST', `mail.myisp.net')dnl
d44 5
a48 2
dnl Disable EXPN and VRFY to help thwart address harvesters and require
dnl senders to say hello.
d53 1
d60 1
d62 3
a64 3
dnl an error (and sometimes used by spammers) so disable support for them.
dnl To simply treat '!' as a normal character, change `reject' to
dnl `nospecial'.
d77 1
d83 1
d88 1
d94 1
d100 1
d106 1
d116 1
d119 1
d122 13
a134 1
dnl Bounce messages addressed to "address.REDIRECT".  This allows the
d137 1
d140 1
d143 1
d146 6
a151 2
dnl Accept incoming connections on any IPv4 or IPv6 interface for ports
dnl 25 (SMTP) and 587 (MSA).
d154 19
d176 1
d186 4
d195 1
d198 1
d217 4
d262 4
d272 1
d274 1
d277 1
d280 1
d291 1
d310 7
a318 1
LOCAL_RULESETS
d327 4
@


1.9.2.1
log
@fastmerge on vendor branch "openbsd", focus on THEIRS, not intended for use
@
text
@d3 2
a4 2
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.9 2009/09/24 17:02:08 tg Exp $
# @@(#)openbsd-proto.mc $Revision: 1.12 $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.9 2009/09/24 17:02:08 tg Exp $')dnl
a110 4
ifdef(`LOCALHOST_ONLY', `
DAEMON_OPTIONS(`Family=inet, address=127.0.0.1, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, address=::1, Name=MTA6, M=O')dnl
',`
a112 1
')dnl
@


1.8
log
@allow the “user@@” part in access_db stanzas like this one:
│To:user@@domain			RELAY
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.7 2008/05/07 13:15:16 tg Exp $
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.7 2008/05/07 13:15:16 tg Exp $')dnl
d113 9
a121 2
DAEMON_OPTIONS(`Family=inet, Address=0.0.0.0, Port=587, Name=MSA, M=E')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::, Port=587, Name=MSA6, M=O, M=E')dnl
@


1.7
log
@merge and reduce diffs against upstream
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.6 2007/02/05 17:29:27 tg Exp $
d7 1
a7 1
#	Thorsten "mirabilos" Glaser <tg@@MirBSD.de>
d23 1
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.6 2007/02/05 17:29:27 tg Exp $')dnl
d36 2
a37 1
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy,nobodyreturn')dnl
d54 1
a54 1
dnl based on the source address.
d57 2
a58 1
FEATURE(`access_db', `hash -o -T<TMPF> MAIL_SETTINGS_DIR`'access')dnl
a137 1
dnl This one is just faster and as secure as /dev/urandom.
d205 2
a206 1
define(`confFORWARD_PATH', `$z/.etc/forward.$w:$z/.etc/forward:$z/.forward.$w:$z/.forward')dnl
d211 1
a211 1
 `$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
@


1.6
log
@Reject envelope sender addresses whose domain part resolves to a "bad" MX record
@
text
@d3 2
a4 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.5 2006/06/15 19:18:47 tg Exp $
d6 1
a6 1
# Copyright (c) 2002, 2003, 2004, 2005, 2007
d23 1
a23 2
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.5 2006/06/15 19:18:47 tg Exp $')dnl
dnl VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.11 $')dnl
a32 1
dnl
a37 1
dnl
a43 1
dnl
a58 1
dnl
a63 1
dnl
a67 1
dnl
a72 1
dnl
a77 1
dnl
a82 1
dnl
a91 1
dnl
a95 1
dnl
a100 1
dnl
a104 1
dnl
a118 1
dnl
a145 1
dnl
@


1.6.2.1
log
@MFC sendmail update to 8.14.3

agreed bsiegert@@
@
text
@d3 1
a3 2
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.7 2008/05/07 13:15:16 tg Exp $
# @@(#)openbsd-proto.mc $Revision: 1.11 $
d5 1
a5 1
# Copyright (c) 2002, 2003, 2004, 2005, 2007, 2008
d22 2
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.7 2008/05/07 13:15:16 tg Exp $')dnl
d33 1
d39 1
d46 1
d62 1
d68 1
d73 1
d79 1
d85 1
d91 1
d101 1
d106 1
d112 1
d117 1
d132 1
d160 1
@


1.5
log
@mirbsd.org, 66h.42h.de, bsdadvocacy.org, and whatnot
we changed that too often, try to clean up the mess
mostly outside the www/ module which is dead anyway.
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.4 2006/03/23 13:20:21 tg Exp $
d5 2
a6 2
# Copyright (c) 2002, 2003, 2004, 2005
#	Thorsten "mirabile" Glaser <tg@@MirBSD.de>
d22 1
a22 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.4 2006/03/23 13:20:21 tg Exp $')dnl
d113 5
@


1.4
log
@fastmerge Sendmail 8.13.6
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.3 2005/04/26 21:04:38 tg Exp $
d6 1
a6 1
#	Thorsten "mirabile" Glaser <tg@@MirBSD.org>
d22 1
a22 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.3 2005/04/26 21:04:38 tg Exp $')dnl
@


1.3
log
@merge
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.2 2005/03/13 15:11:42 tg Exp $
d22 2
a23 1
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.2 2005/03/13 15:11:42 tg Exp $')dnl
d37 1
a37 1
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy')dnl
@


1.3.2.1
log
@MFC most of the recent sendmail updates to MirOS #8-stable
agreed bsiegert@@

This also changes the LOCALBASE stuff, links libmilter not
against LDAP, etc. but doesn't install the FreeBSD 6 confs
nor a shared libmilter in order to pass a no-files-diff:

tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo find / -ls | sort -k11 >~/x1
tg@@maou:/usr/src/gnu/usr.sbin/sendmail $ sudo make install
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo make distribution
tg@@maou:/usr/src/gnu/usr.sbin/sendmail/cf/cf $ sudo find / -ls | sort -k11 | diff -u ~/x1 - | less

Note: files in /etc/mail/ are also changed, this affects the etc8.ngz set
on fresh installs and cannot(!) be automatically upgraded!
@
text
@d3 1
a3 1
# $MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.4 2006/03/23 13:20:21 tg Exp $
d22 1
a22 2
VERSIONID(`$MirOS: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.4 2006/03/23 13:20:21 tg Exp $')dnl
dnl VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.11 $')dnl
d36 1
a36 1
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy,nobodyreturn')dnl
@


1.2
log
@merge sendmail diff against OpenBSD's idea of sendmail port
@
text
@d3 1
a3 1
# $MirOS$
d6 1
a6 1
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d22 1
a22 1
VERSIONID(`$MirOS$')dnl
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
divert(-1)
d3 16
a18 2
# Default OpenBSD sendmail configuration for systems accepting mail
# from the internet.
a19 1
# Note that lines beginning with "dnl" below are comments.
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.10 $')dnl
d32 1
d38 1
d45 1
d51 2
a52 1
FEATURE(nouucp, `reject')dnl
d54 3
a56 2
dnl The access database allows for certain actions to be taken based on
dnl the source address.
d58 1
a58 1
FEATURE(`access_db', `hash -o -T<TMPF> /etc/mail/access')dnl
d61 1
d67 1
d70 2
a71 1
FEATURE(`mailertable', `hash -o /etc/mail/mailertable')dnl
d78 1
d82 2
a83 1
FEATURE(`virtusertable', `hash -o /etc/mail/virtusertable')dnl
d88 2
a89 1
FEATURE(genericstable, `hash -o /etc/mail/genericstable')dnl
d96 1
a96 1
dnl FEATURE(generics_entire_domain)dnl
d98 2
a99 1
dnl GENERICS_DOMAIN_FILE(`/etc/mail/generics-domains')dnl
d103 2
a104 1
FEATURE(always_add_domain)dnl
d109 2
a110 1
FEATURE(redirect)dnl
d126 1
d129 2
d132 1
a132 1
define(`confBIND_OPTS', `WorkAroundBrokenAAAA')dnl
d134 12
a145 1
dnl TLS/SSL support; uncomment and read starttls(8) to use.
a146 7
dnl define(`CERT_DIR', `MAIL_SETTINGS_DIR`'certs')dnl
dnl define(`confCACERT_PATH', `CERT_DIR')dnl
dnl define(`confCACERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confSERVER_CERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confSERVER_KEY', `CERT_DIR/mykey.pem')dnl
dnl define(`confCLIENT_CERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confCLIENT_KEY', `CERT_DIR/mykey.pem')dnl
d154 1
d185 1
a185 1
dnl EXPOSED_USER_FILE(`/etc/mail/exposed-users')dnl
a187 2
MAILER(local)dnl
MAILER(smtp)dnl
d189 40
a228 1
dnl Enforce valid Message-Id to help stop spammers.
d236 22
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Update to Sendmail 8.13.6
@
text
@d9 1
a9 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.11 $')dnl
d22 1
a22 1
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy,nobodyreturn')dnl
@


1.1.1.3
log
@Import OpenBSD’s sendmail 8.14.5, RCS IDs properly sedded back
@
text
@d9 1
a9 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.12 $')dnl
a88 6
ifdef(`LOCALHOST_ONLY', `
DAEMON_OPTIONS(`Family=inet, address=127.0.0.1, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, address=::1, Name=MTA6, M=O')dnl
DAEMON_OPTIONS(`Family=inet, address=127.0.0.1, Port=587, Name=MSA, M=E')dnl
DAEMON_OPTIONS(`Family=inet6, address=::1, Port=587, Name=MSA6, M=O, M=E')dnl
',`
a92 1
')dnl
@


