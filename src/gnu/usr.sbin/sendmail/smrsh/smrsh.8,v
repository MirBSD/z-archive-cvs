head	1.3;
access;
symbols
	sendmail-8_14_9:1.1.127.2
	sendmail-8_14_7:1.1.127.1
	sendmail-8_14_6:1.1.127.1
	sendmail-8_14_5-ERRATA-1:1.1.127.1
	mbsd-20101220_mergebase:1.1.1.3.2.1
	sendmail-8_14_5:1.1.127.1
	cvs-201107021500:1.1.1.5
	cvs-20101220:1.1.1.4
	mbsd-20101220:1.1.1.3.0.2
	cvs-201012191730:1.1.1.3
	sendmail-8_14_5_Beta0:1.1.127.1
	sendmail-8_14_3:1.1.127.1
	sendmail:1.1.127
	cvs-200812170000:1.1.1.2
	cvs-200805071200:1.1.1.2
	MIRBSD_10:1.1.1.2.0.2
	MIRBSD_10_BASE:1.1.1.2
	cvs-200803022030:1.1.1.2
	cvs-200707152000:1.1.1.2
	cvs-200704292000:1.1.1.2
	cvs-200702051700:1.1.1.1
	cvs-200609121900:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	cvs-200606151800:1.1.1.1
	cvs-200603231300:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	cvs-200504262050:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.3
date	2014.06.09.15.18.03;	author tg;	state Exp;
branches;
next	1.2;
commitid	1005395CFC65E5646F1;

1.2
date	2011.07.02.15.04.13;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004E0F31C5496AB95F;

1.1
date	2005.02.05.17.24.33;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.127.1;
next	;

1.1.1.1
date	2005.02.05.17.24.33;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2007.04.29.20.07.13;	author tg;	state Exp;
branches;
next	1.1.1.3;
commitid	1004634FAED5BC54DF0;

1.1.1.3
date	2010.12.19.17.39.47;	author tg;	state Exp;
branches
	1.1.1.3.2.1;
next	1.1.1.4;
commitid	1004D0E436269567D7C;

1.1.1.4
date	2011.07.02.15.01.15;	author tg;	state Exp;
branches;
next	1.1.1.5;
commitid	1004E0F31C5496AB95F;

1.1.1.5
date	2011.07.02.15.17.45;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F36A10B5CA95B;

1.1.1.3.2.1
date	2011.07.02.15.03.03;	author tg;	state Exp;
branches;
next	;
commitid	1004E0F31C5496AB95F;

1.1.127.1
date	2010.12.19.14.45.43;	author tg;	state Exp;
branches;
next	1.1.127.2;
commitid	1004D0E1A94384778FD;

1.1.127.2
date	2014.06.09.14.29.15;	author tg;	state Exp;
branches;
next	;
commitid	1005395C4CC1A6DB9EE;


desc
@@


1.3
log
@merge
@
text
@.\"	$OpenBSD: smrsh.8,v 1.16 2010/09/23 14:51:57 jmc Exp $
.\"
.\" Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
.\"	 All rights reserved.
.\" Copyright (c) 1993 Eric P. Allman.  All rights reserved.
.\" Copyright (c) 1993
.\"     The Regents of the University of California.  All rights reserved.
.\"
.\" By using this file, you agree to the terms and conditions set
.\" forth in the LICENSE file which can be found at the top level of
.\" the sendmail distribution.
.\"
.\"
.\"     $Id: smrsh.8,v 8.23 2013-11-22 20:52:00 ca Exp $
.\"
.Dd $Mdocdate: July 2 2011 $
.Dt SMRSH 8
.Os
.Sh NAME
.Nm smrsh
.Nd restricted shell for sendmail
.Sh SYNOPSIS
.Nm smrsh
.Fl c Ar command
.Sh DESCRIPTION
The
.Nm smrsh
program is intended as a replacement for
.Pa /bin/sh
for use in the
.Dq prog
mailer in
.Xr sendmail 8
configuration files.
It sharply limits the commands that can be run using the
.Dq |program
syntax of
.Xr sendmail 8
in order to improve the overall security of your system.
Briefly, even if a
.Dq bad guy
can get sendmail to run a program
without going through an alias or forward file,
.Nm smrsh
limits the set of programs that he or she can execute.
.Pp
Briefly,
.Nm smrsh
limits programs to be in a single directory, by default
.Pa /usr/libexec/sm.bin ,
allowing the system administrator to choose the set of acceptable commands,
and the shell built-in commands
.Dq exec ,
.Dq exit ,
and
.Dq echo .
It also rejects any commands with the characters
.Sq \e ,
.Sq < ,
.Sq > ,
.So
;
.Sc ,
.Sq $ ,
.So
(
.Sc ,
.So
)
.Sc ,
.Sq \er
(carriage return), or
.Sq \en
(newline) on the command line to prevent
.Dq end run
attacks.
It allows
.Dq ||
and
.Dq &&
to enable commands like:
.Bd -literal -offset indent
.Qq |exec /usr/local/bin/filter || exit 75
.Ed
.Pp
Initial pathnames on programs are stripped,
so forwarding to
.Pa /usr/ucb/vacation ,
.Pa /usr/bin/vacation ,
.Pa /home/server/mydir/bin/vacation ,
and
.Pa vacation
all actually forward to
.Pa /usr/libexec/sm.bin/vacation .
.Pp
System administrators should be conservative about populating
the sm.bin directory.
For example, a reasonable additions is
.Xr vacation 1
and the like.
No matter how brow-beaten you may be,
never include any shell or shell-like program
(such as
.Xr perl 1 )
in the
sm.bin
directory.
Note that this does not restrict the use of shell or perl scripts
in the sm.bin directory (using the
.Dq #!
syntax);
it simply disallows execution of arbitrary programs.
Also, including mail filtering programs such as
.Xr procmail
is a very bad idea.
.Xr procmail
allows users to run arbitrary programs in their
.Xr procmailrc .
.Sh FILES
.Bl -tag -width "/usr/libexec/sm.bin" -compact
.It Pa /usr/libexec/sm.bin
directory for restricted programs
.El
.Sh SEE ALSO
.Xr sendmail 8
@


1.2
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d14 1
a14 1
.\"     $Id: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d16 1
a16 1
.Dd $Mdocdate: December 19 2010 $
@


1.1
log
@Initial revision
@
text
@d1 2
d14 1
a14 1
.\"     $Sendmail: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d16 1
a16 1
.Dd August 8, 2004
d82 2
a83 2
.Bd -literal -compact -offset "XXXX"
.Qq "|exec /usr/local/bin/filter || exit 75"
@


1.1.127.1
log
@Import Sendmail 8.14.3, suitably stripped down by the not yet committed
contrib/samples/import-3rdpty,v 1.35; we have some new and renamed files
@
text
@d12 1
a12 1
.\"     $Id: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d14 10
a23 8
.TH SMRSH 8 "$Date: 2004/08/06 03:55:35 $"
.SH NAME
smrsh \- restricted shell for sendmail
.SH SYNOPSIS
.B smrsh
.B \-c
command
.SH DESCRIPTION
d25 1
a25 1
.I smrsh
d27 5
a31 3
.I sh
for use in the ``prog'' mailer in
.IR sendmail (8)
d34 7
a40 4
``|program'' syntax of
.I sendmail
in order to improve the over all security of your system.
Briefly, even if a ``bad guy'' can get sendmail to run a program
d42 1
a42 1
.I smrsh
d44 1
a44 1
.PP
d46 3
a48 4
.I smrsh
limits programs to be in a single directory,
by default
/usr/adm/sm.bin,
d50 5
a54 1
and to the shell builtin commands ``exec'', ``exit'', and ``echo''.
d56 28
a83 6
`\`', `<', `>', `;', `$', `(', `)', `\er' (carriage return),
or `\en' (newline)
on the command line to prevent ``end run'' attacks.
It allows ``||'' and ``&&'' to enable commands like:
``"|exec /usr/local/bin/filter || exit 75"''
.PP
d85 4
a88 3
so forwarding to ``/usr/ucb/vacation'',
``/usr/bin/vacation'',
``/home/server/mydir/bin/vacation'',
d90 1
a90 1
``vacation''
d92 2
a93 2
``/usr/adm/sm.bin/vacation''.
.PP
d97 1
a97 1
.IR vacation (1),
d102 1
a102 1
.IR perl (1))
d107 3
a109 1
in the sm.bin directory (using the ``#!'' syntax);
d112 1
a112 1
.IR procmail (1)
d114 1
a114 1
.IR procmail (1)
d116 8
a123 18
.IR procmailrc (5).
.SH COMPILATION
Compilation should be trivial on most systems.
You may need to use \-DSMRSH_PATH=\e"\fIpath\fP\e"
to adjust the default search path
(defaults to ``/bin:/usr/bin:/usr/ucb'')
and/or \-DSMRSH_CMDDIR=\e"\fIdir\fP\e"
to change the default program directory
(defaults to ``/usr/adm/sm.bin'').
.SH FILES
/usr/adm/sm.bin \- default directory for restricted programs on most OSs
.PP
/var/adm/sm.bin \- directory for restricted programs on HP UX and Solaris
.PP
/usr/libexec/sm.bin \- directory for restricted programs on FreeBSD (>= 3.3) and DragonFly BSD

.SH SEE ALSO
sendmail(8)
@


1.1.127.2
log
@Import sendmail 8.14.9
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2004 Proofpoint, Inc. and its suppliers.
d12 1
a12 1
.\"     $Id: smrsh.8,v 8.23 2013-11-22 20:52:00 ca Exp $
d14 1
a14 1
.TH SMRSH 8 "$Date: 2013-11-22 20:52:00 $"
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@import openbsd compress, ssh, perl, sendmail for minor bugfixes
@
text
@d80 2
a81 2
.Bd -literal -offset indent
.Qq |exec /usr/local/bin/filter || exit 75
@


1.1.1.3
log
@Import whatever OpenBSD did to sendmail 8.14.3 in the last two years
@
text
@a0 2
.\"	$OpenBSD: smrsh.8,v 1.16 2010/09/23 14:51:57 jmc Exp $
.\"
d14 1
a14 1
.Dd $Mdocdate: September 23 2010 $
@


1.1.1.3.2.1
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d14 1
a14 1
.\"     $Id: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d16 1
a16 1
.Dd $Mdocdate: December 19 2010 $
@


1.1.1.4
log
@Replace “$Sendmail: ” with “$Id: ” (the latter is used by upstream)
@
text
@d14 1
a14 1
.\"     $Id: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d16 1
a16 1
.Dd $Mdocdate: December 19 2010 $
@


1.1.1.5
log
@Import OpenBSD’s sendmail 8.14.5, RCS IDs properly sedded back
@
text
@d16 1
a16 1
.Dd $Mdocdate: September 23 2010 $
@


