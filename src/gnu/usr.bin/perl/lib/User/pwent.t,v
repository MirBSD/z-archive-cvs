head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_4_4:1.1.1.1
	MIRBSD_10:1.1.1.1.0.4
	MIRBSD_10_BASE:1.1.1.1
	cvs-200704292000:1.1.1.1
	cvs-200606302200:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	cvs-200601311430:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2005.02.05.17.23.41;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.23.41;	author tg;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Initial revision
@
text
@#!./perl

BEGIN {
    chdir 't' if -d 't';
    @@INC = '../lib';
}

BEGIN {
    our $haspw;
    eval { my @@n = getpwuid 0 };
    $haspw = 1 unless $@@ && $@@ =~ /unimplemented/;
    unless ($haspw) { print "1..0 # Skip: no getpwuid\n"; exit 0 }
    use Config;
    # VMS's pwd.h struct passwd conflicts with the one in vmsish.h
    $haspw = 0 unless ( $Config{'i_pwd'} eq 'define' || $^O eq 'VMS' );
    unless ($haspw) { print "1..0 # Skip: no pwd.h\n"; exit 0 }
}

BEGIN {
    our $uid = 0;
    # On VMS getpwuid(0) may return [$gid,0] UIC info (which may not exist).
    # It is better to use the $< uid for testing on VMS instead.
    if ( $^O eq 'VMS' ) { $uid = $< ; }
    our @@pwent = getpwuid $uid; # This is the function getpwuid.
    unless (@@pwent) { print "1..0 # Skip: no uid $uid\n"; exit 0 }
}

print "1..9\n";

use User::pwent;

print "ok 1\n";

my $pwent = getpwuid $uid; # This is the OO getpwuid.

my $uid_expect = $uid;
if ( $^O eq 'cygwin' ) {
    print "not " unless (   $pwent->uid == $uid_expect
                         || $pwent->uid == 500         );  # go figure
}
else {
    print "not " unless $pwent->uid    == $uid_expect ;
}
print "ok 2\n";

print "not " unless $pwent->name   eq $pwent[0];
print "ok 3\n";

if ($^O eq 'os390') {
    print "not "
	unless not defined $pwent->passwd &&
	       $pwent[1] eq '0'; # go figure
} else {
    print "not " unless $pwent->passwd eq $pwent[1];
}
print "ok 4\n";

print "not " unless $pwent->uid    == $pwent[2];
print "ok 5\n";

print "not " unless $pwent->gid    == $pwent[3];
print "ok 6\n";

# The quota and comment fields are unportable.

print "not " unless $pwent->gecos  eq $pwent[6];
print "ok 7\n";

print "not " unless $pwent->dir    eq $pwent[7];
print "ok 8\n";

print "not " unless $pwent->shell  eq $pwent[8];
print "ok 9\n";

# The expire field is unportable.

# Testing pretty much anything else is unportable:
# there maybe more than one username with uid 0;
# uid 0's home directory may be "/" or "/root' or something else,
# and so on.

@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
