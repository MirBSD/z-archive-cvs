head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_4_4:1.1.1.1
	MIRBSD_10:1.1.1.1.0.4
	MIRBSD_10_BASE:1.1.1.1
	cvs-200704292000:1.1.1.1
	cvs-200606302200:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	cvs-200601311430:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2005.02.05.17.23.07;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.23.07;	author tg;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Initial revision
@
text
@#!./perl

# Regression tests for attrs.pm and the C<sub x : attrs> syntax.

BEGIN {
    chdir 't' if -d 't';
    @@INC = '../lib';
    eval 'require attrs; 1' or do {
	print "1..0\n";
	exit 0;
    }
}

use warnings;
no warnings qw(deprecated);     # else attrs cries.

sub NTESTS () ;

my ($test, $ntests);
BEGIN {$ntests=0}
$test=0;
my $failed = 0;

print "1..".NTESTS."\n";

eval 'sub t1 ($) { use attrs "locked"; $_[0]++ }';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub t2 { use attrs "locked"; $_[0]++ }';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub t3 ($) : locked ;';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub t4 : locked ;';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

my $anon1;
eval '$anon1 = sub ($) { use attrs qw(locked method); $_[0]++ }';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

my $anon2;
eval '$anon2 = sub { use attrs qw(locked method); $_[0]++ }';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

my $anon3;
eval '$anon3 = sub { use attrs "method"; $_[0]->[1] }';
(print "not "), $failed=1 if $@@;
print "ok ",++$test,"\n";
BEGIN {++$ntests}

my @@attrs = attrs::get($anon3 ? $anon3 : \&ns);
(print "not "), $failed=1 unless "@@attrs" eq "method";
print "ok ",++$test,"\n";
BEGIN {++$ntests}

@@attrs = sort +attrs::get($anon2 ? $anon2 : \&ns);
(print "not "), $failed=1 unless "@@attrs" eq "locked method";
print "ok ",++$test,"\n";
BEGIN {++$ntests}

@@attrs = sort +attrs::get($anon1 ? $anon1 : \&ns);
(print "not "), $failed=1 unless "@@attrs" eq "locked method";
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub e1 ($) : plugh ;';
unless ($@@ && $@@ =~ m/^Invalid CODE attribute: ["']?plugh["']? at/) {
    my $x = $@@;
    $x =~ s/\n.*\z//s;
    print "# $x\n";
    print "not ";
    $failed = 1;
}
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub e2 ($) : plugh(0,0) xyzzy ;';
unless ($@@ && $@@ =~ m/^Invalid CODE attributes: ["']?plugh\(0,0\)["']? /) {
    my $x = $@@;
    $x =~ s/\n.*\z//s;
    print "# $x\n";
    print "not ";
    $failed = 1;
}
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub e3 ($) : plugh(0,0 xyzzy ;';
unless ($@@ && $@@ =~ m/Unterminated attribute parameter in attribute list at/) {
    my $x = $@@;
    $x =~ s/\n.*\z//s;
    print "# $x\n";
    print "not ";
    $failed = 1;
}
print "ok ",++$test,"\n";
BEGIN {++$ntests}

eval 'sub e4 ($) : plugh + xyzzy ;';
unless ($@@ && $@@ =~ m/Invalid separator character '[+]' in attribute list at/) {
    my $x = $@@;
    $x =~ s/\n.*\z//s;
    print "# $x\n";
    print "not ";
    $failed = 1;
}
print "ok ",++$test,"\n";
BEGIN {++$ntests}

{
    my $w = "" ;
    local $SIG{__WARN__} = sub {$w = shift} ;
    eval 'sub w1 ($) { use warnings "deprecated"; use attrs "locked"; $_[0]++ }';
    (print "not "), $failed=1 if $@@;
    print "ok ",++$test,"\n";
    BEGIN {++$ntests}
    (print "not "), $failed=1 
	if $w !~ /^pragma "attrs" is deprecated, use "sub NAME : ATTRS" instead at/;
    print "ok ",++$test,"\n";
    BEGIN {++$ntests}
}


# Other tests should be added above this line

sub NTESTS () { $ntests }

exit $failed;
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
