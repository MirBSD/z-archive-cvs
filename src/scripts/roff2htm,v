head	1.93;
access;
symbols
	MIRBSD_10:1.56.0.2
	MIRBSD_10_BASE:1.56
	MIRBSD_9_BASE:1.31
	MIRBSD_8:1.22.0.2
	MIRBSD_8_BASE:1.22;
locks; strict;
comment	@# @;


1.93
date	2019.11.22.21.43.24;	author tg;	state Exp;
branches;
next	1.92;
commitid	1005DD8562B52B3EE67;

1.92
date	2019.01.05.13.30.48;	author tg;	state Exp;
branches;
next	1.91;
commitid	1005C30B1A05E192EA5;

1.91
date	2018.12.25.23.52.50;	author tg;	state Exp;
branches;
next	1.90;
commitid	1005C22C2EA7107867F;

1.90
date	2018.01.07.23.27.30;	author tg;	state Exp;
branches;
next	1.89;
commitid	1005A52ACF9654215C5;

1.89
date	2017.12.19.00.55.00;	author tg;	state Exp;
branches;
next	1.88;
commitid	1005A38636B714CDF30;

1.88
date	2017.01.29.00.51.06;	author tg;	state Exp;
branches;
next	1.87;
commitid	100588D3C8F09DC1F20;

1.87
date	2017.01.11.23.24.16;	author tg;	state Exp;
branches;
next	1.86;
commitid	1005876BEB73AFF056C;

1.86
date	2017.01.08.19.38.12;	author tg;	state Exp;
branches;
next	1.85;
commitid	1005872953E5E40FCFB;

1.85
date	2017.01.08.19.36.58;	author tg;	state Exp;
branches;
next	1.84;
commitid	100587294F3784933F6;

1.84
date	2017.01.08.19.35.29;	author tg;	state Exp;
branches;
next	1.83;
commitid	100587294941C76EBE9;

1.83
date	2016.03.26.23.38.28;	author tg;	state Exp;
branches;
next	1.82;
commitid	10056F71D8418F43055;

1.82
date	2016.01.02.20.05.08;	author tg;	state Exp;
branches;
next	1.81;
commitid	10056882D871C1C3E41;

1.81
date	2015.10.16.13.19.09;	author tg;	state Exp;
branches;
next	1.80;
commitid	1005620F9660B564E1E;

1.80
date	2015.01.02.13.54.19;	author tg;	state Exp;
branches;
next	1.79;
commitid	10054A6A31E3A41516F;

1.79
date	2014.02.10.00.36.11;	author tg;	state Exp;
branches;
next	1.78;
commitid	10052F81F076BAA49CD;

1.78
date	2014.01.04.20.24.59;	author tg;	state Exp;
branches;
next	1.77;
commitid	10052C86E2F00C31DB5;

1.77
date	2013.01.01.20.49.09;	author tg;	state Exp;
branches;
next	1.76;
commitid	10050E34BDE59450B70;

1.76
date	2012.11.20.20.58.04;	author tg;	state Exp;
branches;
next	1.75;
commitid	10050ABEEF0008D3340;

1.75
date	2012.10.14.14.47.46;	author tg;	state Exp;
branches;
next	1.74;
commitid	100507AD0A02B4A50C7;

1.74
date	2012.09.27.18.03.10;	author tg;	state Exp;
branches;
next	1.73;
commitid	100506494D93A716A90;

1.73
date	2012.07.01.16.04.30;	author tg;	state Exp;
branches;
next	1.72;
commitid	1004FF075090CA0F55A;

1.72
date	2012.06.29.21.13.12;	author tg;	state Exp;
branches;
next	1.71;
commitid	1004FEE1A7B42887737;

1.71
date	2012.05.21.18.34.53;	author tg;	state Exp;
branches;
next	1.70;
commitid	1004FBA8AD201CD39C9;

1.70
date	2011.12.03.18.21.12;	author tg;	state Exp;
branches;
next	1.69;
commitid	1004EDA68A45651E3E3;

1.69
date	2011.12.03.18.14.14;	author tg;	state Exp;
branches;
next	1.68;
commitid	1004EDA67004C177CE6;

1.68
date	2011.09.15.16.13.59;	author tg;	state Exp;
branches;
next	1.67;
commitid	1004E72245D0A54A14A;

1.67
date	2011.09.14.21.08.34;	author tg;	state Exp;
branches;
next	1.66;
commitid	1004E7117AA3152A566;

1.66
date	2011.09.14.19.40.46;	author tg;	state Exp;
branches;
next	1.65;
commitid	1004E71034E2EB661F9;

1.65
date	2011.09.14.18.01.34;	author tg;	state Exp;
branches;
next	1.64;
commitid	1004E70EBF807010DFD;

1.64
date	2011.09.14.17.47.41;	author tg;	state Exp;
branches;
next	1.63;
commitid	1004E70E8BB0B993FA5;

1.63
date	2011.09.14.17.40.41;	author tg;	state Exp;
branches;
next	1.62;
commitid	1004E70E72B32F5E6A4;

1.62
date	2011.09.14.17.31.59;	author tg;	state Exp;
branches;
next	1.61;
commitid	1004E70E5261A6043BB;

1.61
date	2011.09.13.18.36.31;	author tg;	state Exp;
branches;
next	1.60;
commitid	1004E6FA2AC398186FC;

1.60
date	2011.07.17.12.57.48;	author tg;	state Exp;
branches;
next	1.59;
commitid	1004E22DC641A5F8B5F;

1.59
date	2011.02.18.22.37.28;	author tg;	state Exp;
branches;
next	1.58;
commitid	1004D5EF49568A7141B;

1.58
date	2009.02.17.12.55.22;	author tg;	state Exp;
branches;
next	1.57;
commitid	100499AB37E364ABBA1;

1.57
date	2008.12.09.22.04.51;	author tg;	state Exp;
branches;
next	1.56;
commitid	100493EEB863646F0F6;

1.56
date	2008.02.24.12.47.18;	author tg;	state Exp;
branches;
next	1.55;
commitid	10047C167561750E7A3;

1.55
date	2007.10.23.11.09.38;	author tg;	state Exp;
branches;
next	1.54;
commitid	100471DD65B393A1235;

1.54
date	2007.10.21.14.31.15;	author tg;	state Exp;
branches;
next	1.53;
commitid	100471B62A931E28481;

1.53
date	2007.10.21.13.20.16;	author tg;	state Exp;
branches;
next	1.52;
commitid	100471B519C34522566;

1.52
date	2007.10.18.21.08.55;	author tg;	state Exp;
branches;
next	1.51;
commitid	1004717CB7415F225F2;

1.51
date	2007.10.18.21.03.59;	author tg;	state Exp;
branches;
next	1.50;
commitid	1004717CA1F670D2B35;

1.50
date	2007.10.18.21.02.45;	author tg;	state Exp;
branches;
next	1.49;
commitid	1004717C9A73F9E1D15;

1.49
date	2007.10.18.20.49.17;	author tg;	state Exp;
branches;
next	1.48;
commitid	1004717C6E0536D4CA0;

1.48
date	2007.10.18.20.11.02;	author tg;	state Exp;
branches;
next	1.47;
commitid	1004717BDCE3D98769C;

1.47
date	2007.10.18.20.03.56;	author tg;	state Exp;
branches;
next	1.46;
commitid	1004717BC416C3BF20A;

1.46
date	2007.09.13.11.05.05;	author tg;	state Rel;
branches;
next	1.45;
commitid	10046E91913620733C8;

1.45
date	2007.08.03.22.55.05;	author tg;	state Exp;
branches;
next	1.44;
commitid	10046B3B2460B87E562;

1.44
date	2007.02.19.18.05.05;	author tg;	state Exp;
branches;
next	1.43;
commitid	10045D9E6DC24AEBF22;

1.43
date	2007.02.18.04.38.54;	author tg;	state Exp;
branches;
next	1.42;
commitid	10045D7D85902F8CD3E;

1.42
date	2007.01.25.12.27.17;	author tg;	state Exp;
branches;
next	1.41;
commitid	10045B8A2290725296D;

1.41
date	2007.01.25.11.34.23;	author tg;	state Exp;
branches;
next	1.40;
commitid	10045B895AE49917B4E;

1.40
date	2007.01.25.11.26.11;	author tg;	state Exp;
branches;
next	1.39;
commitid	10045B893E007BE45ED;

1.39
date	2007.01.25.11.19.43;	author tg;	state Exp;
branches;
next	1.38;
commitid	10045B8924E14E4255A;

1.38
date	2007.01.25.11.04.42;	author tg;	state Exp;
branches;
next	1.37;
commitid	10045B88ED8498E9CE0;

1.37
date	2007.01.25.10.42.34;	author tg;	state Exp;
branches;
next	1.36;
commitid	10045B88990107B7A28;

1.36
date	2007.01.22.18.03.52;	author tg;	state Exp;
branches;
next	1.35;
commitid	10045B4FC85465D3418;

1.35
date	2007.01.09.17.37.21;	author tg;	state Exp;
branches;
next	1.34;
commitid	10045A3D2E71312BA34;

1.34
date	2006.12.11.23.54.57;	author tg;	state Exp;
branches;
next	1.33;
commitid	100457DEFC626A6A05C;

1.33
date	2006.10.31.04.06.49;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004546CB9E7315ECA9;

1.32
date	2006.08.28.02.03.52;	author tg;	state Exp;
branches;
next	1.31;
commitid	10044F24F143B01ED1B;

1.31
date	2006.06.15.19.18.48;	author tg;	state Exp;
branches;
next	1.30;
commitid	1004491B2706C2443B2;

1.30
date	2006.04.05.20.31.03;	author tg;	state Exp;
branches;
next	1.29;
commitid	100443428D337424A5B;

1.29
date	2006.03.27.09.54.57;	author tg;	state Exp;
branches;
next	1.28;
commitid	1004427B6696FE2EFCB;

1.28
date	2006.01.19.01.43.34;	author tg;	state Exp;
branches;
next	1.27;
commitid	10043CEED8700C9832F;

1.27
date	2006.01.19.01.27.05;	author tg;	state Exp;
branches;
next	1.26;
commitid	10043CEEAF26B8E49FF;

1.26
date	2006.01.19.01.23.55;	author tg;	state Exp;
branches;
next	1.25;
commitid	10043CEEA2C67B8E371;

1.25
date	2006.01.14.01.25.19;	author tg;	state Exp;
branches;
next	1.24;
commitid	10043C85310289851BA;

1.24
date	2006.01.14.01.11.11;	author tg;	state Exp;
branches;
next	1.23;
commitid	10043C84F4E496C148A;

1.23
date	2006.01.02.16.18.00;	author tg;	state Exp;
branches;
next	1.22;
commitid	10043B9521C292BC2B1;

1.22
date	2005.12.22.01.12.34;	author tg;	state Exp;
branches
	1.22.2.1;
next	1.21;
commitid	10043A9FD7D2436905D;

1.21
date	2005.12.06.13.10.45;	author tg;	state Exp;
branches;
next	1.20;
commitid	2d9343958dc2f156;

1.20
date	2005.12.06.00.00.32;	author tg;	state Exp;
branches;
next	1.19;
commitid	41a34394d4aaa54a;

1.19
date	2005.11.15.21.10.19;	author tg;	state Exp;
branches;
next	1.18;
commitid	37ad437a4ec2064b;

1.18
date	2005.11.15.21.05.08;	author tg;	state Exp;
branches;
next	1.17;
commitid	2c01437a4d965711;

1.17
date	2005.11.15.21.01.05;	author tg;	state Exp;
branches;
next	1.16;
commitid	2692437a4c981842;

1.16
date	2005.11.15.20.59.00;	author tg;	state Exp;
branches;
next	1.15;
commitid	30f6437a4c1bf6f6;

1.15
date	2005.11.15.20.54.00;	author tg;	state Exp;
branches;
next	1.14;
commitid	2230437a4af3f57b;

1.14
date	2005.11.15.20.39.40;	author tg;	state Exp;
branches;
next	1.13;
commitid	41ed437a478dbe88;

1.13
date	2005.11.15.20.36.57;	author tg;	state Exp;
branches;
next	1.12;
commitid	4743437a46fa2e52;

1.12
date	2005.11.15.20.33.06;	author tg;	state Exp;
branches;
next	1.11;
commitid	33a2437a4604536a;

1.11
date	2005.11.15.20.30.18;	author tg;	state Exp;
branches;
next	1.10;
commitid	3676437a4537f726;

1.10
date	2005.11.15.20.19.52;	author tg;	state Exp;
branches;
next	1.9;
commitid	22b8437a42eeecf9;

1.9
date	2005.11.15.20.15.42;	author tg;	state Exp;
branches;
next	1.8;
commitid	2aa6437a41c56416;

1.8
date	2005.11.15.20.01.31;	author tg;	state Exp;
branches;
next	1.7;
commitid	7567437a3ea3b669;

1.7
date	2005.07.07.13.06.38;	author tg;	state Exp;
branches;
next	1.6;
commitid	221442cd28daec8b;

1.6
date	2005.03.29.17.27.31;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2005.03.29.12.33.51;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.03.22.20.08.29;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.14.20.50.57;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.03.16.49.33;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.03.16.44.00;	author tg;	state Exp;
branches;
next	;

1.22.2.1
date	2006.01.19.01.47.21;	author tg;	state Exp;
branches;
next	;
commitid	10043CEEF3F5A376DF6;


desc
@@


1.93
log
@slightly adjust amber colour based on phosphorous research

(this darkens the normal text slightly, as well as the intensivity colour
used for the headlines and underlining bold-italic, but keeps for now the
colour of inline bold as otherwise distinguishing is too hard)
@
text
@roff2htm_rcsid='$MirOS: src/scripts/roff2htm,v 1.91 2018/12/25 23:52:50 tg Exp $'
# $ekkoBSD: catman2html.sh,v 1.2 2004/03/07 03:02:53 stephen Exp $
#-
# Copyright (c) 2004, 2005, 2006, 2007, 2011, 2012, 2014, 2015,
#		2016, 2017, 2018
#	mirabilos <m@@mirbsd.org>
# Original version for ekkoBSD by:
# Copyright (c) 2004
#	Stephen Paskaluk <sap@@mirbsd.org>
# Parts of the regular expression set below are based upon work by:
# Copyright (c) 1995
#	Panagiotis J. Christias <christia@@theseas.ntua.gr>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# Advertising materials mentioning features or use of this work must
# display the following acknowledgement:
#	This product includes material provided by mirabilos.
#
# This work is provided ‚ÄúAS IS‚Äù and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.
#-
# Routines for converting catman pages and nrcon(1)d papers to HTML.
# ATTENTION: this file contains embedded white-, backspace and high-
#	     bit-on control characters! Use ‚Äújupp --asis $0‚Äù to edit
# Note: this file contains magic and can‚Äôt be edited as UTF-8 either.
# Note: this script assumes MirBSD filesystem interna: ino_t=uint32_t

# check if mksh R31:2007/10/18 or up
if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(3[2-9]|[4-9][0-9]|[1-9][0-9]+([0-9]))\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then
	i=0
elif [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R31)* ]]; then
	eval $(print "$KSH_VERSION" | sed 's#^.*R31 \([0-9]*\)/\([0-9]*\)/\([0-9]*\)\( .*\)*$#y=\1 m=\2 d=\3#')
	(( i = y < 2007 ? 1 :
	    y > 2007 ? 0 :
	    m < 10 ? 1 :
	    m > 10 ? 0 :
	    d < 18 ? 1 : 0 ))
	unset y m d
else
	i=1
fi
# we need an mksh version with uint32_t array indicƒìs
if (( i )); then
	print -u2 Error: your mksh is not recent enough.
	print -u2 Please upgrade to at least mksh R32.
	exit 1
fi
unset i

# initialise globals
roff2htm_gendate=$(date +"%F %T")		# current time
set -A roff2htm_inodecache			# inode cache (empty)
roff2htm_machine=$(uname -m)			# i386, sparc

function set_conversion_man {
	function do_convert {
		do_convert_man "$@@"
	}
}
function set_conversion_paper {
	function do_convert {
		do_convert_paper "$@@"
	}
}
set_conversion_man

function set_target_absolute {
	roff2htm_rel=http://www.mirbsd.org/
}
function set_target_relative {
	roff2htm_rel=../
}
set_target_relative

function do_convert_man {
	local -i _nl=0
	col -x | sed \
	    -e '/-$/N
{
s/\([0-9A-z][-.,0-9A-z:]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z:]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
\2/
}'									\
	    -e 's#<_#‚â§#g' -e 's#>_#‚â•#g'				\
	    -e 'y#&<>#¡˛ˇ#'						\
									\
	    -e 's#[Oo][Oo]++#‚Ä¢#g'					\
	    -e 's#_||#_|_|#g'					\
	    -e 's#+_#¬±#g'						\
									\
	    -e 's#^[A-z][ 0-9A-z]*$#</pre><h2>&</h2><pre>#'		\
	    -e 's#^  \([A-z][ -%'\''-;=?-~]*\)$#</pre><h3>\1</h3><pre>#'	\
									\
	    -e 's#\([^~<>Ä-ø][Ä-ø]*\)~#\1ÃÖ#g'				\
	    -e 's#\([^]\)~_#\1_ÃÖ #g'					\
	    -e 's#\([^]\)\([^<>_Ä-ø][Ä-ø]*\)\([ÃÖ]*\)_#\1_\2\3#g'	\
	    -e 's#\([^<>Ä-ø]\)[Ä-ø]*\([ÃÖ]*\)\([^<>Ä-ø][Ä-ø]*\)#<\1<\3\2>#g'	\
	    -e 's#\(<_<\([^>_]*\)>\)\1#<G>\2</G>#g'			\
	    -e 's#<_<\([^>_]*\)>#<i>\1</i>#g'				\
	    -e 's#<.<\([^>]*\)>#<b>\1</b>#g'				\
	    -e 's###g'							\
									\
	    -e '/<h[23]/s#</*[biG]>##g'					\
	    -e 's#</\([biG]\)><\1>##g'					\
	    -e 's#</\([biG]\)>\([- -*./:;?@@^_~]*\)<\1>#\2#g'		\
	    -e 's#\([- 0-9A-z]\)\([$/_-]*\)\(<[biG]>\)#\1\3\2#g'	\
	    -e 's#\(</[biG]>\)\([$/_-]*\)\([- 0-9A-z]\)#\2\1\3#g'	\
	    -e 's#\(</[biG]>\))\([- ,.0-9A-z]\)#)\1\2#g'		\
									\
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(3p\))#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([1-9]\)\(/[/0-9A-Za-z]*\)*)#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([PSU][MS][DM]\))#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(PAPERS\))#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(GNU)#<a href="'$roff2htm_rel'manINFO/\1.html">&</a>#g' \
	    -e 's#)\(</[biG]>\)\([- 0-9A-z]\)#\1)\2#g'			\
									\
	    -e 's/¡/\&#38;/g'						\
	    -e 's/˛/\&#60;/g'						\
	    -e 's/ˇ/\&#62;/g'						\
									\
	    -e 's#<G>#<b><i>#g' -e 's#</G>#</i></b>#g'			\
	    -e 's#</b><b>##g'						\
									\
	    -e '1s#^#<pre>#'						\
	    -e '$s#$#</pre>#'						\
	    -e 's#<pre></pre>##g'					\
	    -e 's#</pre><pre>##g'					\
	| while IFS= read -r line; do
		if [[ -n $line ]]; then
			(( _nl )) && [[ $line != '</pre>'* ]] && print
			print -r -- "$line"
			_nl=0
		else
			_nl=1
		fi
	done
}

function do_convert_paper {
	local -i _nl=0
	col -x | sed \
	    -e '/-$/N
{
s/\([0-9A-z][-.,0-9A-z:]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z:]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
\2/
}'									\
	    -e 's#<_#‚â§#g' -e 's#>_#‚â•#g'				\
	    -e 'y#&<>#¡˛ˇ#'						\
									\
	    -e 's#[Oo][Oo]++#‚Ä¢#g'					\
	    -e 's#_||#_|_|#g'					\
	    -e 's#+_#¬±#g'						\
									\
	    -e 's#\([^~<>Ä-ø][Ä-ø]*\)~#\1ÃÖ#g'				\
	    -e 's#\([^]\)~_#\1_ÃÖ #g'					\
	    -e 's#\([^]\)\([^<>_Ä-ø][Ä-ø]*\)\([ÃÖ]*\)_#\1_\2\3#g'	\
	    -e 's#\([^<>Ä-ø]\)[Ä-ø]*\([ÃÖ]*\)\([^<>Ä-ø][Ä-ø]*\)#<\1<\3\2>#g'	\
	    -e 's#\(<_<\([^>_]*\)>\)\1#<G>\2</G>#g'			\
	    -e 's#<_<\([^>_]*\)>#<i>\1</i>#g'				\
	    -e 's#<.<\([^>]*\)>#<b>\1</b>#g'				\
	    -e 's###g'							\
									\
	    -e 's#</\([biG]\)><\1>##g'					\
	    -e 's#</\([biG]\)>\([- -*./:;?@@^_~]*\)<\1>#\2#g'		\
	    -e 's#\([- 0-9A-z]\)\([$/_-]*\)\(<[biG]>\)#\1\3\2#g'	\
	    -e 's#\(</[biG]>\)\([$/_-]*\)\([- 0-9A-z]\)#\2\1\3#g'	\
	    -e 's#\(</[biG]>\))\([- ,.0-9A-z]\)#)\1\2#g'		\
									\
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([1-9]\)[/0-9A-Za-z]*)#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([PSU][MS][DM]\))#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(PAPERS\))#<a href="'$roff2htm_rel'man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(GNU)#<a href="'$roff2htm_rel'manINFO/\1.html">&</a>#g' \
	    -e 's#)\(</[biG]>\)\([- 0-9A-z]\)#\1)\2#g'			\
									\
	    -e 's/¡/\&#38;/g'						\
	    -e 's/˛/\&#60;/g'						\
	    -e 's/ˇ/\&#62;/g'						\
									\
	    -e 's#<G>#<b><i>#g' -e 's#</G>#</i></b>#g'			\
	    -e 's#</b><b>##g'						\
									\
	    -e '1s#^#<pre>#'						\
	    -e '$s#$#</pre>#'						\
	    -e 's#<pre></pre>##g'					\
	    -e 's#</pre><pre>##g'					\
	| while IFS= read -r line; do
		if [[ -n $line ]]; then
			(( _nl )) && [[ $line != '</pre>'* ]] && print
			print -r -- "$line"
			_nl=0
		else
			_nl=1
		fi
	done
}

function output_header {
	print '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <meta name="MSSmartTagsPreventParsing" content="TRUE" />
 <title>RTFM '$1\($2')</title>
 <meta name="robots" content="index, follow" />
 <link rel="canonical" href="http://www.mirbsd.org/man'$roff2htm_machine/$1.$2'" />
 <style type="text/css"><!--/*--><![CDATA[/*><!--*/
	body {
		background-color:#000000;
		color:#666666;
		font-family:serif;
	}
	a {
		color:inherit;
		text-decoration:none;
		border-bottom:1px dashed;
	}
	a:visited {
		text-decoration:none;
		border-bottom:1px dotted;
	}
	a:hover {
		text-decoration:none;
		border-bottom:1px double;
	}
	pre {
		line-height:1.12;
		color:#FFB000;
	}
	b {
		color:#FFEF00;
		font-weight:normal;
	}
	i {
		font-style:normal;
		border-bottom:1px solid #FFB000;
	}
	b i,i b {
		color:#FFEF00;
		font-weight:normal;
		font-style:normal;
		border-bottom:1px solid #FFCC00;
	}
	h1 {
		color:#FFCC00;
		font-size:xx-large;
		font-family:serif;
	}
	h2 {
		color:#FFFFFF;
		font-size:x-large;
		font-family:sans-serif;
	}
	h3 {
		color:#CCCCCC;
		font-size:large;
		font-family:sans-serif;
	}
 /*]]>*/--></style>
</head><body>
<h1>MirBSD manpage: <a href="'$roff2htm_rel'man'$2/$1'.htm">'$1\($2')</a></h1>'
}

function output_footer {
	print '
<hr /><p style="font-size:xx-small;">Generated on' $roff2htm_gendate by \
 '<tt>'$roff2htm_rcsid'</tt></p>
<p>These manual pages and other documentation are <a
 href="'$roff2htm_rel'man7/BSD-Licence.htm">copyrighted</a> by their respective writers;
 their source is available at our <a href="http://cvs.mirbsd.de/">CVSweb</a>,
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äì2019 <a
 href="http://www.mirbsd.org/">MirBSD</a>.<br /><span
 style="font-size:3pt; font-style:italic;">This product includes material
 provided by <b>mirabilos</b>.</span></p>
<p style="font-size:x-small;">This manual page‚Äôs HTML representation
 is supposed to be <a href="http://validator.w3.org/check/referer">valid
 XHTML/1.1</a>; if not, please send a bug report‚Ää‚Äî‚Äädiffs preferred.</p>
</body></html>'
}

function do_conversion {
	output_header ${1:-missing-pagename} ${2:-0}
	do_convert ${2:-0}
	output_footer
}

# do_conversion_verbose title section infile outfile
function do_conversion_verbose {
	print -nru2 -- $3 ‚Üí $4
	do_conversion $1 $2 <$3 >$4
	print -u2
}

# convert_page /path/to/man.cat1 /targetpath
function convert_page {
	local fn=$1 page sect tn
	local -Uui ino=$(stat -Lf %i $fn 2>/dev/null)
	page=${fn##*/}			# basename
	page=${page%.0}			# manual page name
	sect=${fn%/*}			# dirname
	sect=${sect##*/cat}		# archsection
	sect=${sect%%/*}		# section
	tn=man${sect}/${page}.htm	# target file

	if (( ino )) && [[ -n ${roff2htm_inodecache[ino]} ]]; then
		# source file is linked to a file we know
		print -ru2 -- $tn ‚Üê ${roff2htm_inodecache[ino]}
		ln -f $2/${roff2htm_inodecache[ino]} $2/$tn
		# patch in the additional name(s)
		ed -s $2/$tn <<-EOF
			/<title>/s#</title>#, $page($sect)&#
			/<h1>/s#</h1>#, <a href="$roff2htm_rel$tn">$page($sect)</a>&#
			wq
		EOF
	else
		# store target filename in the inode cache
		roff2htm_inodecache[ino]=$tn
		do_conversion_verbose $page $sect $fn $2/$tn
	fi
}

# output_htaccess >‚Ä¶/.htaccess
function output_htaccess {
	print DirectoryIndex /dev/null
	print "AddType 'text/html; charset=utf-8' htm"
}

# convert_all /path/to/share/man /targetpath
function convert_all {
	local tp=${2:-$(pwd)/mbsdman}		# target basepath
	local x f

	(find ${1:-/usr/share/man}/cat{[1-9],3p} -name \*.0 2>/dev/null | \
	    sort -f) |&
	for x in 1 2 3 3p 4 5 6 7 8 9; do
		mkdir -p $tp/man$x	# one per section
		output_htaccess >$tp/man$x/.htaccess
	done
	while read -p f; do
		convert_page $f $tp	# any subpages
	done
}
@


1.92
log
@2019
@
text
@d237 1
a237 1
		color:#FFBF00;
d245 1
a245 1
		border-bottom:1px solid #FFBF00;
d251 1
a251 1
		border-bottom:1px solid #FFEF00;
d254 1
a254 1
		color:#FFEF00;
@


1.91
log
@MirBSD
@
text
@d1 1
a1 1
roff2htm_rcsid='$MirOS: src/scripts/roff2htm,v 1.89 2017/12/19 00:55:00 tg Exp $'
d280 1
a280 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äì2018 <a
@


1.90
log
@2018
@
text
@d5 1
a5 1
#		2016, 2017
d270 1
a270 1
<h1>MirOS Manual: <a href="'$roff2htm_rel'man'$2/$1'.htm">'$1\($2')</a></h1>'
@


1.89
log
@https ‚Üí http, nowadays (unwillingly) considered proper
@
text
@d1 1
a1 1
roff2htm_rcsid='$MirOS: src/scripts/roff2htm,v 1.88 2017/01/29 00:51:06 tg Exp $'
d280 2
a281 2
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äì2017 <a
 href="http://www.mirbsd.org/">The MirOS Project</a>, Germany.<br /><span
@


1.88
log
@2017
@
text
@d1 1
a1 1
roff2htm_rcsid='$MirOS: src/scripts/roff2htm,v 1.85 2017/01/08 19:36:58 tg Exp $'
d79 1
a79 1
	roff2htm_rel=https://www.mirbsd.org/
d215 1
a215 1
 <link rel="canonical" href="https://www.mirbsd.org/man'$roff2htm_machine/$1.$2'" />
d281 1
a281 1
 href="https://www.mirbsd.org/">The MirOS Project</a>, Germany.<br /><span
@


1.87
log
@oops, syntax
@
text
@d88 1
a88 1
	col -x | sed							\
d151 1
a151 1
	col -x | sed							\
d212 1
d216 1
a216 2
 <style type="text/css">
	/* <![CDATA[ */
d268 1
a268 2
	/* ]]> */
 </style>
d286 1
a286 1
 XHTML/1.1</a>; if not, please send a bug report ‚Äì diffs preferred.</p>
@


1.86
log
@2017
@
text
@d276 1
a276 1
<hr /><p style="font-size:xx-small;">Generated on' $roff2htm_gendate by
@


1.85
log
@rcsid only once
@
text
@d281 1
a281 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äì2016 <a
@


1.84
log
@fixup cvs(1) link generation at SEE ALSO
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.82 2016/01/02 20:05:08 tg Exp $
d276 2
a277 2
<hr /><p style="font-size:xx-small;">Generated on' $roff2htm_gendate 'by
 <tt>$MirOS: src/scripts/roff2htm,v 1.82 2016/01/02 20:05:08 tg Exp $</tt></p>
@


1.83
log
@improve display; use unitless line-height
@
text
@d5 1
a5 1
#		2016
d117 2
a118 1
	    -e 's#\(</[biG]>\)\([)$/_-]*\)\([- 0-9A-z]\)#\2\1\3#g'	\
d176 2
a177 1
	    -e 's#\(</[biG]>\)\([)$/_-]*\)\([- 0-9A-z]\)#\2\1\3#g'	\
@


1.82
log
@2016
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.81 2015/10/16 13:19:09 tg Exp $
d4 2
a5 1
# Copyright (c) 2004, 2005, 2006, 2007, 2011, 2012, 2014, 2015
d234 1
a234 1
		line-height:112%;
d275 1
a275 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.81 2015/10/16 13:19:09 tg Exp $</tt></p>
d282 1
a282 1
 provided by <i>mirabilos</i>.</span></p>
@


1.81
log
@extend version check to all possible ones
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.80 2015/01/02 13:54:19 tg Exp $
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.80 2015/01/02 13:54:19 tg Exp $</tt></p>
d278 1
a278 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äì2015 <a
@


1.80
log
@2015; another year of the rolling release (and yes, new snapshots will be coming soonish)
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.79 2014/02/10 00:36:11 tg Exp $
d4 2
a5 2
# Copyright (c) 2004, 2005, 2006, 2007, 2011, 2012, 2014
#	Thorsten ‚Äúmirabilos‚Äù Glaser <tg@@mirbsd.org>
d21 1
a21 1
#	This product includes material provided by Thorsten Glaser.
d39 1
a39 1
if [[ $KSH_VERSION = @@(\@@\(#\)MIRBSD KSH R)@@(3[2-9]|[4-9][0-9]|[1-9][0-9][0-9])\ +([0-9])/+([0-9])/+([0-9])?(\ *) ]]; then
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.79 2014/02/10 00:36:11 tg Exp $</tt></p>
d281 1
a281 1
 provided by Thorsten Glaser.</span></p>
@


1.79
log
@never close stdout or stderr, always redirect it to /dev/null instead
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.78 2014/01/04 20:24:59 tg Exp $
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.78 2014/01/04 20:24:59 tg Exp $</tt></p>
d278 1
a278 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äí2014 <a
@


1.78
log
@2014
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.77 2013/01/01 20:49:09 tg Exp $
d4 1
a4 1
# Copyright (c) 2004, 2005, 2006, 2007, 2011, 2012
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.77 2013/01/01 20:49:09 tg Exp $</tt></p>
d340 2
a341 1
	(find ${1:-/usr/share/man}/cat{[1-9],3p} -name \*.0 2>&- | sort -f) |&
@


1.77
log
@2013
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.76 2012/11/20 20:58:04 tg Exp $
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.76 2012/11/20 20:58:04 tg Exp $</tt></p>
d278 1
a278 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äí2013 <a
@


1.76
log
@allow most chars in .Ss
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.75 2012/10/14 14:47:46 tg Exp $
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.75 2012/10/14 14:47:46 tg Exp $</tt></p>
d278 1
a278 1
 AnonCVS, and other mirrors. The rest is Copyright ¬© 2002‚Äí2011 <a
@


1.75
log
@add an absolute links mode, for one-off pages
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.74 2012/09/27 18:03:10 tg Exp $
d101 1
a101 1
	    -e 's#^  \([A-z][ ,0-9A-z]*\)$#</pre><h3>\1</h3><pre>#'	\
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.74 2012/09/27 18:03:10 tg Exp $</tt></p>
@


1.74
log
@fix over-optimisation: *all* manpage links *must* be *parent-relative*
because we hardlink e.g. man1/foo.htm and man8/bar.htm so they cannot
be pwd-relative
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.73 2012/07/01 16:04:30 tg Exp $
d77 8
d118 5
a122 5
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(3p\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([1-9]\)\(/[/0-9A-Za-z]*\)*)#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([PSU][MS][DM]\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(PAPERS\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(GNU)#<a href="../manINFO/\1.html">&</a>#g' \
d176 4
a179 4
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([1-9]\)[/0-9A-Za-z]*)#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([PSU][MS][DM]\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\(PAPERS\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(GNU)#<a href="../manINFO/\1.html">&</a>#g' \
d268 1
a268 1
<h1>MirOS Manual: <a href="../man'$2/$1'.htm">'$1\($2')</a></h1>'
d274 1
a274 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.73 2012/07/01 16:04:30 tg Exp $</tt></p>
d276 1
a276 1
 href="../man7/BSD-Licence.htm">copyrighted</a> by their respective writers;
d319 1
a319 1
			/<h1>/s#</h1>#, <a href="../$tn">$page($sect)</a>&#
@


1.73
log
@parse warnings::register(3p) and don‚Äôt parse sqrt(33) correctly as manpage

XXX sed BASIC re_format(7) not having alternatives sÃ≤uÃ≤cÃ≤Ã≤kÃ≤sÃ≤!
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.72 2012/06/29 21:13:12 tg Exp $
a115 1
	    -e 's#<a href="../man'${1:-0}'/#<a href="#g'		\
a172 1
	    -e 's#<a href="../man'${1:-0}'/#<a href="#g'		\
d266 1
a266 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.72 2012/06/29 21:13:12 tg Exp $</tt></p>
@


1.72
log
@permit colons in manpage names
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.71 2012/05/21 18:34:53 tg Exp $
d110 2
a111 1
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z:]*\)(\([1-9]\)[/0-9A-Za-z]*)#<a href="../man\2/\1.htm">&</a>#g' \
d268 1
a268 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.71 2012/05/21 18:34:53 tg Exp $</tt></p>
@


1.71
log
@fix manINFO: texinfo-generated HTML pages are *.html (and not UTF-8 XHTML/1.1)
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.70 2011/12/03 18:21:12 tg Exp $
d82 1
a82 1
s/\([0-9A-z][-.,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
d110 4
a113 4
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\([PSU][MS][DM]\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(GNU)#<a href="../manINFO/\1.html">&</a>#g' \
d144 1
a144 1
s/\([0-9A-z][-.,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
d168 4
a171 4
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\([PSU][MS][DM]\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))#<a href="../man\2/\1.htm">&</a>#g' \
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(GNU)#<a href="../manINFO/\1.html">&</a>#g' \
d267 1
a267 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.70 2011/12/03 18:21:12 tg Exp $</tt></p>
@


1.70
log
@introduct set_conversion_{man,paper} to skip <h2> and <h3> generation
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.69 2011/12/03 18:14:14 tg Exp $
d4 1
a4 1
# Copyright (c) 2004, 2005, 2006, 2007, 2011
d113 1
a113 1
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(GNU)#<a href="../manINFO/\1.htm">&</a>#g' \
d171 1
a171 1
	    -e '/^ /s#\([0-9A-z][-.,0-9A-z]*\)(GNU)#<a href="../manINFO/\1.htm">&</a>#g' \
d267 1
a267 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.69 2011/12/03 18:14:14 tg Exp $</tt></p>
@


1.69
log
@deal better with overstrokes
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.68 2011/09/15 16:13:59 tg Exp $
d65 13
a77 1
function do_convert {
d139 58
d267 1
a267 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.68 2011/09/15 16:13:59 tg Exp $</tt></p>
@


1.68
log
@do not use <?xml (except for SVG or xmlstarlet) to avoid triggering ‚Äúquirks mode‚Äù
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.67 2011/09/14 21:08:34 tg Exp $
d73 1
d76 3
a78 1
	    -e 's#oo++#‚Ä¢#'						\
d83 5
a87 1
	    -e 's#\([^<>Ä-ø]\)[Ä-ø]*\([^<>Ä-ø][Ä-ø]*\)#<\1<\2>#g'	\
d90 1
d92 5
a96 5
	    -e '/<h[23]/s#</*[bi]>##g'					\
	    -e 's#</\([bi]\)><\1>##g'					\
	    -e 's#</\([bi]\)>\([- -*./:;?@@^_~]*\)<\1>#\2#g'		\
	    -e 's#\([- 0-9A-z]\)\([$/_-]*\)\(<[bi]>\)#\1\3\2#g'	\
	    -e 's#\(</[bi]>\)\([)$/_-]*\)\([- 0-9A-z]\)#\2\1\3#g'	\
d102 1
a102 1
	    -e 's#)\(</[bi]>\)\([- 0-9A-z]\)#\1)\2#g'			\
d109 3
d197 1
a197 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.67 2011/09/14 21:08:34 tg Exp $</tt></p>
@


1.67
log
@another special case: the underscore character can‚Äôt be italicised
by nroff(1), and its tabcol.c double-stroke representation is bold
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.66 2011/09/14 19:40:46 tg Exp $
d117 1
a117 2
	print '<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
d186 1
a186 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.66 2011/09/14 19:40:46 tg Exp $</tt></p>
@


1.66
log
@much improved heuristics, and better legibility
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.65 2011/09/14 18:01:34 tg Exp $
d81 1
a81 1
	    -e 's#<_<\([^>]*\)>#<i>\1</i>#g'				\
d187 1
a187 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.65 2011/09/14 18:01:34 tg Exp $</tt></p>
@


1.65
log
@dissolve character classes
‚áí unfortunately, requires us to use ‚Äúcol -x‚Äù as e.g. the X manpages
  still contain embedded tabs; on the pro side col drops trailing
  whitespace at EOL for us
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.64 2011/09/14 17:47:41 tg Exp $
d66 1
a66 1
	local -i ws=0
d77 2
a78 3
	    -e '/^[A-Z]/s#.##g'					\
	    -e 's#^[A-Z][ ,A-Z0-9]*$#</pre><h2>&</h2><pre>#'		\
	    -e 's#^  \([A-Za-z][ ,A-Za-z0-9]*\)$#</pre><h3>\1</h3><pre>#'	\
d80 3
a82 2
	    -e 's#_\([^Ä-ø][Ä-ø]*\)#<i>\1</i>#g'			\
	    -e 's#[^Ä-ø][Ä-ø]*\([^Ä-ø][Ä-ø]*\)#<b>\1</b>#g'		\
d84 1
d86 3
a88 4
	    -e 's#</b><b>[^Ä-ø][Ä-ø]*##g'				\
	    -e 's#</b>[^Ä-ø][Ä-ø]*<b>##g'				\
	    -e 's#[^Ä-ø][Ä-ø]*##g'					\
	    -e 's#_</i<b><</b>i>##g'					\
d90 6
a95 15
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(GNU)\)#<a href=\"../manINFO/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(GNU)\)#<a href=\"../manINFO/\2.htm\">\1</a>#g' \
									\
	    -e 's#</\([bi]\)><\1>##g'					\
	    -e 's#</\([bi]\)>\([ -/:-@@[-`{-~]*\)<\1>#\2#g'		\
	    -e 's#\([^!-/:-@@[-`{-~]\)\([-!"#$%&'\''()*+,./:;=?@@[\]^_`{|}~]*\)\(<[bi]>\)#\1\3\2#g'	\
	    -e 's#\(<i>[fh]t*p:[^<]*\)</i>/#\1/</i>#g'			\
	    -e 's#\(<i>/[^<]*\)</i>/#\1/</i>#g'				\
	    -e 's#<h3>*<b>*>#<h3>#g' -e 's#</b></h3>#</h3>#g'		\
a104 1
	    -e 's#<a href="../man'${1:-0}'/#<a href="#g'		\
d107 1
a107 1
			(( ws )) && [[ $line != '</pre>'* ]] && print
d109 1
a109 1
			ws=0
d111 1
a111 1
			let ++ws
d187 1
a187 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.64 2011/09/14 17:47:41 tg Exp $</tt></p>
@


1.64
log
@I‚Äôm almost certain we don‚Äôt need to run this twice (speed improvement)
because the ‚ÄòN‚Äô results seem to be the cause of that <i>-wrapping bug
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.63 2011/09/14 17:40:41 tg Exp $
d67 1
a67 1
	sed -e 's/[	 ]*$//g'					\
d100 2
a101 2
	    -e 's#</\([bi]\)>\([[:punct:][:space:]]*\)<\1>#\2#g'	\
	    -e 's#\([^[:punct:]]\)\([-!"#$%&'\''()*+,./:;=?@@[\]^_`{|}~]*\)\(<[bi]>\)#\1\3\2#g'	\
d197 1
a197 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.63 2011/09/14 17:40:41 tg Exp $</tt></p>
@


1.63
log
@further colour scheme improvements, as discussed with XTaran@@ in IRC
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.62 2011/09/14 17:31:59 tg Exp $
a72 5
	    -e '/-$/N
{
s/\([0-9A-z][-.,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
\2/
}'									\
d197 1
a197 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.62 2011/09/14 17:31:59 tg Exp $</tt></p>
@


1.62
log
@drop the <tt/> conversion, unused in manpages, false-positive in ms/me pages
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.61 2011/09/13 18:36:31 tg Exp $
d144 1
a144 1
		color:#AAAAAA;
a145 11
		line-height:112%;
	}
	.manpage a {
		color:#3FFF3F;
		text-decoration:none;
		border-bottom:1px dashed #3FFF3F;
	}
	.manpage a:visited {
		color:#3FFF3F;
		text-decoration:none;
		border-bottom:1px dotted #3FFF3F;
d147 2
a148 2
	.manpage a:hover {
		color:#3FFF3F;
d150 1
a150 1
		border-bottom:1px solid #3FFF3F;
d152 1
a152 2
	.footer a {
		color:#3F3FFF;
d154 1
a154 1
		border-bottom:1px dashed #3F3FFF;
d156 1
a156 2
	.footer a:visited {
		color:#3F3FFF;
d158 1
a158 6
		border-bottom:1px dotted #3F3FFF;
	}
	.footer a:hover {
		color:#3F3FFF;
		text-decoration:none;
		border-bottom:1px solid #3F3FFF;
d161 1
d179 1
a179 1
		color:#5FFF5F;
a195 1
<div class="manpage">
d200 3
a202 3
	print '</div><hr /><div class="footer"><p
 style="font-size:xx-small;">Generated on' $roff2htm_gendate 'by
 <tt>$MirOS: src/scripts/roff2htm,v 1.61 2011/09/13 18:36:31 tg Exp $</tt></p>
d212 1
a212 1
 XHTML/1.1</a>; if not, please send a bug report ‚Äì diffs preferred.</p></div>
@


1.61
log
@improve XHTML output and put some (valid!) CSS into the pages;
credit for the colour schemes goes to XTaran@@
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.60 2011/07/17 12:57:48 tg Exp $
a94 2
	    -e 's#^\( \{2,3\}\)\([A-z][ ,0-9A-z</>]*\)$#\1<tt>\2</tt>#'	\
									\
a209 14
	/* XXX check whether this and the sed line are at all needed */
	tt {
		color:#CCCCCC;
	}
	tt b {
		color:#FFFFFF;
	}
	tt b i,tt i b {
		color:#FFFFFF;
		border-bottom:1px solid #FFFFFF;
	}
	tt i {
		border-bottom:1px solid #CCCCCC;
	}
d220 1
a220 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.60 2011/07/17 12:57:48 tg Exp $</tt></p>
@


1.60
log
@restore -Tcol bullets after cid 1004E21AAAA5F8BF36C ‚Äì now with proper adjustment on the nroff layer
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.59 2011/02/18 22:37:28 tg Exp $
d66 1
a66 1
	typeset -i ws=0
d84 1
a84 1
	    -e 's#^  \([A-Z][ ,A-Z0-9]*\)$#</pre><h3>\1</h3><pre>#'	\
d95 1
a95 1
	    -e 's#^\( \{2,3\}\)\([A-Z][ ,0-9A-z]*\)$#\1<b>\2</b>#'	\
d97 8
a104 8
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(GNU)\)#<a href=\"../manINFO/\2.htm\" class=\"manlink\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(GNU)\)#<a href=\"../manINFO/\2.htm\" class=\"manlink\">\1</a>#g' \
d124 1
d128 1
a128 1
			(( !ws++ )) && print
d142 86
d229 2
a230 1
<h1>MirOS Manual: <a href="../man'$2/$1'.htm" class="manlink">'$1\($2')</a></h1>'
d234 4
a237 4
	print '<hr /><p style="font-size:xx-small;">Generated on' \
	    $roff2htm_gendate 'by
 <tt>$MirOS: src/scripts/roff2htm,v 1.59 2011/02/18 22:37:28 tg Exp $</tt></p>
<p>These manual pages and other documentation are <a class="manlink"
d241 3
a243 3
 href="https://www.mirbsd.org/">The MirOS Project</a>, Germany.<br /><i
 style="font-size:3pt;"> This product includes material provided by Thorsten
 Glaser.</i></p>
d246 1
a246 1
 XHTML/1.1</a>; if not, please send a bug report ‚Äì diffs preferred.</p>
d265 2
a266 2
	typeset fn=$1 page sect tn
	typeset -Uui ino=$(stat -Lf %i $fn 2>/dev/null)
d281 1
a281 1
			/<h1>/s#</h1>#, <a href="../$tn" class="manlink">$page($sect)</a>&#
d299 2
a300 2
	typeset tp=${2:-$(pwd)/mbsdman}		# target basepath
	typeset x f
@


1.59
log
@colourise ‚Äúautomatic‚Äù manpage links differently from the rest
so we‚Äôre not to blame for broken links there

XXX no CSS for automanpages yet
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.58 2009/02/17 12:55:22 tg Exp $
d80 2
a105 2
	    -e 's#<b>+</b>\( *\)<b>o</b># \1‚Ä¢#'				\
	    -e 's#<b>+</b>#‚Ä¢#'						\
d148 1
a148 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.58 2009/02/17 12:55:22 tg Exp $</tt></p>
@


1.58
log
@Mittagspausencommit/hack: canonical link URIs, per architecture¬π, for the
HTML manual pages as well

‚ë† we can‚Äôt yet distinguish MI from MD; even though they are the same or
  even hardlinked, manual page spaces are per-machine¬≤ currently
‚ë° or per-arch‚Ä¶ for the [i386, sparc] set it doesn‚Äôt matter‚Ä¶ but I think
  it is per-machine
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.57 2008/12/09 22:04:51 tg Exp $
d4 2
a5 2
# Copyright (c) 2004, 2005, 2006, 2007
#	Thorsten ‚Äúmirabilos‚Äù Glaser <tg@@mirbsd.de>
d95 8
a102 8
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([1-9]\)[/0-9A-Za-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([PSU][MS][DM]\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\(PAPERS\))\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(GNU)\)#<a href=\"../manINFO/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(GNU)\)#<a href=\"../manINFO/\2.htm\">\1</a>#g' \
d142 1
a142 1
<h1>MirOS Manual: <a href="../man'$2/$1'.htm">'$1\($2')</a></h1>'
d148 8
a155 7
 <tt>$MirOS: src/scripts/roff2htm,v 1.57 2008/12/09 22:04:51 tg Exp $</tt></p>
<p>These manual pages are <a href="../man7/BSD-Licence.htm">copyrighted</a>
 by their respective writers; their source is available at our <a
 href="http://cvs.mirbsd.de/">CVSweb</a>, AnonCVS, and other mirrors.
 The rest is Copyright ¬© 2002-2008 <a href="http://www.mirbsd.org/">The
 MirOS Project</a>, Germany. <br /><i style="font-size:3pt;">
 This product includes material provided by Thorsten Glaser.</i></p>
d193 1
a193 1
			/<h1>/s#</h1>#, <a href="../$tn">$page($sect)</a>&#
@


1.57
log
@a reference to "wget(GNU)" like in lynx(1) is a texinfo cross-link
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.56 2008/02/24 12:47:18 tg Exp $
d63 1
d140 1
d148 1
a148 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.56 2008/02/24 12:47:18 tg Exp $</tt></p>
@


1.56
log
@2008
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.55 2007/10/23 11:09:38 tg Exp $
d100 2
d146 1
a146 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.55 2007/10/23 11:09:38 tg Exp $</tt></p>
@


1.55
log
@‚Ä¢ handle symbolic links more gracefully: as if they were hard links
  slightly inspired by my yesternight‚Äôs work on this script inside FreeWRT
  fixes the case where the symlink alphabetically comes before the target
‚Ä¢ ignore non-existing man3p dir too
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.54 2007/10/21 14:31:15 tg Exp $
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.54 2007/10/21 14:31:15 tg Exp $</tt></p>
d148 1
a148 1
 The rest is Copyright ¬© 2002-2007 <a href="http://www.mirbsd.org/">The
@


1.54
log
@sort the page filename list case-insensitvely
ok bsiegert@@ via phone
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.53 2007/10/21 13:20:16 tg Exp $
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.53 2007/10/21 13:20:16 tg Exp $</tt></p>
d172 13
a184 36
	typeset fn=$1				# filename
	typeset bn=${fn##*/}			# basename
	typeset page=${bn%.0}			# manual page name
	typeset dn=${fn%/*}			# dirname
	typeset as=${dn##*/cat}			# archsection
	typeset sect=${as%%/*}			# section
	typeset tn=$2/man${sect}/${page}.htm	# target file
	typeset -i linkonly=0

	if [[ -h $fn ]]; then
		# source file is a symbolic link
		fn=$(readlink -f $fn)		# symlink-target filename
		linkonly=1
	else
		typeset -i ino=$(stat -f %i $fn 2>/dev/null)

		(( ino )) && if [[ -n ${roff2htm_inodecache[ino]} ]]; then
			# source file is hardlinked to a file we know
			fn=${roff2htm_inodecache[ino]}
			linkonly=1
		else
			# store this source filename in the inode cache
			roff2htm_inodecache[ino]=$fn
		fi
	fi

	if (( linkonly )); then
		typeset newpage=$page newsect=$sect
		# just link the target too, since the source is linked
		bn=${fn##*/}			# basename
		page=${bn%.0}			# manual page name
		dn=${fn%/*}			# dirname
		as=${dn##*/cat}			# archsection
		sect=${as%%/*}			# section
		print -ru2 -- $tn ‚Üê man${sect}/${page}.htm
		ln -f $2/man${sect}/${page}.htm $tn
d186 3
a188 3
		ed -s $tn <<-EOF
			/<title>/s#</title>#, $newpage($newsect)&#
			/<h1>/s#</h1>#, <a href="../man$newsect/$newpage.htm">$newpage($newsect)</a>&#
d192 3
a194 1
		do_conversion_verbose $page $sect $fn $tn
d209 1
a209 1
	(find ${1:-/usr/share/man}/cat{[1-9],3p} -name \*.0 | sort -f) |&
@


1.53
log
@‚Ä¢ cosmetics: the <h1> arguments are no longer <tt>'d ‚Äì looks better
‚Ä¢ linked manual pages: both <h1> and <title> now contain the names
  of all the pages linked together, to make it easier to see what‚Äôs
  in the group, especially as there is, for hard-linked pages, not
  a master specified
‚Ä¢ pipe the find(1) output through sort to have above list sorted too
‚Ä¢ make find not fail if one of the cat directories doesn‚Äôt exist (debug)
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.52 2007/10/18 21:08:55 tg Exp $
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.52 2007/10/18 21:08:55 tg Exp $</tt></p>
d230 1
a230 1
	(find ${1:-/usr/share/man}/cat{[1-9],3p} -name \*.0 | sort) |&
@


1.52
log
@make the hardlink story actually work by using proper pathnames
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.51 2007/10/18 21:03:59 tg Exp $
d138 1
a138 1
<h1>MirOS Manual: <a href="../man'$2/$1'.htm"><tt>'$1\($2')</tt></a></h1>'
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.51 2007/10/18 21:03:59 tg Exp $</tt></p>
d199 1
d208 6
d230 1
a230 1
	find ${1:-/usr/share/man}/cat{1,2,3,3p,4,5,6,7,8,9} -name \*.0 |&
@


1.51
log
@hard-link HTML manual pages, don‚Äôt symlink them
‚Ä£ saves storage in the cpioball and on the www mirror
‚Ä£ is preserved by pax/cpio/tar, rsync, and mc::F5

this change nÃ≤oÃ≤tÃ≤ ok‚Äôd by bsiegert@@ (yet)
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.50 2007/10/18 21:02:45 tg Exp $
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.50 2007/10/18 21:02:45 tg Exp $</tt></p>
d206 1
a206 1
		ln -f ../man${sect}/${page}.htm $tn
@


1.50
log
@even more speedup ‚Äì <bsd.man.mk> hard-links the ${MLINKS} manual pages, in
contrast to XFree86¬Æ which symlinks them; use mksh feature of 32-bit array
indicƒìs introduced in commitid 1004717C2CE427DDAE7 to let the inode number
given to us by stat(1) be the index of a source filename cache, and link a
manual page if the source was either hard- or softlinked as well

probably controverse but WFM‚Ñ¢
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.49 2007/10/18 20:49:17 tg Exp $
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.49 2007/10/18 20:49:17 tg Exp $</tt></p>
d206 1
a206 1
		ln -sf ../man${sect}/${page}.htm $tn
@


1.49
log
@make all local variables local
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.48 2007/10/18 20:11:02 tg Exp $
d36 1
d38 21
d60 1
d62 1
d144 1
a144 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.48 2007/10/18 20:11:02 tg Exp $</tt></p>
d179 1
d182 1
a182 1
		# we encountered a symbolic link, just link the target too
d184 16
@


1.48
log
@implement a severe speed-up on HTML manpage generation by tracing and
reproducing symbolic links to manpages into symbolic links to HTML mans
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.47 2007/10/18 20:03:56 tg Exp $
d120 1
a120 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.47 2007/10/18 20:03:56 tg Exp $</tt></p>
d148 7
a154 7
	fn=$1				# filename
	bn=${fn##*/}			# basename
	page=${bn%.0}			# manual page name
	dn=${fn%/*}			# dirname
	as=${dn##*/cat}			# archsection
	sect=${as%%/*}			# section
	tn=$2/man${sect}/${page}.htm	# target file
d179 2
a180 1
	tp=${2:-$(pwd)/mbsdman}		# target basepath
@


1.47
log
@cosmetics
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.46 2007/09/13 11:05:05 tg Rel $
d120 1
a120 1
 <tt>$MirOS: src/scripts/roff2htm,v 1.46 2007/09/13 11:05:05 tg Rel $</tt></p>
d156 13
a168 1
	do_conversion_verbose $page $sect $fn $tn
@


1.46
log
@link to the collected BSD-Licence(7) manual page, since almost all of the
manpages‚Äô sources state we must retain the licence on the formatted pages
or the documentation (the latter is the case now, as we put them all into
that collection)

Ist doch kein RumgelÃ≤iÃ≤nÃ≤uÃ≤xÃ≤e hier ‚ò∫
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.45 2007/08/03 22:55:05 tg Exp $
d23 1
a23 1
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
d32 1
a32 1
# Routines for converting catman pages and nrcon'd papers to HTML.
d34 2
a35 2
#	     bit-on control characters! Use "jupp --asis $0" to edit
# Note: this file contains magic and can't be edited as UTF-8 either.
d38 1
a38 1
gendate=$(date +"%F %T")		# current time
d41 1
a41 1
	integer ws=0
d118 3
a120 2
	print '<hr /><p style="font-size:xx-small;">Generated on' $gendate 'by
 $MirOS: src/scripts/roff2htm,v 1.45 2007/08/03 22:55:05 tg Exp $</p>
d123 1
a123 1
 href="http://cvs.mirbsd.de/">CVSweb</a>.
d125 1
a125 1
 MirOS Project</a>, Germany. <i style="font-size:3pt;"><br />
d127 1
a127 1
<p style="font-size:x-small;">This manual page'\''s HTML representation
d141 1
a141 1
	print -nru2 -- $3 -\> $4
d159 1
a159 1
# output_htaccess >.../.htaccess
@


1.45
log
@‚Ä¢ remove shebang, as this is only sourced (sorry tarzeau for confusing you)
  it still needs a korn shell tho ‚ò∫
‚Ä¢ modernise
@
text
@d1 1
a1 1
# $MirOS: src/scripts/roff2htm,v 1.44 2007/02/19 18:05:05 tg Exp $
d5 1
a5 1
#	Thorsten "mirabilos" Glaser <tg@@mirbsd.de>
d119 4
a122 3
 $MirOS: src/scripts/roff2htm,v 1.44 2007/02/19 18:05:05 tg Exp $</p>
<p>These manual pages are copyrighted by their respective writers; their
 source is available at our <a href="http://cvs.mirbsd.de/">CVSweb</a>.
@


1.44
log
@oops, missing sed substitution command; now works as expected
@
text
@d1 1
a1 2
#!/bin/mksh
# $MirOS: src/scripts/roff2htm,v 1.43 2007/02/18 04:38:54 tg Exp $
d40 1
a40 2
do_convert()
{
d105 1
a105 2
output_header()
{
d117 1
a117 2
output_footer()
{
d119 1
a119 1
 $MirOS: src/scripts/roff2htm,v 1.43 2007/02/18 04:38:54 tg Exp $</p>
d131 1
a131 2
do_conversion()
{
d138 1
a138 2
do_conversion_verbose()
{
d145 1
a145 2
convert_page()
{
d158 1
a158 2
output_htaccess()
{
d164 1
a164 2
convert_all()
{
@


1.43
log
@remove trailing whitespace (space and tab only, not e.g. U+00A0) at EOL
this also simplifies the later (shell) logic to scan for empty lines
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.42 2007/01/25 12:27:17 tg Exp $
d44 1
a44 1
	sed -e '/[	 ]*$//'						\
d123 1
a123 1
 $MirOS: src/scripts/roff2htm,v 1.42 2007/01/25 12:27:17 tg Exp $</p>
@


1.42
log
@optimise for speed (nroff(1) doesn't output tabs, nrcon(1) won't any more)
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.41 2007/01/25 11:34:23 tg Exp $
d44 2
a45 1
	sed -e '/-$/N
d98 1
a98 2
		case $line {
		(*[!\	\ ]*)
d100 4
a103 4
			ws=0 ;;
		(*)
			(( !ws++ )) && print ;;
		}
d123 1
a123 1
 $MirOS: src/scripts/roff2htm,v 1.41 2007/01/25 11:34:23 tg Exp $</p>
@


1.41
log
@* replace &bull; with ‚Ä¢ and &amp; &lt; &gt; with their decimal
  numeric counter-part instead of relying on SGML entities
* clean up a little

tested on mksh(1)
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.40 2007/01/25 11:26:11 tg Exp $
d43 2
a44 4
	integer isblank=0
	set +e
	expand | sed							\
	    -e '/-$/N
d95 1
a95 1
	    -e "s#<a href=\"../man${1:-0}/#<a href=\"#g"		\
d97 2
a98 1
		if [[ $line = *@@([!	 †])* ]]; then
d100 4
a103 5
			let isblank=0
		elif (( isblank == 0 )); then
			print
			let isblank++
		fi
d109 9
a117 11
	cat <<-EOF
		<?xml version="1.0" encoding="utf-8" ?>
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
		 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
		 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
		 <title>RTFM ${1}(${2})</title>
		 <meta name="robots" content="index, follow" />
		</head><body>
		<h1>MirOS Manual: <a href="../man${2}/${1}.htm"><tt>${1}(${2})</tt></a></h1>
	EOF
d122 11
a132 13
	cat <<-EOF
		<hr /><p style="font-size:xx-small;">Generated on ${gendate} by
		 \$MirOS: src/scripts/roff2htm,v 1.40 2007/01/25 11:26:11 tg Exp $</p>
		<p>These manual pages are copyrighted by their respective writers; their
		 source is available at our <a href="http://cvs.mirbsd.de/">CVSweb</a>.
		 The rest is Copyright ¬© 2002-2007 <a href="http://www.mirbsd.org/">The
		 MirOS Project</a>, Germany. <i style="font-size:3pt;"><br />
		 This product includes material provided by Thorsten Glaser.</i></p>
		<p style="font-size:x-small;">This manual page's HTML representation
		 is supposed to be <a href="http://validator.w3.org/check/referer">valid
		 XHTML/1.1</a>; if not, please send a bug report ‚Äì diffs preferred.</p>
		</body></html>
	EOF
@


1.40
log
@fix missing backspaces issue, at least for audioctl(1)
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.39 2007/01/25 11:19:43 tg Exp $
d43 1
d45 1
a45 3
	let isblank=0
	expand								\
	| sed								\
d80 2
a81 2
	    -e 's#<b>+</b>\( *\)<b>o</b># \1\&bull;#'			\
	    -e 's#<b>+</b>#\&bull;#'					\
d89 3
a91 3
	    -e 's#¡#\&amp;#g'						\
	    -e 's#˛#\&lt;#g'						\
	    -e 's#ˇ#\&gt;#g'						\
d128 1
a128 1
		 \$MirOS: src/scripts/roff2htm,v 1.39 2007/01/25 11:19:43 tg Exp $</p>
@


1.39
log
@use UTF-8 instead of SGML entities; do not use BOM
passes regression tests
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.38 2007/01/25 11:04:42 tg Exp $
d99 1
a99 1
	| while IFS= read line; do
d129 1
a129 1
		 \$MirOS: src/scripts/roff2htm,v 1.38 2007/01/25 11:04:42 tg Exp $</p>
@


1.38
log
@* new do_conversion_verbose() to simplify code
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.37 2007/01/25 10:42:34 tg Exp $
a38 2
# Set up

a40 2
# Subroutines

a106 9
	done | iconv -csf utf-8 -t ucs-2le | \
	    hexdump -ve '/2 "%04x" "\n"' | while read x; do
		let i=16#$x
		if (( i < 0x7f )); then
			typeset -i8 o=i
			print -n \\0${o#8#}
		else
			print -n "&#${i};"
		fi
d113 1
a113 1
		<?xml version="1.0"?>
d117 1
a117 1
		 <meta http-equiv="content-type" content="text/html; charset=us-ascii" />
d129 1
a129 1
		 \$MirOS: src/scripts/roff2htm,v 1.37 2007/01/25 10:42:34 tg Exp $</p>
d131 2
a132 2
		 source can be retrieved from our <a href="http://cvs.mirbsd.de/">CVSweb</a>.
		 The rest is Copyright &copy; 2002-2007 <a href="http://www.mirbsd.org/">The
d137 1
a137 1
		 XHTML/1.1</a>; if not, please send a bug report &ndash; diffs preferred.</p>
d175 1
@


1.37
log
@* roff2htm, genhtman: new output_htaccess() [no functional change]
* roff2htm: use cat{1,2,...} instead of cat* and optimise
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.36 2007/01/22 18:03:52 tg Exp $
d142 1
a142 1
		 \$MirOS: src/scripts/roff2htm,v 1.36 2007/01/22 18:03:52 tg Exp $</p>
d162 8
d181 1
a181 3
	print -nru2 -- $fn -\> $tn
	do_conversion $page $sect <$fn >$tn
	print -u2
@


1.36
log
@"forgiving" utf-8 conversion - we do expect utf-8 as input,
but if it's not, don't error out, just produce garbage
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.35 2007/01/09 17:37:21 tg Exp $
d142 1
a142 1
		 \$MirOS: src/scripts/roff2htm,v 1.35 2007/01/09 17:37:21 tg Exp $</p>
d178 6
d189 1
d192 1
a192 1
		print DirectoryIndex /dev/null >$tp/man$x/.htaccess
d194 1
a194 1
	find ${1:-/usr/share/man}/cat* -name \*.0 | while read f; do
@


1.35
log
@2007
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.34 2006/12/11 23:54:57 tg Exp $
d5 1
a5 1
# Copyright (c) 2004, 2005, 2006
d36 1
a36 1
# Note: this file contains magic.
a41 12
set -A do_convert_asciiexp		# clear the array
{
	typeset -Uui16 i		# hexadecimal local var
	typeset x=0			# decimal local int var
	for i in $(jot 128 128); do	# chars not in ISO_646.irv:1991
		typeset -i8 j=i		# copy in octal
		do_convert_asciiexp[x++]=-e
		do_convert_asciiexp[x++]="s/$(print -n \
		    "\\0${j#8#}")/\\&#x${i#16#};/g"
	done
}

d61 1
a61 1
	    -e 'y#&<>#çèê#'						\
d67 2
a68 2
	    -e 's#_\(.\)#<i>\1</i>#g'					\
	    -e 's#.\(.\)#<b>\1</b>#g'					\
d71 3
a73 3
	    -e 's#</b><b>.##g'						\
	    -e 's#</b>.<b>##g'						\
	    -e 's#.##g'						\
d94 3
a96 4
	    -e 's#ç#\&amp;#g'						\
	    -e 's#è#\&lt;#g'						\
	    -e 's#ê#\&gt;#g'						\
	    ${do_convert_asciiexp[@@]}					\
d111 9
d142 1
a142 1
		 \$MirOS: src/scripts/roff2htm,v 1.34 2006/12/11 23:54:57 tg Exp $</p>
@


1.34
log
@mostly administrative licence sync w/ current template
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.33 2006/10/31 04:06:49 tg Exp $
d146 1
a146 1
		 \$MirOS: src/scripts/roff2htm,v 1.33 2006/10/31 04:06:49 tg Exp $</p>
d149 1
a149 1
		 The rest is Copyright &copy; 2002-2006 <a href="http://www.mirbsd.org/">The
@


1.33
log
@* don't "unexpand -a" manual pages, this leads to
|‚Üê‚Üê‚Üê                                                                                    RTFM operator(7) (p1 of 2)
|					  MirOS Manual: [1]operator(7)
|
|OPERATOR(7)               BSD Reference Manual                  OPERATOR(7)
|
|
|NAME
|
|     operator - C operator precedence and associativity
|
|
|DESCRIPTION
|
|	   Operator                             Associativity
|	   --------                             -------------
|	   () [] -> .                      left to right
|	   ! ~ ++ -- - (type) * & sizeof            right to left
|	   * / %                                left to right
|	   + -                                  left to right
|	   << >>                                    left to right
|	   < <= > >=                        left to right
|	   == !=                                left to right
|	   &                                left to right
|	   ^                                    left to right
|	   |                                    left to right
|	   &&                                   left to right
|	   ||                                   left to right
|	   ?:                                   right to left
|	   = += -= *= /= %= <<= >>= &= ^= |=    right to left
|	   ,                                    left to right
|
|
|FILES
|
|     /usr/share/misc/operator
|
|MirOS BSD #9-current             June 9, 1993                                1
|     ___________________________________________________________________________________________________
|
|   Generated on 2006-10-29 09:54:03 by $MirOS: src/scripts/roff2htm,v 1.32 2006/08/28 02:03:52 tg Exp $
|
|   These  manual  pages  are copyrighted by their respective writers; their source can normally be found in
|   our [2]CVSweb. The rest is Copyright ¬© 2002-2006 [3]The MirOS Project, Germany.
|   This product includes material provided by Thorsten Glaser.
|
|   This  manual  page's HTML representation is supposed to be [4]valid XHTML/1.1; if not, please send a bug
|   report # diffs preferred.

* while here, change CVSweb URI to persistent one
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.32 2006/08/28 02:03:52 tg Exp $
d14 5
a18 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d24 8
a31 8
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
d146 1
a146 1
		 \$MirOS: src/scripts/roff2htm,v 1.32 2006/08/28 02:03:52 tg Exp $</p>
@


1.32
log
@use &ndash;; simplify licence and website links
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.31 2006/06/15 19:18:48 tg Exp $
d125 1
a125 1
	done | unexpand -a
d147 1
a147 1
		 \$MirOS: src/scripts/roff2htm,v 1.31 2006/06/15 19:18:48 tg Exp $</p>
d149 1
a149 1
		 source can normally be found in our <a href="/cvs.cgi/src/">CVSweb</a>.
@


1.31
log
@mirbsd.org, 66h.42h.de, bsdadvocacy.org, and whatnot
we changed that too often, try to clean up the mess
mostly outside the www/ module which is dead anyway.
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.30 2006/04/05 20:31:03 tg Exp $
d7 1
d10 3
d21 2
a22 2
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
d32 1
a32 5
# the possibility of such damage or existence of a nontrivial bug.
#-
# Parts of the regular expression set below are based upon work by:
# Copyright (c) 1995
#	Panagiotis J. Christias <christia@@theseas.ntua.gr>
d147 1
a147 1
		 \$MirOS: src/scripts/roff2htm,v 1.30 2006/04/05 20:31:03 tg Exp $</p>
d150 1
a150 1
		 The rest is Copyright &copy; 2002-2006 <a href="http://www.MirBSD.org/">The
d155 1
a155 1
		 XHTML/1.1</a>; if not, please send a bug report - diffs preferred.</p>
@


1.30
log
@use "typeset -Uui16" for unsigned uppercase integer hexadecimal,
to prevent stuff like "x=-16#21524111" (0xDEADBEEF) which breaks
about all my scripts
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.29 2006/03/27 09:54:57 tg Exp $
d147 1
a147 1
		 \$MirOS: src/scripts/roff2htm,v 1.29 2006/03/27 09:54:57 tg Exp $</p>
d150 1
a150 1
		 The rest is Copyright &copy; 2002-2006 <a href="http://MirBSD.org/">The
@


1.29
log
@shorten generated manual page: if links to other pages are in same
directory, skip the ../manN/ part of the hyperlink

tested on mksh(1) page, looks like it works
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.28 2006/01/19 01:43:34 tg Exp $
d45 1
a45 1
	typeset -ui16 i			# hexadecimal local var
d147 1
a147 1
		 \$MirOS: src/scripts/roff2htm,v 1.28 2006/01/19 01:43:34 tg Exp $</p>
@


1.28
log
@shorten footer and make parts of it smaller (especially shrink the
advertising clause to a 3pt font and make it be displayed differently
in lynx) - still valid XHTML/1.1
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.27 2006/01/19 01:27:05 tg Exp $
d116 1
d147 1
a147 1
		 \$MirOS: src/scripts/roff2htm,v 1.27 2006/01/19 01:27:05 tg Exp $</p>
d163 1
a163 1
	do_convert
@


1.27
log
@move meta information to the bottom and get rid of one <hr />
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.26 2006/01/19 01:23:55 tg Exp $
d145 2
a146 4
		<hr />
		<p style="font-size:xx-small;">Generated on ${gendate} by
		 \$MirOS: src/scripts/roff2htm,v 1.26 2006/01/19 01:23:55 tg Exp $
		 <br />This product includes material provided by Thorsten Glaser.</p>
d150 2
a151 1
		 MirOS Project</a>, Germany.</p>
@


1.26
log
@remove g**gle ads; for a reason visit http://www.66h.42h.de/?danke soon.
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.25 2006/01/14 01:25:19 tg Exp $
a137 1
		<p style="font-size:2pt;">This product includes material provided by Thorsten Glaser.</p>
a138 3
		<p style="font-size:xx-small;">Generated on ${gendate} by
		 \$MirOS: src/scripts/roff2htm,v 1.25 2006/01/14 01:25:19 tg Exp $</p>
		<hr />
d146 3
@


1.25
log
@whoops, bump ©
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.24 2006/01/14 01:11:11 tg Exp $
a137 15
		<script type="text/javascript"><!--
		 google_ad_client = "pub-0266998858986985";
		 google_ad_width = 468;
		 google_ad_height = 15;
		 google_ad_format = "468x15_0ads_al_s";
		 google_ad_channel = "9683305767";
		 google_color_border = "CCCCCC";
		 google_color_bg = "CCCCCC";
		 google_color_link = "000000";
		 google_color_url = "006600";
		 google_color_text = "006600";
		//--></script>
		<script type="text/javascript"
		 src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
		</script>
d141 1
a141 1
		 \$MirOS: src/scripts/roff2htm,v 1.24 2006/01/14 01:11:11 tg Exp $</p>
d152 1
a152 1
		 The rest is Copyright &copy; 2002-2005 <a href="http://MirBSD.org/">The
@


1.24
log
@Better protection of trespassing (prevents </b<i>> cases):
-           -e 's#\([^[:punct:]]\)\([[:punct:]]*\)\(<[bi]>\)#\1\3\2#g'  \
+           -e 's#\([^[:punct:]]\)\([-!"#$%&'\''()*+,./:;=?@@[\]^_`{|}~]*\)\(<[bi]>\)#\1\3\2#g'  \
                                     ^^^^^^^  ^ ^^^^^^^^^^^^^^^^^^^^^^
These are [:punct:] except < and >, in standardised order (see
http://www.opengroup.org/onlinepubs/007908799/xbd/locale.html),
with the hyphen moved to the beginning and the apostrophe escaped
from shell.

-           -e 's#\(<[bi]>\)\(">\)#\2\1#g'                              \
This workaround is no longer needed now.

Finally, valid XHTML/1.1 manual pages again.
Strong candidate for MFC.
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.23 2006/01/02 16:18:00 tg Exp $
d5 2
a6 2
# Copyright (c) 2004, 2005
#	Thorsten "mirabile" Glaser <tg@@mirbsd.de>
d156 1
a156 1
		 \$MirOS: src/scripts/roff2htm,v 1.23 2006/01/02 16:18:00 tg Exp $</p>
@


1.23
log
@since       -e 's#\([^[:punct:]]\)\([[:punct:]]*\)\(<[bi]>\)#\1\3\2#g'  \
can trespass "> barriers, undo the damage with an added
            -e 's#\(<[bi]>\)\(">\)#\2\1#g'                              \
line (we should better fix that usage of :punct: though, I think)

candidate for MFC
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.22 2005/12/22 01:12:34 tg Exp $
d102 1
a102 2
	    -e 's#\([^[:punct:]]\)\([[:punct:]]*\)\(<[bi]>\)#\1\3\2#g'	\
	    -e 's#\(<[bi]>\)\(">\)#\2\1#g'				\
d156 1
a156 1
		 \$MirOS: src/scripts/roff2htm,v 1.22 2005/12/22 01:12:34 tg Exp $</p>
@


1.22
log
@* add BSD-Licence(7) to the list of generated HTML manual pages,
  for ports/Setup.sh(8)
* fix .htaccess files missing problem
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.21 2005/12/06 13:10:45 tg Exp $
d103 1
d157 1
a157 1
		 \$MirOS: src/scripts/roff2htm,v 1.21 2005/12/06 13:10:45 tg Exp $</p>
@


1.22.2.1
log
@MFC revisions 1.23-1.28 here:
* prevent punctuation italicisation/boldfacing from trespassing HTML tags
* remove ads; shrink red tape (header/footer)
* bump copyright year

Commit IDs: 10043B9521C292BC2B1 10043C84F4E496C148A 10043C85310289851BA
	    10043CEEA2C67B8E371 10043CEEAF26B8E49FF 10043CEED8700C9832F

not yet approved by bsiegert@@
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.28 2006/01/19 01:43:34 tg Exp $
d5 2
a6 2
# Copyright (c) 2004, 2005, 2006
#	Thorsten "mirabilos" Glaser <tg@@mirbsd.de>
d102 1
a102 1
	    -e 's#\([^[:punct:]]\)\([-!"#$%&'\''()*+,./:;=?@@[\]^_`{|}~]*\)\(<[bi]>\)#\1\3\2#g'	\
d138 16
d155 3
d164 1
a164 2
		<hr /><p style="font-size:xx-small;">Generated on ${gendate} by
		 \$MirOS: src/scripts/roff2htm,v 1.28 2006/01/19 01:43:34 tg Exp $</p>
d167 2
a168 3
		 The rest is Copyright &copy; 2002-2006 <a href="http://MirBSD.org/">The
		 MirOS Project</a>, Germany. <i style="font-size:3pt;"><br />
		 This product includes material provided by Thorsten Glaser.</i></p>
@


1.21
log
@* allow foo(8/i386) -> man8/foo.htm
* allow foo(SMM), foo(PSD), foo(USD), foo(PAPERS) only caps tho
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.20 2005/12/06 00:00:32 tg Exp $
d6 1
a6 1
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d8 1
a8 1
#	Stephen Paskaluk <sap@@66h.42h.de>
d156 1
a156 1
		 \$MirOS: src/scripts/roff2htm,v 1.20 2005/12/06 00:00:32 tg Exp $</p>
@


1.20
log
@mh, get me rid of manual work, integrate ad template here
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.19 2005/11/15 21:10:19 tg Exp $
d91 6
a96 2
	    -e '/^   /s#\(\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[A-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
	    -e '/^   /s#\(<i>\([0-9A-z][-.,0-9A-z]*\)</i>(\([1-9]\)[A-z]*)\)#<a href=\"../man\3/\2.htm\">\1</a>#g' \
d156 1
a156 1
		 \$MirOS: src/scripts/roff2htm,v 1.19 2005/11/15 21:10:19 tg Exp $</p>
@


1.19
log
@fix typo in roff2htm and use it to auto-generate the HTML version as well
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.18 2005/11/15 21:05:08 tg Exp $
d21 8
a28 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
d134 15
d152 1
a152 1
		 \$MirOS: src/scripts/roff2htm,v 1.18 2005/11/15 21:05:08 tg Exp $</p>
@


1.18
log
@fix grammar; honour adv clause
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.17 2005/11/15 21:01:05 tg Exp $
d59 1
d133 1
a133 1
		<p style="font-size:2pt;>This product includes material provided by Thorsten Glaser.</p>
d136 1
a136 1
		 \$MirOS: src/scripts/roff2htm,v 1.17 2005/11/15 21:01:05 tg Exp $</p>
@


1.17
log
@unexpand(1) the .htm file - lynx can handle tabulator signs in <pre> blocks
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.16 2005/11/15 20:59:00 tg Exp $
d29 1
a29 1
# Parts of the regular expression set below is based upon work by:
d132 1
d135 1
a135 1
		 \$MirOS: src/scripts/roff2htm,v 1.16 2005/11/15 20:59:00 tg Exp $</p>
@


1.16
log
@determine current date during set-up phase; saves us a whole function
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.15 2005/11/15 20:54:00 tg Exp $
d118 1
a118 1
	done
d134 1
a134 1
		 \$MirOS: src/scripts/roff2htm,v 1.15 2005/11/15 20:54:00 tg Exp $</p>
@


1.15
log
@replace awk(1) with while read if print
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.14 2005/11/15 20:39:40 tg Exp $
d41 1
a42 1
gendate=
d134 1
a134 1
		 \$MirOS: src/scripts/roff2htm,v 1.14 2005/11/15 20:39:40 tg Exp $</p>
d154 1
a154 1
do_convert_onepage()
d156 1
a156 1
	output_header $1 $2
d161 2
a162 1
do_convert_page()
d173 1
a173 1
	do_convert_onepage $page $sect <$fn >$tn
a176 7
# convert_page /path/to/man.cat1 /targetpath
convert_page()
{
	gendate=$(date +"%F %T")	# current time
	do_convert_page "$@@"
}

a179 1
	gendate=$(date +"%F %T")	# current time
d187 1
a187 1
		do_convert_page $f $tp	# any subpages
@


1.14
log
@replace the high-bit7 control characters we use with some which are
actually undefined in the windows-1252 character set, making MirNroff
even more useful
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.13 2005/11/15 20:36:57 tg Exp $
d29 1
a29 1
# Based upon regular expressions by:
d59 1
d110 9
a118 3
	| awk								\
	   '/^$/	{ if(!blank) { print; blank=1 } }
	    /^..*$/	{ print; blank=0 }'
d134 1
a134 1
		 \$MirOS: src/scripts/roff2htm,v 1.13 2005/11/15 20:36:57 tg Exp $</p>
@


1.13
log
@save us another jot(1) invocation
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.12 2005/11/15 20:33:06 tg Exp $
d71 1
a71 1
	    -e 'y#&<>#ÅÇ#'						\
d100 3
a102 3
	    -e 's##\&amp;#g'						\
	    -e 's#Å#\&lt;#g'						\
	    -e 's#Ç#\&gt;#g'						\
d127 1
a127 1
		 \$MirOS: src/scripts/roff2htm,v 1.12 2005/11/15 20:33:06 tg Exp $</p>
@


1.12
log
@call me god...
trailing slashes in .Pa'd http, ftp and absolute-pathname URIs are now
italicised as well
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.11 2005/11/15 20:30:18 tg Exp $
d127 1
a127 1
		 \$MirOS: src/scripts/roff2htm,v 1.11 2005/11/15 20:30:18 tg Exp $</p>
d182 1
a182 1
	for x in $(jot 9 1) 3p; do
@


1.11
log
@* collapse some let x++ into assignment
* remove some unneeded quoting
* indent here documents
* easen up testing
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.10 2005/11/15 20:19:52 tg Exp $
d96 2
d127 1
a127 1
		 \$MirOS: src/scripts/roff2htm,v 1.10 2005/11/15 20:19:52 tg Exp $</p>
@


1.10
log
@get rid of 128 spawned printf(1) invocations,
use print mksh(1) builtin d'oh
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.9 2005/11/15 20:15:42 tg Exp $
d48 2
a49 3
		do_convert_asciiexp[x]="-e"
		let x++
		do_convert_asciiexp[x]="s/$(print -n \
a50 1
		let x++
d114 14
a127 14
	cat <<EOF
<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
 <meta http-equiv="content-type" content="text/html; charset=us-ascii" />
 <title>RTFM ${1}(${2})</title>
 <meta name="robots" content="index, follow" />
</head><body>
<h1>MirOS Manual: <a href="../man${2}/${1}.htm"><tt>${1}(${2})</tt></a></h1>
<p style="font-size:xx-small;">Generated on ${gendate} by
 \$MirOS: src/scripts/roff2htm,v 1.9 2005/11/15 20:15:42 tg Exp $</p>
<hr />
EOF
d132 18
a149 11
	cat <<EOF
<hr />
<p>These manual pages are copyrighted by their respective writers; their
 source can normally be found in our <a href="/cvs.cgi/src/">CVSweb</a>.
 The rest is Copyright &copy; 2002-2005 <a href="http://MirBSD.org/">The
 MirOS Project</a>, Germany.</p>
<p style="font-size:x-small;">This manual page's HTML representation
 is supposed to be <a href="http://validator.w3.org/check/referer">valid
 XHTML/1.1</a>; if not, please send a bug report - diffs preferred.</p>
</body></html>
EOF
d162 3
a164 7
	print -nr -- $fn -\> ${tn}

	output_header $page $sect >$tn
	do_convert <$fn >>$tn
	output_footer >>$tn

	print
d170 1
a170 1
	gendate="$(date +"%F %T")"	# current time
d177 1
a177 1
	gendate="$(date +"%F %T")"	# current time
@


1.9
log
@strain sed(1) and re_format(7) even further:
concatenate sequential rooms of same formatting area (b or i)
with only whitespace or punctuation in between (nroff doesn't
format them, weirdly), and leading punctuation (not trailing,
because a full stop might be not part of it) - can't get any
better without changing nroff...
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.8 2005/11/15 20:01:31 tg Exp $
d17 4
d50 2
a51 2
		do_convert_asciiexp[x]="s/$(printf \
		    "\\${j#8#}")/\\&#x${i#16#};/g"
d127 1
a127 1
 \$MirOS: src/scripts/roff2htm,v 1.8 2005/11/15 20:01:31 tg Exp $</p>
@


1.8
log
@convert mdoc .Ss sub-sections to <h3> level headlines
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.7 2005/07/07 13:06:38 tg Exp $
d72 2
a73 2
	    -e 's#^[A-Z][ ,A-Z]*$#</pre><h2>&</h2><pre>#'		\
	    -e 's#^  \([A-Z][ ,A-Z]*\)#</pre><h3>\1</h3><pre>#'	\
d92 3
a94 1
	    -e 's#<h3><b>#<h3>#g' -e 's#</b></h3>#</h3>#g'		\
d123 1
a123 1
 \$MirOS: src/scripts/roff2htm,v 1.7 2005/07/07 13:06:38 tg Exp $</p>
@


1.7
log
@* some sync with reality
* some sh, ksh -> mksh
* some cleanup
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.6 2005/03/29 17:27:31 tg Exp $
d73 1
d92 1
d121 1
a121 1
 \$MirOS: src/scripts/roff2htm,v 1.6 2005/03/29 17:27:31 tg Exp $</p>
@


1.6
log
@support perl man pages
fix wording
@
text
@d1 2
a2 2
#!/bin/sh
# $MirOS: src/scripts/roff2htm,v 1.5 2005/03/29 12:33:51 tg Exp $
d119 1
a119 1
 \$MirOS: src/scripts/roff2htm,v 1.5 2005/03/29 12:33:51 tg Exp $</p>
@


1.5
log
@can't happen more than twice
(should speed up man page generation quite a bit)
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.4 2005/03/22 20:08:29 tg Exp $
d119 1
a119 1
 \$MirOS: src/scripts/roff2htm,v 1.4 2005/03/22 20:08:29 tg Exp $</p>
d128 2
a129 2
<p>These manual pages are copyrighted by their respective writers, their
 source can normally be found at the <a href="/cvs.cgi/src/">CVSweb</a>.
d171 1
a171 1
	for x in $(jot 9 1); do
@


1.4
log
@Tim Bray says XML 1.1 is not very widely used.
The W3C spec for XML 1.1 says "Programs which generate XML SHOULD generate
XML 1.0, unless one of the specific features of XML 1.1 is required."

So be it, then.

While here, fix roff2htm.sh with regards to the MirBSD.org acquaintance
and the new RCS ID / CVS ID policy.
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.3 2005/03/14 20:50:57 tg Exp $
a68 10
	    -e '/-$/N
{
s/\([0-9A-z][-.,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
\2/
}'									\
	    -e '/-$/N
{
s/\([0-9A-z][-.,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-.,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
\2/
}'									\
d119 1
a119 1
 \$MirOS$</p>
@


1.3
log
@generate a .htaccess in each subdir by default
rationale: man 3 index ... *sigh*
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.2 2005/03/03 16:49:33 tg Exp $
d119 1
a119 1
<?xml version="1.1"?>
d129 1
a129 1
 \$Id: man2htm,v 1.1 2004/10/21 14:22:31 tg Exp $</p>
d138 4
a141 4
<p>These manual pages are copyrighted by their respective writers, the
 source of which can be found at the <a href="/cvs.cgi/src/">CVSweb</a>.
 The rest is Copyright &copy; 2002-2005 <a href="http://mirbsd.de/">The
 MirOS Project</a>.</p>
@


1.2
log
@accept . as character in man pages
here only line continuations
@
text
@d2 1
a2 1
# $MirOS: src/scripts/roff2htm,v 1.1 2005/03/03 16:44:00 tg Exp $
d183 1
@


1.1
log
@copy man2htm from ocvs/ncvs1
@
text
@d2 1
a2 1
# $MirOS$
d5 1
a5 1
# Copyright (c) 2004
d61 1
a61 1
s/\([0-9A-z][-,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
d66 1
a66 1
s/\([0-9A-z][-,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
d71 1
a71 1
s/\([0-9A-z][-,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
d76 1
a76 1
s/\([0-9A-z][-,0-9A-z]*\)-\n\(  *\)\([0-9A-z][-,0-9A-z]*([1-9][A-z]*)\)\([^ ]*\) /\1\3\4\
@

