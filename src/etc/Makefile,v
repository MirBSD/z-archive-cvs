head	1.54;
access;
symbols
	MIRBSD_10:1.40.0.2
	MIRBSD_10_BASE:1.40
	MIRBSD_9_BASE:1.24
	MIRBSD_8:1.14.0.2
	MIRBSD_8_BASE:1.14
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.54
date	2015.05.25.18.19.00;	author tg;	state Exp;
branches;
next	1.53;
commitid	1005563679F07334914;

1.53
date	2014.06.09.13.49.36;	author tg;	state Exp;
branches;
next	1.52;
commitid	1005395BB7B468FE4BB;

1.52
date	2014.03.29.20.56.44;	author tg;	state Exp;
branches;
next	1.51;
commitid	1005337335E54AE6E17;

1.51
date	2014.03.29.01.17.17;	author tg;	state Exp;
branches;
next	1.50;
commitid	10053361F364BE92848;

1.50
date	2014.03.29.00.45.44;	author tg;	state Exp;
branches;
next	1.49;
commitid	100533617D03A39934D;

1.49
date	2013.09.10.18.28.49;	author tg;	state Exp;
branches;
next	1.48;
commitid	100522F64F41F46A361;

1.48
date	2011.01.15.21.52.37;	author tg;	state Exp;
branches;
next	1.47;
commitid	1004D32173B08BB4E36;

1.47
date	2009.10.29.00.47.45;	author tg;	state Exp;
branches;
next	1.46;
commitid	1004AE8E62C03A506A0;

1.46
date	2009.10.27.19.06.31;	author tg;	state Exp;
branches;
next	1.45;
commitid	1004AE744BB2BB759C5;

1.45
date	2009.09.06.15.08.00;	author tg;	state Exp;
branches;
next	1.44;
commitid	1004AA3D05820A532B0;

1.44
date	2009.05.16.14.09.04;	author tg;	state Exp;
branches;
next	1.43;
commitid	1004A0EC8BA0B1EE08F;

1.43
date	2008.11.30.16.09.03;	author tg;	state Exp;
branches;
next	1.42;
commitid	1004932BAB345B18456;

1.42
date	2008.06.27.21.03.59;	author tg;	state Exp;
branches;
next	1.41;
commitid	100486555C62D748E6F;

1.41
date	2008.05.07.12.16.12;	author tg;	state Exp;
branches;
next	1.40;
commitid	10048219D991FE06744;

1.40
date	2007.10.02.18.39.13;	author tg;	state Exp;
branches;
next	1.39;
commitid	100470290611BC5B444;

1.39
date	2007.10.02.18.26.27;	author tg;	state Exp;
branches;
next	1.38;
commitid	10047028D624B67594F;

1.38
date	2007.06.16.22.57.29;	author tg;	state Exp;
branches;
next	1.37;
commitid	10046746ABA340A1476;

1.37
date	2007.06.16.22.36.48;	author tg;	state Exp;
branches;
next	1.36;
commitid	10046746581272CFCA8;

1.36
date	2007.06.12.22.11.36;	author tg;	state Exp;
branches;
next	1.35;
commitid	100466F1A2F44FEC8D0;

1.35
date	2007.04.29.23.17.55;	author tg;	state Exp;
branches;
next	1.34;
commitid	100463527756EBB47A0;

1.34
date	2007.04.29.20.23.09;	author tg;	state Exp;
branches;
next	1.33;
commitid	1004634FEC2113C55F5;

1.33
date	2007.04.16.18.54.37;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004623C5744FDC6F8B;

1.32
date	2007.04.16.17.37.08;	author tg;	state Exp;
branches;
next	1.31;
commitid	1004623B45A7B20ADAB;

1.31
date	2007.03.09.13.05.10;	author tg;	state Exp;
branches;
next	1.30;
commitid	10045F15B4849447B32;

1.30
date	2006.11.17.13.58.12;	author tg;	state Exp;
branches;
next	1.29;
commitid	100455DC0064647DDB1;

1.29
date	2006.10.28.21.27.13;	author tg;	state Exp;
branches;
next	1.28;
commitid	1004543CB446E284F7B;

1.28
date	2006.10.28.20.07.01;	author tg;	state Exp;
branches;
next	1.27;
commitid	1004543B87877130AFB;

1.27
date	2006.10.28.19.54.55;	author tg;	state Exp;
branches;
next	1.26;
commitid	1004543B5A4442CC999;

1.26
date	2006.10.15.02.11.38;	author tg;	state Exp;
branches;
next	1.25;
commitid	100453198E925DD91DC;

1.25
date	2006.09.24.18.13.38;	author tg;	state Exp;
branches;
next	1.24;
commitid	1004516CAD629499454;

1.24
date	2006.06.17.21.37.44;	author tg;	state Exp;
branches;
next	1.23;
commitid	10044947601532D67B8;

1.23
date	2006.06.17.16.21.18;	author tg;	state Exp;
branches;
next	1.22;
commitid	10044942C15499DE35B;

1.22
date	2006.06.17.00.45.00;	author tg;	state Exp;
branches;
next	1.21;
commitid	10044935095684C1DB8;

1.21
date	2006.04.13.01.55.30;	author tg;	state Exp;
branches;
next	1.20;
commitid	100443DAF9F613C2215;

1.20
date	2006.04.12.11.59.20;	author tg;	state Exp;
branches;
next	1.19;
commitid	100443CEB7C3144AC9F;

1.19
date	2006.03.29.13.37.34;	author tg;	state Exp;
branches;
next	1.18;
commitid	100442A8D0D6C1A22B8;

1.18
date	2006.02.14.20.47.53;	author tg;	state Exp;
branches;
next	1.17;
commitid	10043F2407C51151E2F;

1.17
date	2006.01.04.02.15.12;	author tg;	state Exp;
branches;
next	1.16;
commitid	10043BB2FC4746B9C84;

1.16
date	2006.01.03.03.54.56;	author tg;	state Exp;
branches;
next	1.15;
commitid	10043B9F56C65A5546E;

1.15
date	2005.12.24.02.33.16;	author tg;	state Exp;
branches;
next	1.14;
commitid	10043ACB3374B6BBA68;

1.14
date	2005.12.16.23.40.14;	author tg;	state Exp;
branches;
next	1.13;
commitid	10043A350584FAEF786;

1.13
date	2005.12.04.17.20.45;	author tg;	state Exp;
branches;
next	1.12;
commitid	2bd44393257bdcb8;

1.12
date	2005.09.23.10.52.51;	author tg;	state Exp;
branches;
next	1.11;
commitid	a054333de93dbe7;

1.11
date	2005.09.23.10.51.04;	author tg;	state Exp;
branches;
next	1.10;
commitid	24044333de18e99a;

1.10
date	2005.08.21.11.45.38;	author tg;	state Exp;
branches;
next	1.9;
commitid	1c13430869647d4b;

1.9
date	2005.07.24.15.45.28;	author tg;	state Exp;
branches;
next	1.8;
commitid	777042e3b7a03843;

1.8
date	2005.07.06.18.34.10;	author tg;	state Exp;
branches;
next	1.7;
commitid	2ad42cc242e7a07;

1.7
date	2005.07.04.12.43.41;	author tg;	state Exp;
branches;
next	1.6;
commitid	46f442c92f0c1fc5;

1.6
date	2005.06.26.18.07.53;	author tg;	state Exp;
branches;
next	1.5;
commitid	64b142beef0e7eee;

1.5
date	2005.04.20.06.18.06;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.19.12.53.46;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.29.00.12.14;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.19.05.53;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.22.11;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.22.11;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.21.20.45.33;	author tg;	state Exp;
branches;
next	;
commitid	560042e0092f571e;


desc
@@


1.54
log
@we haven’t been using <2Kibit moduli for a while
@
text
@# $MirOS: src/etc/Makefile,v 1.53 2014/06/09 13:49:36 tg Exp $
# $OpenBSD: Makefile,v 1.226 2005/05/26 23:06:06 mcbride Exp $

TZDIR=		/usr/share/zoneinfo
LOCALTIME?=	UTC
NOOBJ=		yes

.include <bsd.own.mk>

# -rw-r--r--
BINOWN=	root
BIN1=	anacron ccd.conf changelist cronrun csh.login daily dhclient.conf \
	dhcpd.conf dhcpd.interfaces etc.${MACHINE}/disktab exports \
	ftpchroot ftpusers gettytab group hosts hosts.lpd \
	locate.rc login.conf \
	mailer.conf man.conf moduli monthly motd mrouted.conf \
	myname netstart networks newsyslog.conf ntpd.conf \
	pf.os phones printcap profile protocols rbootd.conf \
	rc rc.conf rc.local rc.securelevel rc.shutdown remote \
	rpc security sensorsd.conf services shells weekly wsconsctl.conf

# machine dependent parts
BINMD=	make.cfg sysctl.conf syslog.conf

# -rw-rw-r--
BIN2=	motd

# Use NOGZIP on architectures where the gzip'ing would take too much time
# (pmax or slower :-)).  This way you get only tar'ed snap files and you can
# gzip them on a faster machine
.ifndef NOGZIP
GZIP?=		gzip
GZIPFLAGS?=	-9
GZIPEXT?=	.gz
.else
GZIP=		cat
GZIPFLAGS=
GZIPEXT=
.endif
SKIPDIR?=	# empty

all clean cleandir depend etc install lint:

.if !defined(DESTDIR) || empty(DESTDIR)
etc-files:
	@@echo setenv DESTDIR before trying this!
	@@exit 1
.else
etc-files:
	${INSTALL} -c -o ${BINOWN} -g ${CONFGRP} -m 644 ${BIN1} ${DESTDIR}/etc/
	cat fbtab.head etc.${MACHINE}/fbtab fbtab.tail >${DESTDIR}/etc/fbtab
	${SHELL} ${.CURDIR}/ttys.pty ${MACHINE} >${DESTDIR}/etc/ttys.dist
.  for _i in ${BINMD}
	if [ -e ${.CURDIR}/etc.${MACHINE}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/${_i}.md' \
		    -e '//d' ${.CURDIR}/${_i}; \
	else \
		sed -e '/@@@@MDPART@@@@/d' ${.CURDIR}/${_i}; \
	fi >${DESTDIR}/etc/${_i}
.  endfor
	cd ${DESTDIR}/etc && \
	    chown ${BINOWN}:${CONFGRP} fbtab ttys.dist ${BINMD} && \
	    chmod 644 fbtab ttys.dist ${BINMD}
	${INSTALL} -c -o ${BINOWN} -g ${CONFGRP} -m 664 ${BIN2} ${DESTDIR}/etc/
	${INSTALL} -c -o root -g wheel -m 600 hosts.equiv ${DESTDIR}/etc/
	${INSTALL} -c -o root -g wheel -m 600 crontab ${DESTDIR}/var/cron/tabs/root
	${INSTALL} -c -o root -g wheel -m 600 master.passwd ${DESTDIR}/etc/
	pwd_mkdb -p -d ${DESTDIR}/etc /etc/master.passwd
	${INSTALL} -c -o root -g ${CONFGRP} -m 640 inetd.conf ${DESTDIR}/etc/
	${INSTALL} -c -o root -g wheel -m 640 pf.conf ${DESTDIR}/etc/
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 555 \
	    etc.${MACHINE}/MAKEDEV ${DESTDIR}/dev/
	${INSTALL} -c -o root -g wheel -m 600 root.profile ${DESTDIR}/.profile
	cd skel; \
		${INSTALL} -c -o root -g wheel -m 644 calendar \
		    ${DESTDIR}/etc/skel/.etc/calendar/calendar; \
		${INSTALL} -c -o root -g wheel -m 644 dot.Xresources \
		    ${DESTDIR}/etc/skel/.Xresources; \
		${INSTALL} -c -o root -g wheel -m 644 dot.mailrc \
		    ${DESTDIR}/etc/skel/.mailrc
	cd mtree; \
		${INSTALL} -c -o root -g wheel -m 600 special \
		    ${DESTDIR}/etc/mtree/; \
		${INSTALL} -c -o root -g wheel -m 444 4.4BSD.dist \
		    ${DESTDIR}/etc/mtree/
	cd ppp; \
		${INSTALL} -c -o root -g wheel -m 600 \
		    chap-secrets options.sample pap-secrets \
		    ppp.conf.sample ppp.secret.sample \
			${DESTDIR}/etc/ppp/; \
		${INSTALL} -c -o root -g wheel -m 600 \
		    isp.sample isp.chat.sample \
			${DESTDIR}/etc/ppp/peers/; \
		${INSTALL} -c -o root -g wheel -m 755 \
		    ip-up ip-down ppp.linkup.sample ppp.linkdown.sample \
			${DESTDIR}/etc/ppp/
	cd systrace; \
		${INSTALL} -c -o root -g wheel -m 600 usr_sbin_lpd \
		    ${DESTDIR}/etc/systrace/
	/bin/rm -f ${DESTDIR}/etc/localtime
	ln -s ${TZDIR}/${LOCALTIME} ${DESTDIR}/etc/localtime
	/bin/rm -f ${DESTDIR}/etc/rmt
	ln -s /usr/sbin/rmt ${DESTDIR}/etc/rmt
	${INSTALL} -c -o root -g wheel -m 644 minfree \
		${DESTDIR}/var/crash/
	${INSTALL} -c -o ${BINOWN} -g operator -m 664 /dev/null \
		${DESTDIR}/etc/dumpdates
.  if ${MACHINE} == "i386"
	${INSTALL} -c -o root -g wheel -m 644 isdnd.rc.sample \
		${DESTDIR}/etc/isdn/
	${INSTALL} -c -o root -g wheel -m 644 isdnd.sppp.sample \
		${DESTDIR}/etc/isdn/
.  endif
	${INSTALL} -c -o root -g crontab -m 660 /dev/null \
		${DESTDIR}/var/cron/at.deny
	${INSTALL} -c -o root -g crontab -m 660 /dev/null \
		${DESTDIR}/var/cron/cron.deny
	${INSTALL} -c -o root -g wheel -m 444 /dev/null \
		${DESTDIR}/var/db/locate.database
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/messages
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/sendmail.st
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/wtmp
	${INSTALL} -c -o daemon -g staff -m 664 /dev/null \
		${DESTDIR}/var/msgs/bounds
	${INSTALL} -c -o ${BINOWN} -g utmp -m 664 /dev/null \
		${DESTDIR}/var/run/utmp
.  if ${SKIPDIR:Mgnu/usr.sbin/sendmail}
	@@echo "Warning: skipping sendmail"
.  else
	cd ../gnu/usr.sbin/sendmail/cf/cf && exec ${MAKE} distribution
.  endif
.  for _i in lib/libssl bin/mksh usr.bin/indent usr.bin/mail usr.bin/ssh
	cd ../${_i} && exec ${MAKE} distribution
.  endfor
.  if ${CROSS_MODE:L} != "yes"
.    for _i in usr.sbin/httpd gnu/usr.bin/anoncvs gnu/usr.bin/lynx
.      if ${SKIPDIR:M${_i}}
	@@echo "Warning: skipping ${_i}"
.      else
	cd ../${_i}; f=Makefile.bsd-wrapper; [[ -e $$f ]] || f=Makefile; \
	    exec ${MAKE} -f $$f distribution
.      endif
.    endfor
.  endif
	${INSTALL} -c -o root -g wheel -m 440 ../usr.bin/sudo/sudoers \
	    ${DESTDIR}/etc/sudoers
	cd ${DESTDIR}/etc/ssl/certs && ${SHELL} ${.CURDIR}/ssl.certs.shar && \
	    chown ${BINOWN}:${CONFGRP} * && chmod 444 * && \
	    ${SHELL} ${.CURDIR}/ssl.links.shar
	${INSTALL} -c -o ${BINOWN} -g ${CONFGRP} -m 644 spamd.conf \
	    ${DESTDIR}/etc/mail/
	${INSTALL} -c -o ${BINOWN} -g ${CONFGRP} -m 644 ssh_known_hosts \
	    ${DESTDIR}/etc/ssh/
	${INSTALL} -c -o 0 -g 0 -m 644 ssh_root_config \
	    ${DESTDIR}/etc/ssh/root:config
.endif # destdir

MAKEDEVARCHS+= i386
MAKEDEVARCHS+= sparc

clean:
	rm -f etc.${MACHINE}/MAKEDEV

cleandir:
	cd ${.CURDIR}; for m in ${MAKEDEVARCHS}; do \
	    ${MAKE} MACHINE=$$m clean; done

MAKEDEVSRC=	MAKEDEV.mi MAKEDEV.sub MAKEDEV.common
MAKEDEVDOC=	MAKEDEV.man MAKEDEV.mansub MAKEDEV.common
m4: etc.${M}/MAKEDEV
man: ${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8

etc.${M}/MAKEDEV: ${MAKEDEVSRC} etc.${M}/MAKEDEV.md
	@@echo "==> etc.${M}/MAKEDEV"
	m4 -DMACHINE=${M} MAKEDEV.mi >etc.${M}/.MAKEDEV.tmp && \
	    mv etc.${M}/.MAKEDEV.tmp etc.${M}/MAKEDEV || \
	    rm etc.${M}/.MAKEDEV.tmp

${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8: ${MAKEDEVDOC} etc.${M}/MAKEDEV.md
	m4 -DMACHINE=${M} MAKEDEV.man >$@@

allarchs: ${MAKEDEVSRC} ${MAKEDEVDOC}
	cd ${.CURDIR}; for m in ${MAKEDEVARCHS}; do \
	    ${MAKE} M=$$m m4 man; done
	@@echo "================================="
	@@echo " Don't forget to update your own"
	@@echo " '/dev/MAKEDEV' script manually!"
	@@echo "================================="

GENERATED_FILES=

.for _i in ${BINMD}
GENERATED_FILES+= ${_i}.generated

.  for _j in etc.${MACHINE}/${_i}.md etc.${MACHINE_ARCH}/${_i}.md ${_i}
.    if exists(${_j})
${_i}.generated: ${_j}
.    endif
.  endfor

${_i}.generated:
	if [ -e ${.CURDIR}/etc.${MACHINE}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/${_i}.md' \
		    -e '//d'; \
	elif [ -e ${.CURDIR}/etc.${MACHINE_ARCH}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE_ARCH}/${_i}.md' \
		    -e '//d'; \
	else \
		sed -e '/@@@@MDPART@@@@/d'; \
	fi <${.CURDIR}/${_i} >$@@
.endfor

make-generated: ${GENERATED_FILES}

clean-generated:
	-rm -f ${GENERATED_FILES}

.ifdef DESTDIR
install-generated: make-generated
.  for _i in ${BINMD}
	${INSTALL} -c -o ${BINOWN} -g ${CONFGRP} -m 644 \
	    ${_i}.generated ${DESTDIR}/etc/${_i}
.  endfor
.else
install-generated:
	@@echo "Set DESTDIR before trying this!"; false
.endif

DHSIZE=	2048 3072 4096 5120 6144
update-moduli:
	{ \
		echo '# $$MirSecuCron$$'; \
		echo '# $$MirOS: src/etc/Makefile,v 1.53 2014/06/09 13:49:36 tg Exp $$'; \
		echo '#-'; \
		echo '# Time Type Tests Tries Size Generator Modulus'; \
		for i in ${DHSIZE}; do \
			ssh-keygen -b $$i -G /dev/stdout; \
		done | ssh-keygen -T /dev/stdout; \
	} >moduli

.PHONY: all clean cleandir depend etc install lint etc-files \
	clean cleandir m4 man allarchs make-generated clean-generated \
	install-generated update-moduli

.include <bsd.prog.mk>
@


1.53
log
@remove default /etc/suid_profile now it is no longer needed
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.52 2014/03/29 20:56:44 tg Exp $
d232 1
a232 1
DHSIZE=	1024 1536 2048 3072 4096 5120 6144
d236 1
a236 1
		echo '# $$MirOS: src/etc/Makefile,v 1.52 2014/03/29 20:56:44 tg Exp $$'; \
@


1.52
log
@Update X.509v3 Root CA certificates in the base system
• drastically reduce number of CAs shipped, to follow current best practice
  (per recommendation of IanG and mostly Debian)
• install OpenSSL 1.x-format hashed files, by request of bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.51 2014/03/29 01:17:17 tg Exp $
d15 1
a15 1
	locate.rc login.conf suid_profile \
d236 1
a236 1
		echo '# $$MirOS: src/etc/Makefile,v 1.51 2014/03/29 01:17:17 tg Exp $$'; \
@


1.51
log
@we already ship 6144 bit; 5120 bit may also be in demand
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.49 2013/09/10 18:28:49 tg Exp $
d151 2
a152 1
	    chown ${BINOWN}:${CONFGRP} * && chmod 444 *
d236 1
a236 1
		echo '# $$MirOS: src/etc/Makefile,v 1.49 2013/09/10 18:28:49 tg Exp $$'; \
@


1.50
log
@nicer output
@
text
@d231 1
a231 1
DHSIZE=	1024 1536 2048 3072 4096
@


1.49
log
@install a stopgap measure
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.48 2011/01/15 21:52:37 tg Exp $
d234 3
a236 1
		echo '# $$MirOS: src/etc/Makefile,v 1.48 2011/01/15 21:52:37 tg Exp $$'; \
@


1.48
log
@Introduce /etc/ssh/root:config and /etc/ssh/root:known_hosts
and /etc/ssh/root:authorised_keys for the superuser if his
HOME directory is unset, empty or, not normalised, "/" (root).
十̲CVS: ----------------------------------------------------------------------
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.47 2009/10/29 00:47:45 tg Exp $
d15 1
a15 1
	locate.rc login.conf \
d234 1
a234 1
		echo '# $$MirOS: src/etc/Makefile,v 1.47 2009/10/29 00:47:45 tg Exp $$'; \
@


1.47
log
@SIGUSR1 restarts of httpd just don't work with chroot, period.
(and I don't know why, but since I'm building a release, revert.)
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.45 2009/09/06 15:08:00 tg Exp $
d156 2
d234 1
a234 1
		echo '# $$MirOS: src/etc/Makefile,v 1.45 2009/09/06 15:08:00 tg Exp $$'; \
@


1.46
log
@introduce /var/www/etc/ssl/certs/ with hardlinks (to save space and inodes)
now that paxmirabilis/MirCPIO can do them
@
text
@d151 1
a151 2
	    chown ${BINOWN}:${CONFGRP} * && chmod 444 * && \
	    pax -rw -l -pe . ${DESTDIR}/var/www/etc/ssl/certs/
@


1.45
log
@• better Bourne shell, csh, tcsh, zsh compatibility
• RCS IDs
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.44 2009/05/16 14:09:04 tg Exp $
d151 2
a152 1
	    chown ${BINOWN}:${CONFGRP} * && chmod 444 *
d233 1
a233 1
		echo '# $$MirOS: src/etc/Makefile,v 1.44 2009/05/16 14:09:04 tg Exp $$'; \
@


1.44
log
@• after seeing a good rationale, change the recommendation for space
  after the 「sizeof」 keyword (Bill Shannon mode) back to off: it’s
  more of a unary operator than a C keyword which was pointed out to
  me by other OS’ style guides which also mention 「typeof」 and si-
  milar compiler-specific extensions for which the same rule applies
• install .indent.pro into the user skeleton
• apply politure to style(9) while here
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.43 2008/11/30 16:09:03 tg Exp $
d12 2
a13 2
BIN1=	anacron ccd.conf changelist cronrun daily dhclient.conf dhcpd.conf \
	dhcpd.interfaces etc.${MACHINE}/disktab exports \
d232 1
a232 1
		echo '# $$MirOS: src/etc/Makefile,v 1.43 2008/11/30 16:09:03 tg Exp $$'; \
@


1.43
log
@better perms
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.42 2008/06/27 21:03:59 tg Exp $
d135 1
a135 1
.  for _i in lib/libssl bin/mksh usr.bin/mail usr.bin/ssh
d232 1
a232 1
		echo '# $$MirOS: src/etc/Makefile,v 1.42 2008/06/27 21:03:59 tg Exp $$'; \
@


1.42
log
@• make sysctl.conf a BINMD file
• ease generation and installation of all these
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.41 2008/05/07 12:16:12 tg Exp $
d15 1
a15 1
	inetd.conf locate.rc login.conf \
a50 1
	chmod 640 ${DESTDIR}/etc/inetd.conf
d69 1
d232 1
a232 1
		echo '# $$MirOS: src/etc/Makefile,v 1.41 2008/05/07 12:16:12 tg Exp $$'; \
@


1.41
log
@remove all references to /root
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.40 2007/10/02 18:39:13 tg Exp $
d23 1
a23 1
BINMD=	make.cfg syslog.conf
d52 2
a53 12
	${SHELL} ttys.pty | cat etc.${MACHINE}/ttys - >${DESTDIR}/etc/ttys && \
	    chown ${BINOWN} ${DESTDIR}/etc/ttys && \
	    chgrp ${CONFGRP} ${DESTDIR}/etc/ttys && \
	    chmod 644 ${DESTDIR}/etc/ttys
	cat sysctl.conf etc.${MACHINE}/sysctl.conf >${DESTDIR}/etc/sysctl.conf && \
	    chown ${BINOWN} ${DESTDIR}/etc/sysctl.conf && \
	    chgrp ${CONFGRP} ${DESTDIR}/etc/sysctl.conf && \
	    chmod 644 ${DESTDIR}/etc/sysctl.conf
	cat fbtab.head etc.${MACHINE}/fbtab fbtab.tail >${DESTDIR}/etc/fbtab && \
	    chown ${BINOWN} ${DESTDIR}/etc/fbtab && \
	    chgrp ${CONFGRP} ${DESTDIR}/etc/fbtab && \
	    chmod 644 ${DESTDIR}/etc/fbtab
d58 1
a58 1
	    else \
d60 1
a60 4
	fi >${DESTDIR}/etc/${_i}; \
	    chown ${BINOWN} ${DESTDIR}/etc/${_i} && \
	    chgrp ${CONFGRP} ${DESTDIR}/etc/${_i} && \
	    chmod 644 ${DESTDIR}/etc/${_i}
d62 3
d232 1
a232 1
		echo '# $$MirOS: src/etc/Makefile,v 1.40 2007/10/02 18:39:13 tg Exp $$'; \
@


1.40
log
@no etc.ARCH/Makefile.inc any more
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.39 2007/10/02 18:26:27 tg Exp $
a83 1
	cd ${DESTDIR}/root; rm -f .profile; ln ${DESTDIR}/.profile
d242 1
a242 1
		echo '# $$MirOS: src/etc/Makefile,v 1.39 2007/10/02 18:26:27 tg Exp $$'; \
@


1.39
log
@get rid of snap_md
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.38 2007/06/16 22:57:29 tg Exp $
a7 4
.if exists(etc.${MACHINE}/Makefile.inc)
.  include "etc.${MACHINE}/Makefile.inc"
.endif

d243 1
a243 1
		echo '# $$MirOS: src/etc/Makefile,v 1.38 2007/06/16 22:57:29 tg Exp $$'; \
@


1.38
log
@add a script that runs daily/weekly/monthly on reboot + {15,30,45} minutes
if they haven't been run for 3 days over time

cronrun -l is for logging to syslog instead of mails, don't use ☺
cronrun -n is for recursive runs, don't use ☻
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.37 2007/06/16 22:36:48 tg Exp $
a172 3
snap_md:
# nothing here -- look in the machine-dependent Makefile.inc

d247 1
a247 1
		echo '# $$MirOS: src/etc/Makefile,v 1.37 2007/06/16 22:36:48 tg Exp $$'; \
d254 1
a254 1
.PHONY: all clean cleandir depend etc install lint etc-files snap_md \
@


1.37
log
@• rc: run post-install script earlier
• rc, post-install script, installer: run the script in the foreground,
  move the “newaliases” call into it and let the script fork its own
  background processes off
• cronrun: new, to be used to run daily/weekly/monthly with locking
• post-install, crontab: use cronrun
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.36 2007/06/12 22:11:36 tg Exp $
d16 1
a16 1
BIN1=	ccd.conf changelist cronrun daily dhclient.conf dhcpd.conf \
d250 1
a250 1
		echo '# $$MirOS: src/etc/Makefile,v 1.36 2007/06/12 22:11:36 tg Exp $$'; \
@


1.36
log
@style
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.35 2007/04/29 23:17:55 tg Exp $
d16 1
a16 1
BIN1=	ccd.conf changelist daily dhclient.conf dhcpd.conf \
d250 1
a250 1
		echo '# $$MirOS: src/etc/Makefile,v 1.35 2007/04/29 23:17:55 tg Exp $$'; \
@


1.35
log
@move the file src/etc/skel/ssh.known_hosts,v to src/etc/ssh_known_hosts,v
for reference: it contains a bunch of ssh host keys I've been authentica-
ting against for a while, but, other than the mirbsd boxen, I haven't yet
verified a single one out of these
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.34 2007/04/29 20:23:09 tg Exp $
d74 1
a74 1
	  fi >${DESTDIR}/etc/${_i}; \
d250 1
a250 1
		echo '# $$MirOS: src/etc/Makefile,v 1.34 2007/04/29 20:23:09 tg Exp $$'; \
@


1.34
log
@merge openssh
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.33 2007/04/16 18:54:37 tg Exp $
a89 2
		${INSTALL} -c -o root -g wheel -m 644 ssh.known_hosts \
		    ${DESTDIR}/etc/ssh/ssh_known_hosts; \
d169 2
d250 1
a250 1
		echo '# $$MirOS: src/etc/Makefile,v 1.33 2007/04/16 18:54:37 tg Exp $$'; \
@


1.33
log
@• from a MirOS point of view:
  place most stuff from /etc/profile in /etc/skel/.mkshrc; admins must make
  sure to copy this file to users' homes on upgrade (benefit: non-login but
  interactive shells also get all the goodies); fix some quoting; simplify,
  reformat, change comments
• from an mksh point of view:
  slight internal changes in dot.mkshrc; external commands are now prefixed
  with “ulimit -c 0”; $TERM is defined; improvement in determining the host
  name (e.g. on Debian if a FQDN is not given); declare locals as such both
  in $PS1 and outside; remove superfluous quoting, quote properly; simplify
  hd alias, add rot13 alias; place RCS ID at the bottom
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.32 2007/04/16 17:37:08 tg Exp $
d91 1
a91 3
		    ${DESTDIR}/root/.etc/ssh/known_hosts; \
		${INSTALL} -c -o root -g wheel -m 644 ssh.known_hosts \
		    ${DESTDIR}/etc/skel/.etc/ssh/known_hosts; \
d250 1
a250 1
		echo '# $$MirOS: src/etc/Makefile,v 1.32 2007/04/16 17:37:08 tg Exp $$'; \
@


1.32
log
@consolidate
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.31 2007/03/09 13:05:10 tg Exp $
d154 1
a154 1
.  for _i in lib/libssl usr.bin/mail usr.bin/ssh
d252 1
a252 1
		echo '# $$MirOS: src/etc/Makefile,v 1.31 2007/03/09 13:05:10 tg Exp $$'; \
@


1.31
log
@sync spamd upgrades and libpcap, and some /etc stuff; read
• http://undeadly.org/cgi?action=article&sid=20070304035922&mode=expanded
• http://www.openbsd.org/faq/current.html#20070226
for details. In short:
• change rc.conf[.local]
• spamd.conf now lies in /etc/mail/
• greylisting is on by default
• the database has a new format
• there's some database sync stuff
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.30 2006/11/17 13:58:12 tg Exp $
d44 1
d149 1
a149 1
.  if defined(SKIPDIR) && ${SKIPDIR:Mgnu/usr.sbin/sendmail}
d154 3
a156 2
	cd ../usr.bin/ssh && exec ${MAKE} distribution
	cd ../lib/libssl && exec ${MAKE} distribution
d158 2
a159 2
.    for _i in usr.sbin/httpd gnu/usr.bin/lynx
.      if defined(SKIPDIR) && ${SKIPDIR:M${_i}}
d162 2
a163 1
	cd ../${_i} && exec ${MAKE} -f Makefile.bsd-wrapper distribution
a166 8
	cd ../usr.bin/mail && exec ${MAKE} distribution
.  if ${CROSS_MODE:L} != "yes"
.    if defined(SKIPDIR) && ${SKIPDIR:Mgnu/usr.bin/anoncvs}
	@@echo "Warning: skipping anoncvs"
.    else
	cd ../gnu/usr.bin/anoncvs && exec ${MAKE} distribution
.    endif
.  endif
d252 1
a252 1
		echo '# $$MirOS: src/etc/Makefile,v 1.30 2006/11/17 13:58:12 tg Exp $$'; \
@


1.30
log
@ifstated is obsolete
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.29 2006/10/28 21:27:13 tg Exp $
d24 1
a24 2
	rpc security sensorsd.conf services shells spamd.conf \
	weekly wsconsctl.conf
d173 1
a173 1
		${DESTDIR}/etc/sudoers
d175 3
a177 1
		chown ${BINOWN}:${CONFGRP} * && chmod 444 *
d257 1
a257 1
		echo '# $$MirOS: src/etc/Makefile,v 1.29 2006/10/28 21:27:13 tg Exp $$'; \
@


1.29
log
@a few more perms issues
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.28 2006/10/28 20:07:01 tg Exp $
d19 1
a19 1
	ifstated.conf inetd.conf locate.rc login.conf \
d256 1
a256 1
		echo '# $$MirOS: src/etc/Makefile,v 1.28 2006/10/28 20:07:01 tg Exp $$'; \
@


1.28
log
@permissions
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.27 2006/10/28 19:54:55 tg Exp $
d141 1
a141 1
	${INSTALL} -c -o ${BINOWN} -g wheel -m 664 /dev/null \
d256 1
a256 1
		echo '# $$MirOS: src/etc/Makefile,v 1.27 2006/10/28 19:54:55 tg Exp $$'; \
@


1.27
log
@use CONFGRP
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.26 2006/10/15 02:11:38 tg Exp $
d84 1
a84 1
	${INSTALL} -c -o root -g wheel -m 600 pf.conf ${DESTDIR}/etc/
d143 1
a143 1
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
d256 1
a256 1
		echo '# $$MirOS: src/etc/Makefile,v 1.26 2006/10/15 02:11:38 tg Exp $$'; \
@


1.26
log
@mtree says, /.profile and /root/.profile are root:staff
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.25 2006/09/24 18:13:38 tg Exp $
a15 1
BINGRP=	wheel
d54 1
a54 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 644 ${BIN1} ${DESTDIR}/etc/
d58 1
a58 1
	    chgrp ${BINGRP} ${DESTDIR}/etc/ttys && \
d62 1
a62 1
	    chgrp ${BINGRP} ${DESTDIR}/etc/sysctl.conf && \
d66 1
a66 1
	    chgrp ${BINGRP} ${DESTDIR}/etc/fbtab && \
d76 1
a76 1
	    chgrp ${BINGRP} ${DESTDIR}/etc/${_i} && \
d79 1
a79 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 664 ${BIN2} ${DESTDIR}/etc/
d176 1
a176 1
		chown ${BINOWN}:${BINGRP} * && chmod 444 *
d245 1
a245 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 644 \
d256 1
a256 1
		echo '# $$MirOS: src/etc/Makefile,v 1.25 2006/09/24 18:13:38 tg Exp $$'; \
@


1.25
log
@* nuke root mail (ok bsiegert@@)
* simplify root .profile and secure it
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.24 2006/06/17 21:37:44 tg Exp $
d88 1
a88 1
	${INSTALL} -c -o root -g staff -m 600 root.profile ${DESTDIR}/.profile
d257 1
a257 1
		echo '# $$MirOS: src/etc/Makefile,v 1.24 2006/06/17 21:37:44 tg Exp $$'; \
@


1.24
log
@amd64 bit the dust
don't even pretend we would as few as have kept it in sync
with other changes in the system

also, we can't support it because we don't have the boxen,
we would like to support it if we had developers' time, but
as it's now, I'm overloaded even with i386, and I've got to
take care of sparc as well, so we limit ourselves to that.
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.23 2006/06/17 16:21:18 tg Exp $
d88 2
a89 5
	cd root; \
		${INSTALL} -c -o root -g wheel -m 644 dot.profile \
		    ${DESTDIR}/root/.profile; \
		rm -f ${DESTDIR}/.profile; \
		ln ${DESTDIR}/root/.profile ${DESTDIR}/.profile
a173 2
	${INSTALL} -c -o root -g wheel -m 600 root/root.mail \
		${DESTDIR}/var/mail/root
d257 1
a257 1
		echo '# $$MirOS: src/etc/Makefile,v 1.23 2006/06/17 16:21:18 tg Exp $$'; \
@


1.23
log
@skip some dirs in cross mode here, too
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.22 2006/06/17 00:45:00 tg Exp $
a187 1
MAKEDEVARCHS+= amd64
d262 1
a262 1
		echo '# $$MirOS: src/etc/Makefile,v 1.22 2006/06/17 00:45:00 tg Exp $$'; \
@


1.22
log
@install ssh known_hosts for root, too.
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.21 2006/04/13 01:55:30 tg Exp $
d160 3
a162 2
.  for _i in usr.sbin/httpd gnu/usr.bin/lynx
.    if defined(SKIPDIR) && ${SKIPDIR:M${_i}}
d164 1
a164 1
.    else
d166 3
a168 2
.    endif
.  endfor
d170 2
a171 1
.  if defined(SKIPDIR) && ${SKIPDIR:Mgnu/usr.bin/anoncvs}
d173 1
a173 1
.  else
d175 1
d263 1
a263 1
		echo '# $$MirOS: src/etc/Makefile,v 1.21 2006/04/13 01:55:30 tg Exp $$'; \
@


1.21
log
@default to use 'all' calendar
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.20 2006/04/12 11:59:20 tg Exp $
d95 2
d259 1
a259 1
		echo '# $$MirOS: src/etc/Makefile,v 1.20 2006/04/12 11:59:20 tg Exp $$'; \
@


1.20
log
@* by request of bsiegert@@ do not use lightgrey-on-black with
  ISO-8859-1 (i.e. "standard") XTerms, only UXTerms
* enable default ~/.Xresources

grumpingly agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.19 2006/03/29 13:37:34 tg Exp $
d96 2
d257 1
a257 1
		echo '# $$MirOS: src/etc/Makefile,v 1.19 2006/03/29 13:37:34 tg Exp $$'; \
@


1.19
log
@* rework root .profile (the part which is only run in /etc/profile has
  not run - make it really a sort of "worst case" initialisation)
* fix sh(1) compatibility
* remove user .profile, we rely on /etc/profile now, it was a no-op
  anyway, and users who want it can just create it themselves
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.18 2006/02/14 20:47:53 tg Exp $
d96 2
d255 1
a255 1
		echo '# $$MirOS: src/etc/Makefile,v 1.18 2006/02/14 20:47:53 tg Exp $$'; \
@


1.18
log
@restructure build system for better restartability,
move things to proper places, ensure root-only-access
to .buildnotice hack file, fix a few problems (using
${BSDMAKE} in gcc/Makefile, including wrong files),
use ${SUDO} on different places, ensure DESTDIR is
always correct on make build, move most of the former
'release' targets from src/etc/Makefile to src/Makefile
and remove associated targets in src/etc/Makefile; sync
list of phony targets in both; copy out common code in
distrib/i386/generic/Makefile, distrib/i386/common/Makefile.inc
into new distrib/i386/generic/Makefile.kernel, remove
unused target 'includes' in src/Makefile, rewrite the
distrib-dirs target, shuffle the creation and removal
of the systrace files around, build HTML manual pages
under systrace(1) control, auto-remove tmp buildhome,
check HOME makeenv/environment sync and being tmp, fix
index/checksum file generation, maybe more (read the diff)

untested
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.17 2006/01/04 02:15:12 tg Exp $
d97 1
a97 3
		    ${DESTDIR}/etc/skel/.mailrc; \
		${INSTALL} -c -o root -g wheel -m 644 dot.profile \
		    ${DESTDIR}/etc/skel/.profile
d253 1
a253 1
		echo '# $$MirOS: src/etc/Makefile,v 1.17 2006/01/04 02:15:12 tg Exp $$'; \
@


1.17
log
@sync
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.16 2006/01/03 03:54:56 tg Exp $
d49 4
a52 17
distrib-dirs:
.ifdef DESTDIR
	if [ ! -d ${DESTDIR}/. ]; then \
		${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}; \
	fi
.endif
	mtree -qdef mtree/4.4BSD.dist -p ${DESTDIR}/ -U
	cd ${DESTDIR}/var/anoncvs/anoncvs; rm -f usr var; ln -s . var
	for i in ${DESTDIR}/usr/{ports,src}; do \
		[[ -d $$i ]] || ${INSTALL} -d -o root -g wsrc -m 775 $$i; \
	done
	cd ${DESTDIR}/; rm -f sys; ln -s usr/src/sys sys

.ifndef DESTDIR
distribution-etc-root-var distribution release snapshot:
	@@echo setenv DESTDIR before doing that!
	@@false
d54 1
a54 1
distribution-etc-root-var: distrib-dirs
d175 1
a175 31

distribution:
	exec ${SUDO} ${_STCMD_DEST} ${MAKE} distribution-etc-root-var
	cd .. && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install

release: distribution snap_pre snap_md
	@@cd ${.CURDIR} && ${MAKE} release-finish DESTDIR="${DESTDIR}"

release-finish:
	cd ${DESTDIR}/snapshot && [[ ! -e bsd.rd ]] || ${SUDO} gzip -n9 bsd.rd
	-cd ${DESTDIR}/snapshot; for f in bsd* *boot* *BOOT* cd*.iso \
	    *.fs *.fs.gz; do test ! -e $$f || \
		${SUDO} cp $$f ${BSDRELDIR}/rel; \
	 done
	cd ${BSDRELDIR}/rel && [[ ! -e bsd.rd.gz ]] || \
	    ${SUDO} mv bsd.rd.gz bsd.rd
.  ifdef MACHINE_HAS_TOOLS
	${SUDO} mkdir -p ${BSDRELDIR}/rel/tools
	${SUDO} cp ${DESTDIR}/snapshot/tools/* ${BSDRELDIR}/rel/tools/
	cd ${BSDRELDIR}/rel && cksum tools/* | ${SUDO} tee -a CKSUM
	cd ${BSDRELDIR}/rel && rmd160 tools/* | ${SUDO} tee -a RMD160
.  endif
	@@if [[ -s /var/tmp/.buildnotice ]]; then \
		cat /var/tmp/.buildnotice; \
		. /var/tmp/.buildnotice; \
		rm -f /var/tmp/.buildnotice || true; \
	fi

snap_pre:
	${SUDO} /bin/rm -rf ${DESTDIR}/snapshot
	${SUDO} ${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}/snapshot
a179 2
.endif	# DESTDIR check

a212 6
distrib:
	cd ${.CURDIR}/.. && ${MAKE} mksystrace-dest
	cd ${.CURDIR}/../distrib \
	    && ${_STCMD_OBJ} ${MAKE} \
	    && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install

d255 1
a255 1
		echo '# $$MirOS: src/etc/Makefile,v 1.16 2006/01/03 03:54:56 tg Exp $$'; \
d262 3
a264 3
.PHONY: distribution-etc-root-var distribution distrib-dirs release \
	make-generated clean-generated install-generated update-moduli \
	release-finish snapshot allarchs snap_pre snap_tar snap_md m4
@


1.16
log
@* /var/cron/log is unused
* rotate wtmp only once per month (on the 1st at midnight)
* fix login accounting (to look at the wtmp of last month)
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.15 2005/12/24 02:33:16 tg Exp $
d197 1
a197 1
	cd ${DESTDIR}/snapshot && [[ ! -e bsd.rd ]] || gzip -n9 bsd.rd
d202 2
a203 1
	cd ${BSDRELDIR}/rel && [[ ! -e bsd.rd.gz ]] || mv bsd.rd.gz bsd.rd
d306 1
a306 1
		echo '# $$MirOS: src/etc/Makefile,v 1.15 2005/12/24 02:33:16 tg Exp $$'; \
@


1.15
log
@emit a compressed bsd.rd file... our CD bootloader has troubles
booting the uncompressed 10 MB blob
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.14 2005/12/16 23:40:14 tg Exp $
a149 2
	${INSTALL} -c -o root -g wheel -m 600 /dev/null \
		${DESTDIR}/var/cron/log
d305 1
a305 1
		echo '# $$MirOS: src/etc/Makefile,v 1.14 2005/12/16 23:40:14 tg Exp $$'; \
@


1.14
log
@we no longer need the legacy /var/anoncvs/anoncvs/usr symlink to .
in new installations (anoncvssh still supports i tin legacy setups)
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.13 2005/12/04 17:20:45 tg Exp $
d199 1
d204 1
d307 1
a307 1
		echo '# $$MirOS: src/etc/Makefile,v 1.13 2005/12/04 17:20:45 tg Exp $$'; \
@


1.13
log
@symlinks can only be created if they don't exist...
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.12 2005/09/23 10:52:51 tg Exp $
d56 1
a56 2
	cd ${DESTDIR}/var/anoncvs/anoncvs; \
		rm -f usr var; ln -s . usr; ln -s . var
d305 1
a305 1
		echo '# $$MirOS: src/etc/Makefile,v 1.12 2005/09/23 10:52:51 tg Exp $$'; \
@


1.12
log
@same for anoncvs/var (tmp)
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.11 2005/09/23 10:51:04 tg Exp $
d56 2
a57 1
	cd ${DESTDIR}/var/anoncvs/anoncvs; ln -s . usr; ln -s . var
d306 1
a306 1
		echo '# $$MirOS: src/etc/Makefile,v 1.11 2005/09/23 10:51:04 tg Exp $$'; \
@


1.11
log
@/var/anoncvs/anoncvs/usr is now a symbolic link to /var/anoncvs/anoncvs
since all we ever needed anyway was CHROOT/usr/bin/{cvs,rsync}.
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.10 2005/08/21 11:45:38 tg Exp $
d56 1
a56 1
	cd ${DESTDIR}/var/anoncvs/anoncvs; ln -s . usr
d305 1
a305 1
		echo '# $$MirOS: src/etc/Makefile,v 1.10 2005/08/21 11:45:38 tg Exp $$'; \
@


1.10
log
@mk.conf -> make.cfg (uses basename of $MAKE, for portable mirmake's sake)
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.9 2005/07/24 15:45:28 tg Exp $
d56 1
d305 1
a305 1
		echo '# $$MirOS: src/etc/Makefile,v 1.9 2005/07/24 15:45:28 tg Exp $$'; \
@


1.9
log
@merge [A-Za-p] and improve where possible/necessary
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.8 2005/07/06 18:34:10 tg Exp $
d29 1
a29 1
BINMD=	mk.conf syslog.conf
d304 1
a304 1
		echo '# $$MirOS: src/etc/Makefile,v 1.8 2005/07/06 18:34:10 tg Exp $$'; \
@


1.8
log
@nothing uses BSD.local.dist any more
@
text
@d1 2
a2 2
# $MirOS: src/etc/Makefile,v 1.7 2005/07/04 12:43:41 tg Exp $
# $OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $
d15 7
a21 6
BINOWN= root
BINGRP= wheel
BIN1=	changelist ccd.conf \
	daily dhcpd.conf dhcpd.interfaces exports ftpusers \
	ftpchroot gettytab group hosts hosts.lpd inetd.conf \
	locate.rc man.conf monthly motd mrouted.conf \
d23 4
a26 4
	phones printcap protocols rbootd.conf rc rc.conf rc.local \
	rc.securelevel rc.shutdown remote rpc security services \
	shells spamd.conf weekly etc.${MACHINE}/disktab profile \
	dhclient.conf mailer.conf wsconsctl.conf
d69 1
a69 1
	cat etc.${MACHINE}/ttys ttys.pty >${DESTDIR}/etc/ttys && \
a94 1
	${INSTALL} -c -o root -g wheel -m 644 login.conf ${DESTDIR}/etc/
a96 2
	${INSTALL} -c -o root -g wheel -m 644 moduli ${DESTDIR}/etc/
	${INSTALL} -c -o root -g wheel -m 600 bgpd.conf ${DESTDIR}/etc/
a97 2
	${INSTALL} -c -o root -g wheel -m 644 pf.os ${DESTDIR}/etc/
	${INSTALL} -c -o root -g wheel -m 644 sensorsd.conf ${DESTDIR}/etc/
d212 1
a212 1
	 fi
a258 1
	    && ${_STCMD_OBJ} ${MAKE} cleandir \
d303 2
a304 3
	( \
		echo '#    $$MirOS: src/etc/Makefile,v 1.7 2005/07/04 12:43:41 tg Exp $$'; \
		echo '#    $$OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $$'; \
d306 1
a306 1
		( for i in ${DHSIZE}; do \
d308 2
a309 3
		done) | \
		ssh-keygen -T /dev/stdout \
	) >moduli
@


1.7
log
@nothing uses /etc/ksh.kshrc
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.6 2005/06/26 18:07:53 tg Exp $
a119 2
		    ${DESTDIR}/etc/mtree/; \
		${INSTALL} -c -o root -g wheel -m 444 BSD.local.dist \
d309 1
a309 1
		echo '#    $$MirOS: src/etc/Makefile,v 1.6 2005/06/26 18:07:53 tg Exp $$'; \
@


1.6
log
@bye bye, macppc
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.5 2005/04/20 06:18:06 tg Exp $
d20 1
a20 1
	ksh.kshrc locate.rc man.conf monthly motd mrouted.conf \
d311 1
a311 1
		echo '#    $$MirOS: src/etc/Makefile,v 1.5 2005/04/20 06:18:06 tg Exp $$'; \
@


1.5
log
@get rid of ${RELEASEDIR} altogether
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.4 2005/04/19 12:53:46 tg Exp $
a230 1
MAKEDEVARCHS+= macppc
d311 1
a311 1
		echo '#    $$MirOS: src/etc/Makefile,v 1.4 2005/04/19 12:53:46 tg Exp $$'; \
@


1.4
log
@make the overall build process more similar to a build.sh and have a
common framework, with ======== lines and stuff, and the checkflist
and maketars stuff only executed at the end of the whole make dist
(this means they are not built any more with a make b-r, I know).
This also unifies the set generation, runs cksum and rmd160 only
once and makes an unattended non-quiet build possible.
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.3 2005/03/29 00:12:14 tg Exp $
a199 5
.  ifndef RELEASEDIR
release:
	@@echo setenv RELEASEDIR before building a release.
	@@false
.  else
d201 1
a201 2
	@@cd ${.CURDIR} && ${MAKE} release-finish DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}"
d206 1
a206 1
		${SUDO} cp $$f ${RELEASEDIR}; \
d208 6
a213 6
.    ifdef MACHINE_HAS_TOOLS
	${SUDO} mkdir -p ${RELEASEDIR}/tools
	${SUDO} cp ${DESTDIR}/snapshot/tools/* ${RELEASEDIR}/tools
	cd ${RELEASEDIR} && cksum tools/* | ${SUDO} tee -a CKSUM
	cd ${RELEASEDIR} && rmd160 tools/* | ${SUDO} tee -a RMD160
.    endif
a218 1
.  endif
d312 1
a312 1
		echo '#    $$MirOS: src/etc/Makefile,v 1.3 2005/03/29 00:12:14 tg Exp $$'; \
@


1.3
log
@WAIT_CHECKFLIST => BATCH and reverse logic
default is now an interactive b-r
@
text
@d1 1
a1 1
# $MirOS: src/etc/Makefile,v 1.2 2005/03/06 19:05:53 tg Exp $
a205 13
	@@echo "============================================================"
	@@echo "Checking files:"
	@@echo ""
	-cd ${.CURDIR}/../distrib/lists/base && DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}" ${SUDO} ${SHELL} \
	    ${BSDSRCDIR}/scripts/tarck
	@@echo "============================================================"
.    ifndef BATCH
	@@read a?'Press Return to continue...'
.    endif
	cd ${.CURDIR}/../distrib/lists/base && DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}" ${SUDO} ${SHELL} \
	    ${BSDSRCDIR}/scripts/tarmk ${OSrev}
a219 4
	-cd ${RELEASEDIR}; cksum bsd!(*.gz) *boot* *BOOT* *.fs \
	    *.iso *.gz *.ngz | cat - CKSUM | ${SUDO} sort -k3 -o CKSUM
	-cd ${RELEASEDIR}; rmd160 bsd!(*.gz) *boot* *BOOT* *.fs \
	    *.iso *.gz *.ngz | cat - RMD160 | ${SUDO} sort -o RMD160
d319 1
a319 1
		echo '#    $$MirOS: src/etc/Makefile,v 1.2 2005/03/06 19:05:53 tg Exp $$'; \
@


1.2
log
@merge src/etc minus generated files
@
text
@d1 1
a1 1
# $MirOS$
d213 1
a213 1
.    ifdef WAIT_CHECKFLIST
d336 1
a336 1
		echo '#    $$MirOS$$'; \
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $
d5 2
a6 3
LOCALTIME=	Canada/Mountain

NOOBJ=	oobj
d9 1
a9 1
.include "etc.${MACHINE}/Makefile.inc"
d12 2
d17 12
a28 15
BIN1=	changelist ccd.conf csh.cshrc csh.login csh.logout daily dhcpd.conf \
	dhcpd.interfaces exports ftpusers ftpchroot gettytab group hosts \
	hosts.lpd inetd.conf ksh.kshrc locate.rc man.conf monthly motd \
	mrouted.conf myname netstart networks newsyslog.conf phones printcap \
	protocols rbootd.conf rc rc.conf rc.local rc.securelevel rc.shutdown \
	remote rpc security services shells spamd.conf syslog.conf weekly \
	etc.${MACHINE}/disktab dhclient.conf mailer.conf

.if ${MACHINE} == "alpha" || ${MACHINE} == "amd64" || \
    ${MACHINE} == "cats" || ${MACHINE} == "hppa" || \
    ${MACHINE} == "i386" || ${MACHINE} == "luna88k" || \
    ${MACHINE} == "macppc" || ${MACHINE} == "sparc" || \
    ${MACHINE} == "sparc64"
BIN1+=	wsconsctl.conf
.endif
a32 5
NAMEDB=	localhost.rev localhost.v6.rev localhost.zone root.cache
PCS=	pcs750.bin
WCS1=	wcs fppwcs poc poc1 poc2 fppoc
WCS2=	fpevent fppwcs fppwcs_dual hdcwcs load_diags start_fpp wcs wcs_dual

d48 12
d61 1
a61 1
distribution-etc-root-var distribution distrib-dirs release snapshot:
d66 3
a68 2
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 644 ${BIN1} ${DESTDIR}/etc
	cat etc.${MACHINE}/ttys ttys.pty > ${DESTDIR}/etc/ttys && \
d72 1
a72 1
	cat sysctl.conf etc.${MACHINE}/sysctl.conf > ${DESTDIR}/etc/sysctl.conf && \
d76 1
a76 1
	cat fbtab.head etc.${MACHINE}/fbtab fbtab.tail > ${DESTDIR}/etc/fbtab && \
d80 13
a92 2
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 664 ${BIN2} ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 hosts.equiv ${DESTDIR}/etc
d94 2
a95 2
	${INSTALL} -c -o root -g wheel -m 644 login.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 master.passwd ${DESTDIR}/etc
d97 5
a101 5
	${INSTALL} -c -o root -g wheel -m 644 moduli ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 bgpd.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 pf.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 644 pf.os ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 644 sensorsd.conf ${DESTDIR}/etc
d103 1
a103 1
	    etc.${MACHINE}/MAKEDEV ${DESTDIR}/dev
a104 6
		${INSTALL} -c -o root -g wheel -m 644 dot.cshrc \
		    ${DESTDIR}/root/.cshrc; \
		${INSTALL} -c -o root -g wheel -m 600 dot.klogin \
		    ${DESTDIR}/root/.klogin; \
		${INSTALL} -c -o root -g wheel -m 644 dot.login \
		    ${DESTDIR}/root/.login; \
d107 1
a107 2
		rm -f ${DESTDIR}/.cshrc ${DESTDIR}/.profile; \
		ln ${DESTDIR}/root/.cshrc ${DESTDIR}/.cshrc; \
d110 2
a111 4
		${INSTALL} -c -o root -g wheel -m 644 dot.cshrc \
		    ${DESTDIR}/etc/skel/.cshrc; \
		${INSTALL} -c -o root -g wheel -m 644 dot.login \
		    ${DESTDIR}/etc/skel/.login; \
a115 8
	cd kerberosV; \
		${INSTALL} -c -o root -g wheel -m 644 README \
		    ${DESTDIR}/etc/kerberosV; \
		${INSTALL} -c -o root -g wheel -m 644 krb5.conf.example \
		    ${DESTDIR}/etc/kerberosV
	cd amd; \
		${INSTALL} -c -o root -g wheel -m 644 master.sample \
		    ${DESTDIR}/etc/amd
d118 1
a118 1
		    ${DESTDIR}/etc/mtree; \
d120 1
a120 1
		    ${DESTDIR}/etc/mtree; \
d122 1
a122 3
		    ${DESTDIR}/etc/mtree; \
		${INSTALL} -c -o root -g wheel -m 444 BSD.x11.dist \
		    ${DESTDIR}/etc/mtree
d124 10
a133 31
		${INSTALL} -c -o root -g wheel -m 600 chap-secrets \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 options \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 options.leaf \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 options.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 chatscript.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 pap-secrets \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 ppp.conf.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.linkup.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.linkdown.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.secret.sample \
		    ${DESTDIR}/etc/ppp
	cd afs; \
		${INSTALL} -c -o root -g wheel -m 644 afsd.conf \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 ThisCell \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 CellServDB \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 SuidCells \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 README \
		    ${DESTDIR}/etc/afs
d136 1
a136 18
		    ${DESTDIR}/etc/systrace; \
		${INSTALL} -c -o root -g wheel -m 600 usr_sbin_named \
		    ${DESTDIR}/etc/systrace;
	cd bind; \
		${INSTALL} -c -o root -g named -m 640 named-simple.conf \
		    ${DESTDIR}/var/named/etc/named.conf; \
		${INSTALL} -c -o root -g named -m 640 named-*.conf \
		    ${DESTDIR}/var/named/etc; \
		${INSTALL} -c -o root -g wheel -m 644 db.localhost \
		    ${DESTDIR}/var/named/standard/localhost; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback \
		    ${DESTDIR}/var/named/standard/loopback; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback6.arpa \
		    ${DESTDIR}/var/named/standard/loopback6.arpa; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback6.int \
		    ${DESTDIR}/var/named/standard/loopback6.int; \
		${INSTALL} -c -o root -g wheel -m 644 root.hint \
		    ${DESTDIR}/var/named/standard; \
d142 1
a142 1
		${DESTDIR}/var/crash
d145 6
a159 14
		${DESTDIR}/var/log/authlog
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/daemon
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/failedlogin
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/ftpd
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
		${DESTDIR}/var/log/lastlog
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/lpd-errs
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/maillog
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
a160 2
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/secure
a164 2
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/xferlog
d169 3
a171 6
.if ${MACHINE} == "vax"
	uudecode -p etc.vax/${PCS}.uu > ${DESTDIR}/${PCS} && \
	    chown ${BINOWN} ${DESTDIR}/${PCS} && \
	    chgrp ${BINGRP} ${DESTDIR}/${PCS} && \
	    chmod 644 ${DESTDIR}/${PCS}
.endif
d173 1
a173 1
	cd ../usr.sbin/ypserv/ypinit && exec ${MAKE} distribution
a174 1
	cd ../usr.sbin/httpd && exec ${MAKE} -f Makefile.bsd-wrapper distribution
d176 7
a182 1
	cd ../gnu/usr.bin/lynx && exec ${MAKE} -f Makefile.bsd-wrapper distribution
d184 5
a188 1
	cd mail && exec ${MAKE} distribution
d193 2
d197 2
a198 12
	exec ${SUDO} ${MAKE} distribution-etc-root-var
	cd .. && exec ${SUDO} ${MAKE} install

distrib-dirs:
	if [ ! -d ${DESTDIR}/. ]; then \
		${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}; \
	fi
	mtree -qdef mtree/4.4BSD.dist -p ${DESTDIR}/ -U
	if [ ! -d ${DESTDIR}/usr/src ]; then \
		${INSTALL} -d -o root -g wsrc -m 775 ${DESTDIR}/usr/src; \
	fi
	cd ${DESTDIR}/; rm -f sys; ln -s usr/src/sys sys
d200 1
a200 1
.ifndef RELEASEDIR
d204 1
a204 1
.else
d206 37
a242 27
	cd ${.CURDIR}/../distrib/notes && ${MAKE} && exec ${SUDO} ${MAKE} install
	cd ${.CURDIR}/../distrib/sets && exec ${SUDO} sh maketars ${OSrev}
	-cp ${DESTDIR}/snapshot/bsd* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*boot* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*BOOT* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/cd*.iso ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/INSTALL.* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*.fs ${DESTDIR}/snapshot/*.fs.gz ${RELEASEDIR}
	-cd ${RELEASEDIR}; \
		md5 bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
		    > MD5
	-cd ${RELEASEDIR}; \
		cksum bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
		    > CKSUM
.if defined(MACHINE_HAS_TOOLS)
	mkdir -p ${RELEASEDIR}/tools
	cp ${DESTDIR}/snapshot/tools/* ${RELEASEDIR}/tools
	cd ${RELEASEDIR} && md5 tools/* >>MD5
	cd ${RELEASEDIR} && cksum tools/* >>CKSUM
.endif
	-cd ${RELEASEDIR} && sort -o MD5 MD5
	-cd ${RELEASEDIR} && sort -o CKSUM -k 3 CKSUM
.endif

snapshot: distribution snap_pre snap_tar snap_md
	cd ${DESTDIR}/snapshot && cksum * > CKSUMS
	cd ${DESTDIR}/snapshot && md5 * > MD5
a247 31
snap_tar:
	cd ${DESTDIR} && tar cf - bin \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/bin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - dev \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/dev.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - .profile .cshrc altroot etc home mnt \
	    root stand sys tmp | ${GZIP} ${GZIPFLAGS} \
	    > snapshot/etc.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - sbin \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/sbin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/bin \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.bin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/games \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.games.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/include \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.include.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/lib \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.lib.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/libexec \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.libexec.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/mdec usr/libdata usr/lkm usr/local \
	    usr/src usr/obj | ${GZIP} ${GZIPFLAGS} \
	    > snapshot/usr.misc.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/sbin \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.sbin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/share \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.share.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - var \
	    | ${GZIP} ${GZIPFLAGS} > snapshot/var.tar${GZIPEXT}
	cd ../distrib/notes; ${MAKE}; ${MAKE} install

a252 1
MAKEDEVARCHS+= alpha
a253 3
MAKEDEVARCHS+= cats
MAKEDEVARCHS+= hp300
MAKEDEVARCHS+= hppa
a254 2
MAKEDEVARCHS+= luna88k
MAKEDEVARCHS+= mac68k
a255 3
MAKEDEVARCHS+= mvme68k
MAKEDEVARCHS+= mvme88k
#MAKEDEVARCHS+= mvmeppc
a256 2
MAKEDEVARCHS+= sparc64
MAKEDEVARCHS+= vax
d268 1
a268 1
man: ${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8
d272 1
a272 1
	m4 -DMACHINE=${M} MAKEDEV.mi > etc.${M}/.MAKEDEV.tmp && \
d276 2
a277 3
${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8: ${MAKEDEVDOC} etc.${M}/MAKEDEV.md
	m4 -DMACHINE=${M} MAKEDEV.man > \
	    ${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8
d282 4
d288 44
a331 2
	cd ${.CURDIR}/../distrib && \
	    ${MAKE} cleandir && ${MAKE} && exec ${SUDO} ${MAKE} install
d333 1
a333 1
DHSIZE=1024 1536 2048 3072 4096
d336 1
d343 5
a347 1
	) > moduli
a348 2
.PHONY: distribution-etc-root-var distribution distrib-dirs \
	release snapshot allarchs snap_pre snap_tar snap_md m4
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.226 2005/05/26 23:06:06 mcbride Exp $
d21 1
a21 2
	etc.${MACHINE}/disktab dhclient.conf mailer.conf ntpd.conf \
	login.conf moduli pf.os sensorsd.conf ifstated.conf
d24 4
a27 5
    ${MACHINE} == "cats" || ${MACHINE} == "hp300" || \
    ${MACHINE} == "hppa" || ${MACHINE} == "hppa64" || \
    ${MACHINE} == "luna88k" || ${MACHINE} == "macppc" || \
    ${MACHINE} == "sparc" || ${MACHINE} == "sparc64" || \
    ${MACHINE} == "zaurus" || ${MACHINE} == "i386"
d61 1
a61 1
	ksh ttys.pty | cat etc.${MACHINE}/ttys - > ${DESTDIR}/etc/ttys && \
d76 1
d79 1
a80 1
	${INSTALL} -c -o root -g wheel -m 600 ospfd.conf ${DESTDIR}/etc
d82 2
a83 1
	${INSTALL} -c -o root -g wheel -m 600 hostapd.conf ${DESTDIR}/etc
d172 2
d261 1
a261 1
	-cp ${DESTDIR}/snapshot/*bsd* ${RELEASEDIR}
a262 1
	-cp ${DESTDIR}/snapshot/cdbr ${RELEASEDIR}
a264 1
	-cp ${DESTDIR}/snapshot/Packages ${RELEASEDIR}
d268 2
a269 2
		md5 *bsd!(*.gz) *boot* cdbr *BOOT* INSTALL.* Packages *.fs \
		*.iso *.gz *.tgz > MD5
d271 2
a272 2
		cksum *bsd!(*.gz) *boot* cdbr *BOOT* INSTALL.* Packages *.fs \
		*.iso *.gz *.tgz > CKSUM
a331 1
MAKEDEVARCHS+= hppa64
a338 1
MAKEDEVARCHS+= sgi
a341 1
MAKEDEVARCHS+= zaurus
d371 1
a371 1
	    ${MAKE} && exec ${SUDO} ${MAKE} install
d376 1
a376 1
		echo '#    $$OpenBSD: Makefile,v 1.226 2005/05/26 23:06:06 mcbride Exp $$'; \
@

