head	1.30;
access;
symbols
	MIRBSD_10:1.22.0.2
	MIRBSD_10_BASE:1.22
	MIRBSD_9_BASE:1.9
	MIRBSD_8:1.4.0.2
	MIRBSD_8_BASE:1.4;
locks; strict;
comment	@# @;


1.30
date	2017.04.08.16.05.43;	author tg;	state Exp;
branches;
next	1.29;
commitid	10058E90A645BB20D20;

1.29
date	2014.11.26.19.29.29;	author tg;	state Exp;
branches;
next	1.28;
commitid	10054762A213E06B080;

1.28
date	2011.12.31.00.24.40;	author tg;	state Exp;
branches;
next	1.27;
commitid	1004EFE563A21301EE9;

1.27
date	2009.07.18.14.09.03;	author tg;	state Exp;
branches;
next	1.26;
commitid	1004A61D73A7953CBB8;

1.26
date	2008.11.11.20.41.04;	author tg;	state Exp;
branches;
next	1.25;
commitid	1004919EDD87C8F9A0D;

1.25
date	2008.11.11.06.49.23;	author tg;	state Exp;
branches;
next	1.24;
commitid	10049192AF433A81CB0;

1.24
date	2008.11.10.20.43.06;	author tg;	state Exp;
branches;
next	1.23;
commitid	10049189CF038F460F4;

1.23
date	2008.03.27.14.09.08;	author tg;	state Exp;
branches;
next	1.22;
commitid	10047EBAA8F77F6311A;

1.22
date	2007.08.24.14.25.33;	author tg;	state Exp;
branches;
next	1.21;
commitid	10046CEEA1D199F064A;

1.21
date	2007.08.24.14.20.00;	author tg;	state Exp;
branches;
next	1.20;
commitid	10046CEE8E817DEC27F;

1.20
date	2007.01.26.02.03.34;	author tg;	state Exp;
branches;
next	1.19;
commitid	10045B9618807910F99;

1.19
date	2007.01.24.00.32.43;	author tg;	state Exp;
branches;
next	1.18;
commitid	10045B6A9341DEDD209;

1.18
date	2007.01.16.03.44.03;	author tg;	state Exp;
branches;
next	1.17;
commitid	10045AC49ED71E7CB81;

1.17
date	2006.10.16.13.28.00;	author tg;	state Exp;
branches;
next	1.16;
commitid	1004533888D7056F26A;

1.16
date	2006.09.30.23.11.12;	author tg;	state Exp;
branches;
next	1.15;
commitid	100451EF97B210B0D28;

1.15
date	2006.09.25.22.07.51;	author tg;	state Exp;
branches;
next	1.14;
commitid	1004518534040E49CE9;

1.14
date	2006.09.20.19.27.50;	author tg;	state Exp;
branches;
next	1.13;
commitid	1004511964D6EBE4C2E;

1.13
date	2006.09.20.19.26.49;	author tg;	state Exp;
branches;
next	1.12;
commitid	100451195FE092D5A41;

1.12
date	2006.08.11.13.47.56;	author tg;	state Exp;
branches;
next	1.11;
commitid	10044DC8AA06FEC9B61;

1.11
date	2006.07.26.22.42.12;	author tg;	state Exp;
branches;
next	1.10;
commitid	10044C7EFC225F44A35;

1.10
date	2006.06.30.17.01.09;	author tg;	state Exp;
branches;
next	1.9;
commitid	10044A558DC21CFDBAB;

1.9
date	2006.06.15.18.25.15;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004491A61A59C31B19;

1.8
date	2006.06.11.01.08.28;	author tg;	state Exp;
branches;
next	1.7;
commitid	100448B6D170B979B25;

1.7
date	2006.06.05.03.31.26;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004483A5A1457AA28C;

1.6
date	2006.02.03.20.23.42;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043E3BBDA0C96E495;

1.5
date	2006.01.31.11.43.39;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043DF4D7200C260F8;

1.4
date	2005.12.04.17.18.26;	author tg;	state Exp;
branches;
next	1.3;
commitid	1c1c439324f31302;

1.3
date	2005.10.21.20.00.11;	author tg;	state Exp;
branches;
next	1.2;
commitid	7c2f435948d43637;

1.2
date	2005.08.28.22.41.24;	author tg;	state Exp;
branches;
next	1.1;
commitid	14a543123d39f391;

1.1
date	2005.08.21.11.45.39;	author tg;	state Exp;
branches;
next	;
commitid	1c13430869647d4b;


desc
@@


1.30
log
@add -fverbose-asm and MD options to compile-to-.s by default
@
text
@# $MirSecuCron$
# $MirOS: src/etc/make.cfg,v 1.28 2011/12/31 00:24:40 tg Exp $
#@@@@MDPART@@@@
_DEFCOPTS:=	-Os -fweb -frename-registers -Wformat -Wstrict-aliasing \
		-Wbounded -fwrapv -fno-align-functions -fno-align-labels \
		-falign-loops=4 -falign-jumps=4 ${_DEFCOPTS} -fhonour-copts
_DEFCOPTS_llvm:=-O1 -Wformat -fwrapv -fno-strict-aliasing ${_DEFCOPTS_llvm}
_DEFCOPTS_pcc:=	-O ${_DEFCOPTS_pcc}
_DEFcTOsOPTS:=	-fverbose-asm ${_DEFcTOsOPTS} -S

# This is the MirMake configuration file for MirOS and MirPorts.
# This file is included by the system Makefile includes and contains
# selected default settings and modules which can be overridden, al-
# tered or activated unless $MAKECONF_OVERRIDE is set.
# *THIS IS A SAMPLE FILE*  Review it before changing.

### Set up sudo(8) first; use visudoers(8) and sudoers(5)
SUDO?=			sudo

### Remove support for shared libraries
#NOPIC=			yes

### make build release process
# Build no ramdisk/floppy/CD during make releaser
#REL_NO_GENERIC?=	yes	# no kernel (bsd)
#REL_NO_RAMDISK?=	yes	# no ramdisks, floppy, ISO

### debugging
# Set MKC_DEBG to enable debugging support
.if defined(MKC_DEBG) && ${MKC_DEBG:L} != "no"
_DEFCOPTS+=		-O1 -fno-web -fno-rename-registers \
			-fno-omit-frame-pointer -g3
DEBUG+=			-g
.  if ${MKC_DEBG:L:Mcpp}
CPPFLAGS+=		-DDEBUG
.  endif
.  if ${MKC_DEBG:L:Mgc-sections}
_DEFCOPTS:=		${_DEFCOPTS} -ffunction-sections -fdata-sections
LDFLAGS+=		-Wl,--gc-sections
.  endif
DEBUGLIBS=		Yes
INSTALL_STRIP=		#nothing
.endif

### Link Sendmail against extra software
#SENDMAIL_WANT_SASL?=	Yes	# SMTP AUTH, needs cyrus-sasl2 package
#SENDMAIL_WANT_LDAP?=	Yes	# LDAP support, needs OpenLDAP package

@


1.29
log
@remove MKC_USAP fully from the tree, we don’t deal with patents
@
text
@d9 1
@


1.28
log
@if not MKC_DEBG=no (default) it is now read as a set;
add gc-sections functionality in addition to cpp
@
text
@d2 1
a2 1
# $MirOS: src/etc/make.cfg,v 1.27 2009/07/18 14:09:03 tg Exp $
a43 5
### Patent issues
# Define this if you live in the United States of America. Note: we're
# not aware of all patents there, just RC5, MDC-2 and TrueType hinting
#MKC_USAP?=		yes	# default: No

@


1.27
log
@prevent data corruption from /etc/security’s automated backup cronjob
by using “MirSecuCron” as RCS ID for these and preventing it from ex-
panding any of the default keywords

also, add RCS IDs to almost all configuration files and enhance the
default changelist file
@
text
@d2 1
a2 1
# $MirOS: src/etc/make.cfg,v 1.26 2008/11/11 20:41:04 tg Exp $
d33 1
a33 1
.  if ${MKC_DEBG:L} == "cpp"
d36 4
@


1.26
log
@with -O2, this thing goes past the boundaries of ulimits even after
unlocking _all_ of them to the max on i386… so use -O1 which helps… some.
@
text
@d1 2
a2 1
# $MirOS: src/etc/make.cfg,v 1.25 2008/11/11 06:49:23 tg Exp $
@


1.25
log
@use -O2 not -Os, to make llvm-gcc a tad more stable, because at
theirs, nobody cares about the -Os case…
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.24 2008/11/10 20:43:06 tg Exp $
d6 1
a6 1
_DEFCOPTS_llvm:=-O2 -Wformat -fwrapv -fno-strict-aliasing ${_DEFCOPTS_llvm}
@


1.24
log
@somewhat sensible DEFCOPTS
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.23 2008/03/27 14:09:08 tg Exp $
d6 2
a7 2
_DEFCOPTS_llvm:=-Os -Wformat -fwrapv -fno-strict-aliasing ${_DEFCOPTS_llvm}
_DEFCOPTS_pcc:=	-Os ${_DEFCOPTS_pcc}
@


1.23
log
@we no longer have ${STATIC} now, /bin and /sbin are always
statically linked
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.22 2007/08/24 14:25:33 tg Exp $
d6 2
@


1.22
log
@revert the -std=gnu99–by–default change until programmes are ready, as this
is too much annoying (for now) – extra commit so that we have a changeset
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.21 2007/08/24 14:20:00 tg Exp $
d16 1
a16 6
### If you really, really want /bin and /sbin to depend on /usr/lib
# Note: this does not link _all_ binaries dynamically, but some which
# depend on being statically linked may be broken (boot process bins?)
#STATIC=		#empty
## The exact contrary
# Remove support for shared libraries
@


1.21
log
@• add -std=gnu99 to default CFLAGS
• first round of assorted fixes
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.20 2007/01/26 02:03:34 tg Exp $
d3 3
a5 3
_DEFCOPTS:=	-Os -frename-registers -Wformat -Wstrict-aliasing -std=gnu99 \
		-Wbounded -fwrapv -fweb -fno-align-functions -falign-jumps=4 \
		-fno-align-labels -falign-loops=4 ${_DEFCOPTS} -fhonour-copts
@


1.20
log
@interesting bad pasto…
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.19 2007/01/24 00:32:43 tg Exp $
d3 3
a5 3
_DEFCOPTS:=	-Os -fweb -frename-registers -Wformat -Wstrict-aliasing \
		-Wbounded -fwrapv -fno-align-functions -fno-align-labels \
		-falign-loops=4 -falign-jumps=4 ${_DEFCOPTS} -fhonour-copts
@


1.19
log
@we can use -frename-registers too if we disable it when using debug stuff
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.18 2007/01/16 03:44:03 tg Exp $
d32 1
a32 1
_DEFCOPTS+=		-O1 -fno-web -fno--frename-registers \
@


1.18
log
@enable -fwrapv to have (limited) signed integer arithmetic
overflows, in order to make certain SECURITY relevant checks work.

this is still pending http://gcc.gnu.org/bugzilla/show_bug.cgi?id=30477
where gcc developers are delaying security bug fixes in existing code
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.17 2006/10/16 13:28:00 tg Exp $
d3 2
a4 2
_DEFCOPTS:=	-Os -fweb -fwrapv -Wformat -Wstrict-aliasing \
		-Wbounded -fno-align-functions -fno-align-labels \
d25 1
a25 1
# Build no ramdisk/floppy/CD during make release
d32 2
a33 1
_DEFCOPTS+=		-O1 -fno-web -fno-omit-frame-pointer -g3
@


1.17
log
@-fomit-frame-pointer makes the following code fail due to a miscompile:

| w = maint->curwin;
| do {
|	if (w->y != -1) {
|		fprintf(stderr, "\r%p -> ", w);
|		if (w->object && w->watom->disp)
|			w->watom->disp(w->object, flg);
|		fprintf(stderr, "%p\n", w);
|		msgout(w);
|	}
|	w = (W *) (w->link.next);
| } while (w != maint->curwin);

Output:
| 0x8442e400 -> 0x8442e400
| 0x8442e200 -> 0x0

The code is taken from jupp (main.c). This is clearly an issue
with gcc, so -fomit-frame-pointer was removed from default COPTS.
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.16 2006/09/30 23:11:12 tg Exp $
d3 1
a3 1
_DEFCOPTS:=	-Os -fweb -Wformat -Wstrict-aliasing \
@


1.16
log
@don't duplicate -g1 -fno-omit-frame-pointer for libs, place them in the
right place on the command line, handle linking, assembly files, etc.
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.15 2006/09/25 22:07:51 tg Exp $
d3 1
a3 1
_DEFCOPTS:=	-Os -fomit-frame-pointer -fweb -Wformat -Wstrict-aliasing \
@


1.15
log
@turn on -fomit-frame-pointer unless debugging
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.14 2006/09/20 19:27:50 tg Exp $
d33 1
@


1.14
log
@improve description
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.13 2006/09/20 19:26:49 tg Exp $
d3 3
a5 3
_DEFCOPTS:=	-Os -fweb -fno-align-functions -fno-align-labels \
		-falign-loops=4 -falign-jumps=4 ${_DEFCOPTS} \
		-Wbounded -Wformat -Wstrict-aliasing -fhonour-copts
d32 1
a32 1
_DEFCOPTS+=		-O1 -fno-web -g3
@


1.13
log
@while wondering why -Wbounded wasn't active by default, add a few
others and merge same code
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.12 2006/08/11 13:47:56 tg Exp $
d45 3
a47 3
### Sendmail fnordisation
#SENDMAIL_WANT_SASL?=	Yes	# SMTP AUTH, needs cyrus-sasl2 port
#SENDMAIL_WANT_LDAP?=	Yes	# LDAP support, needs OpenLDAP port
@


1.12
log
@syntax error
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.11 2006/07/26 22:42:12 tg Exp $
d3 3
a5 1
_DEFCOPTS+=	-fhonour-copts
d32 1
a32 1
_DEFCOPTS+=		-O1 -g3
@


1.11
log
@simplify building rules, now that the
special handling of the floppy and ISO is gone
XXX still not completed
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.10 2006/06/30 17:01:09 tg Exp $
d31 1
a31 1
.  if ${MKC_DEBG:L} = "cpp"
@


1.10
log
@only add -DDEBUG if necessary; =1 isn't; use CPPFLAGS for that
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.9 2006/06/15 18:25:15 tg Exp $
a23 2
#REL_NO_KERNEL?=	yes	# nothing
#REL_NO_FLOPPY?=	yes	# no floppy kernel/image
d25 1
a25 3
#REL_NO_RAMDISK?=	yes	# no ramdisk (bsd.rd)
#REL_NO_MINIROOT?=	yes	# no miniroot (NFS)
#REL_NO_AUTOISO?=	yes	# no bootable ISO image
@


1.9
log
@remove DEBUGPROGS remnants, that flag is long dead
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.8 2006/06/11 01:08:28 tg Exp $
d35 2
a36 2
.  if ${MKC_DEBG:L} != "nocpp"
_DEFCOPTS+=		-DDEBUG=1
@


1.8
log
@bring some sparc kernel build infrastructure up to date
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.7 2006/06/05 03:31:26 tg Exp $
a38 1
DEBUGPROGS=		Yes
@


1.7
log
@stupid, broken curses!
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.6 2006/02/03 20:23:42 tg Exp $
d28 1
@


1.6
log
@why was INSTALL_STRIP=#empty commented out on MKC_DEBG=yes ?
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.5 2006/01/31 11:43:39 tg Exp $
d33 4
a36 1
_DEFCOPTS+=		-O1 -g -DDEBUG=1
@


1.5
log
@add -fhonour-copts to _DEFCOPTS on all architectures, will soon be needed
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.4 2005/12/04 17:18:26 tg Exp $
d36 1
a36 1
#INSTALL_STRIP=		#nothing
@


1.4
log
@we'll address floppies later
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.3 2005/10/21 20:00:11 tg Exp $
d3 1
@


1.3
log
@* DEFCOPTS -> _DEFCOPTS
* add them in MirMake, too
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.2 2005/08/28 22:41:24 tg Exp $
d24 1
a24 1
REL_NO_FLOPPY?=		yes	# no floppy kernel/image
@


1.2
log
@* -fno-strict-aliasing -fno-strength-reduce are unneeded, since mgcc
  (not stock gcc) only enables them at -O3 (or the old unroller)
* use new -Wstrict-aliasing instead to warn at such corner cases
* don't use -fno-unit-at-a-time any more
* if MKC_DEBG use new DEBUGPROGS instead of disabling INSTALL_STRIP
* don't build a release floppy for now
@
text
@d1 1
a1 1
# $MirOS: src/etc/make.cfg,v 1.1 2005/08/21 11:45:39 tg Exp $
d32 1
a32 1
DEFCOPTS+=		-O1 -g -DDEBUG=1
@


1.1
log
@mk.conf -> make.cfg (uses basename of $MAKE, for portable mirmake's sake)
@
text
@d1 1
a1 1
# $MirOS: src/etc/mk.conf,v 1.3 2005/07/04 02:37:17 tg Exp $
d24 1
a24 1
#REL_NO_FLOPPY?=	yes	# no floppy kernel/image
d34 2
a35 1
INSTALL_STRIP=		#nothing
@

