head	1.15;
access;
symbols
	MIRBSD_10:1.10.0.2
	MIRBSD_10_BASE:1.10
	MIRBSD_9_BASE:1.9
	MIRBSD_8:1.8.0.2
	MIRBSD_8_BASE:1.8
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.15
date	2009.02.22.16.29.08;	author tg;	state Exp;
branches;
next	1.14;
commitid	10049A17D65672B716B;

1.14
date	2009.02.22.11.58.35;	author tg;	state Exp;
branches;
next	1.12;
commitid	10049A13DBE56AE3AB3;

1.12
date	2009.02.22.11.56.49;	author tg;	state Exp;
branches;
next	1.11;
commitid	10049A13D865B6FDA7E;

1.11
date	2009.02.16.21.20.59;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004999D6C503898A56;

1.10
date	2007.10.26.23.08.22;	author tg;	state Exp;
branches;
next	1.9;
commitid	100472273727FFA24E7;

1.9
date	2006.06.17.16.28.21;	author tg;	state Exp;
branches;
next	1.8;
commitid	10044942DB56CF0BB8A;

1.8
date	2005.10.21.12.54.30;	author tg;	state Exp;
branches;
next	1.7;
commitid	59a34358e4dbf737;

1.7
date	2005.08.02.12.02.06;	author tg;	state Exp;
branches;
next	1.6;
commitid	112642ef60cd2bb0;

1.6
date	2005.07.23.15.36.58;	author tg;	state Exp;
branches;
next	1.5;
commitid	59a042e264296dd2;

1.5
date	2005.07.23.15.33.11;	author tg;	state Exp;
branches;
next	1.4;
commitid	75ba42e2632733f1;

1.4
date	2005.07.23.15.00.32;	author tg;	state Exp;
branches;
next	1.3;
commitid	428642e25b9873d0;

1.3
date	2005.03.15.16.45.45;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.19.05.55;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.22.11;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.22.11;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.21.20.45.40;	author tg;	state Exp;
branches;
next	;
commitid	560042e0092f571e;


desc
@@


1.15
log
@rambig wants tpm (and crypto)
@
text
@vers(__file__,
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.14 2009/02/22 11:58:35 tg Exp $-})dnl
vers(__file__,
	{-$OpenBSD: MAKEDEV.md,v 1.32 2005/06/29 18:23:27 todd Exp $-},
etc.MACHINE)dnl
dnl
dnl Copyright (c) 2003-2005 Thorsten Glaser <tg@@mirbsd.de>
dnl Copyright (c) 2001-2004 Todd T. Fries <todd@@OpenBSD.org>
dnl
dnl Permission to use, copy, modify, and distribute this software for any
dnl purpose with or without fee is hereby granted, provided that the above
dnl copyright notice and this permission notice appear in all copies.
dnl
dnl THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
dnl WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
dnl MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
dnl ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
dnl WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
dnl ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
dnl OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
dnl
__devitem(apm, apm, Power management device)dnl
dnl #notyet#__devitem(acpi, acpi, Advanced Configuration and Power Interface)dnl
dnl #notyet#__devitem(nvram, nvram, NVRAM access)dnl
_mkdev(nvram, nvram, {-M nvram c major_nvram_c 0 440 kmem-})dnl
__devitem(cry, crypto, Hardware crypto access driver,crypto)dnl
_mkdev(cry, crypto, {-M crypto c major_cry_c 0
	M tpm c major_cry_c 1 660 operator-})dnl
_TITLE(make)
_DEV(all)
_DEV(ramdisk)
__devitem(rambig, rambig, additional devices to be put on large ramdisk media,nothing)dnl
_DEV(rambig)
_DEV(std)
_DEV(local)
_TITLE(dis)
_DEV(ccd, 18, 16)
_DEV(cd, 15, 6)
_DEV(flo, 9, 2)
_DEV(mcd, 39, 7)
_DEV(raid, 54, 19)
_DEV(rd, 47, 17)
_DEV(sd, 13, 4)
_DEV(vnd, 41, 14)
_DEV(wd, 3, 0)
_TITLE(tap)
_DEV(ch, 17)
_DEV(st, 14, 5)
_DEV(wt, 10, 3)
_TITLE(term)
_DEV(com, 8)
_DEV(ttyc, 38)
_TITLE(pty)
_DEV(ptm, 82)
_DEV(pty, 6)
_DEV(tty, 5)
_TITLE(cons)
_DEV(wscons)
_DEV(wsdisp, 12)
_DEV(wskbd, 67)
_DEV(wsmux, 69)
_TITLE(point)
_DEV(wsmouse, 68)
_TITLE(prn)
_DEV(lpa)
_DEV(lpt, 16)
_TITLE(usb)
_DEV(uall)
_DEV(ttyU, 66)
_DEV(ugen, 63)
_DEV(uhid, 62)
_DEV(ulpt, 64)
_DEV(urio, 65)
_DEV(usb, 61)
_DEV(uscan, 77)
_TITLE(spec)
_DEV(apm, 21)
dnl #notyet#_DEV(acpi, 85)
_DEV(au, 42)
_DEV(bio, 79)
_DEV(bktr, 49)
_DEV(bpf, 23)
_DEV(cry, 70)
_DEV(fdesc, 22)
dnl #notyet#_DEV(gpio, 83)
_DEV(gpr, 80)
dnl #notyet#_DEV(hotplug, 81)
_DEV(iop, 75)
_DEV(joy, 26)
_DEV(lkm, 28)
_DEV(music, 53)
dnl #notyet#_DEV(nvram, 84)
_DEV(pci, 72)
_DEV(pctr, 46)
_DEV(pf, 73)
_DEV(radio, 76)
_DEV(rmidi, 52)
_DEV(rnd, 45)
_DEV(speak, 27)
_DEV(ss, 19)
_DEV(systrace, 78)
_DEV(tun, 40)
_DEV(tuner, 49)
_DEV(uk, 20)
_DEV(wdt, 55)
_TITLE(isdns)
_DEV(isdn, 56)
_DEV(isdnctl, 57)
_DEV(isdnbchan, 58)
_DEV(isdntrc, 59)
_DEV(isdntel, 60)
dnl
divert(__mddivert)dnl
dnl
ramdisk)
	_recurse std bpf0 fd0 wd0 sd0 tty00 tty01 rd0
	_recurse st0 cd0 ttyC0 random wskbd0 wskbd1 wskbd2 apm vnd0
	;;
rambig)
	_recurse bpf1 pty0 raid0 raid1 tun0 vnd1 crypto
	;;

_std(1, 2, 50, 4, 7)
	M xf86		c 2 4 600
	;;

ttyc*)
	M ttyc$U c 38 $U 660 dialer uucp
	M cuac$U c 38 Add($U, 128) 660 dialer uucp
	;;
dnl
dnl i386 specific targets
dnl
target(all, ch, 0)dnl
target(all, ss, 0, 1)dnl
twrget(all, flo, fd, 0, 0B, 0C, 0D, 0E, 0F, 0G, 0H)dnl
twrget(all, flo, fd, 1, 1B, 1C, 1D, 1E, 1F, 1G, 1H)dnl
target(all, pty, 0)dnl
target(all, bpf, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9)dnl
target(all, bio)dnl
twrget(all, cry, crypto)dnl
target(all, tun, 0, 1, 2, 3)dnl
target(all, xy, 0, 1, 2, 3)dnl
target(all, rd, 0)dnl
target(all, cd, 0, 1)dnl
target(all, sd, 0, 1, 2, 3, 4)dnl
target(all, vnd, 0, 1, 2, 3)dnl
target(all, ccd, 0, 1, 2, 3)dnl
target(all, bktr, 0)dnl
dnl #notyet#target(all, gpio, 0, 1, 2)dnl
dnl #notyet#target(all, nvram)dnl
target(ramd, tty0, 0, 1, 2, 3)dnl
twrget(ramd, wsdisp, ttyC, 0)dnl
target(ramd, wt, 0)dnl
target(ramd, fd, 0)dnl
target(ramd, rd, 0)dnl
target(ramd, wd, 0, 1, 2, 3)dnl
target(ramd, sd, 0, 1, 2, 3)dnl
target(ramd, cd, 0, 1)dnl
target(ramd, st, 0, 1)dnl
target(ramd, mcd, 0)dnl

isdns)
	_recurse isdn isdnctl isdnbchan0 isdnbchan1
	_recurse isdntel0 isdntel1 isdntrc0 isdntrc1
	cat <<_EOF_ALLISDN
The author of the ISDN4BSD package is:
 * Hellmuth Michaelis
 * Hallstrasse 20
 * D-25462 Rellingen
 * voice: +49 4101 473574
 * fax:   +49 4101 473575
 * email: hm@@kts.org

He requests a picture postcard of the home town of any ISDN4BSD
user as licence fee.  Please send him one if you are using this
ISDN subsystem for MirOS BSD, too.

 * It may be illegal in your country to connect an ISDN4BSD-based machine
 * using a passive ISDN card to the ISDN at your site because the protocol
 * stack of ISDN4BSD, which is necessary to run passive cards, has not been
 * approved by the telecommunication certification authority of your country.
 * If in doubt, please contact your local ISDN provider!

_EOF_ALLISDN
	;;
@


1.14
log
@add /dev/tpm as minor 1 for /dev/crypto; kernel code to follow
this is against major abuse (a major for only one minor node…)
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.11 2009/02/16 21:20:59 tg Exp $-})dnl
d120 1
a120 1
	_recurse bpf1 pty0 raid0 raid1 tun0 vnd1
@


1.12
log
@sparc has no /dev/crypto, so make it totally MD
(and back out tpm)
@
text
@d27 2
a28 1
_mkdev(cry, crypto, {-M crypto c major_cry_c 0-})dnl
@


1.11
log
@functional TPM driver, from Joshua Stein’s efforts
• tested with a slightly hacked user space library (GPL) from IBM:
  RMD160 (tpm-3.2.0.tar.gz) = 80bae009bdfeaaba5d4f2ce371bde630cf6913d1
  ‣ /dev/tpm not /dev/tpm0
  ‣ comment out ioctl
  ‣ for entropy testing of the RNG, slurp 768 bytes in each call
    (more aren’t returned on my IBM Stinkpad X40)
• TODO: make /dev/tpm available only if kern.usercrypto=1
• TODO: similar to VIA C3 HW RNG, feed into kernel pool from TPM, unless
  the device is already opened from user space
  ‣ XXX do we want/need to do a full reset once it was opened?
  ‣ XXX do we take it back once user space had addressed it?
• TODO: write tpm(4) manual page, regen MAKEDEV(8)

Think about it. (Hah, how bleu from me.) Why not let cprng(8) do the deed?
(Of course, in-kernel operation is much cooler. But it may block, and in
any case, it adds complexity. Plus, we only allow one user space programme
to actually access the device.)

Tests with mirports/math/ent on a 64 KiB sample looked good, although the
TPM is a very slow HW RNG (about 1KB/s even at the largest block size my
exemplar could do, which is not guaranteed by the standard anyway).

*winks Theo* Every bit counts. Even if it may not be worth it for crypto.

PS: someone with actual kernel coding experience might want to help me
    to attach the tpm0 at ichpcib0, which I couldn’t get quite right…
    for now, tpm0 attaches at mainbus0 or root, similar to powernowhack0…
    the match function falses constantly unless manually called from the
    ichpcib attach routine – but it is at least better than jsg’s trick
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.10 2007/10/26 23:08:22 tg Exp $-})dnl
d26 2
a27 2
__devitem(tpm, tpm, Trusted Platform Module)dnl
_mkdev(tpm, tpm, {-M tpm c major_tpm_c 0 660 operator-})dnl
a100 1
_DEV(tpm, 83)
d140 1
a140 1
target(all, tpm)dnl
@


1.10
log
@we need /dev/bpf1 on bsd.rd(i386) for rarpd(8)
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.9 2006/06/17 16:28:21 tg Exp $-})dnl
d26 2
d101 1
d141 1
@


1.9
log
@sync style and (c)
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.8 2005/10/21 12:54:30 tg Exp $-})dnl
d117 1
a117 1
	_recurse pty0 raid0 raid1 tun0 vnd1
@


1.8
log
@revert /dev/ptm to major 82
rationale: if we plug current kernels onto older MirOS systems, the user
	   should not have to run a different MAKEDEV - this (backwards
	   compatibility) is more important than equalness with OpenBSD

this only affects users from a pretty short timeframe, compared with how
long we already have had ptm
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.7 2005/08/02 12:02:06 tg Exp $-})dnl
d7 1
a8 1
dnl Copyright (c) 2003-2005 Thorsten Glaser <tg@@66h.42h.de>
@


1.7
log
@ses, xfs are dead
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.6 2005/07/23 15:36:58 tg Exp $-})dnl
d51 1
a51 1
_DEV(ptm, 81)
d84 1
a84 1
dnl #notyet#_DEV(hotplug, 82)
@


1.6
log
@fix notyets
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.5 2005/07/23 15:33:11 tg Exp $-})dnl
a95 1
_DEV(ses, 24)
a130 1
target(all, ses, 0)dnl
a132 1
target(all, xfs, 0)dnl
@


1.5
log
@* comment out devices we don't have ATM
* move ptm to major 81 from major 82
  (this means, people, regen your /dev after upgrading the kernel!)
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.4 2005/07/23 15:00:32 tg Exp $-})dnl
d23 2
a24 2
#notyet#__devitem(acpi, acpi, Advanced Configuration and Power Interface)dnl
#notyet#__devitem(nvram, nvram, NVRAM access)dnl
d75 1
a75 1
#notyet#_DEV(acpi, 85)
d82 1
a82 1
#notyet#_DEV(gpio, 83)
d84 1
a84 1
#notyet#_DEV(hotplug, 82)
d89 1
a89 1
#notyet#_DEV(nvram, 84)
d149 2
a150 2
#notyet#target(all, gpio, 0, 1, 2)dnl
#notyet#target(all, nvram)dnl
@


1.4
log
@manually merge the etc/*/ subdirectory entries from OpenBSD
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.3 2005/03/15 16:45:45 tg Exp $-})dnl
d23 2
a24 2
__devitem(acpi, acpi, Advanced Configuration and Power Interface)dnl
__devitem(nvram, nvram, NVRAM access)dnl
d51 1
a51 1
_DEV(ptm, 82)
d75 1
a75 1
_DEV(acpi, 85)
d82 1
a82 1
_DEV(gpio, 83)
d84 1
a84 1
_DEV(hotplug, 82)
d89 1
a89 1
_DEV(nvram, 84)
d149 2
a150 2
target(all, gpio, 0, 1, 2)dnl
target(all, nvram)dnl
@


1.3
log
@* update
* remove tap(4) remnance which got superceded by tun(4)
* remove st(4) man-page workaround
* don't prepend directory before MirBSD rcs id
* it's MirOS now
@
text
@d2 1
a2 1
	{-$MirOS: src/etc/etc.i386/MAKEDEV.md,v 1.2 2005/03/06 19:05:55 tg Exp $-})dnl
d4 1
a4 1
	{-$OpenBSD: MAKEDEV.md,v 1.23 2004/04/11 18:05:23 millert Exp $-},
d22 4
a49 2
_TITLE(call)
_DEV(tun, 40)
d75 1
d77 1
d82 1
d84 1
d89 1
d100 1
d114 2
a115 2
	_recurse std bpf0 fd0 wd0 wd1 wd2 sd0 sd1 sd2 tty00 tty01 rd0
	_recurse st0 cd0 ttyC0 random wskbd0 vnd0
d140 1
d149 2
@


1.2
log
@merge src/etc minus generated files
@
text
@d2 1
a2 1
	{-$MirOS$-})dnl
d107 1
a107 1
	_recurse st0 cd0 ttyC0 random wskbd0 tun0 vnd0 vnd1
d110 1
a110 1
	_recurse pty0 raid0 raid1
a132 1
target(all, tap, 0, 1, 2, 3)dnl
d165 1
a165 1
ISDN subsystem for MirOS, too.
d167 1
a167 1
 * It may be illegal in your country to connect an isdn4bsd based machine
d169 1
a169 1
 * stack of isdn4bsd, which is necessary to run passive cards, has not been
@


1.1
log
@Initial revision
@
text
@d2 2
d8 1
a21 1
dnl
d25 2
d49 1
a49 1
_DEV(ptm, 81)
d96 6
a101 1
_DEV(xfs, 51)
d107 4
a110 1
	_recurse st0 cd0 ttyC0 random wskbd0
d133 1
d151 25
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d2 1
a2 1
	{-$OpenBSD: MAKEDEV.md,v 1.32 2005/06/29 18:23:27 todd Exp $-},
a19 4
__devitem(apm, apm, Power management device)dnl
__devitem(acpi, acpi, Advanced Configuration and Power Interface)dnl
__devitem(nvram, nvram, NVRAM access)dnl
_mkdev(nvram, nvram, {-M nvram c major_nvram_c 0 440 kmem-})dnl
d42 2
a68 1
_DEV(acpi, 85)
a69 1
_DEV(bio, 79)
a73 1
_DEV(gpio, 83)
a74 1
_DEV(hotplug, 82)
a78 1
_DEV(nvram, 84)
a88 1
_DEV(tun, 40)
d97 2
a98 2
	_recurse std bpf0 fd0 wd0 sd0 tty00 tty01 rd0
	_recurse st0 cd0 ttyC0 random wskbd0 wskbd1 wskbd2 apm
a119 1
target(all, bio)dnl
a127 2
target(all, gpio, 0, 1, 2)dnl
target(all, nvram)dnl
@

