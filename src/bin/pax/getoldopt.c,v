head	1.7;
access;
symbols
	paxmirabilis-20190825:1.7
	paxmirabilis-20190224:1.7
	paxmirabilis-20190210:1.7
	npax:1.1.1.2.0.2
	cvs-20181212:1.1.1.2
	paxmirabilis-20171021:1.5
	paxmirabilis-20161104:1.5
	paxmirabilis-20161031:1.5
	paxmirabilis-20161025:1.5
	paxmirabilis-20160306:1.5
	cvs-201603041945:1.1.1.2
	paxmirabilis-20151013:1.5
	paxmirabilis-20140703:1.5
	paxmirabilis-20120606:1.5
	paxmirabilis-20120605:1.5
	cvs-201206051745:1.1.1.2
	paxmirabilis-20120520:1.5
	paxmirabilis-20120216:1.4
	paxmirabilis-20120212:1.4
	cvs-201202112230:1.1.1.2
	paxmirabilis-20110817:1.3
	MIRBSD_10:1.2.0.2
	MIRBSD_10_BASE:1.2
	cvs-200710231945:1.1.1.1
	cvs-200606232242:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	cvs-200504291700:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.7
date	2019.02.10.22.00.06;	author tg;	state Exp;
branches;
next	1.6;
commitid	1005C609EEE08448145;

1.6
date	2018.12.12.18.08.44;	author tg;	state Exp;
branches;
next	1.5;
commitid	1005C114EA81986F5EC;

1.5
date	2012.05.20.16.13.18;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004FB918314D2FECC0;

1.4
date	2012.02.12.00.27.16;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004F3707786D20BF4A;

1.3
date	2011.08.16.13.57.14;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004E4A774D3CB07A5D;

1.2
date	2007.02.17.04.52.40;	author tg;	state Exp;
branches;
next	1.1;
commitid	10045D68A2D54E2C558;

1.1
date	2005.02.05.17.22.06;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.22.06;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2012.02.11.22.47.21;	author tg;	state Exp;
branches
	1.1.1.2.2.1;
next	;
commitid	1004F36F008225F3522;

1.1.1.2.2.1
date	2018.12.12.01.05.52;	author tg;	state Exp;
branches;
next	1.1.1.2.2.2;
commitid	1005C105F03799CC958;

1.1.1.2.2.2
date	2018.12.12.03.13.32;	author tg;	state Exp;
branches;
next	;
commitid	1005C107CE315DC51F3;


desc
@@


1.7
log
@I got a CC0 for this piece of PD code (and others); thanks, John Gilmore!
@
text
@/*	$OpenBSD: getoldopt.c,v 1.9 2009/10/27 23:59:22 deraadt Exp $	*/
/*	$NetBSD: getoldopt.c,v 1.3 1995/03/21 09:07:28 cgd Exp $	*/

/*
 * Plug-compatible replacement for getopt() for parsing tar-like
 * arguments.  If the first argument begins with "-", it uses getopt;
 * otherwise, it uses the old rules used by tar, dump, and ps.
 *
 * Written 25 August 1985 by John Gilmore (ihnp4!hoptoad!gnu) and
 * placed in the Public Domain for your edification and enjoyment,
 * https://creativecommons.org/publicdomain/zero/1.0/legalcode (CC0)
 * being an alternative licence, confirmed by eMail on 2019-02-10.
 */

#include <sys/types.h>
#include <sys/stat.h>
#include <stdio.h>
#include <string.h>
#if HAVE_STRINGS_H
#include <strings.h>
#endif
#include <unistd.h>

#include "pax.h"
#include "extern.h"

__RCSID("$MirOS: src/bin/pax/getoldopt.c,v 1.4 2012/02/12 00:27:16 tg Exp $");

int
getoldopt(int argc, char **argv, const char *optstring)
{
	static char	*key;		/* Points to next keyletter */
	static char	use_getopt;	/* !=0 if argv[1][0] was '-' */
	char		c;
	char		*place;

	optarg = NULL;

	if (key == NULL) {		/* First time */
		if (argc < 2)
			return (-1);
		key = argv[1];
		if (*key == '-')
			use_getopt++;
		else
			optind = 2;
	}

	if (use_getopt)
		return (getopt(argc, argv, optstring));

	c = *key++;
	if (c == '\0') {
		key--;
		return (-1);
	}
	place = strchr(optstring, c);

	if (place == NULL || c == ':') {
		fprintf(stderr, "%s: unknown option %c\n", argv[0], c);
		return ('?');
	}

	place++;
	if (*place == ':') {
		if (optind < argc) {
			optarg = argv[optind];
			optind++;
		} else {
			fprintf(stderr, "%s: %c argument missing\n",
				argv[0], c);
			return ('?');
		}
	}

	return (c);
}
@


1.6
log
@merge the npax branch into MAIN

asides from a missing dprintf and portability, this ought to be
good enough for people (well me) to play with for now
@
text
@d9 4
a12 2
 * Written 25 August 1985 by John Gilmore (ihnp4!hoptoad!gnu) and placed
 * in the Public Domain for your edification and enjoyment.
@


1.5
log
@get rid of extern.h including other headers
@
text
@d13 1
a13 1
#include <sys/param.h>
d17 3
a19 1
#include <time.h>
d21 1
@


1.4
log
@merge OpenBSD
@
text
@d17 1
d22 1
a22 1
__RCSID("$MirOS: src/bin/pax/getoldopt.c,v 1.3 2011/08/16 13:57:14 tg Exp $");
@


1.3
log
@portability overhaul
@
text
@d1 1
a1 1
/*	$OpenBSD: getoldopt.c,v 1.8 2003/07/02 21:19:33 deraadt Exp $	*/
d21 1
a21 1
__RCSID("$MirOS: src/bin/pax/getoldopt.c,v 1.2 2007/02/17 04:52:40 tg Exp $");
@


1.2
log
@__CRAZY clean
@
text
@d13 1
a13 1
#include <sys/types.h>
d21 1
a21 1
__RCSID("$MirOS$");
@


1.1
log
@Initial revision
@
text
@a12 4
#ifndef lint
static const char rcsid[] = "$OpenBSD: getoldopt.c,v 1.8 2003/07/02 21:19:33 deraadt Exp $";
#endif /* not lint */

d21 2
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@import up-to-date pax from OpenBSD 5.1-current
@
text
@d1 1
a1 1
/*	$OpenBSD: getoldopt.c,v 1.9 2009/10/27 23:59:22 deraadt Exp $	*/
d13 4
@


1.1.1.2.2.1
log
@a little KNF: sort the includes
@
text
@a17 1

@


1.1.1.2.2.2
log
@extremely rudimentary conversion to mirtoconf, doesnâ€™t even build yet
@
text
@a16 3
#if HAVE_STRINGS_H
#include <strings.h>
#endif
@


