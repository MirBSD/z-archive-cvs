head	1.4;
access;
symbols
	paxmirabilis-20190825:1.4
	paxmirabilis-20190224:1.4
	paxmirabilis-20190210:1.4
	npax:1.1.1.4.0.2
	cvs-20181212:1.1.1.4
	paxmirabilis-20171021:1.3
	paxmirabilis-20161104:1.3
	paxmirabilis-20161031:1.3
	paxmirabilis-20161025:1.3
	paxmirabilis-20160306:1.3
	cvs-201603041945:1.1.1.2
	paxmirabilis-20151013:1.2
	paxmirabilis-20140703:1.2
	paxmirabilis-20120606:1.2
	paxmirabilis-20120605:1.2
	cvs-201206051745:1.1.1.1
	paxmirabilis-20120520:1.2
	paxmirabilis-20120216:1.2
	paxmirabilis-20120212:1.2
	cvs-201202112230:1.1.1.1
	paxmirabilis-20110817:1.1.1.1
	MIRBSD_10:1.1.1.1.0.4
	MIRBSD_10_BASE:1.1.1.1
	cvs-200710231945:1.1.1.1
	cvs-200606232242:1.1.1.1
	MIRBSD_9_BASE:1.1.1.1
	MIRBSD_8:1.1.1.1.0.2
	MIRBSD_8_BASE:1.1.1.1
	cvs-200507211800:1.1.1.1
	cvs-200504291700:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.4
date	2018.12.12.18.08.48;	author tg;	state Exp;
branches;
next	1.3;
commitid	1005C114EA81986F5EC;

1.3
date	2016.03.06.14.12.29;	author tg;	state Exp;
branches;
next	1.2;
commitid	10056DC3ADA1858410D;

1.2
date	2012.02.12.00.27.18;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004F3707786D20BF4A;

1.1
date	2005.02.05.17.22.06;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.22.06;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2016.03.04.19.46.09;	author tg;	state Exp;
branches;
next	1.1.1.3;
commitid	10056D9E61429EE6550;

1.1.1.3
date	2016.03.04.20.55.05;	author tg;	state Exp;
branches;
next	1.1.1.4;
commitid	10056D9F62E152ECBA5;

1.1.1.4
date	2018.12.12.00.24.23;	author tg;	state Exp;
branches
	1.1.1.4.2.1;
next	;
commitid	1005C1055452C78F9E4;

1.1.1.4.2.1
date	2018.12.12.03.13.35;	author tg;	state Exp;
branches;
next	;
commitid	1005C107CE315DC51F3;


desc
@@


1.4
log
@merge the npax branch into MAIN

asides from a missing dprintf and portability, this ought to be
good enough for people (well me) to play with for now
@
text
@/*	$OpenBSD: tar.h,v 1.9 2014/01/08 06:43:34 deraadt Exp $	*/
/*	$NetBSD: tar.h,v 1.3 1995/03/21 09:07:51 cgd Exp $	*/

/*-
 * Copyright (c) 1992 Keith Muller.
 * Copyright (c) 1992, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * Keith Muller of the University of California, San Diego.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)tar.h	8.2 (Berkeley) 4/18/94
 */

#ifdef EXTERN
__IDSTRING(rcsid_tar_h, "$MirOS: src/bin/pax/tar.h,v 1.1.1.4.2.1 2018/12/12 03:13:35 tg Exp $");
#endif

/*
 * defines and data structures common to all tar formats
 */
#define CHK_LEN		8		/* length of checksum field */
#define TNMSZ		100		/* size of name field */
#ifdef _PAX_
#define NULLCNT		2		/* number of null blocks in trailer */
#define CHK_OFFSET	148		/* start of chksum field */
#define BLNKSUM		256L		/* sum of checksum field using ' ' */
#endif /* _PAX_ */

/*
 * Values used in typeflag field in all tar formats
 * (only REGTYPE, LNKTYPE and SYMTYPE are used in old bsd tar headers)
 */
#define	REGTYPE		'0'		/* Regular File */
#define	AREGTYPE	'\0'		/* Regular File */
#define	LNKTYPE		'1'		/* Link */
#define	SYMTYPE		'2'		/* Symlink */
#define	CHRTYPE		'3'		/* Character Special File */
#define	BLKTYPE		'4'		/* Block Special File */
#define	DIRTYPE		'5'		/* Directory */
#define	FIFOTYPE	'6'		/* FIFO */
#define	CONTTYPE	'7'		/* high perf file */

/*
 * Extended header - POSIX.1-2001
 */
#define	XHDRTYPE	'x'		/* Extended header */
#define	GHDRTYPE	'g'		/* Global header*/

/*
 * GNU tar compatibility;
 */
#define	LONGLINKTYPE	'K'		/* Long Symlink */
#define	LONGNAMETYPE	'L'		/* Long File */

/*
 * Mode field encoding of the different file types - values in octal
 */
#define TSUID		04000		/* Set UID on execution */
#define TSGID		02000		/* Set GID on execution */
#define TSVTX		01000		/* Reserved */
#define TUREAD		00400		/* Read by owner */
#define TUWRITE		00200		/* Write by owner */
#define TUEXEC		00100		/* Execute/Search by owner */
#define TGREAD		00040		/* Read by group */
#define TGWRITE		00020		/* Write by group */
#define TGEXEC		00010		/* Execute/Search by group */
#define TOREAD		00004		/* Read by other */
#define TOWRITE		00002		/* Write by other */
#define TOEXEC		00001		/* Execute/Search by other */

#ifdef _PAX_
/*
 * Pad with a bit mask, much faster than doing a mod but only works on powers
 * of 2. Macro below is for block of 512 bytes.
 */
#define TAR_PAD(x)	((512 - ((x) & 511)) & 511)
#endif /* _PAX_ */

/*
 * structure of an old tar header as it appeared in BSD releases
 */
typedef struct {
	char name[TNMSZ];		/* name of entry */
	char mode[8];			/* mode */
	char uid[8];			/* uid */
	char gid[8];			/* gid */
	char size[12];			/* size */
	char mtime[12];			/* modification time */
	char chksum[CHK_LEN];		/* checksum */
	char linkflag;			/* norm, hard, or sym. */
	char linkname[TNMSZ];		/* linked to name */
} HD_TAR;

#ifdef _PAX_
/*
 * -o options for BSD tar to not write directories to the archive
 */
#define TAR_NODIR	"nodir"
#define TAR_OPTION	"write_opt"

/*
 * default device names
 */
#define	DEV_0		"/dev/rst0"
#define	DEV_1		"/dev/rst1"
#define	DEV_4		"/dev/rst4"
#define	DEV_5		"/dev/rst5"
#define	DEV_7		"/dev/rst7"
#define	DEV_8		"/dev/rst8"
#endif /* _PAX_ */

/*
 * Data Interchange Format - Extended tar header format - POSIX 1003.1-1990
 */
#define TPFSZ		155
#define	TMAGIC		"ustar"		/* ustar and a null */
#define	TMAGLEN		6
#define	TVERSION	"00"		/* 00 and no null */
#define	TVERSLEN	2

typedef struct {
	char name[TNMSZ];		/* name of entry */
	char mode[8];			/* mode */
	char uid[8];			/* uid */
	char gid[8];			/* gid */
	char size[12];			/* size */
	char mtime[12];			/* modification time */
	char chksum[CHK_LEN];		/* checksum */
	char typeflag;			/* type of file. */
	char linkname[TNMSZ];		/* linked to name */
	char magic[TMAGLEN];		/* magic cookie */
	char version[TVERSLEN];		/* version */
	char uname[32];			/* ascii owner name */
	char gname[32];			/* ascii group name */
	char devmajor[8];		/* major device number */
	char devminor[8];		/* minor device number */
	char prefix[TPFSZ];		/* linked to name */
} HD_USTAR;
@


1.3
log
@version the *.h files as idstrings, too
@
text
@d1 1
a1 1
/*	$OpenBSD: tar.h,v 1.7 2003/06/02 23:32:09 millert Exp $	*/
d39 3
a41 2
#ifndef MIRCPIO_TAR_H
#define MIRCPIO_TAR_H "$MirOS$"
d69 6
d109 2
a110 2
	char mode[8]; 			/* mode */
	char uid[8]; 			/* uid */
d148 2
a149 2
	char mode[8]; 			/* mode */
	char uid[8]; 			/* uid */
a163 2

#endif
@


1.2
log
@merge OpenBSD
@
text
@a0 1
/**	$MirOS$ */
d39 3
d157 2
@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@pull newer paxtar from OpenBSD
@
text
@d1 1
a1 1
/*	$OpenBSD: tar.h,v 1.9 2014/01/08 06:43:34 deraadt Exp $	*/
a64 6
 * Extended header - POSIX.1-2001
 */
#define	XHDRTYPE	'x'		/* Extended header */
#define	GHDRTYPE	'g'		/* Global header*/

/*
d99 2
a100 2
	char mode[8];			/* mode */
	char uid[8];			/* uid */
d138 2
a139 2
	char mode[8];			/* mode */
	char uid[8];			/* uid */
@


1.1.1.3
log
@revert the import; we’ll just backport the CVE fixes, for now ☹
@
text
@d1 1
a1 1
/*	$OpenBSD: tar.h,v 1.7 2003/06/02 23:32:09 millert Exp $	*/
d65 6
d105 2
a106 2
	char mode[8]; 			/* mode */
	char uid[8]; 			/* uid */
d144 2
a145 2
	char mode[8]; 			/* mode */
	char uid[8]; 			/* uid */
@


1.1.1.4
log
@Import latest OpenBSD paxtar, unmodified, into vendor branch
@
text
@d1 1
a1 1
/*	$OpenBSD: tar.h,v 1.9 2014/01/08 06:43:34 deraadt Exp $	*/
a64 6
 * Extended header - POSIX.1-2001
 */
#define	XHDRTYPE	'x'		/* Extended header */
#define	GHDRTYPE	'g'		/* Global header*/

/*
d99 2
a100 2
	char mode[8];			/* mode */
	char uid[8];			/* uid */
d138 2
a139 2
	char mode[8];			/* mode */
	char uid[8];			/* uid */
@


1.1.1.4.2.1
log
@extremely rudimentary conversion to mirtoconf, doesn’t even build yet
@
text
@a38 4
#ifdef EXTERN
__IDSTRING(rcsid_tar_h, "$MirOS: src/bin/mksh/sh.h,v 1.868 2018/12/04 21:13:47 tg Exp $");
#endif

@


