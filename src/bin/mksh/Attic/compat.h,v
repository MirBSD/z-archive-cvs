head	1.5;
access;
symbols
	tg-mksh-plan9ape:1.1.2.7.0.2
	mksh-R27e:1.1.2.7
	MIRBSD_9_BASE:1.1.2.7
	mksh-R27d:1.1.2.7
	mksh-R27:1.1.2.7
	mksh-R26c:1.1.2.7
	mksh-R26b:1.1.2.7
	mksh-R26:1.1.2.7
	mksh-R25:1.1.2.7
	mirbsd:1.1.0.2;
locks; strict;
comment	@ * @;


1.5
date	2006.08.22.22.49.34;	author tg;	state dead;
branches;
next	1.4;
commitid	10044EB89CB27D175DB;

1.4
date	2006.08.22.22.16.04;	author tg;	state Exp;
branches;
next	1.3;
commitid	10044EB821E410451C2;

1.3
date	2006.08.18.18.59.49;	author tg;	state Exp;
branches;
next	1.2;
commitid	10044E60E3718AB26DE;

1.2
date	2006.08.16.00.00.24;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044E2602313DC1D93;

1.1
date	2005.10.25.19.39.50;	author tg;	state dead;
branches
	1.1.2.1;
next	;
commitid	1d3b435e89eb038b;

1.1.2.1
date	2005.10.25.19.39.50;	author tg;	state Exp;
branches;
next	1.1.2.2;
commitid	1d3b435e89eb038b;

1.1.2.2
date	2005.10.25.19.46.10;	author tg;	state Exp;
branches;
next	1.1.2.3;
commitid	6836435e8b86013e;

1.1.2.3
date	2005.10.25.19.53.26;	author tg;	state Exp;
branches;
next	1.1.2.4;
commitid	76cc435e8d34d8ce;

1.1.2.4
date	2005.10.25.20.24.41;	author tg;	state Exp;
branches;
next	1.1.2.5;
commitid	56e3435e94987e65;

1.1.2.5
date	2005.10.25.20.48.18;	author tg;	state Exp;
branches;
next	1.1.2.6;
commitid	4729435e9a1b954a;

1.1.2.6
date	2005.10.25.21.04.16;	author tg;	state Exp;
branches;
next	1.1.2.7;
commitid	6dd5435e9dd7fe74;

1.1.2.7
date	2005.11.19.23.51.01;	author tg;	state Exp;
branches
	1.1.2.7.2.1;
next	;
commitid	2fcc437fba432ffd;

1.1.2.7.2.1
date	2006.08.15.23.49.51;	author tg;	state Exp;
branches;
next	1.1.2.7.2.2;
commitid	10044E25D6841FC583E;

1.1.2.7.2.2
date	2006.08.18.19.04.34;	author tg;	state Exp;
branches;
next	1.1.2.7.2.3;
commitid	10044E60F4E50D3F577;

1.1.2.7.2.3
date	2006.08.24.19.52.56;	author tg;	state Exp;
branches;
next	1.1.2.7.2.4;
commitid	10044EE03AB30C6D00A;

1.1.2.7.2.4
date	2006.08.24.20.07.22;	author tg;	state Exp;
branches;
next	1.1.2.7.2.5;
commitid	10044EE070C375BDA53;

1.1.2.7.2.5
date	2006.08.24.20.52.10;	author tg;	state dead;
branches;
next	;
commitid	10044EE117A130AF943;


desc
@@


1.5
log
@* remove redundancy
* integrate compat.h, version.h into sh.h (dependency trick didn't work anyway)
* mention #ksh in mksh(1) since the founder (twkm) said it's on topic too
  (don't remove mention of #mksh despite it's usually empty because of control)
@
text
@#define MKSH_COMPAT_H_ID "$MirOS: src/bin/mksh/compat.h,v 1.4 2006/08/22 22:16:04 tg Exp $"

#ifdef NEED_COMPAT
/* Part I: extra headers */

#if defined(__sun__) || defined(__INTERIX)
#include <sys/mkdev.h>
#endif
#if !defined(__OpenBSD__) && !defined(__CYGWIN__)
#include <ulimit.h>
#endif
#if defined(__sun__) || defined(__gnu_linux__)
#include <values.h>
#endif


/* Part II: extra macros */

#ifndef timeradd
#define	timeradd(tvp, uvp, vvp)						\
	do {								\
		(vvp)->tv_sec = (tvp)->tv_sec + (uvp)->tv_sec;		\
		(vvp)->tv_usec = (tvp)->tv_usec + (uvp)->tv_usec;	\
		if ((vvp)->tv_usec >= 1000000) {			\
			(vvp)->tv_sec++;				\
			(vvp)->tv_usec -= 1000000;			\
		}							\
	} while (0)
#endif
#ifndef timersub
#define	timersub(tvp, uvp, vvp)						\
	do {								\
		(vvp)->tv_sec = (tvp)->tv_sec - (uvp)->tv_sec;		\
		(vvp)->tv_usec = (tvp)->tv_usec - (uvp)->tv_usec;	\
		if ((vvp)->tv_usec < 0) {				\
			(vvp)->tv_sec--;				\
			(vvp)->tv_usec += 1000000;			\
		}							\
	} while (0)
#endif

#ifndef S_ISTXT
#define S_ISTXT 0001000
#endif


/* Part III: OS-dependent additions */

#if defined(__gnu_linux__)
size_t strlcat(char *, const char *, size_t);
size_t strlcpy(char *, const char *, size_t);
#endif

#if defined(__sun__)
size_t confstr(int, char *, size_t);
#endif

#if defined(__gnu_linux__) || defined(__sun__) || defined(__CYGWIN__)
#define DEFFILEMODE (S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)
mode_t getmode(const void *, mode_t);
void *setmode(const char *);
#endif

#ifdef __INTERIX
#define	makedev(x,y)	mkdev((x),(y))
extern int __cdecl seteuid(uid_t);
extern int __cdecl setegid(gid_t);
#endif

#endif
@


1.4
log
@* version.h doesn't need an RCS ID
* compat.h does, add it to misc.c, always include it, move if NEED_COMPAT
* major whitespace cleanup in sh.h
@
text
@d1 1
a1 1
#define MKSH_COMPAT_H_ID "$MirOS$"
@


1.3
log
@Plan 9 stuff belongs into its branch
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.2 2006/08/16 00:00:24 tg Exp $ */
d3 1
d43 1
a43 1
#define	S_ISTXT	0001000			/* sticky bit */
d59 3
a61 3
#define	DEFFILEMODE	(S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)
mode_t	 getmode(const void *, mode_t);
void	*setmode(const char *);
d64 1
a64 1
#if defined(__INTERIX)
d66 4
a69 2
extern int   __cdecl	seteuid(uid_t);
extern int   __cdecl	setegid(gid_t);
@


1.2
log
@compat.h has a section 'extra headers', move inttypes.h there
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7 2005/11/19 23:51:01 tg Exp $ */
a7 3
#if defined(__Plan9__)
#include <inttypes.h>
#endif
@


1.1
log
@file compat.h was initially added on branch mirbsd.
@
text
@d1 70
@


1.1.2.1
log
@* add extra header for compat functions, too
* add src/lib/libc/gen/setmode.c
* sync src/lib/libc/string/strlfun.c
@
text
@@


1.1.2.2
log
@Shuffle some stuff around to the compat functions and add glue
@
text
@a0 69
/* $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $ */

/*-
 * Copyright (c) 2005
 *	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
 *
 * Licensee is hereby permitted to deal in this work without restric-
 * tion, including unlimited rights to use, publicly perform, modify,
 * merge, distribute, sell, give away or sublicence, provided all co-
 * pyright notices above, these terms and the disclaimer are retained
 * in all redistributions or reproduced in accompanying documentation
 * or other materials provided with binary redistributions.
 *
 * All advertising materials mentioning features or use of this soft-
 * ware must display the following acknowledgement:
 *	This product includes material provided by Thorsten Glaser.
 *
 * Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
 * any kind, expressed or implied, to the maximum extent permitted by
 * applicable law, but with the warranty of being written without ma-
 * licious intent or gross negligence; in no event shall licensor, an
 * author or contributor be held liable for any damage, direct, indi-
 * rect or other, however caused, arising in any way out of the usage
 * of this work, even if advised of the possibility of such damage.
 */

/* Part I: extra headers */

/* Part II: extra macros */

#ifndef timeradd
#define	timeradd(tvp, uvp, vvp)						\
	do {								\
		(vvp)->tv_sec = (tvp)->tv_sec + (uvp)->tv_sec;		\
		(vvp)->tv_usec = (tvp)->tv_usec + (uvp)->tv_usec;	\
		if ((vvp)->tv_usec >= 1000000) {			\
			(vvp)->tv_sec++;				\
			(vvp)->tv_usec -= 1000000;			\
		}							\
	} while (0)
#endif
#ifndef timersub
#define	timersub(tvp, uvp, vvp)						\
	do {								\
		(vvp)->tv_sec = (tvp)->tv_sec - (uvp)->tv_sec;		\
		(vvp)->tv_usec = (tvp)->tv_usec - (uvp)->tv_usec;	\
		if ((vvp)->tv_usec < 0) {				\
			(vvp)->tv_sec--;				\
			(vvp)->tv_usec += 1000000;			\
		}							\
	} while (0)
#endif

/* Part III: OS-dependent additions */

#if defined(__gnu_linux__)
size_t strlcat(char *, const char *, size_t);
size_t strlcpy(char *, const char *, size_t);
#endif

#if defined(__sun__)
size_t confstr(int, char *, size_t);
#endif

#if defined(__gnu_linux__) || defined(__sun__)
#define	DEFFILEMODE	(S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)
mode_t	 getmode(const void *, mode_t);
void	*setmode(const char *);
#endif
@


1.1.2.3
log
@* move _all_ #include stuff into sh.h
* sort out #include stuff which isn't necessary on MirOS into compat.h
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.2 2005/10/25 19:46:10 tg Exp $ */
a28 10
#if defined(__sun__)
#include <sys/mkdev.h>
#endif
#if !defined(__OpenBSD__) && !defined(__CYGWIN__)
#include <ulimit.h>
#endif
#if defined(__sun__) || defined(__gnu_linux__)
#include <values.h>
#endif

@


1.1.2.4
log
@make this work on Interix (tested)
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.3 2005/10/25 19:53:26 tg Exp $ */
d29 1
a29 1
#if defined(__sun__) || defined(__INTERIX)
a79 6

#if defined(__INTERIX)
#define	makedev(x,y)	mkdev((x),(y))
extern int   __cdecl	seteuid(uid_t);
extern int   __cdecl	setegid(gid_t);
#endif
@


1.1.2.5
log
@* setmode.c needs __SCCSID
* some OSes don't have S_ISTXT omg...
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.4 2005/10/25 20:24:41 tg Exp $ */
a38 1

a63 5
#ifndef S_ISTXT
#define	S_ISTXT	0001000			/* sticky bit */
#endif


@


1.1.2.6
log
@remove redundant licences already contained in ./copyright
to make the tarball smaller
@
text
@d1 25
a25 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.5 2005/10/25 20:48:18 tg Exp $ */
@


1.1.2.7
log
@| Total failed: 2 (as expected)
| Total passed: 203
| $ uname -a
| CYGWIN_NT-5.0 odem2k 1.5.18(0.132/4/2) 2005-07-02 20:30 i686 unknown unknown Cygwin

You have to install cpio, ed and gcc manually, and perl for the testsuite,
and you *CANNOT* legally redistribute the resulting binaries since cygwin1.dll
is GPL'd (unless you bought a licence from or are at Deadrat), but it looks OK
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.6 2005/10/25 21:04:16 tg Exp $ */
d57 1
a57 1
#if defined(__gnu_linux__) || defined(__sun__) || defined(__CYGWIN__)
@


1.1.2.7.2.1
log
@initial attempt at porting mksh to the Plan 9 ANSI'n'POSIX Environment
struck dumb at SIGWINCH/TIOCGWINSZ, we'll have to ifdef out all of the
command line editing code as a next measure

incidentally, my qemu just crashed (not the guest OS - Plan 9 - no, it
really crashed the "outside" qemu programme, won't redraw or catch the
mouse any more), so I'll call it a day
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7 2005/11/19 23:51:01 tg Exp $ */
d8 1
a8 1
#if !defined(__OpenBSD__) && !defined(__CYGWIN__) && !defined(__Plan9__)
d48 1
a48 1
#if defined(__gnu_linux__) || defined(__Plan9__)
a67 4

#if defined(__Plan9__)
typedef unsigned char u_char;
#endif
@


1.1.2.7.2.2
log
@bring back Plan 9 specific stuff; we only do APE, not xterm
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7.2.1 2006/08/15 23:49:51 tg Exp $ */
a7 3
#if defined(__Plan9__)
#include <inttypes.h>
#endif
@


1.1.2.7.2.3
log
@stuff not in Plan 9
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7.2.2 2006/08/18 19:04:34 tg Exp $ */
a47 5
#ifdef __Plan9__
#define S_ISLNK(x) 0
#define S_ISSOCK(x) 0
#endif

@


1.1.2.7.2.4
log
@killpg for Plan 9, from pdksh
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7.2.3 2006/08/24 19:52:56 tg Exp $ */
d49 2
a50 3
#define S_ISLNK(x)	0
#define S_ISSOCK(x)	0
#define killpg(p,s)	kill(-(p), (s))
@


1.1.2.7.2.5
log
@move tg-mksh-plan9ape_BASE to current cvs HEAD and sync tg-mksh-plan9ape branch
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.h,v 1.1.2.7.2.4 2006/08/24 20:07:22 tg Exp $ */
@


