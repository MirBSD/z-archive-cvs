head	1.3;
access;
symbols
	tg-mksh-minixthree_BASE:1.2
	tg-mksh-minixthree:1.2.0.2
	mksh-R28:1.1.2.7
	tg-mksh-plan9ape_BASE:1.1.2.7
	tg-mksh-plan9ape:1.1.2.7.0.2
	mksh-R27e:1.1.2.7
	MIRBSD_9_BASE:1.1.2.7
	mksh-R27d:1.1.2.7
	mksh-R27:1.1.2.7
	mksh-R26c:1.1.2.7
	mksh-R26b:1.1.2.7
	mksh-R26:1.1.2.7
	mksh-R25:1.1.2.7
	mirbsd:1.1.0.2;
locks; strict;
comment	@ * @;


1.3
date	2006.11.08.23.23.41;	author tg;	state dead;
branches;
next	1.2;
commitid	1004552670E1A677D8A;

1.2
date	2006.09.21.22.03.23;	author tg;	state Exp;
branches;
next	1.1;
commitid	10045130C366B82F12F;

1.1
date	2005.10.25.19.36.16;	author tg;	state dead;
branches
	1.1.2.1;
next	;
commitid	896435e8936c944;

1.1.2.1
date	2005.10.25.19.36.16;	author tg;	state Exp;
branches;
next	1.1.2.2;
commitid	896435e8936c944;

1.1.2.2
date	2005.10.25.19.46.10;	author tg;	state Exp;
branches;
next	1.1.2.3;
commitid	6836435e8b86013e;

1.1.2.3
date	2005.10.25.19.53.26;	author tg;	state Exp;
branches;
next	1.1.2.4;
commitid	76cc435e8d34d8ce;

1.1.2.4
date	2005.10.25.20.48.18;	author tg;	state Exp;
branches;
next	1.1.2.5;
commitid	4729435e9a1b954a;

1.1.2.5
date	2005.10.25.21.04.16;	author tg;	state Exp;
branches;
next	1.1.2.6;
commitid	6dd5435e9dd7fe74;

1.1.2.6
date	2005.10.26.08.45.32;	author tg;	state Exp;
branches;
next	1.1.2.7;
commitid	4a1c435f4233bbdf;

1.1.2.7
date	2005.11.19.23.51.01;	author tg;	state Exp;
branches
	1.1.2.7.2.1;
next	;
commitid	2fcc437fba432ffd;

1.1.2.7.2.1
date	2006.08.24.19.52.55;	author tg;	state Exp;
branches;
next	1.1.2.7.2.2;
commitid	10044EE03AB30C6D00A;

1.1.2.7.2.2
date	2006.08.24.19.58.31;	author tg;	state Exp;
branches;
next	1.1.2.7.2.3;
commitid	10044EE04F86417A028;

1.1.2.7.2.3
date	2006.08.24.20.52.10;	author tg;	state Exp;
branches;
next	1.1.2.7.2.4;
commitid	10044EE117A130AF943;

1.1.2.7.2.4
date	2006.08.28.01.49.15;	author tg;	state Exp;
branches;
next	;
commitid	10044F24B9666020C36;


desc
@@


1.3
log
@first attempts at more autoconf'isation
@
text
@#include "sh.h"

__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.2 2006/09/21 22:03:23 tg Exp $");

#if defined(__gnu_linux__) || defined(__sun__) || defined(__CYGWIN__)
#include "setmode.c"
#endif
@


1.2
log
@use the easier __RCSID() etc. stuff from current <sys/cdefs.h>
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.7 2005/11/19 23:51:01 tg Exp $");
@


1.1
log
@file compat.c was initially added on branch mirbsd.
@
text
@d1 7
@


1.1.2.1
log
@This is where compatibility routines for deficient OSes will go.
@
text
@@


1.1.2.2
log
@Shuffle some stuff around to the compat functions and add glue
@
text
@a0 31
/* $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $ */

/*-
 * Copyright (c) 2005
 *	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
 *
 * Licensee is hereby permitted to deal in this work without restric-
 * tion, including unlimited rights to use, publicly perform, modify,
 * merge, distribute, sell, give away or sublicence, provided all co-
 * pyright notices above, these terms and the disclaimer are retained
 * in all redistributions or reproduced in accompanying documentation
 * or other materials provided with binary redistributions.
 *
 * All advertising materials mentioning features or use of this soft-
 * ware must display the following acknowledgement:
 *	This product includes material provided by Thorsten Glaser.
 *
 * Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
 * any kind, expressed or implied, to the maximum extent permitted by
 * applicable law, but with the warranty of being written without ma-
 * licious intent or gross negligence; in no event shall licensor, an
 * author or contributor be held liable for any damage, direct, indi-
 * rect or other, however caused, arising in any way out of the usage
 * of this work, even if advised of the possibility of such damage.
 */

#include "compat.h"

#if defined(__gnu_linux__) || defined(__sun__)
#include "setmode.c"
#endif
@


1.1.2.3
log
@* move _all_ #include stuff into sh.h
* sort out #include stuff which isn't necessary on MirOS into compat.h
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.c,v 1.1.2.2 2005/10/25 19:46:10 tg Exp $ */
d27 1
a27 1
#include "sh.h"
@


1.1.2.4
log
@* setmode.c needs __SCCSID
* some OSes don't have S_ISTXT omg...
@
text
@d1 1
a1 1
/* $MirOS: src/bin/mksh/compat.c,v 1.1.2.3 2005/10/25 19:53:26 tg Exp $ */
a28 4
#ifndef __SCCSID
#define	__SCCSID(x)	static const char __sccsid[] __attribute__((used)) = (x)
#endif

@


1.1.2.5
log
@remove redundant licences already contained in ./copyright
to make the tarball smaller
@
text
@d1 26
a28 2
__RCSID("$MirOS$");

@


1.1.2.6
log
@quick fix for __RCSID() conflicts on GNU/Linux
discovered by Han Boetes
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.5 2005/10/25 21:04:16 tg Exp $");
a8 4
#undef __RCSID
#undef __RCSID2
#define	__RCSID2(x,y)	static const char __rcsid_ ## _y[] __attribute__((used)) = (x)

a9 1
#define	__RCSID(x)	__RCSID2((x),setmode)
a10 1
#undef __RCSID
@


1.1.2.7
log
@| Total failed: 2 (as expected)
| Total passed: 203
| $ uname -a
| CYGWIN_NT-5.0 odem2k 1.5.18(0.132/4/2) 2005-07-02 20:30 i686 unknown unknown Cygwin

You have to install cpio, ed and gcc manually, and perl for the testsuite,
and you *CANNOT* legally redistribute the resulting binaries since cygwin1.dll
is GPL'd (unless you bought a licence from or are at Deadrat), but it looks OK
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.6 2005/10/26 08:45:32 tg Exp $");
d13 1
a13 1
#if defined(__gnu_linux__) || defined(__sun__) || defined(__CYGWIN__)
@


1.1.2.7.2.1
log
@stuff not in Plan 9
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.7 2005/11/19 23:51:01 tg Exp $");
a17 26

#ifdef __Plan9__
int
seteuid(int x)
{
	return (setuid(x));
}

int
setegid(int x)
{
	return (setuid(x));
}

int
setreuid(int x)
{
	return (setuid(x));
}

int
setregid(int x)
{
	return (setuid(x));
}
#endif
@


1.1.2.7.2.2
log
@they don't even have mkstemp(3)!
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.7.2.1 2006/08/24 19:52:55 tg Exp $");
a42 10

int
mkstemp(char *x)
{
	char *fn;

	if ((fn = mktemp(x)) == NULL)
		return (-1);
	return (open(fn, O_CREAT|O_EXCL|O_RDWR, 0600));
}
@


1.1.2.7.2.3
log
@move tg-mksh-plan9ape_BASE to current cvs HEAD and sync tg-mksh-plan9ape branch
@
text
@d3 1
a3 1
__RCSID("$MirOS: src/bin/mksh/compat.c,v 1.1.2.7 2005/11/19 23:51:01 tg Exp $");
@


1.1.2.7.2.4
log
@merge the latest results of HEAD in here
and bring back the probably-problematic
chunk with a fat comment
@
text
@@


