head	1.8;
access;
symbols
	mksh-R57:1.6
	mksh-R56c:1.5
	mksh-R56b:1.5
	mksh-R56:1.5
	mksh-R55:1.5
	mksh-R54:1.4
	mksh-R53a:1.4
	mksh-R53:1.4
	mksh-R52c:1.4
	mksh-R52b:1.4
	mksh-R52:1.4
	mksh-R51:1.3
	mksh-R50f:1.2
	mksh-R50e:1.2
	mksh-R50stable:1.2.0.2
	mksh-R50d:1.2
	mksh-R50c:1.2
	mksh-R50b:1.2
	mksh-R50:1.2
	mksh-R49:1.1;
locks; strict;
comment	@# @;


1.8
date	2019.12.30.03.58.58;	author tg;	state Exp;
branches;
next	1.7;
commitid	1005E09760D6DFD4643;

1.7
date	2019.12.30.01.10.58;	author tg;	state Exp;
branches;
next	1.6;
commitid	1005E094E9A55F97D93;

1.6
date	2018.08.10.02.53.39;	author tg;	state Exp;
branches;
next	1.5;
commitid	1005B6CFE0B5BDFE404;

1.5
date	2017.02.18.02.33.15;	author tg;	state Exp;
branches;
next	1.4;
commitid	10058A7B271530B4CED;

1.4
date	2015.12.12.21.08.44;	author tg;	state Exp;
branches;
next	1.3;
commitid	100566C8CF54F3FF318;

1.3
date	2015.05.01.23.16.31;	author tg;	state Exp;
branches;
next	1.2;
commitid	100554409082C43CC56;

1.2
date	2014.06.09.12.28.19;	author tg;	state Exp;
branches;
next	1.1;
commitid	1005395A8677E96EF7B;

1.1
date	2013.11.17.22.22.56;	author tg;	state Exp;
branches;
next	;
commitid	100528941C810C8A893;


desc
@@


1.8
log
@move the “is inside eval” flag into struct env
@
text
@/*-
 * Copyright (c) 2013, 2014, 2015, 2017
 *	mirabilos <m@@mirbsd.org>
 *
 * Provided that these terms and disclaimer and all copyright notices
 * are retained or reproduced in an accompanying document, permission
 * is granted to deal in this work without restriction, including un-
 * limited rights to use, publicly perform, distribute, sell, modify,
 * merge, give away, or sublicence.
 *
 * This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
 * the utmost extent permitted by applicable law, neither express nor
 * implied; without malicious intent or gross negligence. In no event
 * may a licensor, author or contributor be held liable for indirect,
 * direct, other damage, loss, or other issues arising in any way out
 * of dealing in the work, even if advised of the possibility of such
 * damage or existence of a defect, except proven that it results out
 * of said person's immediate fault when using the work as intended.
 */

@@SHFLAGS_DEFNS
__RCSID("$MirOS: src/bin/mksh/sh_flags.opt,v 1.5 2017/02/18 02:33:15 tg Exp $");
@@SHFLAGS_ENUMS
#define FN(sname,cname,flags,ochar)	cname,
#define F0(sname,cname,flags,ochar)	cname = 0,
@@SHFLAGS_ITEMS
#define FN(sname,cname,flags,ochar)	((const char *)(&shoptione_ ## cname)) + 2,
@@@@

/* special cases */

<o:|!SHFLAGS_NOT_CMD
<T:|!SHFLAGS_NOT_CMD
<A:|!SHFLAGS_NOT_SET
<o;|!SHFLAGS_NOT_SET
<s|!SHFLAGS_NOT_SET

/*
 * options are sorted by their longnames
 */

/* -a	all new parameters are created with the export attribute */
>a|
F0("allexport", FEXPORT, OF_ANY

/* ./.	bgnice */
>| HAVE_NICE
FN("bgnice", FBGNICE, OF_ANY

/* ./.	enable {} globbing (non-standard) */
>|
FN("braceexpand", FBRACEEXPAND, OF_ANY

/* ./.	Emacs command line editing mode */
>|!MKSH_NO_CMDLINE_EDITING
FN("emacs", FEMACS, OF_ANY

/* -e	quit on error */
>e|
FN("errexit", FERREXIT, OF_ANY

/* ./.	Emacs command line editing mode, gmacs variant */
>|!MKSH_NO_CMDLINE_EDITING
FN("gmacs", FGMACS, OF_ANY

/* ./.	reading EOF does not exit */
>|
FN("ignoreeof", FIGNOREEOF, OF_ANY

/* ./.	inherit -x flag */
>|
FN("inherit-xtrace", FXTRACEREC, OF_ANY

/* -i	interactive shell */
>i|!SHFLAGS_NOT_CMD
FN("interactive", FTALKING, OF_CMDLINE

/* -k	name=value are recognised anywhere */
>k|
FN("keyword", FKEYWORD, OF_ANY

/* -l	login shell */
>l|!SHFLAGS_NOT_CMD
FN("login", FLOGIN, OF_CMDLINE

/* -X	mark dirs with / in file name completion */
>X|
FN("markdirs", FMARKDIRS, OF_ANY

/* -m	job control monitoring */
>m|!MKSH_UNEMPLOYED
FN("monitor", FMONITOR, OF_ANY

/* -C	don't overwrite existing files */
>C|
FN("noclobber", FNOCLOBBER, OF_ANY

/* -n	don't execute any commands */
>n|
FN("noexec", FNOEXEC, OF_ANY

/* -f	don't do file globbing */
>f|
FN("noglob", FNOGLOB, OF_ANY

/* ./.	don't kill running jobs when login shell exits */
>|
FN("nohup", FNOHUP, OF_ANY

/* ./.	don't save functions in history (no effect) */
>|
FN("nolog", FNOLOG, OF_ANY

/* -b	asynchronous job completion notification */
>b|!MKSH_UNEMPLOYED
FN("notify", FNOTIFY, OF_ANY

/* -u	using an unset variable is an error */
>u|
FN("nounset", FNOUNSET, OF_ANY

/* ./.	don't do logical cds/pwds (non-standard) */
>|
FN("physical", FPHYSICAL, OF_ANY

/* ./.	errorlevel of a pipeline is the rightmost nonzero value */
>|
FN("pipefail", FPIPEFAIL, OF_ANY

/* ./.	adhere more closely to POSIX even when undesirable */
>|
FN("posix", FPOSIX, OF_ANY

/* -p	privileged shell (suid) */
>p|
FN("privileged", FPRIVILEGED, OF_ANY

/* -r	restricted shell */
>r|!SHFLAGS_NOT_CMD
FN("restricted", FRESTRICTED, OF_CMDLINE

/* ./.	kludge mode for better compat with traditional sh (OS-specific) */
>|
FN("sh", FSH, OF_ANY

/* -s	(invocation) parse stdin (pseudo non-standard) */
>s|!SHFLAGS_NOT_CMD
FN("stdin", FSTDIN, OF_CMDLINE

/* -h	create tracked aliases for all commands */
>h|
FN("trackall", FTRACKALL, OF_ANY

/* -U	enable UTF-8 processing (non-standard) */
>U|
FN("utf8-mode", FUNNYCODE, OF_ANY

/* -v	echo input */
>v|
FN("verbose", FVERBOSE, OF_ANY

/* ./.	Vi command line editing mode */
>|!MKSH_NO_CMDLINE_EDITING
FN("vi", FVI, OF_ANY

/* ./.	enable ESC as file name completion character (non-standard) */
>|!MKSH_NO_CMDLINE_EDITING
FN("vi-esccomplete", FVIESCCOMPLETE, OF_ANY

/* ./.	enable Tab as file name completion character (non-standard) */
>|!MKSH_NO_CMDLINE_EDITING
FN("vi-tabcomplete", FVITABCOMPLETE, OF_ANY

/* ./.	always read in raw mode (no effect) */
>|!MKSH_NO_CMDLINE_EDITING
FN("viraw", FVIRAW, OF_ANY

/* -x	execution trace (display commands as they are run) */
>x|
FN("xtrace", FXTRACE, OF_ANY

/* -c	(invocation) execute specified command */
>c|!SHFLAGS_NOT_CMD
FN("", FCOMMAND, OF_CMDLINE

/*
 * anonymous flags: used internally by shell only (not visible to user)
 */

/* ./.	direct builtin call (divined from argv[0] multi-call binary) */
>|
FN("", FAS_BUILTIN, OF_INTERNAL

/* ./.	(internal) initial shell was interactive */
>|
FN("", FTALKING_I, OF_INTERNAL

|SHFLAGS_OPTCS
@


1.7
log
@introduce FEVALERR to replace (FERREXIT & 0x80)

fixes “set -e appears active within eval but isn’t”
reported by Martijn Dekker
@
text
@d2 1
a2 1
 * Copyright (c) 2013, 2014, 2015, 2017, 2019
a193 4
/* ./.	(internal) FERREXIT temporarily inhibited, during eval */
>|
FN("", FEVALERR, OF_INTERNAL

@


1.6
log
@same as in commitid 1005B6CF36E3932B560, plus assorted cleanup
@
text
@d2 1
a2 1
 * Copyright (c) 2013, 2014, 2015, 2017
d187 1
a187 1
 * anonymous flags: used internally by shell only (not visible to user
d194 4
@


1.5
log
@fixup relation between lksh and mksh (somewhat minimal delta)
@
text
@d22 1
a22 1
__RCSID("$MirOS: src/bin/mksh/sh_flags.opt,v 1.4 2015/12/12 21:08:44 tg Exp $");
d156 1
a156 1
FN("utf8-mode", FUNICODE, OF_ANY
@


1.4
log
@add explicit licence
@
text
@d2 1
a2 1
 * Copyright (c) 2013, 2014, 2015
d22 1
a22 1
__RCSID("$MirOS: src/bin/mksh/sh_flags.opt,v 1.3 2015/05/01 23:16:31 tg Exp $");
d55 1
a55 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
d63 1
a63 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
d163 1
a163 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
d167 1
a167 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
d171 1
a171 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
d175 1
a175 1
>|!defined(MKSH_NO_CMDLINE_EDITING) || defined(MKSH_LEGACY_MODE)
@


1.3
log
@sometimes, I feel pretty stupid

separate the backslash+newline things out of the *.opt files,
logically not 100% clean, but better as it is not generated
content anyway (keeping the one-liners in there for now, even
though more consistent would be shifting them out as well)
@
text
@d1 20
d22 1
a22 1
__RCSID("$MirOS: src/bin/mksh/sh_flags.opt,v 1.2 2014/06/09 12:28:19 tg Exp $");
@


1.2
log
@fix the “set ±p” issue for good
cf. http://blog.cmpxchg8b.com/2013/08/security-debianisms.html
@
text
@d2 1
a2 12
__RCSID("$MirOS: src/bin/mksh/sh_flags.opt,v 1.1 2013/11/17 22:22:56 tg Exp $");
#define FN(sname,cname,flags,ochar)		\
	static const struct {			\
		/* character flag (if any) */	\
		char c;				\
		/* OF_* */			\
		unsigned char optflags;		\
		/* long name of option */	\
		char name[sizeof(sname)];	\
	} shoptione_ ## cname = {		\
		ochar, flags, sname		\
	};
d7 1
a7 2
#define FN(sname,cname,flags,ochar)	\
	((const char *)(&shoptione_ ## cname)) + 2,
@


1.1
log
@static option creating for cmdline and set, too
(in preparation of doing something real with set ±p)
@
text
@d2 1
a2 1
__RCSID("$MirOS: src/bin/mksh/sh_flags.h,v 1.15 2013/07/21 18:47:24 tg Exp $");
d126 1
a126 1
/* -p	use suid_profile; privileged shell */
@

