head	1.9;
access;
symbols
	cvs-200810311900:1.1.3.1
	MIRBSD_10:1.2.0.2
	MIRBSD_10_BASE:1.2
	cvs-200607051500:1.1.3.1
	netbsd:1.1.3;
locks; strict;
comment	@ * @;


1.9
date	2019.01.05.16.02.29;	author tg;	state Exp;
branches;
next	1.8;
commitid	1005C30D4FC04E81E4A;

1.8
date	2010.03.16.21.44.02;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004B9FFBBA675E0E41;

1.7
date	2010.03.06.23.24.18;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004B92E431600E22B7;

1.6
date	2010.03.06.20.35.44;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004B92BCB662C7D22A;

1.5
date	2009.07.23.19.32.26;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004A68BAC01D44054A;

1.4
date	2008.10.31.19.25.48;	author tg;	state Exp;
branches;
next	1.3;
commitid	100490B5BC877164082;

1.3
date	2008.10.31.19.11.36;	author tg;	state Exp;
branches;
next	1.2;
commitid	100490B58676FCB2D2F;

1.2
date	2006.07.05.16.06.03;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044ABE38158225608;

1.1
date	2006.07.05.16.04.42;	author tg;	state Exp;
branches
	1.1.3.1;
next	;
commitid	10044ABE32A76E10D6A;

1.1.3.1
date	2006.07.05.16.04.42;	author tg;	state Exp;
branches;
next	1.1.3.2;
commitid	10044ABE32A76E10D6A;

1.1.3.2
date	2010.03.06.20.34.39;	author tg;	state Exp;
branches;
next	;
commitid	1004B92BC7173A36792;


desc
@@


1.9
log
@do not use libbsd, even on Debian (collapse FEDORA into GNUPORT):
it’ll RSN ship an incompatible strnvis() and strnunvis() from,
incidentally, NetBSD®… (and has fgetln/fparseln issues)
@
text
@/**	$MirOS: src/usr.sbin/makefs/nbsrc/sys/ufs/ufs/ufs_bswap.h,v 1.8 2010/03/16 21:44:02 tg Exp $ */
/*	$NetBSD: ufs_bswap.h,v 1.19 2009/10/19 18:41:17 bouyer Exp $	*/

/*
 * Copyright (c) 2009, 2010
 *	Thorsten Glaser <tg@@mirbsd.org>
 * Copyright (c) 1998 Manuel Bouyer.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

#ifndef _UFS_UFS_BSWAP_H_
#define _UFS_UFS_BSWAP_H_

#if defined(_KERNEL_OPT)
#include "opt_ffs.h"
#endif

#ifdef __MirBSD__
#include <sys/endian.h>
#elif defined(__GLIBC__)
#include <endian.h>
#else
#include <sys/bswap.h>
#endif

/* Macros to access UFS flags */
#ifdef FFS_EI
#define	UFS_MPNEEDSWAP(ump)	((ump)->um_flags & UFS_NEEDSWAP)
#define UFS_FSNEEDSWAP(fs)	((fs)->fs_flags & FS_SWAPPED)
#define	UFS_IPNEEDSWAP(ip)	UFS_MPNEEDSWAP((ip)->i_ump)
#else
#define	UFS_MPNEEDSWAP(ump)	(0)
#define UFS_FSNEEDSWAP(fs)	(0)
#define	UFS_IPNEEDSWAP(ip)	(0)
#endif

#if !defined(_KERNEL) || defined(FFS_EI)
#ifdef GNUPORT
#include <stdint.h>
#endif
/* inlines for access to swapped data */
static inline u_int16_t
ufs_rw16(uint16_t a, int ns)
{
	return ((ns) ? bswap16(a) : (a));
}

static inline u_int32_t
ufs_rw32(uint32_t a, int ns)
{
	return ((ns) ? bswap32(a) : (a));
}

static inline u_int64_t
ufs_rw64(uint64_t a, int ns)
{
	return ((ns) ? bswap64(a) : (a));
}
#else
#define ufs_rw16(a, ns) ((uint16_t)(a))
#define ufs_rw32(a, ns) ((uint32_t)(a))
#define ufs_rw64(a, ns) ((uint64_t)(a))
#endif

#define ufs_add16(a, b, ns) \
	(a) = ufs_rw16(ufs_rw16((a), (ns)) + (b), (ns))
#define ufs_add32(a, b, ns) \
	(a) = ufs_rw32(ufs_rw32((a), (ns)) + (b), (ns))
#define ufs_add64(a, b, ns) \
	(a) = ufs_rw64(ufs_rw64((a), (ns)) + (b), (ns))

#endif /* !_UFS_UFS_BSWAP_H_ */
@


1.8
log
@more integer types
@
text
@d1 1
a1 1
/**	$MirOS: src/usr.sbin/makefs/nbsrc/sys/ufs/ufs/ufs_bswap.h,v 1.7 2010/03/06 23:24:18 tg Exp $ */
d58 1
a58 1
#ifdef DEBIAN
@


1.7
log
@sync © lines
@
text
@d1 1
a1 1
/**	$MirOS: src/usr.sbin/makefs/nbsrc/sys/ufs/ufs/ufs_bswap.h,v 1.6 2010/03/06 20:35:44 tg Exp $ */
d5 1
a5 1
 * Copyright (c) 2009
d58 3
@


1.6
log
@merge
@
text
@d1 1
a1 1
/**	$MirOS: src/usr.sbin/makefs/nbsrc/sys/ufs/ufs/ufs_bswap.h,v 1.5 2009/07/23 19:32:26 tg Exp $ */
d5 2
a6 1
 * Copyright (c) 2009 Thorsten Glaser.
@


1.5
log
@apply fixes, missing includes, and Debian compatibility glue to makefs(8);
create an initial, experimental Debian source package for it for Luca Fav.
@
text
@d1 2
a2 2
/**	$MirOS: src/usr.sbin/makefs/nbsrc/sys/ufs/ufs/ufs_bswap.h,v 1.4 2008/10/31 19:25:48 tg Exp $ */
/*	$NetBSD: ufs_bswap.h,v 1.18 2006/01/29 21:42:42 dsl Exp $	*/
a15 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Manuel Bouyer.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.4
log
@let “make depend” succeed, carry over stuff from the old Makefile
@
text
@d1 1
a1 1
/**	$MirOS$ */
d5 1
d44 2
@


1.3
log
@bring MAIN branch into the pristine TNF state for reverse-merging
@
text
@d1 1
d41 3
d45 1
@


1.2
log
@make depend
@
text
@d40 1
a40 1
#include <sys/endian.h>
@


1.1
log
@Initial revision
@
text
@d40 1
a40 1
#include <sys/bswap.h>
@


1.1.3.1
log
@Import a gazillion of other files...
@
text
@@


1.1.3.2
log
@sync with TNF
@
text
@d1 1
a1 1
/*	$NetBSD: ufs_bswap.h,v 1.19 2009/10/19 18:41:17 bouyer Exp $	*/
d14 5
@

