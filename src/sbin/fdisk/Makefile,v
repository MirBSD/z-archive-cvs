head	1.6;
access;
symbols
	MIRBSD_10:1.5.0.2
	MIRBSD_10_BASE:1.5
	OPENBSD_4_0:1.1.1.3
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.2
	cvs-200504302130:1.1.1.2
	cvs-200504291700:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2010.08.14.20.53.07;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004C6702403C804E92;

1.5
date	2007.09.18.20.31.55;	author tg;	state Exp;
branches;
next	1.4;
commitid	10046F035A068BB8C9F;

1.4
date	2006.09.20.20.03.30;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045119E9F677AC322;

1.3
date	2005.03.14.22.16.09;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.19.49.54;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.26.30;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.26.30;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.29.17.05.32;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2006.09.20.19.06.47;	author tg;	state Exp;
branches;
next	;
commitid	10045119150397FC669;


desc
@@


1.6
log
@new library for all those pesky functions like cdblockedread() or
my arc4random extensions or ambstowcs(3) or whatever other MirBSD
specific functions we provide – this way, they can be shared on a
crunchgen(1)d executable (such as ramdisks’ instbin) but need not
affect libc or other shared libraries’ versions

XXX manpages ought to still be mandated
@
text
@# $MirOS: src/sbin/fdisk/Makefile,v 1.5 2007/09/18 20:31:55 tg Exp $

.include <bsd.own.mk>

PROG=		fdisk
SRCS=		cmd.c disk.c fdisk.c mbr.c misc.c part.c user.c manpage.S
MAN=		fdisk.8
DPADD+=		${LIBMBFUN} ${LIBUTIL}
LDADD+=		-lmbfun -lutil
COPTS+=		-Wall

.if !defined(NOMAN) || ${NOMAN:L} == "no"
manpage.o: fdisk.cat8
.else
AFLAGS_manpage.o+= -DNOMAN
.endif

.include <bsd.prog.mk>
@


1.5
log
@• disklabel: while here, replace the manpage.c-generation logic with one
  that uses GNU as(1)’s “.incbin” directive, like so often in the tree now
• fdisk: while here, do the same and sync the built-in MBR
@
text
@d1 1
a1 1
# $MirOS: src/sbin/fdisk/Makefile,v 1.4 2006/09/20 20:03:30 tg Exp $
d8 2
a9 2
DPADD+=		${LIBUTIL}
LDADD+=		-lutil
@


1.4
log
@merge fdisk, dhcp stuff
fix fdisk units
@
text
@d1 1
a1 1
# $MirOS: src/sbin/fdisk/Makefile,v 1.3 2005/03/14 22:16:09 tg Exp $
d6 1
a7 4
SRCS=		cmd.c disk.c fdisk.c mbr.c misc.c part.c user.c manpage.c
CLEANFILES+=	manpage.c
CFLAGS+=	-Wall

d10 1
d13 1
a13 7
manpage.c: fdisk.cat8
.endif

manpage.c:
	print 'const unsigned char manpage[] = ' >$@@
.if defined(NOMAN) && ${NOMAN:L} != "no"
	print -r '"no manual\n"' >>$@@
d15 1
a15 2
	col -b <fdisk.cat8 | sed -e 's/[\\"]/\\&/g' \
	    -e 's/^/"/' -e 's/$$/\\n"/' >>$@@
a16 1
	print ';' >>$@@
@


1.3
log
@remove references to sbin/bootsys; MBR will be back in fdisk
where it's only needed, and pregen'd
(though it shouldn't be too hard to build it natively even on ppc)
@
text
@d1 1
a1 1
# $MirOS: src/sbin/fdisk/Makefile,v 1.2 2005/03/06 19:49:54 tg Exp $
d19 1
a19 1
	print 'char manpage[] = ' >$@@
@


1.2
log
@merge src/sbin
@
text
@d1 1
a1 1
# $MirOS$
d9 1
a9 10

MBRPATH=	../bootsys/common/dosmbr
CPPFLAGS+=	-I${.OBJDIR}/${MBRPATH}
CFLAGS+=	-Wall -Werror
.PATH: ${.OBJDIR}/${MBRPATH}

${.OBJDIR}/${MBRPATH}/mbrcode.h:
	cd ${.CURDIR}/${MBRPATH} && ${MAKE} _DEP=1 $@@

fdisk.o: ${.OBJDIR}/${MBRPATH}/mbrcode.h
@


1.1
log
@Initial revision
@
text
@d1 1
a1 35
#
#	$OpenBSD: Makefile,v 1.27 2004/05/03 15:18:19 drahn Exp $
#
# Copyright (c) 1997 Tobias Weingartner
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

.if (${MACHINE} == "i386") || (${MACHINE} == "amd64") || \
    (${MACHINE} == "macppc") || (${MACHINE} == "alpha") || \
    (${MACHINE} == "cats")
PROG=	fdisk
SRCS=	fdisk.c user.c misc.c disk.c mbr.c part.c cmd.c manual.c
DPADD=	${LIBUTIL}
LDADD=	-lutil
CLEANFILES+=manual.c
d5 20
a24 10
.ifdef NOMAN
manual.c:
	(echo 'char manpage[] = "\\'; \
	echo "no manual\\"; \
	echo '";' ) > manual.c
.else
manual.c:	fdisk.cat8
	(echo 'char manpage[] = "\\'; \
	sed -e 's/[\\"]/\\&/g' -e 's/$$/\\n\\/' fdisk.cat8; \
	echo '";' ) > manual.c
d27 4
d32 2
a33 1
NOPROG=yes
d35 1
a35 3

MAN=	fdisk.8
MANSUBDIR=i386 amd64 macppc alpha cats
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@improve my Frankenstein OS (*wink* you know who you are) further
sans wchar_t of course

this is the essence of reading >1200 commit messages which suck
due to not having the new format of ours...
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.30 2005/02/16 20:39:38 millert Exp $
d30 1
a30 1
    (${MACHINE} == "cats") || (${MACHINE} == "zaurus") 
d41 3
a43 3
	(echo 'const char manpage[] = {'; \
	echo 'no manual' | gzip -9c | hexdump -ve '"0x" 1/1 "%02x,"'; \
	echo '};'; echo 'const int manpage_sz = sizeof(manpage);') > manual.c
d46 3
a48 3
	(echo 'const char manpage[] = {'; \
	cat fdisk.cat8 | gzip -9c | hexdump -ve '"0x" 1/1 "%02x,"'; \
	echo '};'; echo 'const int manpage_sz = sizeof(manpage);') > manual.c
d56 1
a56 1
MANSUBDIR=i386 amd64 macppc alpha cats zaurus
@


1.1.1.3
log
@import a few security-wise relevant changes right now
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.33 2006/07/09 21:02:38 miod Exp $
d28 3
a30 4
.if (${MACHINE} == "alpha") || (${MACHINE} == "amd64") || \
    (${MACHINE} == "armish") || (${MACHINE} == "cats") || \
    (${MACHINE} == "i386") || (${MACHINE} == "macppc") || \
    (${MACHINE} == "zaurus")
d41 1
a41 1
	(echo 'const unsigned char manpage[] = {'; \
d46 1
a46 1
	(echo 'const unsigned char manpage[] = {'; \
d56 1
a56 1
MANSUBDIR=alpha amd64 armish cats i386 macppc zaurus
@


