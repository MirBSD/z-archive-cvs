head	1.4;
access;
symbols
	MIRBSD_10:1.3.0.4
	MIRBSD_10_BASE:1.3
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.4
date	2010.07.25.16.31.07;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004C4C66B4083A50C4;

1.3
date	2005.11.17.12.07.57;	author tg;	state Exp;
branches;
next	1.2;
commitid	f32437c72426e47;

1.2
date	2005.03.06.19.50.16;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.26.38;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.26.38;	author tg;	state Exp;
branches;
next	;


desc
@@


1.4
log
@let modload(8) check the version of the running kernel with the version
of the kernel image and error out if they fail

something like “which kernel has been loaded” passed by the bootloader
would be better, of course, but this is failsafe unless someone manually
manipulates the version strings willingly
@
text
@# $MirOS: src/sbin/modload/Makefile,v 1.3 2005/11/17 12:07:57 tg Exp $
# $OpenBSD: Makefile,v 1.4 2002/01/08 21:28:38 ericj Exp $

PROG=		modload
SRCS=		modload.c exec.c util.c
MAN=		modload.8

.include <bsd.own.mk>

.if ${OBJECT_FMT:U} == "ELF"
SRCS+=		elf.c exec_elf.c
CLEANFILES+=	a.out.o exec_aout.o
CPPFLAGS+=	-DELF_SUPPORT
.elif ${OBJECT_FMT:L} == "aout"
SRCS+=		a.out.c exec_aout.c
CLEANFILES+=	elf.o exec_elf.o
CPPFLAGS+=	-DUSE_AOUT -DAOUT_SUPPORT
.endif

CPPFLAGS+=	-DIN_MODLOAD
.PATH: ${BSDSRCDIR}/usr.sbin/config

.include <bsd.prog.mk>
@


1.3
log
@module load/unload utilities cleanup spree:
* add MirOS RCS IDs
* make __CRAZY=Yes clean
* fix ELF/a.out detection
* remove duplicate file
* rewrite Makefile
* honour ELF vs a.out issue in "_%s" printing of symbol names
* allow modules to be named <foo>.ko as well
* use .Sq in manual page instead of by-hand quoting
* use <stdbool.h> instead of rolling our own
@
text
@d1 1
a1 1
# $MirOS: src/sbin/modload/Makefile,v 1.2 2005/03/06 19:50:16 tg Exp $
d5 1
a5 1
SRCS=		modload.c
d11 3
a13 2
SRCS+=		elf.c
CLEANFILES+=	a.out.o
d15 3
a17 3
SRCS+=		a.out.c
CLEANFILES+=	elf.o
CPPFLAGS+=	-DUSE_AOUT
d20 3
@


1.2
log
@merge src/sbin
@
text
@d1 1
a1 1
# $MirOS$
d4 3
a6 4
PROG=	modload
MAN=	modload.8

SRCS=	modload.c
d11 5
a15 3
SRCS+=	elf.c
.el${OBJECT_FMT:L} == "aout"
SRCS+=	a.out.c
@


1.1
log
@Initial revision
@
text
@d1 1
d9 1
a9 1
.include <bsd.own.mk>	# for ELF_TOOLCHAIN
d11 1
a11 1
.if (${ELF_TOOLCHAIN:L} == "yes")
d13 1
a13 1
.else
d15 1
a15 1
CFLAGS+=	-DUSE_AOUT
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
