head	1.10;
access;
symbols
	MIRBSD_10:1.9.0.2
	MIRBSD_10_BASE:1.9
	MIRBSD_9_BASE:1.6
	MIRBSD_8:1.5.0.2
	MIRBSD_8_BASE:1.5
	cvs-200507211800:1.1.1.2
	cvs-200504302130:1.1.1.2
	cvs-200504291700:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2010.08.14.20.53.06;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004C6702403C804E92;

1.9
date	2007.09.18.20.31.56;	author tg;	state Exp;
branches;
next	1.8;
commitid	10046F035A068BB8C9F;

1.8
date	2006.09.22.15.44.31;	author tg;	state Exp;
branches;
next	1.7;
commitid	100451404EB1D0250BD;

1.7
date	2006.06.30.23.18.04;	author tg;	state Exp;
branches;
next	1.6;
commitid	10044A5B12A66F53B0F;

1.6
date	2006.06.17.22.12.40;	author tg;	state Exp;
branches;
next	1.5;
commitid	10044947A600871A477;

1.5
date	2005.04.29.18.34.53;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.03.15.19.03.50;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.15.18.39.17;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.19.49.51;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.26.30;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.26.30;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.29.17.05.30;	author tg;	state Exp;
branches;
next	;


desc
@@


1.10
log
@new library for all those pesky functions like cdblockedread() or
my arc4random extensions or ambstowcs(3) or whatever other MirBSD
specific functions we provide – this way, they can be shared on a
crunchgen(1)d executable (such as ramdisks’ instbin) but need not
affect libc or other shared libraries’ versions

XXX manpages ought to still be mandated
@
text
@# $MirOS: src/sbin/disklabel/Makefile,v 1.9 2007/09/18 20:31:56 tg Exp $
# $OpenBSD: Makefile,v 1.38 2005/04/01 16:00:09 deraadt Exp $

.include <bsd.own.mk>

PROG=		disklabel
SRCS=		disklabel.c dkcksum.c editor.c manpage.S
DPADD+=		${LIBMBFUN} ${LIBUTIL}
LDADD+=		-lmbfun -lutil
MAN=		disklabel.8 disklabel.5
COPTS+=		-Wall

.if !defined(NOMAN) || ${NOMAN:L} == "no"
manpage.o: disklabel.cat8
.else
AFLAGS_manpage.o+= -DNOMAN
.endif

.if ${MACHINE_ARCH} == "i386"
CPPFLAGS+=	-DNUMBOOT=2 -DDOSLABEL
CPPFLAGS+=	-DSEEALSO="\"fdisk(8), installboot(8)\""
.endif

.if ${MACHINE_ARCH} == "sparc"
CPPFLAGS+=	-DSEEALSO="\"installboot(8)\"" -DCYLCHECK -DAAT0
.endif

.include <bsd.prog.mk>
@


1.9
log
@• disklabel: while here, replace the manpage.c-generation logic with one
  that uses GNU as(1)’s “.incbin” directive, like so often in the tree now
• fdisk: while here, do the same and sync the built-in MBR
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.8 2006/09/22 15:44:31 tg Exp $
d8 2
a9 2
DPADD+=		${LIBUTIL}
LDADD+=		-lutil
@


1.8
log
@manpage should be in .rodata and u_char like fdisk(8)
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.7 2006/06/30 23:18:04 tg Exp $
d7 1
a7 2
SRCS=		disklabel.c dkcksum.c editor.c manpage.c
CLEANFILES+=	manpage.c
d11 1
a11 1
CFLAGS+=	-Wall
d14 1
a14 7
manpage.c: disklabel.cat8
.endif

manpage.c:
	print 'const unsigned char manpage[] = ' >$@@
.if defined(NOMAN) && ${NOMAN:L} != "no"
	print -r '"no manual\n"' >>$@@
d16 1
a16 2
	col -b <disklabel.cat8 | sed -e 's/[\\"]/\\&/g' \
	    -e 's/^/"/' -e 's/$$/\\n"/' >>$@@
a17 1
	print ';' >>$@@
@


1.7
log
@check MACHINE_ARCH not MACHINE for same-userland stuff
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.6 2006/06/17 22:12:40 tg Exp $
d19 1
a19 1
	print 'char manpage[] = ' >$@@
@


1.6
log
@remove more of these AMD64 remains
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.5 2005/04/29 18:34:53 tg Exp $
d28 1
a28 1
.if ${MACHINE} == "i386"
d33 1
a33 1
.if ${MACHINE} == "sparc"
@


1.5
log
@(tentative) merge, more to come
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.4 2005/03/15 19:03:50 tg Exp $
d28 1
a28 1
.if (${MACHINE} == "i386") || (${MACHINE} == "amd64")
a36 5
.if ${MACHINE} == "macppc"
CPPFLAGS+=	-DDOSLABEL
CPPFLAGS+=	-DSEEALSO="\"fdisk(8)\""
.endif

@


1.4
log
@more compiler flags shuffling
@
text
@d1 2
a2 2
# $MirOS: src/sbin/disklabel/Makefile,v 1.3 2005/03/15 18:39:17 tg Exp $
# $OpenBSD: Makefile,v 1.30 2003/10/31 04:05:29 drahn Exp $
d28 1
a28 1
.if ${MACHINE} == "i386"
@


1.3
log
@only descend into archdep subdirs if building for that arch
@
text
@d1 1
a1 1
# $MirOS: src/sbin/disklabel/Makefile,v 1.2 2005/03/06 19:49:51 tg Exp $
d12 1
a12 1
CFLAGS+=	-Wall -Werror
@


1.2
log
@merge src/sbin
@
text
@d1 1
a1 1
# $MirOS$
d33 1
a33 1
.if ${MACHINE} == "sparc" || ${MACHINE} == "sparc64"
@


1.1
log
@Initial revision
@
text
@d1 2
a2 10
#	$OpenBSD: Makefile,v 1.35 2004/11/06 20:03:08 otto Exp $

PROG=	disklabel
SRCS=	disklabel.c dkcksum.c editor.c manual.c
DPADD=	${LIBUTIL}
LDADD=	-lutil
MAN=	disklabel.8 disklabel.5


CLEANFILES+=manual.c
d6 16
a21 5
.ifdef NOMAN
manual.c:
	(echo 'const char manpage[] = {'; \
	echo 'no manual' | gzip -9c | hexdump -ve '"0x" 1/1 "%02x,"'; \
	echo '};'; echo 'const int manpage_sz = sizeof(manpage);') > manual.c
d23 2
a24 22
manual.c:	disklabel.cat8
	(echo 'const char manpage[] = {'; \
	gzip -9c disklabel.cat8 | hexdump -ve '"0x" 1/1 "%02x,"'; \
	echo '};'; echo 'const int manpage_sz = sizeof(manpage);') > manual.c
.endif

.if (${MACHINE} == "alpha")
CFLAGS+= -DSEEALSO="\"fdisk(8), installboot(8)\""
.endif

.if (${MACHINE} == "cats")
CFLAGS+= -DSEEALSO="\"fdisk(8)\""
.endif

.if (${MACHINE} == "i386") || (${MACHINE} == "amd64")
CFLAGS+= -DNUMBOOT=2 -DDOSLABEL
CFLAGS+= -DSEEALSO="\"fdisk(8), installboot(8)\""
.endif


.if (${MACHINE} == "hp300") || (${MACHINE} == "vax") || (${MACHINE} == "hppa")
CFLAGS+= -DNUMBOOT=1
d26 1
d28 3
a30 3
.if (${MACHINE} == "sun3") || (${MACHINE} == "sparc") || \
    (${MACHINE} == "sparc64")
CFLAGS+= -DSEEALSO="\"installboot(8)\"" -DCYLCHECK -DAAT0
d33 2
a34 2
.if (${MACHINE} == "mvme68k") || (${MACHINE} == "mvme88k")
CFLAGS+= -DSEEALSO="\"installboot(8)\""
d37 3
a39 3
.if (${MACHINE} == "macppc")
CFLAGS+= -DDOSLABEL
CFLAGS+= -DSEEALSO="\"fdisk(8)\""
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@improve my Frankenstein OS (*wink* you know who you are) further
sans wchar_t of course

this is the essence of reading >1200 commit messages which suck
due to not having the new format of ours...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.38 2005/04/01 16:00:09 deraadt Exp $
d22 1
a22 1
	cat disklabel.cat8 | gzip -9c | hexdump -ve '"0x" 1/1 "%02x,"'; \
d30 1
a30 1
.if (${MACHINE} == "cats") || (${MACHINE} == "zaurus")
d40 1
a40 2
.if (${MACHINE} == "hp300") || (${MACHINE} == "vax") || \
    (${MACHINE} == "hppa") || (${MACHINE} == "hppa64")
@

