head	1.7;
access;
symbols
	MIRBSD_10:1.6.0.4
	MIRBSD_10_BASE:1.6
	MIRBSD_9_BASE:1.6
	MIRBSD_8:1.6.0.2
	MIRBSD_8_BASE:1.6
	cvs-200507211800:1.1.1.3
	cvs-200505050030:1.1.1.2
	cvs-200504291700:1.1.1.2
	cvs-200504261445:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2008.03.27.19.05.16;	author tg;	state Exp;
branches;
next	1.6;
commitid	10047EBEE7D110FDF6B;

1.6
date	2005.11.23.16.43.57;	author tg;	state Exp;
branches;
next	1.5;
commitid	560c43849c55498d;

1.5
date	2005.04.26.21.06.00;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.26.15.42.37;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.15.19.03.54;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.19.50.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.26.33;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.26.33;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.26.14.55.31;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2005.07.21.20.57.07;	author tg;	state Exp;
branches;
next	;
commitid	560042e0092f571e;


desc
@@


1.7
log
@‚Ä¢ move all the formerly statically linked binaries to /usr/d{,s}bin/ and
  link them dynamically, except‚Ä¶
  ‚Ä£ init(8) since it‚Äôs used for system startup (chflags(8) comes to mind)
  ‚Ä£ shutdown(8) since it‚Äôs 4550 root:operator, which would be hard to do
    in a non-exploitable way otherwise
  ‚Ä£ test(1), domainname(1), dhclient-script, since they are shell scripts
  ‚Ä£ ldconfig(8) to prevent shooting into ourselves‚Äô feet
‚Ä¢ add the build of two crunchgen(1)d binaries, dbins and dbinsuid, collec-
  ting the stuff formerly statically built (dbins is 0555 root:bin, while
  dbinsuid is 4555 root:bin ‚Äì {ping,traceroute}{,6} only)
‚Ä¢ some cosmetical et al. changes to the Makefiles involved
  ‚Ä£ spacing, shell
  ‚Ä£ utf-8
  ‚Ä£ use ${CONFGRP}
‚Ä¢ CFLAGS+=-DNFS -I‚Ä¶ ‚Üí CPPFLAGS+=‚Ä¶ *sigh*

This enables us to make most out of ports/sysutils/fakeroot

agreed bsiegert@@
‚Äúfakeroot ist cool‚Äù Jonathan Schleifer
idea from and ‚Äú:-)‚Äù Han Boetes
@
text
@# $MirOS: src/sbin/isakmpd/Makefile,v 1.6 2005/11/23 16:43:57 tg Exp $
# $OpenBSD: Makefile,v 1.77 2005/05/18 20:15:22 hshoexer Exp $
# $EOM: Makefile,v 1.78 2000/10/15 21:33:42 niklas Exp $

#
# Copyright (c) 1998, 1999, 2000, 2001 Niklas Hallqvist.  All rights reserved.
# Copyright (c) 2000, 2001 H√•kan Olsson.  All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

#
# This code was written under funding by Ericsson Radio Systems.
#

.PATH:		${.CURDIR}/sysdep/openbsd

PROG=		isakmpd
SRCS=		app.c attribute.c cert.c connection.c constants.c conf.c \
		cookie.c crypto.c dh.c doi.c exchange.c exchange_num.c \
		field.c hash.c if.c ike_auth.c ike_main_mode.c \
		ike_phase_1.c ike_quick_mode.c init.c ipsec.c ipsec_fld.c \
		ipsec_num.c isakmpd.c isakmp_doi.c isakmp_fld.c isakmp_num.c \
		key.c libcrypto.c log.c message.c math_2n.c math_group.c \
		prf.c sa.c sysdep.c timer.c transport.c virtual.c udp.c \
		ui.c util.c x509.c \
		pf_key_v2.c policy.c math_ec2n.c ike_aggressive.c isakmp_cfg.c \
		dpd.c monitor.c monitor_fdpass.c nat_traversal.c udp_encap.c

GENERATED=	exchange_num.h ipsec_fld.h ipsec_num.h isakmp_fld.h \
		isakmp_num.h
CLEANFILES=	exchange_num.c exchange_num.h ipsec_num.c ipsec_num.h \
		isakmp_num.c isakmp_num.h ipsec_fld.c ipsec_fld.h \
		isakmp_fld.c isakmp_fld.h
MAN=		isakmpd.8 isakmpd.conf.5 isakmpd.policy.5
CFLAGS+=	-Wall -Wstrict-prototypes -Wmissing-prototypes
CPPFLAGS+=	-I.

# Include symbolic debugging info
#DEBUG=		-g

# If you have ElectricFence available, you can spot abuses of the heap.
# (/usr/ports/devel/ElectricFence)
#LDADD+=		-L/usr/local/lib -lefence
#DPADD+=		/usr/local/lib/libefence.a

# If you like to use Boehm's garbage collector (/usr/ports/devel/boehm-gc).
#LDADD+=		-L/usr/local/lib -lgc
#DPADD+=		/usr/local/lib/libgc.a
#CPPFLAGS+=		-DUSE_BOEHM_GC -DGC_DEBUG
# You can also use Boehm's garbage collector as a means to find leaks.
#  # setenv GC_FIND_LEAK

.if make(install)
#SUBDIR+=	samples
.endif

# Enable for DNSSEC use
#CPPFLAGS+=	USE_DNSSEC
#SRCS+=		dnssec.c
#LWRESLIB=      /usr/local/lib/liblwres.a
#DNSSEC_CFLAGS= -I/usr/local/include -DLWRES

LDADD+=		${LWRESLIB} -lkeynote -lcrypto -ldes -lm
DPADD+=		${LWRESLIB} ${LIBKEYNOTE} ${LIBCRYPTO} ${LIBDES} ${LIBM}

exchange_num.c exchange_num.h: genconstants.sh exchange_num.cst
	${SHELL} ${.CURDIR}/genconstants.sh ${.CURDIR}/exchange_num

ipsec_fld.c ipsec_fld.h: genfields.sh ipsec_fld.fld
	${SHELL} ${.CURDIR}/genfields.sh ${.CURDIR}/ipsec_fld

ipsec_num.c ipsec_num.h: genconstants.sh ipsec_num.cst
	${SHELL} ${.CURDIR}/genconstants.sh ${.CURDIR}/ipsec_num

isakmp_fld.c isakmp_fld.h: genfields.sh isakmp_fld.fld
	${SHELL} ${.CURDIR}/genfields.sh ${.CURDIR}/isakmp_fld

isakmp_num.c isakmp_num.h: genconstants.sh isakmp_num.cst
	${SHELL} ${.CURDIR}/genconstants.sh ${.CURDIR}/isakmp_num

${PROG} beforedepend: ${GENERATED}

.include <bsd.prog.mk>
.include <bsd.subdir.mk>
@


1.6
log
@fastmerge
@
text
@d1 1
a1 1
# $MirOS: src/sbin/isakmpd/Makefile,v 1.5 2005/04/26 21:06:00 tg Exp $
d7 1
a7 1
# Copyright (c) 2000, 2001 HÂkan Olsson.  All rights reserved.
@


1.5
log
@some build fixes
@
text
@d1 3
a3 3
#	$MirOS: src/sbin/isakmpd/Makefile,v 1.4 2005/04/26 15:42:37 tg Exp $
#	$OpenBSD: Makefile,v 1.76 2005/04/08 21:09:36 deraadt Exp $
#	$EOM: Makefile,v 1.78 2000/10/15 21:33:42 niklas Exp $
a71 2
SUBDIR=		apps

@


1.4
log
@merge
@
text
@d1 1
a1 1
#	$MirOS: src/sbin/isakmpd/Makefile,v 1.3 2005/03/15 19:03:54 tg Exp $
d54 1
a54 1
CFLAGS+=	-Wall -Wstrict-prototypes -Wmissing-prototypes \
@


1.3
log
@more compiler flags shuffling
@
text
@d1 2
a2 2
#	$MirOS: src/sbin/isakmpd/Makefile,v 1.2 2005/03/06 19:50:03 tg Exp $
#	$OpenBSD: Makefile,v 1.58 2004/11/10 22:07:46 drahn Exp $
d34 1
a34 23
#
# This makefile is a "pmake" one, i.e. the make variant commonly found in
# BSD derived systems, where it is indeed named "make".  Other systems
# may provide this make variant as "pmake" or maybe "bsdmake".
#

# openbsd means OpenBSD 2.5 or newer. freeswan is the name for Linux with
# FreeS/WAN integrated, freebsd/netbsd means FreeBSD/NetBSD with KAME IPsec.
OS=		openbsd
#OS=		netbsd
#OS=		freebsd
#OS=		freeswan
#OS=		bsdi

# Compile-time configuration of otherwise optional features
#FEATURES=	tripledes des blowfish cast aes
#FEATURES+=	policy x509 ec aggressive debug gmp
#FEATURES+=	rawkey isakmp_cfg dnssec privsep nat_traversal dpd
FEATURES=	tripledes des blowfish cast aes
FEATURES+=	policy x509 ec aggressive debug
FEATURES+=	rawkey isakmp_cfg privsep nat_traversal dpd

.PATH:		${.CURDIR}/sysdep/${OS}
a36 2
BINDIR?=	/sbin
LDSTATIC?=	${STATIC}
d39 1
a39 1
		field.c gmp_util.c hash.c if.c ike_auth.c ike_main_mode.c \
d44 3
a46 1
		ui.c util.c
d55 1
a55 5
		-Wmissing-declarations
CPPFLAGS+=	-DNEED_SYSDEP_APP -I${.CURDIR} -I${.CURDIR}/sysdep/${OS} -I.
#CFLAGS+=	-Wsign-compare -Werror

# Different debugging & profiling suggestions
d58 1
a58 7
#DEBUG=		-g	# OpenBSD
#DEBUG_FLAGS=	-g	# FreeBSD
#CFLAGS+=	-g	# NetBSD, MirOS and others
#STRIPFLAG=		# NETBSD

# Do execution time profiles
#CFLAGS+=	-pg
a73 7
.include "sysdep/${OS}/Makefile.sysdep"

.if ${FEATURES} != ""
FEATURES_UC!=	echo ${FEATURES} | tr '[:lower:]' '[:upper:]'
CPPFLAGS+=	${FEATURES_UC:S/^/-DUSE_/g}
.endif

d78 5
a82 46
.if !make(install) && !defined(NO_REGRESS)
SUBDIR+=	regress
.endif

.for FEATURE in ${FEATURES}
.if exists(features/${FEATURE})
.include "features/${FEATURE}"
.endif
.endfor

.if ${FEATURES:Mgmp} == "gmp"
CPPFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_GMP
LDADD+=		-lgmp
DPADD+=		${LIBGMP}
.else
CPPFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_OPENSSL
.endif

.ifdef USE_KEYNOTE
USE_LIBCRYPTO=	yes
USE_LIBDES=	yes
LDADD+=		-lkeynote -lm
DPADD+=		${LIBKEYNOTE} ${LIBM}
CPPFLAGS+=	-DUSE_KEYNOTE
.endif

.ifdef USE_RAWKEY
USE_LIBCRYPTO=	yes
CPPFLAGS+=	-DUSE_RAWKEY
.endif

.ifdef USE_LIBCRYPTO
CPPFLAGS+=	-DUSE_LIBCRYPTO
LDADD+=		-lcrypto
DPADD+=		${LIBCRYPTO}
.endif

.ifdef USE_LIBDES
CPPFLAGS+=	-DUSE_LIBDES
LDADD+=		-ldes
DPADD+=		${LIBDES}
.endif

SRCS+=		${IPSEC_SRCS} ${X509} ${POLICY} ${EC} ${AGGRESSIVE} ${DNSSEC} \
		${ISAKMP_CFG} ${PRIVSEP} ${DPD} ${NAT_TRAVERSAL}
CFLAGS+=	${IPSEC_CFLAGS} ${DNSSEC_CFLAGS}
d84 2
a85 2
LDADD+=		${DESLIB} ${LWRESLIB}
DPADD+=		${DESLIBDEP} ${LWRESLIB}
a105 9

debug:
	(cd ${.CURDIR}; ${MAKE} DEBUG="-g -Werror")

show-os:
	@@echo ${OS}

show-features:
	@@echo ${FEATURES}
@


1.2
log
@merge src/sbin
@
text
@d1 1
a1 1
#	$MirOS$
d86 1
a86 1
#CFLAGS+=	-g	# NetBSD and others
@


1.1
log
@Initial revision
@
text
@d1 1
d77 2
a78 2
		-Wmissing-declarations -DNEED_SYSDEP_APP \
		-I${.CURDIR} -I${.CURDIR}/sysdep/${OS} -I.
d100 1
a100 1
#CFLAGS+=		-DUSE_BOEHM_GC -DGC_DEBUG
d110 1
a110 1
CFLAGS+=	${FEATURES_UC:S/^/-DUSE_/g}
d114 1
a114 1
SUBDIR+=	samples
d128 1
a128 1
CFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_GMP
d132 1
a132 1
CFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_OPENSSL
d140 1
a140 1
CFLAGS+=	-DUSE_KEYNOTE
d145 1
a145 1
CFLAGS+=	-DUSE_RAWKEY
d149 1
a149 1
CFLAGS+=	-DUSE_LIBCRYPTO
d155 1
a155 1
CFLAGS+=	-DUSE_LIBDES
d168 1
a168 1
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/exchange_num
d171 1
a171 1
	/bin/sh ${.CURDIR}/genfields.sh ${.CURDIR}/ipsec_fld
d174 1
a174 1
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/ipsec_num
d177 1
a177 1
	/bin/sh ${.CURDIR}/genfields.sh ${.CURDIR}/isakmp_fld
d180 1
a180 1
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/isakmp_num
d189 6
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@latest fixes from OpenBSD, last update for #8 if nothing weird happens
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.76 2005/04/08 21:09:36 deraadt Exp $
d33 23
a55 1
.PATH:		${.CURDIR}/sysdep/openbsd
d58 2
d62 1
a62 1
		field.c hash.c if.c ike_auth.c ike_main_mode.c \
d67 1
a67 3
		ui.c util.c x509.c \
		pf_key_v2.c policy.c math_ec2n.c ike_aggressive.c isakmp_cfg.c \
		dpd.c monitor.c monitor_fdpass.c nat_traversal.c udp_encap.c
d76 5
a80 1
		-Wmissing-declarations -I${.CURDIR} -I.
d83 7
a89 1
#DEBUG=		-g
d105 7
d116 25
a140 5
# Enable for DNSSEC use
#CFLAGS+=	USE_DNSSEC
#SRCS+=		dnssec.c
#LWRESLIB=      /usr/local/lib/liblwres.a
#DNSSEC_CFLAGS= -I/usr/local/include -DLWRES
d142 23
a164 2
LDADD+=		${LWRESLIB} -lkeynote -lcrypto -ldes -lm
DPADD+=		${LWRESLIB} ${LIBKEYNOTE} ${LIBCRYPTO} ${LIBDES} ${LIBM}
d185 3
@


1.1.1.3
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.77 2005/05/18 20:15:22 hshoexer Exp $
d71 2
@


