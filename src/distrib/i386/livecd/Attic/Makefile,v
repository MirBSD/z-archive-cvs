head	1.53;
access;
symbols
	MIRBSD_9_BASE:1.47;
locks; strict;
comment	@# @;


1.53
date	2006.08.17.19.58.03;	author tg;	state dead;
branches;
next	1.52;
commitid	10044E4CA2D0E8EFBD4;

1.52
date	2006.08.16.18.46.13;	author tg;	state Exp;
branches;
next	1.51;
commitid	10044E367FF357E2D31;

1.51
date	2006.07.28.20.06.47;	author tg;	state Exp;
branches;
next	1.50;
commitid	10044CA6E6260A01148;

1.50
date	2006.07.26.22.36.24;	author tg;	state Exp;
branches;
next	1.49;
commitid	10044C7EE7D315670A5;

1.49
date	2006.07.26.22.00.52;	author tg;	state Exp;
branches;
next	1.48;
commitid	10044C7E6286443E4CF;

1.48
date	2006.07.23.23.41.27;	author tg;	state Exp;
branches;
next	1.47;
commitid	10044C409313E5D0B2B;

1.47
date	2006.06.15.19.18.46;	author tg;	state Exp;
branches;
next	1.46;
commitid	1004491B2706C2443B2;

1.46
date	2006.05.29.17.30.20;	author tg;	state Exp;
branches;
next	1.45;
commitid	100447B2FA931FB39C1;

1.45
date	2006.05.28.21.19.18;	author tg;	state Exp;
branches;
next	1.44;
commitid	100447A13ED427C430C;

1.44
date	2006.05.28.20.41.18;	author tg;	state Exp;
branches;
next	1.43;
commitid	100447A0B00359F87B2;

1.43
date	2006.05.26.21.18.51;	author tg;	state Exp;
branches;
next	1.42;
commitid	1004477708C461A3A5B;

1.42
date	2006.05.26.21.09.02;	author tg;	state Exp;
branches;
next	1.41;
commitid	10044776E7E52ADE458;

1.41
date	2006.05.26.20.05.01;	author tg;	state Exp;
branches;
next	1.40;
commitid	10044775F7E6936CB72;

1.40
date	2006.05.26.17.34.52;	author tg;	state Exp;
branches;
next	1.39;
commitid	10044773C4E55BA0C64;

1.39
date	2006.05.25.21.32.05;	author tg;	state Exp;
branches;
next	1.38;
commitid	1004476224140DA1421;

1.38
date	2006.05.25.21.27.15;	author tg;	state Exp;
branches;
next	1.37;
commitid	1004476213B15C9FFCA;

1.37
date	2006.05.15.19.54.55;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004468DC9A0110D686;

1.36
date	2006.05.08.19.16.35;	author tg;	state Exp;
branches;
next	1.35;
commitid	100445F991F081C985F;

1.35
date	2006.04.27.08.31.38;	author tg;	state Exp;
branches;
next	1.34;
commitid	1004450818137B75535;

1.34
date	2006.04.19.21.28.27;	author tg;	state Exp;
branches;
next	1.33;
commitid	1004446AB82639D6F78;

1.33
date	2006.04.19.21.27.06;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004446AB1B438FA4C9;

1.32
date	2006.04.19.20.03.56;	author tg;	state Exp;
branches;
next	1.31;
commitid	100444697BE5381D0E6;

1.31
date	2006.04.19.20.03.28;	author tg;	state Exp;
branches;
next	1.30;
commitid	100444697911DC567B0;

1.30
date	2006.04.12.23.24.08;	author tg;	state Exp;
branches;
next	1.29;
commitid	100443D8C2B37C60496;

1.29
date	2006.04.11.18.52.21;	author tg;	state Exp;
branches;
next	1.28;
commitid	100443BFADF0BA1D5E5;

1.28
date	2006.04.10.23.00.04;	author tg;	state Exp;
branches;
next	1.27;
commitid	100443AE386639B5687;

1.27
date	2006.04.10.21.06.26;	author tg;	state Exp;
branches;
next	1.26;
commitid	100443AC8E407DB98BF;

1.26
date	2006.04.10.21.03.05;	author tg;	state Exp;
branches;
next	1.25;
commitid	100443AC7F2345C041D;

1.25
date	2006.04.10.20.47.47;	author tg;	state Exp;
branches;
next	1.24;
commitid	100443AC48718CADA77;

1.24
date	2006.04.10.19.10.51;	author tg;	state Exp;
branches;
next	1.23;
commitid	100443AADBE25E05304;

1.23
date	2006.04.07.23.38.14;	author tg;	state Exp;
branches;
next	1.22;
commitid	1004436F7CD48C3291E;

1.22
date	2006.04.07.23.30.09;	author tg;	state Exp;
branches;
next	1.21;
commitid	1004436F61262E6C8E6;

1.21
date	2006.04.07.23.29.01;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004436F5A902E4DC6A;

1.20
date	2006.04.07.12.41.43;	author tg;	state Exp;
branches;
next	1.19;
commitid	10044365E183999CF79;

1.19
date	2006.04.07.12.38.54;	author tg;	state Exp;
branches;
next	1.18;
commitid	10044365D744DF272BB;

1.18
date	2006.04.07.12.37.02;	author tg;	state Exp;
branches;
next	1.17;
commitid	10044365CF36B608D74;

1.17
date	2006.04.07.12.17.41;	author tg;	state Exp;
branches;
next	1.16;
commitid	100443658777410C4AE;

1.16
date	2006.04.07.12.15.58;	author tg;	state Exp;
branches;
next	1.15;
commitid	100443658067D599CBD;

1.15
date	2006.04.06.22.08.12;	author tg;	state Exp;
branches;
next	1.14;
commitid	1004435915E13C84749;

1.14
date	2006.04.06.22.05.35;	author tg;	state Exp;
branches;
next	1.13;
commitid	100443590BF7476FBEF;

1.13
date	2006.04.06.21.58.48;	author tg;	state Exp;
branches;
next	1.12;
commitid	10044358F1B69FB54BC;

1.12
date	2006.04.06.21.19.18;	author tg;	state Exp;
branches;
next	1.11;
commitid	100443585CF29CDC049;

1.11
date	2006.04.06.11.40.42;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004434FE2D6B92A46A;

1.10
date	2006.04.06.11.25.37;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004434FAB50A756477;

1.9
date	2006.04.06.00.58.25;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004434679D35DB18E8;

1.8
date	2006.04.05.23.58.35;	author tg;	state Exp;
branches;
next	1.7;
commitid	100443459C22EA4B256;

1.7
date	2006.04.05.23.40.47;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004434558638312C1B;

1.6
date	2006.04.05.23.39.47;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004434555173E73A7B;

1.5
date	2006.04.05.23.23.54;	author tg;	state Exp;
branches;
next	1.4;
commitid	100443451995E2107B1;

1.4
date	2006.04.05.23.20.01;	author tg;	state Exp;
branches;
next	1.3;
commitid	100443450AD61038BE9;

1.3
date	2006.04.05.23.15.59;	author tg;	state Exp;
branches;
next	1.2;
commitid	10044344FC274D1FE61;

1.2
date	2006.04.05.23.15.05;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044344F9071C6DEC7;

1.1
date	2006.04.05.23.14.40;	author tg;	state Exp;
branches;
next	;
commitid	10044344F6C1F24E946;


desc
@@


1.53
log
@* new Makefile structure
* move i386/livecd into baselive/ and sub-directory-structure appropriately
* rid unneeded files
* ifdef out build of rescue tools not needed on certain arches
@
text
@# $MirOS: src/distrib/i386/livecd/Makefile,v 1.52 2006/08/16 18:46:13 tg Exp $

.include <bsd.own.mk>

CDROM?=		livecd${OSrev}.iso
REALOBJDIR!=	readlink -nf ${.OBJDIR}
HOSTCFLAGS?=	${CFLAGS} ${COPTS}

ANONCVSROOT=	anoncvs@@anoncvs.mirbsd.org:/cvs

all install:

it: ${CDROM}

${CDROM}: unpack gendev addcontrib prepimg nukefiles makeimg

unpack:
	mkdir -p workdir/v${OSrev}
.for _i in base dev etc gnu xbase xetc
#.for _i in base dev etc gnu ports xbase xetc
	cd workdir && ${SUDO} tar xzphf ${BSDRELDIR}/rel/${_i}${OSrev}.ngz
.endfor
	cd workdir && ln -s ${.CURDIR}/../../ramdisk/00-README
	cd workdir/v${OSrev} && ln -s ${BSDRELDIR}/rel i386
	${SUDO} cp ${.CURDIR}/boot.* workdir/etc/
#	# create mount points
#	${SUDO} mkdir workdir/usr/{mpkg,ports/{Distfiles,Packages}}

gendev: mr.fs

mr.fs:
	dd if=/dev/zero of=mr.fs bs=512 count=8192
	${SUDO} vnconfig -v -c svnd0 mr.fs
	${SUDO} disklabel -w -r svnd0 ipldisc
	${SUDO} newfs -m 0 -o space -c 16 -i 1024 /dev/rsvnd0a
	mkdir -p tmpmnt
	${SUDO} mount /dev/svnd0a tmpmnt
	${SUDO} cp workdir/dev/MAKEDEV tmpmnt/
	cd tmpmnt && ${SUDO} ${MKSH} ./MAKEDEV all
	@@${SUDO} dd if=/dev/arandom bs=512 count=8 of=tmpmnt/.rs
	@@df -i tmpmnt
	-${SUDO} umount tmpmnt
	-${SUDO} vnconfig -u svnd0

addcontrib: addjupp addtinyirc

addjupp:
	mkdir -p tempdir/jupp
	@@if [[ -s ${BSDSRCDIR}/contrib/code/jupp/jupprc ]]; then \
		cd tempdir/jupp; \
		lndir ${BSDSRCDIR}/contrib/code/jupp; \
	else \
		cd tempdir; \
		cvs -Rqz3 -d ${ANONCVSROOT} co \
		    -PAdjupp contrib/code/jupp || rm -rf jupp; \
	fi
	@@if [[ -d tempdir/jupp ]]; then \
		targpath=$$(readlink -nf workdir); \
		cd tempdir/jupp; \
		CC=${CC:Q} CFLAGS=${CFLAGS:Q}\ ${COPTS:Q} ${MKSH} \
		    ./configure --prefix=/usr --sysconfdir=/etc; \
		make; \
		${SUDO} make install DESTDIR="$$targpath"; \
	fi

addtinyirc:
	mkdir -p tempdir/tinyirc
	@@if [[ -s ${BSDSRCDIR}/contrib/code/Snippets/tinyirc.c ]]; then \
		cd tempdir/tinyirc; \
		lndir ${BSDSRCDIR}/contrib/code/Snippets; \
	else \
		cd tempdir; \
		cvs -Rqz3 -d ${ANONCVSROOT} co \
		    -PAdtinyirc contrib/code/Snippets/tinyirc.c \
		    || rm -rf tinyirc; \
	fi
	@@if [[ -s tempdir/tinyirc/tinyirc.c ]]; then \
		targpath=$$(readlink -nf workdir); \
		cd tempdir/tinyirc; \
		${CC} ${CFLAGS} ${COPTS} ${CPPFLAGS} ${LDFLAGS} \
		    ${LDSTATIC} tinyirc.c -ltermcap; \
		${SUDO} install -c -s -o root -g bin -m 555 a.out \
		    $$targpath/usr/bin/tinyirc; \
	fi

prepimg:
	cd workdir && ${SUDO} mksh ${.CURDIR}/munge_it.sh

bsd.gz: ${REALOBJDIR}/../generic/bsd mr.fs rdsetroot
	-rm -f bsd bsd.gz
	gzip -d <${REALOBJDIR}/../generic/bsd >bsd
	print 'rootdev 6 0\nquit' | config -ef bsd	# (6,0) = cd0a
	./rdsetroot bsd <mr.fs
	gzip -n9 bsd

nukefiles:
#	cd workdir && ${SUDO} rm -rf etc/X11 usr/{local/lib/X11,releng} \
#	    usr/{,X11R6/,share/}{doc,info,man} usr/X11R6/lib/X11/doc
	cd workdir && ${SUDO} rm -rf etc/X11 usr/{local/lib/X11,releng} \
	    usr/{,X11R6/}{doc,info,man} usr/X11R6/lib/X11/doc
	-for name in workdir/usr/lib/*@@(.so.*|.a); do \
		print -n stripping $$name ...; \
		if [[ $$name = *.a ]]; then \
			${SUDO} strip -g $$name && print; \
		else \
			${SUDO} strip -s $$name && print; \
		fi; \
	done

makeimg: bsd.gz mr.fs
	${SUDO} dd if=bsd.gz obs=2048 conv=osync of=workdir/bsd
	${SUDO} dd if=${BSDOBJDIR}/sys/arch/i386/stand/liveboot/boot \
	    obs=2048 conv=osync of=workdir/v${OSrev}/i386/boot.liv
	cd workdir/v${OSrev}/i386 && ${SUDO} cp boot.liv boot.iso
	sed 's!RMD160 (!&v${OSrev}/i386/!' <workdir/v${OSrev}/i386/RMD160 \
	    >workdir/RMD160
	touch workdir/boot.cat
	cd workdir && rmd160 00-README boot.cat bsd stand/fsrw.cpio \
	    tftpboot/bsd tftpboot/pxeboot v${OSrev}/i386/boot.iso \
	    v${OSrev}/i386/boot.liv >>RMD160
	rm -f workdir/boot.cat
	cd workdir; rm -f boot.cat; sort -uo RMD160 RMD160; gzip -n9 RMD160
	# pad for gzsig(1) application later on
	dd if=/dev/zero count=2 >>workdir/RMD160.gz
	-rm -f ${CDROM}
	cd workdir && ${SUDO} ${MKSH} ${.CURDIR}/mklocatedb.sh \
	    ${REALOBJDIR}/mr.fs
	touch ${CDROM}
	${SUDO} mkisofs -R -L -d -D -N -v -v -f \
	    -b v${OSrev}/i386/boot.iso -c boot.cat -p "Thorsten Glaser" \
	    -P "The http://MirBSD.de/ team and its contributors" \
	    -V "MirOS #${OSrev} BSD/${MACHINE} Live CD" \
	    -volset "$$(uname -slm) Live" -sysid "MirOSBSD" \
	    -no-emul-boot -boot-load-size 4 -boot-info-table \
	    -pad -o ${CDROM} workdir 2>&1 | tee mkisofs.log
	workdir/usr/mdec/installboot -v -I \
	    $$(fgrep 'workdir/v${OSrev}/i386/boot.liv' mkisofs.log | \
		while read start end rest; do print $$start $$end; done) \
	    workdir/usr/mdec/bootxx ${CDROM}

rdsetroot:	${.CURDIR}/../../common/elfrdsetroot.c
	${HOSTCC} ${HOSTCFLAGS} -DDEBUG -o $@@ ${.ALLSRC}

unconfig:
	-${SUDO} umount -f /dev/svnd0a
	-${SUDO} vnconfig -u svnd0

.PHONY:	addcontrib addjupp addtinyirc clean cleandir cleannobsd cleanworkdir \
	gendev it makeimg nukefiles prepimg tstmnt tstumnt unconfig unpack

clean cleandir cleannobsd: cleanworkdir
	-rm -f ${CDROM} bsd{,.gz} mkisofs.log mr.fs rdsetroot
	-rm -rf tempdir tmpmnt

cleanworkdir:
	-test ! -e workdir || ${SUDO} rm -rf workdir

tstmnt:
	${SUDO} vnconfig svnd0 ${CDROM}
	${SUDO} mount_cd9660 /dev/svnd0a tmpmnt

tstumnt: unconfig

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
@


1.52
log
@prefer arc4random and don't htonl() its return value
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.51 2006/07/28 20:06:47 tg Exp $
@


1.51
log
@disable mirports on the CD, for now
size constraints / issues
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.50 2006/07/26 22:36:24 tg Exp $
d40 1
a40 1
	@@${SUDO} dd if=/dev/urandom bs=512 count=8 of=tmpmnt/.rs
@


1.50
log
@move 00-README and rewrite much of the text
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.49 2006/07/26 22:00:52 tg Exp $
d19 2
a20 1
.for _i in base dev etc gnu ports xbase xetc
d26 2
a27 2
	# create mount points
	${SUDO} mkdir workdir/usr/{mpkg,ports/{Distfiles,Packages}}
@


1.49
log
@move boot.cfg
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.48 2006/07/23 23:41:27 tg Exp $
d22 1
a22 1
	cd workdir && ln -s ${.CURDIR}/../iso/00-README
@


1.48
log
@rename ldsec to bootxx to match all other arches
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.47 2006/06/15 19:18:46 tg Exp $
d24 1
a24 4
	cd workdir/etc; \
	    for a in ${.CURDIR}/../iso/boot.cfg ${.CURDIR}/boot.*; do \
		${SUDO} cp $$a .; \
	done
@


1.47
log
@mirbsd.org, 66h.42h.de, bsdadvocacy.org, and whatnot
we changed that too often, try to clean up the mess
mostly outside the www/ module which is dead anyway.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.46 2006/05/29 17:30:20 tg Exp $
d141 1
a141 1
	    workdir/usr/mdec/ldsec ${CDROM}
@


1.46
log
@* tinyirc.c is not a directory
* install -o root requires (obviously) sudo privs

sorry guys, but next time, the live cd _will_ contain tinyirc.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.45 2006/05/28 21:19:18 tg Exp $
d9 1
a9 2
#ANONCVSROOT=	_anoncvs@@anoncvs.66h.42h.de:/cvs
ANONCVSROOT=	anoncvs@@unixforge.de:/cvs
d133 1
a133 1
	    -P "The http://MirBSD.org/ team and its contributors" \
@


1.45
log
@switch to gecko2s anoncvs mirror for now
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.44 2006/05/28 20:41:18 tg Exp $
d80 1
a80 1
	@@if [[ -d tempdir/tinyirc/tinyirc.c ]]; then \
d85 1
a85 1
		install -c -s -o root -g bin -m 555 a.out \
@


1.44
log
@don't duplicate data
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.43 2006/05/26 21:18:51 tg Exp $
d9 3
d57 1
a57 1
		cvs -Rqz3 -d _anoncvs@@anoncvs.66h.42h.de:/cvs co \
d76 1
a76 1
		cvs -Rqz3 -d _anoncvs@@anoncvs.66h.42h.de:/cvs co \
@


1.43
log
@* while stuff fits, still nuke some files (not the base docs tho)
* move a rm from munge_it.sh to Makefile too
* incidentally, stripping never worked before (missing sudo)
* don't strip i18n bundles (who t.f. versions bundles (not dylibs)?)
* don't strip gcc libs either
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.42 2006/05/26 21:09:02 tg Exp $
d122 1
a122 2
	sort -uo workdir/RMD160 workdir/RMD160
	gzip -n9 <workdir/RMD160 >workdir/RMD160.gz
@


1.42
log
@some path relocation issues (locate db)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.41 2006/05/26 20:05:01 tg Exp $
d13 1
a13 2
#${CDROM}: unpack gendev addcontrib prepimg nukefiles makeimg
${CDROM}: unpack gendev addcontrib prepimg makeimg
d97 2
d100 9
a108 3
	    usr/{,X11R6/,share/}{doc,info,man}
	-strip -s $$(find workdir/usr/lib -name \*.so.\*)
	-strip -g $$(find workdir/usr/lib -name \*.a)
@


1.41
log
@missing priviledgues
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.40 2006/05/26 17:34:52 tg Exp $
d120 2
a121 1
	cd workdir && ${SUDO} ${MKSH} ${.CURDIR}/mklocatedb.sh ${.CURDIR}/mr.fs
@


1.40
log
@reverse test logic (Makefile)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.39 2006/05/25 21:32:05 tg Exp $
d28 1
a28 1
	mkdir workdir/usr/{mpkg,ports/{Distfiles,Packages}}
@


1.39
log
@extract ports onto the live CD too
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.38 2006/05/25 21:27:15 tg Exp $
d149 1
a149 1
	-test -e workdir && ${SUDO} rm -rf workdir
@


1.38
log
@don't "nukefiles" at the moment, let's see if a full install fits
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.37 2006/05/15 19:54:55 tg Exp $
d18 1
a18 1
.for _i in base dev etc gnu xbase xetc
a20 1
	mkdir workdir/usr/mpkg
d27 2
@


1.37
log
@first try at a locate database on the live CD
idea but no code by Vutral
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.36 2006/05/08 19:16:35 tg Exp $
d13 2
a14 1
${CDROM}: unpack gendev addcontrib prepimg nukefiles makeimg
@


1.36
log
@add tinyirc to live CD
- untested
- needs to be cleaned up
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.35 2006/04/27 08:31:38 tg Exp $
d101 1
a101 1
makeimg: bsd.gz
d118 1
@


1.35
log
@we might need a /usr/mpkg mount point for mfs
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.34 2006/04/19 21:28:27 tg Exp $
d44 3
a46 1
addcontrib:
d65 20
d138 2
a139 2
.PHONY:	addcontrib clean cleandir cleannobsd cleanworkdir gendev it makeimg \
	nukefiles prepimg tstmnt tstumnt unconfig unpack
@


1.34
log
@get rid of TRANS.TBL
(oh my, reminds me of trying to install Caldera OpenLinux 1.2)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.33 2006/04/19 21:27:06 tg Exp $
d20 1
@


1.33
log
@* Makefile: remove RMD160.gz generation which didn't work
* Makefile: add boot.iso, boot.liv to index.txt
* livecd: generate RMD160.gz here instead (actually working)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.32 2006/04/19 20:03:56 tg Exp $
d96 1
a96 1
	${SUDO} mkisofs -R -T -L -d -D -N -v -v -f \
@


1.32
log
@okay, strip static libs as well
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.31 2006/04/19 20:03:28 tg Exp $
d83 11
@


1.31
log
@strip shlibs on the live CD (XXX what about static libs?)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.30 2006/04/12 23:24:08 tg Exp $
d76 1
@


1.30
log
@rm workdir only if needed
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.29 2006/04/11 18:52:21 tg Exp $
d75 1
@


1.29
log
@solve the X11 auth problem (more symlinks issues) and, überhaupt,
all symlink-related problems by just packing them on the ram disc
or nuking them
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.28 2006/04/10 23:00:04 tg Exp $
d110 1
a110 1
	-${SUDO} rm -rf workdir
@


1.28
log
@add 'cleanworkdir'
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.27 2006/04/10 21:06:26 tg Exp $
d24 1
a24 1
		${SUDO} ln -fs $$a; \
d73 2
a74 2
	cd workdir/usr && ${SUDO} rm -rf \
	    X11R6/{lib/X11/doc,man} {,share/}{doc,info,man} releng
@


1.27
log
@add the readme to the CD, too
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.26 2006/04/10 21:03:05 tg Exp $
d102 1
a102 1
.PHONY:	addcontrib clean cleandir cleannobsd gendev it makeimg \
d105 1
a105 1
clean cleandir cleannobsd:
d108 2
@


1.26
log
@* put etc/boot.x86 into v8/i386/boot.iso instead (this is the
  one patched by mkisofs(8) -boot-info-table)
* put the boot catalogue into /
* livecd: use liveboot instead of boot(8) in the hard disc case, too
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.25 2006/04/10 20:47:47 tg Exp $
d20 1
@


1.25
log
@undo 100443459C22EA4B256
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.7 2006/04/05 23:40:47 tg Exp $
d16 1
a16 1
	mkdir -p workdir/v8
d20 1
a20 1
	cd workdir/v8 && ln -s ${BSDRELDIR}/rel i386
d78 2
a79 1
	    obs=2048 conv=osync of=workdir/etc/boot.x86
d83 1
a83 1
	    -b etc/boot.x86 -c etc/boot.cat -p "Thorsten Glaser" \
d90 1
a90 1
	    $$(fgrep 'workdir/usr/mdec/boot' mkisofs.log | \
@


1.24
log
@fix hook stuff, enable liveboot
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.23 2006/04/07 23:38:14 tg Exp $
d17 1
a17 2
#.for _i in base dev etc gnu xbase xetc
.for _i in base dev etc gnu
@


1.23
log
@starting from now, official MirOS ISOs can be installed onto foreign
peoples' IBM X40s by 'cat cdrom8.iso >/dev/hda' under lunox as root;
same for the live CD except you need to use 'boot -a' there.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.22 2006/04/07 23:30:09 tg Exp $
d16 1
a16 1
	mkdir -p workdir
d21 5
d78 2
a79 2
	${SUDO} dd if=workdir/usr/mdec/boot obs=2048 conv=osync \
	    of=workdir/etc/boot.x86
d82 1
a82 1
	${SUDO} mkisofs -R -T -L -d -D -N -v -v \
d101 2
a102 1
.PHONY: addcontrib gendev it makeimg nukefiles prepimg unconfig unpack
d109 6
@


1.22
log
@log to mkisofs.log (both cases)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.21 2006/04/07 23:29:01 tg Exp $
d84 4
@


1.21
log
@cool trick: if touch(1)ing the ISO file as user before creating it as root
permissions are correct
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.20 2006/04/07 12:41:43 tg Exp $
d83 1
a83 1
	    -pad -o ${CDROM} workdir 2>&1 | tee makeimg.log
d95 1
a95 1
	-rm -f ${CDROM} bsd{,.gz} makeimg.log mr.fs rdsetroot
@


1.20
log
@yeah, catch the right thing... temee...
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.19 2006/04/07 12:38:54 tg Exp $
d75 2
@


1.19
log
@log image creation to hunt broken rock ridge stuff
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.18 2006/04/07 12:37:02 tg Exp $
d81 1
a81 1
	    -pad -o ${CDROM} workdir | tee makeimg.log
@


1.18
log
@* adjust sizes of mfs to prevent cylgroup stuff warnings
* give 'em a little bit more entropy on the way
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.17 2006/04/07 12:17:41 tg Exp $
d81 1
a81 1
	    -pad -o ${CDROM} workdir
d93 1
a93 1
	-rm -f ${CDROM} bsd{,.gz} mr.fs rdsetroot
@


1.17
log
@fix 'make clean'; use less privs
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.16 2006/04/07 12:15:58 tg Exp $
d33 1
@


1.16
log
@* livecd: attempt at using the 4 MiB ramdisk image for /dev (and /root)
* common: sync
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.15 2006/04/06 22:08:12 tg Exp $
d92 3
a94 1
	-${SUDO} rm -rf ${CDROM} bsd{,.gz} mr.fs tempdir tmpmnt workdir
@


1.15
log
@no need for /usr/releng on the CD either
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.14 2006/04/06 22:05:35 tg Exp $
d7 1
d13 1
a13 1
${CDROM}: unpack addcontrib prepimg nukefiles makeimg
d22 15
d59 1
a59 1
bsd.gz: ${REALOBJDIR}/../generic/bsd
d63 1
d82 8
a89 1
.PHONY: addcontrib it makeimg nukefiles prepimg unpack
d92 1
a92 1
	-${SUDO} rm -rf ${CDROM} bsd bsd.gz tempdir workdir
@


1.14
log
@/usr/man? /usr/info? you must be kidding
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.13 2006/04/06 21:58:48 tg Exp $
d51 1
a51 1
	    X11R6/{lib/X11/doc,man} {,share/}{doc,info,man}
@


1.13
log
@can't be /etc/boot.386 any more (for /usr/mdec/boot),
we'll use /etc/boot.x86 (for liveboot, too, then, probably)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.12 2006/04/06 21:19:18 tg Exp $
d51 1
a51 1
	    X11R6/{lib/X11/doc,man} share/{doc,info,man}
@


1.12
log
@* livecd/Makefile: use CFLAGS; plug bsd in the right place
* RAIDframe: if root device overridden from UKC, don't ask
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.11 2006/04/06 11:40:42 tg Exp $
d56 1
a56 1
	    of=workdir/etc/boot.386
d58 1
a58 1
	    -b etc/boot.386 -c etc/boot.cat \
a59 1
	    -p "Copyright © 2002-2006 by The MirOS Project" \
@


1.11
log
@* use bootloader from extracted package (for now;
  later we'll use src/sys/arch/i386/stand/liveboot instead ;)
* add contrib/code/jupp into the image, as an exception (untested)
* sync CLEANFILES
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.10 2006/04/06 11:25:37 tg Exp $
d34 2
a35 2
		CC=${CC:Q} ${MKSH} ./configure \
		    --prefix=/usr --sysconfdir=/etc; \
d37 1
a37 1
		make install DESTDIR="$$targpath"; \
d40 1
a40 1
prepimg: bsd.gz
a41 3
	${SUDO} dd if=bsd.gz obs=2048 conv=osync of=workdir/bsd
	${SUDO} dd if=workdir/usr/mdec/boot obs=2048 conv=osync \
	    of=workdir/etc/boot.386
d53 4
a56 1
makeimg:
@


1.10
log
@manually remove most of the java/Ada-related entries; full sync follows
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.9 2006/04/06 00:58:25 tg Exp $
d12 1
a12 1
${CDROM}: unpack prepimg nukefiles makeimg
d21 19
d43 1
a43 1
	${SUDO} dd if=${DESTDIR}/usr/mdec/boot obs=2048 conv=osync \
d66 1
a66 1
.PHONY: it unpack prepimg makeimg nukefiles
d69 1
a69 1
	-${SUDO} rm -rf ${CDROM} workdir
@


1.9
log
@with the new config(8) we shouldn't even need that any more
(XXX untested, I'm going to bed REALLY now)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.8 2006/04/05 23:58:35 tg Exp $
d34 2
a35 2
	cd workdir/usr && ${SUDO} rm -rf X11R6/lib/X11/doc X11R6/man \
	    lib/libgcj.* share/{doc,gnat,info,java,man}
@


1.8
log
@test w/o X11, faster cycles
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.7 2006/04/05 23:40:47 tg Exp $
d21 1
a21 1
prepimg:
d23 1
d26 6
a31 4
	${SUDO} dd if=${REALOBJDIR}/../ramdisk/bsd.rd obs=2048 conv=osync \
	    of=workdir/bsd
	${SUDO} install -c -o root -g wheel -m 644 ${.CURDIR}/boot.cfg \
	    workdir/etc/
@


1.7
log
@mkisofs(8) must be run as root, too,
in order to be allowed to descend that deeply
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.6 2006/04/05 23:39:47 tg Exp $
d16 2
a17 1
.for _i in base dev etc gnu xbase xetc
@


1.6
log
@work around a little quoting, paths and sudo confusion
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.5 2006/04/05 23:23:54 tg Exp $
d34 1
a34 1
	mkisofs -R -T -L -d -D -N -v -v \
@


1.5
log
@kill some files to make the live CD fit onto a CD
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.4 2006/04/05 23:20:01 tg Exp $
d22 1
a22 1
	dd if=${DESTDIR}/usr/mdec/boot obs=2048 conv=osync \
d24 1
a24 1
	dd if=${REALOBJDIR}/../ramdisk/bsd.rd obs=2048 conv=osync \
d26 2
a27 1
	cp ${.CURDIR}/boot.cfg workdir/etc/
@


1.4
log
@* both: use -pad
* livecd: fix rock ridge
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.3 2006/04/05 23:15:59 tg Exp $
d12 1
a12 1
${CDROM}: unpack prepimg makeimg
d28 4
d42 1
a42 1
.PHONY: it unpack prepimg makeimg
@


1.3
log
@fix 'make clean', use sudo
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.2 2006/04/05 23:15:05 tg Exp $
d29 1
a29 1
	mkisofs -r -f -T -L -d -D -N -v -v \
d36 1
a36 1
	    -o ${CDROM} workdir
@


1.2
log
@be cool
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/livecd/Makefile,v 1.1 2006/04/05 23:14:40 tg Exp $
d41 1
a41 1
	-rm -rf ${CDROM} workdir
@


1.1
log
@add some live cd stuff to aid me in testing this
@
text
@d1 1
a1 1
# $MirOS$
d10 1
a10 1
cd: ${CDROM}
d38 1
a38 1
.PHONY: cd unpack prepimg makeimg
@

