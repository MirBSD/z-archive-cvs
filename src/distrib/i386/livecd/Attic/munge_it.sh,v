head	1.46;
access;
symbols
	MIRBSD_9_BASE:1.43;
locks; strict;
comment	@# @;


1.46
date	2006.08.17.19.58.05;	author tg;	state dead;
branches;
next	1.45;
commitid	10044E4CA2D0E8EFBD4;

1.45
date	2006.08.16.18.46.13;	author tg;	state Exp;
branches;
next	1.44;
commitid	10044E367FF357E2D31;

1.44
date	2006.07.28.20.06.47;	author tg;	state Exp;
branches;
next	1.43;
commitid	10044CA6E6260A01148;

1.43
date	2006.06.09.01.05.16;	author tg;	state Exp;
branches;
next	1.42;
commitid	1004488C9585CB8807D;

1.42
date	2006.05.26.21.40.21;	author tg;	state Exp;
branches;
next	1.41;
commitid	100447775D357ECD6AA;

1.41
date	2006.05.26.21.18.51;	author tg;	state Exp;
branches;
next	1.40;
commitid	1004477708C461A3A5B;

1.40
date	2006.05.17.13.36.40;	author tg;	state Exp;
branches;
next	1.39;
commitid	100446B26F71091D628;

1.39
date	2006.05.15.20.06.58;	author tg;	state Exp;
branches;
next	1.38;
commitid	1004468DF717ADA2E79;

1.38
date	2006.05.15.19.56.42;	author tg;	state Exp;
branches;
next	1.37;
commitid	1004468DD07315947F0;

1.37
date	2006.05.15.19.54.55;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004468DC9A0110D686;

1.36
date	2006.05.08.18.58.34;	author tg;	state Exp;
branches;
next	1.35;
commitid	100445F94D641E20EDB;

1.35
date	2006.05.01.18.44.49;	author tg;	state Exp;
branches;
next	1.34;
commitid	100445657374F0FB94A;

1.34
date	2006.04.29.21.40.09;	author tg;	state Exp;
branches;
next	1.33;
commitid	1004453DD3B21426FB0;

1.33
date	2006.04.27.08.31.39;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004450818137B75534;

1.32
date	2006.04.27.08.25.46;	author tg;	state Exp;
branches;
next	1.31;
commitid	1004450802157F52D82;

1.31
date	2006.04.19.20.22.11;	author tg;	state Exp;
branches;
next	1.30;
commitid	10044469C043532AE1A;

1.30
date	2006.04.12.23.57.46;	author tg;	state Exp;
branches;
next	1.29;
commitid	100443D940727F8D3CE;

1.29
date	2006.04.12.23.42.33;	author tg;	state Exp;
branches;
next	1.28;
commitid	100443D907F286EE07C;

1.28
date	2006.04.12.23.32.56;	author tg;	state Exp;
branches;
next	1.27;
commitid	100443D8E3B2B2AB0A8;

1.27
date	2006.04.12.23.27.30;	author tg;	state Exp;
branches;
next	1.26;
commitid	100443D8CF50ED5B36E;

1.26
date	2006.04.12.23.11.25;	author tg;	state Exp;
branches;
next	1.25;
commitid	100443D892D771174B4;

1.25
date	2006.04.12.22.53.46;	author tg;	state Exp;
branches;
next	1.24;
commitid	100443D85037877D789;

1.24
date	2006.04.11.21.11.09;	author tg;	state Exp;
branches;
next	1.23;
commitid	100443C1B7D334F1612;

1.23
date	2006.04.11.20.20.18;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2006.04.11.19.04.49;	author tg;	state Exp;
branches;
next	1.21;
commitid	100443BFDE26F4989A6;

1.21
date	2006.04.11.18.58.27;	author tg;	state Exp;
branches;
next	1.20;
commitid	100443BFC665F36BB39;

1.20
date	2006.04.11.18.53.01;	author tg;	state Exp;
branches;
next	1.19;
commitid	100443BFB1F4E3BA9B1;

1.19
date	2006.04.11.18.52.21;	author tg;	state Exp;
branches;
next	1.18;
commitid	100443BFADF0BA1D5E5;

1.18
date	2006.04.10.21.51.52;	author tg;	state Exp;
branches;
next	1.17;
commitid	100443AD37103DF05C8;

1.17
date	2006.04.10.20.47.48;	author tg;	state Exp;
branches;
next	1.16;
commitid	100443AC48718CADA77;

1.16
date	2006.04.08.01.29.58;	author tg;	state Exp;
branches;
next	1.15;
commitid	100443712252FA03F9C;

1.15
date	2006.04.07.13.05.43;	author tg;	state Exp;
branches;
next	1.14;
commitid	100443663B878211759;

1.14
date	2006.04.07.13.04.04;	author tg;	state Exp;
branches;
next	1.13;
commitid	1004436633F39BD8509;

1.13
date	2006.04.07.12.53.33;	author tg;	state Exp;
branches;
next	1.12;
commitid	100443660DE3DA5E07A;

1.12
date	2006.04.07.12.37.02;	author tg;	state Exp;
branches;
next	1.11;
commitid	10044365CF36B608D74;

1.11
date	2006.04.07.12.15.58;	author tg;	state Exp;
branches;
next	1.10;
commitid	100443658067D599CBD;

1.10
date	2006.04.06.00.53.20;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004434668C38FA0FC9;

1.9
date	2006.04.06.00.25.48;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004434601A36556256;

1.8
date	2006.04.06.00.18.46;	author tg;	state Exp;
branches;
next	1.7;
commitid	10044345E5D1576FB3A;

1.7
date	2006.04.06.00.16.31;	author tg;	state Exp;
branches;
next	1.6;
commitid	10044345DE2589A1B6F;

1.6
date	2006.04.05.23.58.35;	author tg;	state Exp;
branches;
next	1.5;
commitid	100443459C22EA4B256;

1.5
date	2006.04.05.23.57.37;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004434597E35E32312;

1.4
date	2006.04.05.23.50.17;	author tg;	state Exp;
branches;
next	1.3;
commitid	100443457C535F2492F;

1.3
date	2006.04.05.23.39.47;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004434555173E73A7B;

1.2
date	2006.04.05.23.14.40;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044344F6C1F24E946;

1.1
date	2006.04.05.22.38.12;	author tg;	state Exp;
branches;
next	;
commitid	100443446DF3481AB6D;


desc
@@


1.46
log
@* new Makefile structure
* move i386/livecd into baselive/ and sub-directory-structure appropriately
* rid unneeded files
* ifdef out build of rescue tools not needed on certain arches
@
text
@#!/bin/mksh
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.45 2006/08/16 18:46:13 tg Exp $
#-
# Copyright (c) 2006
#	Thorsten Glaser <tg@@mirbsd.de>
#
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
#
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a nontrivial bug.
#-
# Patch a freshly unpacked MirOS installation into the standard live
# CD distribution.

set -ex
myplace=$(readlink -nf $(dirname "$0"))

ed -s etc/X11/xdm/Xresources <<-'EOF'
	/^xlogin.greeting:/s/CLIENTHOST/the MirOS BSD Live CD/
	/^Chooser.label.label:/s/CLIENTHOST/Live-CD/
	wq
EOF
cat >>etc/bootparams <<-'EOF'
	* root=172.23.42.1:/
EOF
cat >>etc/ethers <<-'EOF'
	# format: aa:bb:cc:dd:ee:ff bpclnt1{0,1,2}
EOF
cat >>etc/exports <<-'EOF'
	/ -ro -maproot=root
EOF
ed -s etc/group <<-'EOF'
	/^wheel:/s/$/,live/
	/^operator:/s/$/,live/
	/^wsrc:/s/$/live/
	/^staff:/s/$/,live/
	/^www:/s/$/live/
	/^dialer:/s/$/live/
	/^audio:/s/$/live/
	/^nobody:/i
		live:*:32762:
	.
	wq
EOF
ed -s etc/inetd.conf <<-'EOF'
	%g/^.tftp/s/^.//
	wq
EOF
ed -s etc/master.passwd <<-'EOF'
	/^root:/s!/root!/dev/.root!
	/^nobody:/i
		live:$2a$04$NCMhVFfIg3afYRXLCDGjcOPYJxem4lxSLcthQT5AaejUaAAvIWdCW:32762:32762:staff:0:0:MirOS BSD Live CD User:/home/live:/bin/mksh
	.
	wq
EOF
: || ed -s etc/make.cfg <<-'EOF'
	$a
		### Run MirPorts off the Live CD
		DISTDIR?=		${LOCALBASE}/.ports/Distfiles
		BULK_COOKIES_DIR?=	${LOCALBASE}/.ports/Bulk
		PKGREPOSITORY?=		${LOCALBASE}/.ports/Packages
		WRKOBJDIR?=		${LOCALBASE}/.ports/build

	.
	wq
EOF
#ed -s etc/ntpd.conf <<-'EOF'
#	/^.server /d
#	i
#		server ntp.mirbsd.org
#	.
#	wq
#EOF
ed -s etc/rc <<-'EOF'
	1i
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.45 2006/08/16 18:46:13 tg Exp $
	.
	/shutdown request/ka
	/^fi/a

		mount /dev/rd0a /dev
		test -e /dev/.rs && cat /dev/.rs >/dev/arandom
		( (dd if=/dev/rwd0c count=126; dd if=/dev/rsd0c count=126) \
		    2>&1 | /bin/cksum -ba sha512 >/dev/arandom ) &
		(cd /dev; ln -s $(sysctl -n kern.root_device) root)
		rm -f /dev/.rs
		print \#\\tThis product includes material provided by Thorsten Glaser.
	.
	/^raidctl.*all/s/^/#/
	/^rm.*fastboot$/a

		function do_mfsmount
		{
			print -n " $1"
			mount_mfs -s ${2:-300000} swap /$1
		}
		print -n 'initialising memory filesystems...'
		do_mfsmount etc 20480
		do_mfsmount home
		do_mfsmount tmp 600000
		do_mfsmount usr/X11R6/lib/X11 20480
		do_mfsmount var
		print '... done'
		sleep 2
		print -n 'extracting mfs contents...'
		cpio -mid </stand/fsrw.cpio
		print ' done'
		sleep 1
		cp -r etc/skel home/live
		chown -R 32762:32762 home/live
		[[ -s /stand/locate.database ]] && \
		    cp /stand/locate.database /var/db/locate.database
	.
	/load arp tables/i
		#if [[ -e /tmp/try_rnd ]]; then
		#	( /usr/bin/ftp -r 120 -Vo - http://tg.mirsolutions.de/rnd_bin.cgi 2>&1 | /bin/cksum -ba sha512 >/dev/prandom ) &
		#fi

	.
	/rd0c/d
	/openssl genrsa/s/4096/1024/
	wq
EOF
: || ed -s etc/rc.local <<-'EOF'
	$a
		has_pkgs=0
		for a in /v?/*/*.cgz; do
			if [[ -s $a ]]; then
				has_pkgs=1
				break
			fi
		done
		if [[ $has_pkgs = 1 ]]; then
			print -n 'preloading packages...'
			mount_mfs -s 1200000 swap /usr/mpkg
			has_pkgtools=0
			print -n ' <pkgtools'
			for a in /v?/*/pkgutl*.ngz; do
				if [[ -s $a ]]; then
					has_pkgtools=$a
					break
				fi
			done
			if [[ $has_pkgtools != 0 ]]; then
				tar xzphf $a
			else
				print -n ' (compiling)'
				(cd /usr/ports; make setup)
			fi
			print -n '>'
			for a in /v?/*/*.cgz; do
				[[ -s $a ]] || continue
				print -n " ${a%.cgz}"
				/usr/mpkg/sbin/pkg_info ${a%.cgz} >/dev/null \
				    2>&1 || /usr/mpkg/sbin/pkg_add $a
			done
			print ' done'
		fi
	.
	wq
EOF
ed -s etc/rc.securelevel <<-'EOF'
	/^securelevel/s/1/-1/
	wq
EOF
ed -s etc/sudoers <<-'EOF'
	%g/@@ROOT@@/s//live/
	wq
EOF
ed -s etc/sysctl.conf <<-'EOF'
	/accept_rtadv/s/^.//
	/^.ddb.console/s/^.//
	/^.kern.seminfo.semmni/s/^.//
	/^.kern.seminfo.semmns/s/^.//
	/^.kern.seminfo.semmnu/s/^.//
	/^.kern.shminfo.shmall/s/^.//
	/^.machdep.allowaperture/s/^.//
	/^.machdep.kbdreset/s/^.//
	/^.kern.emul.linux/s/^.//
	/^.kern.emul.openbsd/s/^.//
	wq
EOF
ed -s etc/ttys <<-'EOF'
	/^tty00/s/unknown/vt220/
	s/off/on secure/
	wq
EOF
ed -s usr/bin/ftp <<-'EOF'
	%g/MirOS ftp(1)/s//MirOS LiveCD/
	wq
EOF
ed -s var/cron/tabs/root <<-'EOF'
	/daily/s/^/#/
	/weekly/s/^/#/
	/monthly/s/^/#/
	/randshuffle/s/^/#/
	/randomnumbers.info/s/^.//
	/fourmilab.ch/s/^.//
	wq
EOF

install -c -o root -g staff -m 644 $myplace/XF86Config etc/X11/XF86Config
install -c -o root -g staff -m 644 $myplace/fstab etc/fstab
install -c -o root -g staff -m 644 $myplace/rc.conf.local etc/rc.conf.local
install -c -o root -g staff -m 644 $myplace/rc.netselect etc/rc.netselect

(cd dev; mksh ./MAKEDEV std rd0a)
pwd_mkdb -pd $(readlink -nf etc) master.passwd
dd if=/dev/arandom bs=4096 count=1 of=var/db/host.random
mkdir -p tftpboot/etc
(cd tftpboot; ln -s ../bsd; ln -s ../usr/mdec/pxeboot)
cat >tftpboot/etc/boot.cfg <<-'EOF'
	echo
	echo To boot from NFS, enter "nfs" as root device when asked.
	echo
	boot /bsd -a
EOF

mv root dev/.root
rm -rf usr/X11R6/lib/X11/fonts/{100dpi,OTF,Speedo,Type1,cyrillic,local}
mv usr/X11R6/lib/X11/fonts usr/X11R6/lib/fonts
(cd usr/X11R6/lib/X11; ln -s ../fonts)
# tmp because of perms
find dev/.root etc tmp usr/X11R6/lib/X11 var | sort | \
    cpio -oC512 -Hsv4crc -Mset >stand/fsrw.cpio
rm -rf dev/.root usr/X11R6/lib/X11 var sys
mkdir -p usr/X11R6/lib/X11 var

exit 0
@


1.45
log
@prefer arc4random and don't htonl() its return value
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.44 2006/07/28 20:06:47 tg Exp $
d91 1
a91 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.44 2006/07/28 20:06:47 tg Exp $
@


1.44
log
@disable mirports on the CD, for now
size constraints / issues
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.43 2006/06/09 01:05:16 tg Exp $
d91 1
a91 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.43 2006/06/09 01:05:16 tg Exp $
d97 1
a97 1
		test -e /dev/.rs && cat /dev/.rs >/dev/urandom
d99 1
a99 1
		    2>&1 | /bin/cksum -ba sha512 >/dev/urandom ) &
d224 1
a224 1
dd if=/dev/urandom bs=4096 count=1 of=var/db/host.random
@


1.43
log
@supply /etc/make.cfg to run MirPorts off a CD-ROM
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.42 2006/05/26 21:40:21 tg Exp $
d71 1
a71 1
ed -s etc/make.cfg <<-'EOF'
d91 1
a91 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.42 2006/05/26 21:40:21 tg Exp $
d139 1
a139 1
ed -s etc/rc.local <<-'EOF'
@


1.42
log
@(alpha) pre-install binary packages put onto the CD
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.41 2006/05/26 21:18:51 tg Exp $
d71 11
d91 1
a91 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.41 2006/05/26 21:18:51 tg Exp $
@


1.41
log
@* while stuff fits, still nuke some files (not the base docs tho)
* move a rm from munge_it.sh to Makefile too
* incidentally, stripping never worked before (missing sudo)
* don't strip i18n bundles (who t.f. versions bundles (not dylibs)?)
* don't strip gcc libs either
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.40 2006/05/17 13:36:40 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.40 2006/05/17 13:36:40 tg Exp $
d128 38
@


1.40
log
@don't do that right now, until...
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.39 2006/05/15 20:06:58 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.39 2006/05/15 20:06:58 tg Exp $
d186 1
a186 2
rm -rf usr/X11R6/lib/X11/doc \
    usr/X11R6/lib/X11/fonts/{100dpi,OTF,Speedo,Type1,cyrillic,local}
@


1.39
log
@use rc.conf.local, don't change rc.conf directly
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.38 2006/05/15 19:56:42 tg Exp $
d71 7
a77 7
ed -s etc/ntpd.conf <<-'EOF'
	/^.server /d
	i
		server 81.169.176.177
	.
	wq
EOF
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.38 2006/05/15 19:56:42 tg Exp $
d119 3
a121 3
		if [[ -e /tmp/try_rnd ]]; then
			( /usr/bin/ftp -r 120 -Vo - http://tg.mirsolutions.de/rnd_bin.cgi 2>&1 | /bin/cksum -ba sha512 >/dev/prandom ) &
		fi
@


1.38
log
@enable apmd and (non-chroot, SSL) httpd by default, too
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.37 2006/05/15 19:54:55 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.37 2006/05/15 19:54:55 tg Exp $
a127 11
ed -s etc/rc.conf <<-'EOF'
	/^rarpd_flags/s/NO/-a/
	/^bootparamd_flags/s/NO/-s/
	/^ntpd_flags/s/NO/""/
	/^apmd_flags/s/NO/""/
	/^httpd_flags/s/NO/"-u -DSSL"/
	/^wsmoused_flags/s/NO/"-2"/
	/^nfs_server/s/NO/YES/
	/^portmap/s/NO/YES/
	wq
EOF
d170 1
@


1.37
log
@first try at a locate database on the live CD
idea but no code by Vutral
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.36 2006/05/08 18:58:34 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.36 2006/05/08 18:58:34 tg Exp $
d132 2
@


1.36
log
@* enable IPv6 autoconfiguration support (always)
* enable IPv6 autoconfiguration (unless network is configured manually)
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.35 2006/05/01 18:44:49 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.35 2006/05/01 18:44:49 tg Exp $
d115 2
@


1.35
log
@do stuff like that in the background
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.34 2006/04/29 21:40:09 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.34 2006/04/29 21:40:09 tg Exp $
d144 1
@


1.34
log
@oh oh...

don't automatically re-write parity on auto-detected RAIDs on live CD boot
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.33 2006/04/27 08:31:39 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.33 2006/04/27 08:31:39 tg Exp $
d87 2
a88 2
		(dd if=/dev/rwd0c count=126; dd if=/dev/rsd0c count=126) \
		    2>&1 | /bin/cksum -ba sha512 >/dev/urandom
@


1.33
log
@consolidate; use cksum instead of relying on the addpool to collapse because it delays
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.32 2006/04/27 08:25:46 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.32 2006/04/27 08:25:46 tg Exp $
d93 1
@


1.32
log
@sync with miniroot/dot.profile
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.31 2006/04/19 20:22:11 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.31 2006/04/19 20:22:11 tg Exp $
d87 2
a88 2
		dd if=/dev/rwd0c count=126 >/dev/prandom 2>&1
		dd if=/dev/rsd0c count=126 >/dev/prandom 2>&1
@


1.31
log
@rarpd has no -n option (XXX wtf?)
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.30 2006/04/12 23:57:46 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.30 2006/04/12 23:57:46 tg Exp $
d87 2
@


1.30
log
@slightly change network config
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.29 2006/04/12 23:42:33 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.29 2006/04/12 23:42:33 tg Exp $
d124 1
a124 1
	/^rarpd_flags/s/NO/-an/
@


1.29
log
@typo
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.28 2006/04/12 23:32:56 tg Exp $
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.28 2006/04/12 23:32:56 tg Exp $
d124 2
d128 2
@


1.28
log
@handle rarpd
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.27 2006/04/12 23:27:30 tg Exp $
d38 1
a38 1
car >>etc/bootparams <<-'EOF'
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.27 2006/04/12 23:27:30 tg Exp $
@


1.27
log
@handle bootparams
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.26 2006/04/12 23:11:25 tg Exp $
d41 3
d80 1
a80 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.26 2006/04/12 23:11:25 tg Exp $
@


1.26
log
@basic NFS export of / filesystem
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.25 2006/04/12 22:53:46 tg Exp $
d38 3
d77 1
a77 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.25 2006/04/12 22:53:46 tg Exp $
@


1.25
log
@move fsrw.cpio to /stand to make it accessible later
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.24 2006/04/11 21:11:09 tg Exp $
d38 3
d54 4
d74 1
a74 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.24 2006/04/11 21:11:09 tg Exp $
d168 8
@


1.24
log
@use /dev/root (let's see whether this is possible)
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.23 2006/04/11 20:20:18 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.23 2006/04/11 20:20:18 tg Exp $
d85 1
a85 1
		print -n 'creating memory filesystems...'
d87 1
d91 1
d93 3
a95 2
		print -n ' (unpack)'
		cpio -mid </home/fsrw.cpio
a96 2
		do_mfsmount home
		print ' done'
d169 1
a169 1
    cpio -oC512 -Hsv4crc -Mset >home/fsrw.cpio
@


1.23
log
@tweak ftp(1) for Live CD
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.21 2006/04/11 18:58:27 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.21 2006/04/11 18:58:27 tg Exp $
d74 1
@


1.22
log
@CID is no longer part of the distribution
@
text
@d138 4
@


1.21
log
@remove a few more unused fonts
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.20 2006/04/11 18:53:01 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.20 2006/04/11 18:53:01 tg Exp $
d158 1
a158 1
    usr/X11R6/lib/X11/fonts/{100dpi,CID,OTF,Speedo,Type1,cyrillic,local}
@


1.20
log
@shrink /etc as well
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.19 2006/04/11 18:52:21 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.19 2006/04/11 18:52:21 tg Exp $
d157 2
a158 1
rm -rf usr/X11R6/lib/X11/doc usr/X11R6/lib/X11/fonts/100dpi
@


1.19
log
@solve the X11 auth problem (more symlinks issues) and, überhaupt,
all symlink-related problems by just packing them on the ram disc
or nuking them
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.18 2006/04/10 21:51:52 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.18 2006/04/10 21:51:52 tg Exp $
d85 1
a85 1
		do_mfsmount etc 40960
@


1.18
log
@get some (64 bytes) entropy at boot from maou
(probably not to be included in final release
but still doable due to our low number of users)
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.17 2006/04/10 20:47:48 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.17 2006/04/10 20:47:48 tg Exp $
d84 1
a84 1
		print -n 'initialising memory filesystems...'
d87 1
d90 1
a90 1
		print -n ' (extracting)'
d94 1
a94 1
		print '... done'
d157 3
d161 4
a164 3
find dev/.root etc tmp var | sort | cpio -oC512 -Hsv4crc -Mset >home/fsrw.cpio
rm -rf dev/.root var sys
mkdir -p var
@


1.17
log
@undo 100443459C22EA4B256
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.16 2006/04/08 01:29:58 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.16 2006/04/08 01:29:58 tg Exp $
d97 6
@


1.16
log
@optical (cosmetic) tweak
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.15 2006/04/07 13:05:43 tg Exp $
d33 1
a33 1
false && ed -s etc/X11/xdm/Xresources <<-'EOF'
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.15 2006/04/07 13:05:43 tg Exp $
d141 1
a141 1
false && install -c -o root -g staff -m 644 $myplace/XF86Config etc/X11/XF86Config
@


1.15
log
@advertise a little for me ;)
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.14 2006/04/07 13:04:04 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.14 2006/04/07 13:04:04 tg Exp $
d75 1
a75 1
		print \\tThis product includes material provided by Thorsten Glaser.
@


1.14
log
@* beautify
* address the /root issue (differently)
  (why can't CDs contain symbolic links?)
* sync fstab with reality
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.13 2006/04/07 12:53:33 tg Exp $
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.13 2006/04/07 12:53:33 tg Exp $
d75 1
@


1.13
log
@address the symlinks issue
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.12 2006/04/07 12:37:02 tg Exp $
d52 1
d67 1
a67 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.12 2006/04/07 12:37:02 tg Exp $
a148 2
ln -s dev/.root root

d152 1
a152 1
mkdir -p dev/.root var
@


1.12
log
@* adjust sizes of mfs to prevent cylgroup stuff warnings
* give 'em a little bit more entropy on the way
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.11 2006/04/07 12:15:58 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.11 2006/04/07 12:15:58 tg Exp $
d152 2
a153 2
rm -rf dev/.root var
mkdir var
@


1.11
log
@* livecd: attempt at using the 4 MiB ramdisk image for /dev (and /root)
* common: sync
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.10 2006/04/06 00:53:20 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.10 2006/04/06 00:53:20 tg Exp $
d72 2
d83 1
a83 1
		do_mfsmount etc 60000
@


1.10
log
@4096 bits takes too long on every boot, use 1024 on the live CD
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.9 2006/04/06 00:25:48 tg Exp $
d66 6
a71 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.9 2006/04/06 00:25:48 tg Exp $
d81 1
a81 3
		do_mfsmount dev 15000
		do_mfsmount etc 150000
		do_mfsmount root
d85 1
d89 1
a89 5
		print ' done'
		print -n 'creating device nodes (takes a long time)...'
		(cd /dev; mksh ./MAKEDEV all)
		print done
		sleep 1
d93 1
d141 1
a141 1
(cd dev; mksh ./MAKEDEV std)
d145 3
d149 3
a151 3
find dev etc root tmp var | sort | cpio -oC512 -Hsv4crc -Mset >home/fsrw.cpio
rm -rf root var
mkdir root var
@


1.9
log
@I was just too quick... it does work
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.8 2006/04/06 00:18:46 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.8 2006/04/06 00:18:46 tg Exp $
d93 1
@


1.8
log
@do not gzip the tarball to avoid strange effects

(still doesn't work, but I'm tired and goto¹ bed now)
¹) yeah, that's BASIC for you.
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.7 2006/04/06 00:16:31 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.7 2006/04/06 00:16:31 tg Exp $
d86 1
d88 1
@


1.7
log
@round up/down on the size of memory filesystems;
mfs still uses 'cylinder groups' of UFSv1
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.6 2006/04/05 23:58:35 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.6 2006/04/05 23:58:35 tg Exp $
d82 1
a82 1
		gzip -dc /home/fsrw.cgz | tar xphf -
d142 1
a142 2
find dev etc root tmp var | sort | cpio -oC512 -Hsv4crc -Mset | \
    gzip -n9 >home/fsrw.cgz
@


1.6
log
@test w/o X11, faster cycles
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.5 2006/04/05 23:57:37 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.5 2006/04/05 23:57:37 tg Exp $
d73 1
a73 1
			mount_mfs -s ${2:-262144} swap /$1
d76 2
a77 2
		do_mfsmount dev 16384
		do_mfsmount etc 131072
d79 1
a79 1
		do_mfsmount tmp 524288
@


1.5
log
@there's no /dev/stdin, r/o noauto root, etc.
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.4 2006/04/05 23:50:17 tg Exp $
d33 1
a33 1
ed -s etc/X11/xdm/Xresources <<-'EOF'
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.4 2006/04/05 23:50:17 tg Exp $
d133 1
a133 1
install -c -o root -g staff -m 644 $myplace/XF86Config etc/X11/XF86Config
@


1.4
log
@init(8) needs /dev/console early, I hope rock ridge copes
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.3 2006/04/05 23:39:47 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.3 2006/04/05 23:39:47 tg Exp $
d82 1
a82 1
		tar xzphf /home/fsrw.cgz
@


1.3
log
@work around a little quoting, paths and sudo confusion
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.2 2006/04/05 23:14:40 tg Exp $
d66 1
a66 1
		# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.2 2006/04/05 23:14:40 tg Exp $
d137 1
d144 2
a145 2
rm -rf dev root var
mkdir dev root var
@


1.2
log
@add some live cd stuff to aid me in testing this
@
text
@d2 1
a2 1
# $MirOS: src/distrib/i386/livecd/munge_it.sh,v 1.1 2006/04/05 22:38:12 tg Exp $
d37 1
a37 1
'EOF'
d50 1
a50 1
'EOF'
d56 1
a56 1
'EOF'
d63 1
a63 1
'EOF'
d66 1
a66 1
		# $MirOS$
d97 1
a97 1
'EOF'
d101 1
a101 1
'EOF'
d105 1
a105 1
'EOF'
d117 1
a117 1
'EOF'
d122 1
a122 1
'EOF'
d131 1
a131 1
'EOF'
d133 3
a135 4
install -c -o root -g staff -m 644 \
    $myplace/etc/X11/XF86Config etc/X11/XF86Config
install -c -o root -g staff -m 644 $myplace/etc/fstab etc/fstab
install -c -o root -g staff -m 644 $myplace/etc/rc.netselect etc/rc.netselect
@


1.1
log
@live CD diffs, still without fstab and diffs to /etc/rc
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.6 2006/01/24 22:24:02 tg Rel $
d64 29
a138 2
cp -r etc/skel home/live
chown -R 32762:32762 home/live
d140 8
@

