head	1.11;
access;
symbols
	MIRBSD_9_BASE:1.10
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	mirbsd:1.1.7;
locks; strict;
comment	@# @;


1.11
date	2006.07.03.22.08.06;	author tg;	state dead;
branches;
next	1.10;
commitid	10044A9955565E81421;

1.10
date	2006.06.16.13.12.56;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004492AE534A0B6BB6;

1.9
date	2006.06.11.01.41.43;	author tg;	state Exp;
branches;
next	1.8;
commitid	100448B74E73026F8F8;

1.8
date	2006.06.11.01.08.29;	author tg;	state Exp;
branches;
next	1.7;
commitid	100448B6D170B979B25;

1.7
date	2006.05.26.18.55.11;	author tg;	state Exp;
branches;
next	1.6;
commitid	10044774F1D07926CA6;

1.6
date	2006.02.21.21.04.09;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043FB805C10DC41D1;

1.5
date	2006.02.14.20.47.52;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043F2407C51151E2F;

1.4
date	2006.02.01.18.30.49;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043E0FE6C10081285;

1.3
date	2005.07.01.11.51.43;	author tg;	state Exp;
branches;
next	1.2;
commitid	248142c52e5bc87f;

1.2
date	2005.03.29.17.54.46;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.06.16.33.37;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.06.16.33.37;	author tg;	state Exp;
branches;
next	;


desc
@@


1.11
log
@unify build of GENERIC kernels
@
text
@# $MirOS: src/distrib/i386/generic/Makefile,v 1.10 2006/06/16 13:12:56 tg Exp $

.include <bsd.own.mk>
CFLAGS+=	${CDIAGFLAGS} ${COPTS}
HOSTCFLAGS?=	${CFLAGS}

RAMDISK=	GENERIC
SYSDIR=		${.CURDIR}/../../../sys
SYSSUBDIR=	${SYSDIR}/arch/i386
KERNDIR=	${SYSSUBDIR}/compile/${RAMDISK}

all:	bsd

rebsd:
	rm -f bsd
	cd ${.CURDIR} && exec ${MAKE} KMAKE_CLEAN=: bsd

depend:
	# Nothing here so far...

install:
	cp bsd ${DESTDIR}/snapshot/bsd

install-root:
	@@if [[ -e /bsd ]]; then \
		echo Move /bsd out of the way!; \
		exit 1; \
	elif [[ ! -e /bsd.old ]]; then \
		echo Back up your old kernel to /bsd.old!; \
		exit 1; \
	else \
		set -x; \
		install -c -o root -g daemon -m 400 bsd /; \
	fi

cleandir: clean

clean:
	-rm -rf build
	rm -f bsd

cleannobsd:

.include "../../Makefile.kernel"
.include <bsd.obj.mk>
.include <bsd.subdir.mk>

.PHONY: rebsd install-root
@


1.10
log
@d'oh, that didn't work. copy two lines from i386/common/Makefile.inc
to the arch/generic/Makefile then and reduce the amount of work the
Makefile.kernel does
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.9 2006/06/11 01:41:43 tg Exp $
@


1.9
log
@less redundancy
@
text
@d1 5
a5 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.8 2006/06/11 01:08:29 tg Exp $
@


1.8
log
@bring some sparc kernel build infrastructure up to date
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.7 2006/05/26 18:55:11 tg Exp $
a6 1
MAKE_CLEAN?=	${MAKE} clean
d12 1
a12 1
	cd ${.CURDIR} && exec ${MAKE} MAKE_CLEAN=: bsd
@


1.7
log
@sync with floppy - cleannobsd doesn't remove build dir
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.6 2006/02/21 21:04:09 tg Exp $
d41 1
a41 1
.include "Makefile.kernel"
@


1.6
log
@add install-root, rebsd targets
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.5 2006/02/14 20:47:52 tg Exp $
a39 1
	-rm -rf build
@


1.5
log
@restructure build system for better restartability,
move things to proper places, ensure root-only-access
to .buildnotice hack file, fix a few problems (using
${BSDMAKE} in gcc/Makefile, including wrong files),
use ${SUDO} on different places, ensure DESTDIR is
always correct on make build, move most of the former
'release' targets from src/etc/Makefile to src/Makefile
and remove associated targets in src/etc/Makefile; sync
list of phony targets in both; copy out common code in
distrib/i386/generic/Makefile, distrib/i386/common/Makefile.inc
into new distrib/i386/generic/Makefile.kernel, remove
unused target 'includes' in src/Makefile, rewrite the
distrib-dirs target, shuffle the creation and removal
of the systrace files around, build HTML manual pages
under systrace(1) control, auto-remove tmp buildhome,
check HOME makeenv/environment sync and being tmp, fix
index/checksum file generation, maybe more (read the diff)

untested
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.4 2006/02/01 18:30:49 tg Exp $
d11 4
d21 12
d45 2
@


1.4
log
@offer continuation
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.3 2005/07/01 11:51:43 tg Exp $
a13 16
bsd:
	mkdir -p build/${RAMDISK}
	[[ -f build/${RAMDISK}/version || ! -f ${KERNDIR}/version ]] \
	    || cat ${KERNDIR}/version >build/${RAMDISK}/version
	( cd build/${RAMDISK}; config -s ${SYSDIR} -b . \
	    ${SYSSUBDIR}/conf/${RAMDISK} \
	    && ${MAKE_CLEAN} && ${MAKE} depend && exec ${MAKE} bsd )
	mv build/${RAMDISK}/bsd .
	-[[ ! -e ${KERNDIR} ]] \
	    || if ! cat build/${RAMDISK}/version >${KERNDIR}/version; then \
		( print "# warning: kernel version changed"; \
		  print "print $$(<build/${RAMDISK}/version)" \
		     ">${KERNDIR}/version" ) \
		  | tee -a /var/tmp/.buildnotice >&2; \
	    fi

d26 1
@


1.3
log
@use [[ ! -e ]] || logic, even if prefixed by a dash
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.2 2005/03/29 17:54:46 tg Exp $
d7 1
d20 1
a20 1
	    && ${MAKE} clean && ${MAKE} depend && exec ${MAKE} bsd )
@


1.2
log
@Attention -> warning
man grep
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/generic/Makefile,v 1.1.7.1 2005/03/06 16:33:37 tg Exp $
d21 2
a22 2
	-[[ -e ${KERNDIR} ]] \
	    && if ! cat build/${RAMDISK}/version >${KERNDIR}/version; then \
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $MirOS$
d23 1
a23 1
		( print "# Attention: kernel version changed"; \
@


1.1.7.1
log
@Add some missing files, such as some ISDN4BSD stuff,
documentation, tmac and tab files, TAI64 etc.
@
text
@@
