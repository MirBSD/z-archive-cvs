head	1.7;
access;
symbols
	MIRBSD_9_BASE:1.4
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2006.08.17.13.50.33;	author tg;	state dead;
branches;
next	1.6;
commitid	10044E474331BDC0C62;

1.6
date	2006.07.23.23.41.25;	author tg;	state Exp;
branches;
next	1.5;
commitid	10044C409313E5D0B2B;

1.5
date	2006.07.03.23.16.18;	author tg;	state Exp;
branches;
next	1.4;
commitid	10044A9A54E524A68E1;

1.4
date	2006.04.06.11.07.29;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004434F66517D09156;

1.3
date	2005.07.01.13.31.29;	author tg;	state Exp;
branches;
next	1.2;
commitid	c1d42c545bfd3b1;

1.2
date	2005.03.06.18.58.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.22.10;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.22.10;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.01.13.01.19;	author tg;	state Exp;
branches;
next	;
commitid	52f42c53eb438da;


desc
@@


1.7
log
@move distrib/i386/common/install.md to distrib/i386/install.md like sparc
@
text
@# $MirOS: src/distrib/i386/common/install.md,v 1.6 2006/07/23 23:41:25 tg Exp $
# $OpenBSD: install.md,v 1.28 2005/04/02 14:34:46 krw Exp $
#
#
# Copyright (c) 1996 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Jason R. Thorpe.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
#
# machine dependent section of installation/upgrade script.
#

MDFSTYPE=ntfs
MDFSOPTS=ro
MDTERM=wsvtg
MDXAPERTURE=2
MDSERIAL="pccom com tty0"
ARCH=ARCH

md_installboot() {
	echo Installing boot block...
	cat /usr/mdec/boot >/mnt/boot
	/usr/mdec/installboot -v /mnt/boot /usr/mdec/bootxx ${1}
	echo "done."
}

# $1 is the disk to check
md_checkfordisklabel() {
	local rval=0

	disklabel -r $1 >/dev/null 2>/tmp/checkfordisklabel

	if grep "disk label corrupted" /tmp/checkfordisklabel; then
		rval=2
	fi >/dev/null 2>&1

	rm -f /tmp/checkfordisklabel
	return $rval
}

md_prep_fdisk() {
	local _disk=$1

	ask_yn "Do you want to use *all* of $_disk for MirBSD?"
	if [[ $resp == y ]]; then
		echo -n "Putting all of $_disk into an active MirBSD MBR partition (type 27)..."
		fdisk -ef /.nex ${_disk} <<__EOT >/dev/null
r
u
w
q
__EOT
		echo "done."
		return
	fi

	# Manually configure the MBR.
	cat <<__EOT

You will now create a single MBR partition to contain the disklabel. This
partition must have an id of 27; must *NOT* overlap other partitions; and must
be marked as the only active partition. You can create other MBR partitions,
primary or extended ones, to contain the filesystems, but these must *NOT* be
of type 27, A6, A5 or A9. It is recommended they be of type DB (CP/M-86), and
they are only used to mark the space as USED for other operating systems that
still need MBR partitions. BSD exclusively uses the data in the disklabel to
determine where filesystems are, and uses the MBR partition exclusively to
determine where on the disk the disklabel is positioned.

The 'manual' command describes all the fdisk commands in detail.

$(fdisk ${_disk})
__EOT
	fdisk -e ${_disk}

	cat <<__EOT
Here is the partition information you chose:

$(fdisk ${_disk})
__EOT
}

md_prep_disklabel() {
	local _disk=$1

	md_prep_fdisk $_disk

	cat <<__EOT

You will now create an MirBSD disklabel inside the MirBSD MBR partition.
The disklabel defines how MirBSD splits up the whole disc into slices
in which filesystems and swap space are created and other operating
systems' filesystems are mapped.

The offsets used in the disklabel are ABSOLUTE, i.e. relative to the
start of the disk, NOT the start of the MirBSD MBR partition. If you
have created a split space, i.e. one partition of type 27 and one or
more partitions of type (e.g.) DB, use b<return>0<return>*<return>
to enable using the entire disk for MirBSD. Be sure to create slices
mapping all other operating systems' filesystems to not overwrite them.

__EOT

	md_checkfordisklabel $_disk
	case $? in
	2)	echo "WARNING: Label on disk $_disk is corrupted. You will be repairing it.\n"
		;;
	esac

	disklabel -W $_disk >/dev/null 2>&1
	disklabel -f /tmp/fstab.$_disk -E $_disk
}

md_congrats() {
}
@


1.6
log
@rename ldsec to bootxx to match all other arches
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/common/install.md,v 1.5 2006/07/03 23:16:18 tg Exp $
@


1.5
log
@remove useless line
XXX this means we can't currently install to ccd
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/common/install.md,v 1.4 2006/04/06 11:07:29 tg Exp $
d53 1
a53 1
	/usr/mdec/installboot -v /mnt/boot /usr/mdec/ldsec ${1}
@


1.4
log
@rename ffspbr to ldsec - it's not UFS specific anyway,
it's just the loading sector with map (á la lilo)

also simplify
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/common/install.md,v 1.3 2005/07/01 13:31:29 tg Exp $
a48 1
MDDISKDEVS='/^\([sw]d\)*\(raid\)*\(ccd\)*[0-9][0-9]* /s/ .*//p'
@


1.3
log
@EXPERIMENTAL merge the installer
PLEASE TEST
@
text
@d1 1
a1 1
# $MirOS: src/distrib/i386/common/install.md,v 1.2 2005/03/06 18:58:03 tg Exp $
d54 1
a54 1
	/usr/mdec/installboot -v /mnt/boot /usr/mdec/ffspbr ${1}
@


1.2
log
@merge src/distrib
@
text
@d1 2
a2 2
# $MirOS$
# $OpenBSD: install.md,v 1.22 2004/03/03 02:19:26 krw Exp $
d47 1
d49 1
a49 48

md_set_term() {
    if [ -x /sbin/kbd ]; then
	local _tables

	ask_yn "Do you wish to select a keyboard encoding table?"
	[[ $resp == n ]] && return

	while : ; do
		ask "Select your keyboard type: (P)C-AT/XT, (U)SB or 'done'" P
		case $resp in
		P*|p*)  _tables="be br de dk es fr it jp lt no pt ru sf sg sv ua uk us"
			;;
		U*|u*)	_tables="br de dk es fr it jp no sf sg sv uk us"
			;;
		done)	;;
		*)	echo "'$resp' is not a valid keyboard type."
			resp=
			continue
			;;
		esac
		break;
	done

	[ -z "$_tables" ] && return

	while : ; do
		cat <<__EOT
The available keyboard encoding tables are:

	${_tables}

__EOT
		ask "Table name? (or 'done')" us
		case $resp in
		done)	;;
		*)	if kbd $resp ; then
				echo $resp >/tmp/kbdtype
			else
				echo "'${resp}' is not a valid table name."
				continue
			fi
			;;
		esac
		break;
	done
    fi
}
d78 1
a78 1
		fdisk -ef /nonexist ${_disk} <<__EOT >/dev/null
d91 3
a93 3
You will now create at least a single MBR partition to contain the disklabel.
This *PRIMARY* partition must have an ID of 27 hex (or 0xA9 for compatibility
reasons) and NOT overlap other partitions. You can create other MBR partitions,
d116 1
d118 1
d121 4
a124 3
You will now create a MirBSD disklabel inside the MirBSD MBR partition. The
disklabel defines how MirBSD splits up the MBR partition (rather, the whole
disk) into MirBSD slices in which filesystems and swap space are created.
d127 5
a131 6
start of the disk, NOT the start of the MirBSD MBR partition.

If you have created a split space, i.e. one partition of type 27 and one or
more partitions of type (e.g.) DB, use the command b<return>0<return>*<return>
to enable using the entire disk for MirBSD. Be sure to create slices mapping
the filesystems of any other operating systems in order to not overwrite them.
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
#	$OpenBSD: install.md,v 1.22 2004/03/03 02:19:26 krw Exp $
d43 3
a45 2
MDFSTYPE=msdos
MDFSOPTS=-s
d50 1
d75 1
a75 1
		cat << __EOT
d85 1
a85 1
				echo $resp > /tmp/kbdtype
d94 1
d99 2
a100 4
	# LBA biosboot uses /boot's i-node number. Using 'cat' preserves that
	# number, so multiboot setups (NTLDR) can work across upgrades.
	cat /usr/mdec/boot > /mnt/boot
	/usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot ${1}
d121 1
a121 1
	ask_yn "Do you want to use *all* of $_disk for OpenBSD?"
d123 6
a128 6
		echo -n "Putting all of $_disk into an active OpenBSD MBR partition (type 'A6')..."
		fdisk -e ${_disk} << __EOT > /dev/null
reinit
update
write
quit
d135 1
a135 1
	cat << __EOT
d137 9
a145 3
You will now create a single MBR partition to contain your OpenBSD data. This
partition must have an id of 'A6'; must *NOT* overlap other partitions; and
must be marked as the only active partition.
d153 1
a153 1
	cat << __EOT
a161 1

d163 1
d165 3
a167 1
	cat << __EOT
d169 2
a170 3
You will now create an OpenBSD disklabel inside the OpenBSD MBR
partition. The disklabel defines how OpenBSD splits up the MBR partition
into OpenBSD partitions in which filesystems and swap space are created.
d172 4
a175 2
The offsets used in the disklabel are ABSOLUTE, i.e. relative to the
start of the disk, NOT the start of the OpenBSD MBR partition.
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@update
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.28 2005/04/02 14:34:46 krw Exp $
a44 1
MDSERIAL="pccom com tty0"
d47 46
d97 1
a97 1
	cat /usr/mdec/boot >/mnt/boot
d122 1
a122 1
		fdisk -e ${_disk} <<__EOT >/dev/null
d133 1
a133 1
	cat <<__EOT
d145 1
a145 1
	cat <<__EOT
d157 1
a157 1
	cat <<__EOT
@

