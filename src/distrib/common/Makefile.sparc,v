head	1.21;
access;
symbols
	MIRBSD_10:1.10.0.2
	MIRBSD_10_BASE:1.10;
locks; strict;
comment	@# @;


1.21
date	2013.09.15.11.01.24;	author tg;	state Exp;
branches;
next	1.20;
commitid	1005235938A2629E92C;

1.20
date	2010.01.18.17.41.33;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004B549D3E753841B1;

1.19
date	2010.01.17.00.35.08;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004B525B3629110DD5;

1.18
date	2010.01.16.23.36.45;	author tg;	state Exp;
branches;
next	1.17;
commitid	1004B524D9A6D7BE1E2;

1.17
date	2010.01.10.21.09.54;	author tg;	state Exp;
branches;
next	1.16;
commitid	1004B4A42324C8E3C80;

1.16
date	2010.01.10.12.55.21;	author tg;	state Exp;
branches;
next	1.15;
commitid	1004B49CE4755206B66;

1.15
date	2008.07.13.23.53.09;	author tg;	state Exp;
branches;
next	1.14;
commitid	100487A9547305EFA07;

1.14
date	2008.07.13.20.06.12;	author tg;	state Exp;
branches;
next	1.13;
commitid	100487A603F3AE6908C;

1.13
date	2008.07.12.22.56.32;	author tg;	state Exp;
branches;
next	1.12;
commitid	100487936B641F734DC;

1.12
date	2008.07.12.22.20.06;	author tg;	state Exp;
branches;
next	1.11;
commitid	10048792E2B3C5E53C4;

1.11
date	2008.07.12.22.06.12;	author tg;	state Exp;
branches;
next	1.10;
commitid	10048792AAF4F6C5252;

1.10
date	2007.10.20.22.44.40;	author tg;	state Exp;
branches;
next	1.9;
commitid	100471A84E479B84A8D;

1.9
date	2007.10.02.00.48.12;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004701954801EB034C;

1.8
date	2007.10.01.21.52.20;	author tg;	state Exp;
branches;
next	1.7;
commitid	10047016C034CB50FF7;

1.7
date	2007.10.01.20.53.45;	author tg;	state Exp;
branches;
next	1.6;
commitid	10047015E696BD7B698;

1.6
date	2007.08.12.21.17.58;	author tg;	state Exp;
branches;
next	1.5;
commitid	10046BF79160DC9FB4B;

1.5
date	2006.10.13.19.18.02;	author tg;	state Exp;
branches;
next	1.4;
commitid	100452FE67757921301;

1.4
date	2006.08.19.15.00.42;	author tg;	state Exp;
branches;
next	1.3;
commitid	10044E727AE60C8E939;

1.3
date	2006.08.18.21.36.29;	author tg;	state Exp;
branches;
next	1.2;
commitid	10044E6324B5104F24D;

1.2
date	2006.08.18.20.48.46;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044E627C4580B7224;

1.1
date	2006.08.17.19.34.13;	author tg;	state Exp;
branches;
next	;
commitid	10044E4C48801BF3A85;


desc
@@


1.21
log
@we can build SPARC again, but only with a tad more floppy squeezing
@
text
@# $MirOS: src/distrib/common/Makefile.sparc,v 1.20 2010/01/18 17:41:33 tg Exp $
# $OpenBSD: Makefile.inc,v 1.14 2002/05/01 19:21:28 mickey Exp $

RAWLABEL=
RAMDISK=	FLOPPY
IMAGESIZE=	3584
AOUT_BSDRD=	Yes

LISTADDS=	boot-fd dl-noman nfs no-huge pager-more ppp-off sparc

FLOPPYFILES=	bsd
BOOTXX_TAR=	(${MKSH} ${BOOTSH} -g ${FLOPPYGEOM} -T ${BOOT_TAR}; cat)

CDROM=		no
INST_FILES=	${FLOPPY}

# desperately needed (to make the floppy fit) ☹
#IMAGE_NO_ARND=	defined
@


1.20
log
@give sparc a nicer boot floppy too (17 KiB left, and in contrast
to i386 there is no need to take 1-1.5 KiB aside for boot.cfg)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.19 2010/01/17 00:35:08 tg Exp $
d16 3
@


1.19
log
@• modularise floppy configuration and let sparc/floppy use the common one,
  adding some to it
• nuke printf(1) we have mksh(1) print builtin
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.18 2010/01/16 23:36:45 tg Exp $
d6 1
a6 1
IMAGESIZE=	3328
d9 1
a9 1
LISTADDS=	boot cd9660 dl-noman nfs no-huge pager-more ppp-off sparc
@


1.18
log
@use the bootxx.sh for ustarfs on sparc
tested in qemu
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.17 2010/01/10 21:09:54 tg Exp $
a5 1
LISTS=		${TOPDIR}/common/list.sparc-fdd
d9 2
@


1.17
log
@experimental ustar format boot floppies
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.16 2010/01/10 12:55:21 tg Exp $
d10 3
@


1.16
log
@install the floppy bootloaders too, to simplify things
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.15 2008/07/13 23:53:09 tg Exp $
a3 2
INSTALLBOOT?=	${DESTDIR}/usr/mdec/installboot
BOOT=		${DESTDIR}/usr/mdec/boot.fd
@


1.15
log
@with sysctl(8) in, 17 sectors of free space are a little few,
and the image won't fit (again) anyway, so increase
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.14 2008/07/13 20:06:12 tg Exp $
d5 1
a5 1
BOOT=		${BSDOBJDIR}/sys/arch/sparc/stand/fdboot/boot
@


1.14
log
@bring, at some cost, ed(1) and NFS client support to the floppy
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.13 2008/07/12 22:56:32 tg Exp $
d9 1
a9 1
IMAGESIZE=	3264
@


1.13
log
@forgot one
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.12 2008/07/12 22:20:06 tg Exp $
d5 1
d9 1
a9 1
IMAGESIZE=	3200
@


1.12
log
@missed this one
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.11 2008/07/12 22:06:12 tg Exp $
d8 1
@


1.11
log
@• sparc, i386: rmdir stuff only for i386-big
• sparc: add upgrade.sh
• move sparc bsd.rd from common+sparc to common/extra+sparc-big
• new sparc: stub for floppy building (experimental)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.10 2007/10/20 22:44:40 tg Exp $
d7 1
@


1.10
log
@eliminate the need for cdrom-mdboot and merge cdrom-finish into cdrom-generate
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.9 2007/10/02 00:48:12 tg Exp $
d4 1
a4 1
#INSTALLBOOT?=	${DESTDIR}/usr/mdec/installboot
d6 1
a6 1
IMAGESIZE=	3712
d9 2
a10 7
# for now, since it's quite too big
# makefs: '/usr/obj/distrib/common/tmpdata' size of 1798144 is larger than the maxsize of 1474560.
FLOPPY=		no

cdrom-mdcopy:
	ln ${WRKDIR}/v${OSrev}/${MACHINE}/bsd.rd ${WRKDIR}/vmunix # for kicks
	ln ${WRKDIR}/v${OSrev}/${MACHINE}/bsd.rd ${WRKDIR}/bsd	# no comment…
@


1.9
log
@all this mumpitz wasn't really necessary, after all (at least qemu shows)
now we'd better unify installboot(8) syntax between arches…
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.8 2007/10/01 21:52:20 tg Exp $
a13 1
	cp ${BOOTXX} ${WRKDIR}/v${OSrev}/${MACHINE}/
a15 7

cdrom-mdboot:
	${DESTDIR}/usr/mdec/installboot -v $$(fgrep \
	    ${WRKDIR}/b_${MACHINE}.ldr mkisofs.log | \
	    while read start end rest; do \
		print -- -s $$start -e $$end; \
	done) dummy ${BOOTXX} ${CDROM}
@


1.8
log
@if I see this correctly, boot(8/sparc) doesn’t parse a boot.cfg
until this is fixed, link the kernel to /bsd

doesn’t hurt as we won’t have dual-arch baselive CDs
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.7 2007/10/01 20:53:45 tg Exp $
a17 1
# XXX is this really necessary?
d19 5
a23 9
	test ! -e ${TMPMOUNT} || (cd ${.CURDIR}; ${MAKE} unconfig)
	mkdir -p ${TMPMOUNT}
	${SUDO} vnconfig -v -c ${VND} ${CDROM}
	${SUDO} disklabel -w ${VND} fakecdrom "MirOS BSD/sparc "
	${SUDO} ${DESTDIR}/usr/mdec/installboot -v $$(fgrep \
	    ${WRKDIR}/b_${MACHINE}.ldr mkisofs.log | while read start end rest; do \
		print -- -s $$start -e $$end; done) dummy ${BOOTXX} ${VND_CRDEV}
	${SUDO} vnconfig -v -u ${VND}
	${SUDO} rm -rf ${TMPMOUNT}
@


1.7
log
@boot.ldr -> b_{i386,sparc}.ldr
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.6 2007/08/12 21:17:58 tg Exp $
d16 1
@


1.6
log
@full sync; for now, no floppy (but bsd.rd) and no more miniroot for the sparc, I just wanna have a snapshot; built with QUICK_DISK2 so no X11, ports, HTML manpages, etc.; tbf l8er
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.5 2006/10/13 19:18:02 tg Exp $
d24 1
a24 1
	    ${WRKDIR}/boot.ldr mkisofs.log | while read start end rest; do \
@


1.5
log
@move /etc/boot.cfg and friends to /
agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.4 2006/08/19 15:00:42 tg Exp $
d6 1
d9 4
@


1.4
log
@use ${WRKDIR}
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.3 2006/08/18 21:36:29 tg Exp $
d19 1
a19 1
	    ${WRKDIR}/etc/boot.ldr mkisofs.log | while read start end rest; do \
@


1.3
log
@sync the sizes of the ramdisk images and the disktabs between arches
XXX i386 RAMDISK is probably too big now
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.2 2006/08/18 20:48:46 tg Exp $
d9 2
a10 2
	cp ${BOOTXX} workdir/v${OSrev}/${MACHINE}/
	ln workdir/v${OSrev}/${MACHINE}/bsd.rd workdir/vmunix	# for kicks
d19 1
a19 1
	    workdir/etc/boot.ldr mkisofs.log | while read start end rest; do \
@


1.2
log
@fix paths, etc.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.sparc,v 1.1 2006/08/17 19:34:13 tg Exp $
a6 1
IMAGESIZE=	3584
@


1.1
log
@move stuff required for images from miniroot/ and ramdisk/ to common/

PS: now's probably the time to not merge these with openbsd any more

PPS: this commit sponsored by johl's DEC VT320 @@9600,8n1 on NetBSD 1.6.1/pmax
@
text
@d1 1
a1 1
# $MirOS: src/distrib/ramdisk/Makefile.sparc,v 1.3 2006/08/17 12:49:49 tg Exp $
d10 1
a10 1
#	cp ${BOOTXX} workdir/v${OSrev}/${MACHINE}/
@

