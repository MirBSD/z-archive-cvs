head	1.2;
access;
symbols
	MIRBSD_10:1.1.0.2
	MIRBSD_10_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2010.08.14.20.53.09;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004C6702403C804E92;

1.1
date	2006.08.17.19.34.16;	author tg;	state Exp;
branches;
next	;
commitid	10044E4C48801BF3A85;


desc
@@


1.2
log
@new library for all those pesky functions like cdblockedread() or
my arc4random extensions or ambstowcs(3) or whatever other MirBSD
specific functions we provide – this way, they can be shared on a
crunchgen(1)d executable (such as ramdisks’ instbin) but need not
affect libc or other shared libraries’ versions

XXX manpages ought to still be mandated
@
text
@#	$MirOS: src/distrib/common/makeconf.awk,v 1.1 2006/08/17 19:34:16 tg Exp $
#	$OpenBSD: makeconf.awk,v 1.14 2003/12/16 22:41:40 henning Exp $
#	$NetBSD: makeconf.awk,v 1.3 1996/05/04 15:45:32 pk Exp $

#
# generate crunchgen(1) configuration file from `list' spec.
#

BEGIN {
	printf("#\n# This file is automatically generated by `makeconf'\n#\n\n");
	libs = "libs -lutil -locurses -lm -lkvm -lz -lmbfun";
}

$1 == "LIBS" {
	$1 = tolower($1);
	libs = $0;
}

$1 == "SRCDIRS" {
	$1 = tolower($1);
	print;
}

($1 == "LINK" || $1 == "SYMLINK") && index($2,CBIN) {
	# find basenames for inclusion in crunchgen's `prog' and `ln' directives
	n = split($3, x, "/");
	p = x[n];
	progs[p] = NF - 3;
	for (i = 4; i <= NF; i++) {
		n = split($i, x, "/");
		l = x[n];
		links[i - 3, p] = l;
	}
}

$1 == "ARGVLINK" {
	# add extra `ln' entries (these don't appear in the filesystem)
	n = progs[$2];
	progs[$2] = ++n;
	links[n, $2] = $3;
}

$1 == "CRUNCHSPECIAL" {
	# collect crunchgen `special' directives
	$1 = "";
	specials[$0] = 1;
}

END {
	# write crunchgen configuration

	# `prog' directives; print 8 to a line
	column = 0;
	for (p in progs) {
		if ((column++ % 8) == 0)
			printf("\nprogs");
		printf(" %s", p);
	}
	printf("\n\n");

	# `ln' directives
	for (p in progs) {
		n = progs[p];
		for (i = 1; i <= n; i++)
			printf("ln %s %s\n", p, links[i,p]);
	}
	printf("\n%s\n\n", libs);

	# `special' directives
	for (s in specials) {
		printf("special %s\n", s);
	}
}
@


1.1
log
@move stuff required for images from miniroot/ and ramdisk/ to common/

PS: now's probably the time to not merge these with openbsd any more

PPS: this commit sponsored by johl's DEC VT320 @@9600,8n1 on NetBSD 1.6.1/pmax
@
text
@d1 1
a1 1
#	$MirOS: src/distrib/miniroot/makeconf.awk,v 1.3 2006/05/26 19:19:57 tg Exp $
d11 1
a11 1
	libs = "libs -lutil -locurses -lm -lkvm -lz";
@

