head	1.63;
access;
symbols
	MIRBSD_10:1.24.0.2
	MIRBSD_10_BASE:1.24
	tg-release_reconsider:1.11;
locks; strict;
comment	@# @;


1.63
date	2015.10.24.21.59.03;	author tg;	state Exp;
branches;
next	1.62;
commitid	100562BFF3657F6BB88;

1.62
date	2013.09.28.19.55.15;	author tg;	state Exp;
branches;
next	1.61;
commitid	100524733DE1CEE6C8A;

1.61
date	2013.09.10.21.56.45;	author tg;	state Exp;
branches;
next	1.60;
commitid	100522F95B529763C82;

1.60
date	2011.02.19.13.10.23;	author tg;	state Exp;
branches;
next	1.59;
commitid	1004D5FC1547BD1CA38;

1.59
date	2011.02.18.23.06.02;	author tg;	state Exp;
branches;
next	1.58;
commitid	1004D5EFB713D2F7B5F;

1.58
date	2010.09.25.12.01.48;	author tg;	state Exp;
branches;
next	1.57;
commitid	1004C9DE4B85FA98E46;

1.57
date	2010.01.07.20.56.08;	author tg;	state Exp;
branches;
next	1.56;
commitid	1004B464A630F817F6F;

1.56
date	2009.11.15.12.54.30;	author tg;	state Exp;
branches;
next	1.55;
commitid	1004AFFFA18670AC0C4;

1.55
date	2009.11.12.22.24.39;	author tg;	state Exp;
branches;
next	1.54;
commitid	1004AFC8B345A853AB7;

1.54
date	2009.11.11.19.28.48;	author tg;	state Exp;
branches;
next	1.53;
commitid	1004AFB10773717DC2F;

1.53
date	2009.11.05.22.48.00;	author tg;	state Exp;
branches;
next	1.52;
commitid	1004AF356264FC187FF;

1.52
date	2009.11.05.21.38.36;	author tg;	state Exp;
branches;
next	1.51;
commitid	1004AF345EF1A8F34C3;

1.51
date	2009.10.27.16.10.45;	author tg;	state Exp;
branches;
next	1.50;
commitid	1004AE71B927785CFF3;

1.50
date	2009.08.09.10.31.57;	author tg;	state Exp;
branches;
next	1.49;
commitid	1004A7EA5AE6AE76840;

1.49
date	2009.02.22.19.13.24;	author tg;	state Exp;
branches;
next	1.48;
commitid	10049A1A3D96F798FC8;

1.48
date	2009.01.26.09.04.08;	author tg;	state Exp;
branches;
next	1.47;
commitid	100497D7C9B1EEF0C7B;

1.47
date	2009.01.26.09.03.18;	author tg;	state Exp;
branches;
next	1.46;
commitid	100497D7C59650C5A0D;

1.46
date	2009.01.18.15.52.58;	author tg;	state Exp;
branches;
next	1.45;
commitid	1004973506D69BE6A7B;

1.45
date	2009.01.18.15.44.08;	author tg;	state Exp;
branches;
next	1.44;
commitid	10049734E5D0FA9D269;

1.44
date	2009.01.18.14.50.03;	author tg;	state Exp;
branches;
next	1.43;
commitid	1004973419C0AEA45D1;

1.43
date	2009.01.12.21.54.40;	author tg;	state Exp;
branches;
next	1.42;
commitid	100496BBC367E14F1B5;

1.42
date	2008.12.30.02.00.11;	author tg;	state Exp;
branches;
next	1.41;
commitid	100495980994C82350F;

1.41
date	2008.12.29.23.57.12;	author tg;	state Exp;
branches;
next	1.40;
commitid	100495963E321EF1CE2;

1.40
date	2008.12.27.00.26.59;	author tg;	state Exp;
branches;
next	1.39;
commitid	1004955765B63334424;

1.39
date	2008.12.26.22.43.44;	author tg;	state Exp;
branches;
next	1.38;
commitid	10049555DE404FB865C;

1.38
date	2008.12.04.15.18.32;	author tg;	state Exp;
branches;
next	1.37;
commitid	1004937F4D6236A5682;

1.37
date	2008.11.08.22.23.51;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004916117E0B020D70;

1.36
date	2008.11.02.14.17.33;	author tg;	state Exp;
branches;
next	1.35;
commitid	100490DB68B5D59C511;

1.35
date	2008.11.01.18.40.05;	author tg;	state Exp;
branches;
next	1.34;
commitid	100490CA28205BE226C;

1.34
date	2008.11.01.18.37.17;	author tg;	state Exp;
branches;
next	1.33;
commitid	100490CA1ED511FAF22;

1.33
date	2008.10.20.19.29.20;	author tg;	state Exp;
branches;
next	1.32;
commitid	10048FCDBAF5C7D98EB;

1.32
date	2008.10.20.18.20.31;	author tg;	state Exp;
branches;
next	1.31;
commitid	10048FCCBF9283FF1EE;

1.31
date	2008.10.20.17.51.31;	author tg;	state Exp;
branches;
next	1.30;
commitid	10048FCC53937EEC290;

1.30
date	2008.10.19.19.27.50;	author tg;	state Exp;
branches;
next	1.29;
commitid	10048FB8A4119CDB544;

1.29
date	2008.07.12.22.06.13;	author tg;	state Exp;
branches;
next	1.28;
commitid	10048792AAF4F6C5252;

1.28
date	2008.06.27.20.09.44;	author tg;	state Exp;
branches;
next	1.27;
commitid	100486549193484A06F;

1.27
date	2008.05.22.23.07.51;	author tg;	state Exp;
branches;
next	1.26;
commitid	1004835FCBE00105829;

1.26
date	2008.03.15.21.12.59;	author tg;	state Exp;
branches;
next	1.25;
commitid	10047DC3BEF13111ADE;

1.25
date	2008.03.10.15.40.57;	author tg;	state Exp;
branches;
next	1.24;
commitid	10047D556921423B9B5;

1.24
date	2008.03.04.23.48.58;	author tg;	state Exp;
branches
	1.24.2.1;
next	1.23;
commitid	10047CDDF93661C0E2E;

1.23
date	2008.02.24.14.47.56;	author tg;	state Exp;
branches;
next	1.22;
commitid	10047C183A8674596AE;

1.22
date	2007.09.28.22.54.07;	author tg;	state Exp;
branches;
next	1.21;
commitid	10046FD8626212580F2;

1.21
date	2007.09.28.20.46.54;	author tg;	state Exp;
branches;
next	1.20;
commitid	10046FD684B204757B3;

1.20
date	2007.09.01.10.51.49;	author tg;	state Exp;
branches;
next	1.19;
commitid	10046D9443D6F54D117;

1.19
date	2007.07.26.10.49.47;	author tg;	state Exp;
branches;
next	1.18;
commitid	10046A87C5B49DA92DE;

1.18
date	2007.07.07.20.32.06;	author tg;	state Exp;
branches;
next	1.17;
commitid	100468FF6665289063C;

1.17
date	2007.06.22.19.58.59;	author tg;	state Exp;
branches;
next	1.16;
commitid	100467C2A0D72BEE2AC;

1.16
date	2007.06.04.09.05.40;	author tg;	state Exp;
branches;
next	1.15;
commitid	1004663D5F31FA91204;

1.15
date	2007.05.24.22.38.21;	author tg;	state Exp;
branches;
next	1.14;
commitid	100465613EC5D0FEBA4;

1.14
date	2007.05.24.20.32.19;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004655F65468CF9FCB;

1.12
date	2007.05.23.19.58.03;	author tg;	state Exp;
branches;
next	1.11;
commitid	10046549CE13F18059E;

1.11
date	2007.03.26.17.57.07;	author tg;	state Exp;
branches;
next	1.10;
commitid	100460809891D334527;

1.10
date	2007.03.08.09.01.59;	author tg;	state Exp;
branches;
next	1.9;
commitid	10045EFD11B3F2287E1;

1.9
date	2007.02.18.18.23.29;	author tg;	state Exp;
branches;
next	1.8;
commitid	10045D8999E5238716F;

1.8
date	2007.02.18.01.56.44;	author tg;	state Exp;
branches;
next	1.7;
commitid	10045D7B21A57601D00;

1.7
date	2007.02.02.16.45.09;	author tg;	state Exp;
branches;
next	1.6;
commitid	10045C36A7B5DB2058E;

1.6
date	2006.10.17.21.21.03;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004535494B58B40CE1;

1.5
date	2006.10.15.00.56.31;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004531874D5C338345;

1.4
date	2006.10.08.00.24.42;	author tg;	state Exp;
branches;
next	1.3;
commitid	100452845255DA75FEF;

1.3
date	2006.10.07.23.29.13;	author tg;	state Exp;
branches;
next	1.2;
commitid	100452838586FBE9244;

1.2
date	2006.08.18.20.48.46;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044E627C4580B7224;

1.1
date	2006.08.17.19.34.14;	author tg;	state Exp;
branches;
next	;
commitid	10044E4C48801BF3A85;

1.24.2.1
date	2008.03.12.19.11.20;	author tg;	state Exp;
branches;
next	1.24.2.2;
commitid	10047D82AEC01A2B6BA;

1.24.2.2
date	2008.05.22.23.08.22;	author tg;	state Exp;
branches;
next	1.24.2.3;
commitid	1004835FCF821C7A2C9;

1.24.2.3
date	2008.06.11.10.24.31;	author tg;	state Exp;
branches;
next	;
commitid	100484FA7D30360EA68;


desc
@@


1.63
log
@attempt at making the i386 floppy a tad smaller again
@
text
@# $MirOS: src/distrib/common/dot.profile,v 1.62 2013/09/28 19:55:15 tg Exp $
# $OpenBSD: dot.profile,v 1.4 2002/09/13 21:38:47 deraadt Exp $
# $NetBSD: dot.profile,v 1.1 1995/12/18 22:54:43 pk Exp $
#
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2013
#	mirabilos <m@@mirbsd.org>
# Copyright (c) 1995 Jason R. Thorpe
# Copyright (c) 1994 Christopher G. Demetriou
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by Christopher G. Demetriou.
# 4. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

export HOME=/ LC_CTYPE=en_US.UTF-8 PATH=/sbin:/bin:/usr/sbin:/usr/bin:/ PS1='$PWD # '
umask 022
cd /
ulimit -c 0

if [[ -z $NEED_UNICODE ]]; then
	# 0 = UTF-8; >0 = ISO-8859-1
	chkuterm; export NEED_UNICODE=$?
	# no typescript, login shell
	(( NEED_UNICODE )) && exec script -lns
fi
unset NEED_UNICODE

. /etc/functions
sshd() {
	if grep -q '^root:x:' /etc/master.passwd 2>/dev/null; then
		echo error: you must passwd root first
		return 1
	fi
	if [[ ! -f /etc/ssh/ssh_host_rsa_key ]]; then
		_getrnd skg
		print -n "ssh-keygen: generating new RSA host key... "
		sleep 3
		if ssh-keygen -qt rsa -f /etc/ssh/ssh_host_rsa_key -N ''; then
			echo done.
		else
			echo failed.
			rm -f /etc/ssh/ssh_host_rsa_key
		fi
	fi
	if [[ -f /etc/ssh/ssh_host_rsa_key ]]; then
		ssh-keygen -lf /etc/ssh/ssh_host_rsa_key
		/usr/sbin/sshd "$@@"
	fi
}

do_netcfg() {
	local bpf=0 cwd=$(pwd) nic pwhash rootpw='miros'
	: this is extra space to facilitate easy editing of the ISO
	echo Setting up the loopback interface
	ifconfig lo0 inet 127.0.0.1 up
	sysctl -w net.inet6.ip6.accept_rtadv=1
	cd /dev
	for nic in $(ifconfig -l); do
		[[ $nic = @@(lo|plip)+([0-9]) ]] && continue
		echo Setting up interface $nic
		ifconfig $nic up
		(rtsol $nic 2>&1 &) 2>/dev/null
		mksh MAKEDEV bpf$((bpf++))
		dhclient $nic
	done
	cd "$cwd"
	echo Configuring the ssh daemon
	pwhash=$(encrypt -b 8 -- "$rootpw")
	print "/^root/s^root:[^:]*:root:${pwhash}:\nwq" | ed -s /etc/master.passwd
	pwd_mkdb -p /etc/master.passwd
	sshd
	echo "All done, you can log in now (root/$rootpw)"
}

alias l='/bin/ls -F'
alias la='l -a'
alias ll='l -l'
alias lo='la -lo'

rootdisk=$(sysctl -n kern.root_device)
rootdisk=/dev/${rootdisk:-rd0a}

if [[ ! -f /.profile.done ]]; then
	# first of all, we need a /tmp - use all memory minus 4 MiB
	integer avmem=$(sysctl -n hw.usermem)
	(( avmem = avmem > 321634304 ? 620000 : avmem / 512 - 8192 ))
	(( avmem < 144 )) || mount_mfs -s $avmem swap /tmp
	unset avmem

	# on sparc, use the nvram to provide some additional entropy
	# also read some stuff from the HDD etc. (doesn't matter if it breaks)
	[[ -x /usr/libexec/tpmrng ]] && /usr/libexec/tpmrng
	( ( (for d in {w,s,rai,c}:128, r:1,32; do b=${d#*,}; d=${d%,*}; dd \
	    if=/dev/r${d%:*}d0c count=${d#*:} ${b:+bs=$b of=/dev/urandom}; \
	    done; eeprom; dmesg; sysctl -a) 2>&1 | cksum -backsum -asha512 \
	    -asuma -atiger -armd160 -aadler32 >/dev/wrandom) &)

	# say hello and legalese
	echo '
Welcome to MirOS #10-current!

Welcome to the MirOS BSD operating system installer.  This work is
licenced open source software; for further information please read
the information at http://mirbsd.de/ and its mirrors.  After setup
the files in /usr/share/doc/legal/ contain additional licences and
other terms used by MirOS or its contributed material.
This work is provided "AS IS" and WITHOUT WARRANTY of any kind.
'

	mount -u $rootdisk / || mount -fuw /dev/rd0a /

	# set up some sane defaults
	echo 'erase ^?, werase ^W, kill ^U, intr ^C, status ^T'
	stty newcrt werase ^W intr ^C kill ^U erase ^? status ^T

	# Extract and save one boot's worth of dmesg
	dmesg | sed -ne '/^MirBSD/h;/^MirBSD/!H;${g;p;}' >/var/run/dmesg.boot

	# Now we can try to access an eKey if there is one
	[[ -x /usr/libexec/ekeyrng ]] && /usr/libexec/ekeyrng

	# Enable mouse, if any, for extra possible entropy and copy/paste
	[[ -x /usr/sbin/wsmoused ]] && /usr/sbin/wsmoused

	# look if we're DHCP/TFTP enabled
	if [[ -e /usr/libexec/tftpd ]]; then
		mkdir /tmp/tftpboot
		cp /usr/mdec/boot /tmp/tftpboot/
	fi

	# reset arandom(4)
	typeset -i1 x=RANDOM; print -n "${x#1#}" >/dev/arandom

	# try to spawn a second shell
	mksh -lT1 >/dev/null 2>&1

	# don't run this twice
	:>/.profile.done

	# Installing or upgrading?
	_forceloop=
	while [[ $_forceloop != [IiUuSsN]* ]]; do
		print -n '(I)nstall'
		[[ -f /upgrade ]] && print -n ', (U)pgrade'
		print -n ' or (S)hell? '
		read _forceloop
		case $_forceloop {
		([Ii]*)	/install ;;
		([Uu]*)	/upgrade ;;
		}
	done
	[[ $_forceloop = N ]] && do_netcfg
	unset _forceloop
else
	stty newcrt werase ^W intr ^C kill ^U erase ^? status ^T
fi
RANDOM=$(dd if=/dev/arandom count=1 bs=4 2>/dev/null | hexdump -e '1/4 "%u"')
export TERM=vt220 IRCUSER=MirBSD_s IRCNICK=MirOS_BSD-$RANDOM
print -n '\nAvailable editor: ed'
[ -x /usr/bin/vi ] && print -n ' (n)vi'
[ -x /usr/bin/e3 ] && print -n ' e3*'
[ -s /ed.hlp ] && print -n ' - help with # less /ed.hlp'
print '\nNetwork interfaces (e.g. for dhclient $if;passwd root;sshd):' $(ifconfig -l)
[ -x /usr/bin/tinyirc ] && echo 'Chat client: tinyirc'
echo
_vbox_check && echo Sorry, WirrtualBox is not supported.
@


1.62
log
@ITIMER_PROF is driven from hardintr, not rtcintr, what a shame!
with this cprng(8) brings virtually no entropy but at pretty high
CPU cost nevertheless (I never liked it much, anyway…) so rid it
(think about adding jytter later)

basically we’ll need something that signals us at stathz intervals
(or profhz), for this to work
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.61 2013/09/10 21:56:45 tg Exp $
d6 1
a6 1
#	Thorsten “mirabilos” Glaser <tg@@mirbsd.org>
d36 1
a36 2
export HOME=/ LC_CTYPE=en_US.UTF-8 PATH=/sbin:/bin:/usr/sbin:/usr/bin:/ \
    PS1='$PWD # '
d42 4
a45 2
	chkuterm; export NEED_UNICODE=$?	# 0 = UTF-8; >0 = ISO-8859-1
	(( NEED_UNICODE )) && exec script -lns	# no typescript, login shell
d52 1
a52 1
		print -u2 error: you must passwd root first
d60 1
a60 1
			print done.
d62 1
a62 1
			print failed.
d83 1
a83 1
		(rtsol $nic 2>&1 &) 2>&-
d90 1
a90 2
	print "/^root/s^root:[^:]*:root:${pwhash}:\nwq" | \
	    ed -s /etc/master.passwd
d104 1
a104 1
if [ ! -f /.profile.done ]; then
d114 4
a117 4
	( ( (for d in {w,s,rai,c}:128, r:1,128; do b=${d#*,}; d=${d%,*}; dd \
	     if=/dev/r${d%:*}d0c count=${d#*:} ${b:+bs=$b of=/dev/urandom}; \
	     done; eeprom; dmesg; sysctl -a) 2>&1 | cksum -backsum -asha512 \
	     -asuma -atiger -armd160 -aadler32 >/dev/wrandom) &)
d120 1
a120 1
	print '
d128 2
a129 1
This work is provided "AS IS" and WITHOUT WARRANTY of any kind.\n'
d134 1
a134 1
	print 'erase ^?, werase ^W, kill ^U, intr ^C, status ^T'
d147 1
a147 1
	if [ -e usr/libexec/tftpd ]; then
a151 3
	# don't run this twice
	:>/.profile.done

d158 3
d165 1
a165 1
		[ -f upgrade ] && print -n ', (U)pgrade'
d184 3
a186 4
print '\nNetwork interfaces (e.g. for dhclient $if;passwd root;sshd):' \
    $(ifconfig -l)
[ -x /usr/bin/tinyirc ] && print 'Chat client: tinyirc'
print
@


1.61
log
@improve comments and such
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.60 2011/02/19 13:10:23 tg Exp $
a112 1
	[[ -x /usr/libexec/cprng ]] && /usr/libexec/cprng -p
@


1.60
log
@better entropy reset
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.59 2011/02/18 23:06:02 tg Exp $
d5 1
a5 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
d153 1
a153 1
	print -n >/.profile.done
d155 1
a155 1
	# reset arandom(4) – in a subshell for arc4_stir_pid
d184 2
a185 1
print '\nNetwork interfaces (e.g. for dhclient $if):' $(ifconfig -l)
@


1.59
log
@apply a limited amount of preventing the user from shooting into his foot
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.58 2010/09/25 12:01:48 tg Exp $
d156 1
a156 1
	(typeset -i1 x=RANDOM; print -n "${x#1#}" >/dev/arandom)
d178 1
@


1.58
log
@enable wsmoused in the installer, both for comfort and RND_SRC_MOUSE ☺
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.57 2010/01/07 20:56:08 tg Exp $
d186 1
@


1.57
log
@add auto-network-and-sshd ISO variant, requested by Vutral
thanks for the good idea - we'll provide it by default from now
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.56 2009/11/15 12:54:30 tg Exp $
d143 3
@


1.56
log
@it helps to have / R/W…
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.55 2009/11/12 22:24:39 tg Exp $
d5 1
a5 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009
d71 25
d160 1
a160 1
	while [[ $_forceloop != [IiUuSs]* ]]; do
d170 1
@


1.55
log
@tweak the IRC nick and ident again, with testing
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.54 2009/11/11 19:28:48 tg Exp $
a88 1
	[[ -x /usr/libexec/ekeyrng ]] && /usr/libexec/ekeyrng
d115 3
@


1.54
log
@today's commit: tweak default IRC nick per flavour
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.53 2009/11/05 22:48:00 tg Exp $
d147 1
a147 1
export TERM=vt220 IRCUSER=MirBSD IRCNICK=MirBSD$RANDOM
@


1.53
log
@add an experimental minimum EntropyKey client to the ramdisk with cu(1)

XXX rewrite tpmrx (née tpmrng), cprng(8) and ekeyrng as ONE .c file DTRT
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.52 2009/11/05 21:38:36 tg Exp $
d147 1
a147 1
export TERM=vt220 IRCUSER=MirBSD IRCNICK=guest$RANDOM
@


1.52
log
@fix sed expression to actually match dmesg
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.51 2009/10/27 16:10:45 tg Exp $
d89 1
@


1.51
log
@more cool help text especially for bsd4grml
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.50 2009/08/09 10:31:57 tg Exp $
d113 1
a113 1
	dmesg | sed -ne '/^MirBSD /h;/^MirBSD /!H;${g;p;}' >/var/run/dmesg.boot
@


1.50
log
@adjust mfs sizes to what works on sparc
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.49 2009/02/22 19:13:24 tg Exp $
d151 1
a151 1
print
@


1.49
log
@hook tpmrng(8), to be written, into the system and installer
(you can never have enough entropy)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.48 2009/01/26 09:04:08 tg Exp $
d82 1
a82 1
	(( avmem = avmem > 536870912 ? 1048576 : avmem / 512 - 8192 ))
@


1.48
log
@this is actually smaller
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.47 2009/01/26 09:03:18 tg Exp $
d89 1
@


1.47
log
@gah! break out after an install or upgrade
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.46 2009/01/18 15:52:58 tg Exp $
d131 1
a131 1
	while [[ $_forceloop != [Ss]* ]]; do
d137 2
a138 2
		([Ii]*)	/install; break ;;
		([Uu]*)	/upgrade; break ;;
@


1.46
log
@we don’t need _forceloop exposed
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.45 2009/01/18 15:44:08 tg Exp $
d5 1
a5 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008
d137 2
a138 2
		([Ii]*)	/install ;;
		([Uu]*)	/upgrade ;;
@


1.45
log
@bugfixes
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.44 2009/01/18 14:50:03 tg Exp $
d141 1
@


1.44
log
@• optimise the Install/Upgrade/Shell loop
• recognise if tinyirc is there
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.43 2009/01/12 21:54:40 tg Exp $
d144 1
a144 1
export TERM=vt220
@


1.43
log
@add a pxeboot(8/i386) MLINK to provide an upgrade path (not removing
pxeboot.8 just yet) and switch pxeboot→boot in all sensible places

mention MirOS /boot is unified, local disc and network capable, for
all architectures now (and add “ldbsd.com” commonly-known-alias name)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.42 2008/12/30 02:00:11 tg Exp $
d131 1
a131 1
	while [[ -z $_forceloop ]]; do
a138 2
		([Ss]*)	;;
		(*)	_forceloop= ;;
d147 1
a147 1
[ -x /usr/bin/e3 ] && print -n ' e3'
d149 3
a151 1
print '\n'
@


1.42
log
@one might want this one on the bsd.rd instead:
-rwxr-xr-x  1 tg  wsrc  - 13520 Dec 30 01:43 /usr/obj/contrib/gnu/e3/e3*
e3: ELF 32-bit LSB executable, Intel 80386, version 1, for MirOS BSD, statically linked, stripped
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.41 2008/12/29 23:57:12 tg Exp $
d115 1
a115 1
	if [ -e /usr/mdec/pxeboot ]; then
d117 1
a117 1
		cp /usr/mdec/pxeboot /tmp/tftpboot/
@


1.41
log
@just in case someone adds 224K of nvi on his installer/rescue system…
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.40 2008/12/27 00:26:59 tg Exp $
d149 1
@


1.40
log
@use a common bunch of functions too

XXX throw ask* and initterm there as well some day
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.39 2008/12/26 22:43:44 tg Exp $
d148 1
@


1.39
log
@throw entropy on dhclient finishing on bsd.rd too
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.38 2008/12/04 15:18:32 tg Exp $
d42 5
a46 40
function uri_escape {
	print -nr -- "$*" | sed -e '
	    s.%.%25.g
	    s.;.%3B.g
	    s./.%2F.g
	    s.?.%3F.g
	    s.:.%3A.g
	    s.@@@@.%40.g
	    s.&.%26.g
	    s.=.%3D.g
	    s.+.%2B.g
	    s.\$.%24.g
	    s.,.%2C.g
	    s.	.%09.g
	    s. .%20.g
	    s.<.%3C.g
	    s.>.%3E.g
	    s.#.%23.g
	    s.".%22.g
	    s.{.%7B.g
	    s.}.%7D.g
	    s.|.%7C.g
	    s.\\.%5C.g
	    s.\^.%5E.g
	    s.\[.%5B.g
	    s.\].%5D.g
	    s.`.%60.g
	    s.'\''.%27.g
	'
}

_getrnd() {
	typeset url=${2:-https}://call.mirbsd.org/rn.cgi

	url=${url}?bsdrd${1:-manuell}
	url=$url,os=$(uri_escape "$(uname -a)")
	url=$url,seed=$(dd if=/dev/arandom bs=57 count=1 2>&- | \
	    b64encode -r - | tr '+=/' '._-')
	(ulimit -T 60; exec ftp -mvo /dev/arandom "$url") >/dev/wrandom 2>&1
}
d48 1
a70 6
if [[ -z $NEED_UNICODE ]]; then
	chkuterm; export NEED_UNICODE=$?	# 0 = UTF-8; >0 = ISO-8859-1
	(( NEED_UNICODE )) && exec script -lns	# no typescript, login shell
fi
unset NEED_UNICODE

@


1.38
log
@distinguish between manual and automatic calls
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.37 2008/11/08 22:23:51 tg Exp $
d42 31
d74 7
a80 4
	(ulimit -T 60; exec ftp -mvo /dev/arandom \
	    https://call.mirbsd.org/rn.cgi?bsdrd${1:-manuell},$(dd \
	    if=/dev/arandom bs=57 count=1 | \
	    b64encode -r - | tr '+=/' '._-')) >/dev/wrandom 2>&1
@


1.37
log
@mass conversion 66h.42h.de → mirbsd.org
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.36 2008/11/02 14:17:33 tg Exp $
d44 1
a44 1
	    https://call.mirbsd.org/rn.cgi?bsdrdskg,$(dd \
d55 1
a55 1
		_getrnd
@


1.36
log
@adjust minimum MFS size after 100490CA28205BE226C
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.35 2008/11/01 18:40:05 tg Exp $
d6 1
a6 1
#	Thorsten “mirabilos” Glaser <tg@@66h.42h.de>
@


1.35
log
@when you have “enough” RAM, you hit interesting boundaries… the maximum
size argument for mount_mfs(8) is somewhere between 550 and 768 MiB.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.34 2008/11/01 18:37:17 tg Exp $
d89 1
a89 1
	(( avmem < 8200 )) || mount_mfs -s $avmem swap /tmp
@


1.34
log
@refactorise
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.33 2008/10/20 19:29:20 tg Exp $
d87 3
a89 2
	integer avmem="$(sysctl -n hw.usermem) / 512"
	(( avmem < 8200 )) || mount_mfs -s $((avmem - 8192)) swap /tmp
@


1.33
log
@• change mksh to only then behave more POSuXish when called as /bin/sh or
  “-sh” if -DMKSH_BINSHREDUCED was passed during compilation, for example
  for Debian, but d̲e̲f̲i̲n̲i̲t̲i̲v̲e̲l̲y̲ n̲̲o̲̲t̲̲ for MirBSD™
• split up regression test to force this behaviour
• remove the gunk from our MirBSD™ startup scripts again
• mention arc4random.c changes on website, sync clog, warn packagers
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.32 2008/10/20 18:20:31 tg Exp $
d42 7
d55 1
a55 4
		(ulimit -T 60; exec ftp -mvo /dev/arandom \
		    https://call.mirbsd.org/rn.cgi?bsdrdskg,$(dd \
		    if=/dev/arandom bs=57 count=1 2>&- | \
		    b64encode -r - | tr '+=/' '._-')) >/dev/wrandom 2>&1
@


1.32
log
@better safe than sorry: fixup and cleanup initial state
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.31 2008/10/20 17:51:31 tg Exp $
a35 1
set +o posix -o braceexpand +o utf8-hack
@


1.31
log
@mksh has more to offer… also shrink size while here
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.30 2008/10/19 19:27:50 tg Exp $
d36 3
a38 2
set +o posix -o braceexpand
export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/ PS1='$PWD # ' HOME=/
d40 1
@


1.30
log
@use b64encode for seed generation if available
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.29 2008/07/12 22:06:13 tg Exp $
d36 5
d47 1
a47 1
		(ulimit -T 60; exec /usr/bin/ftp -mvo /dev/arandom \
d53 1
a53 2
		if /usr/bin/ssh-keygen -q -t rsa \
		    -f /etc/ssh/ssh_host_rsa_key -N ''; then
d61 1
a61 1
		/usr/bin/ssh-keygen -l -f /etc/ssh/ssh_host_rsa_key
a65 4
export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/ PS1='$PWD # ' HOME=/
umask 022
ulimit -c 0

d67 2
a68 5
	chkuterm; NEED_UNICODE=$?	# 0 = UTF-8; >0 = ISO-8859-1
	if (( NEED_UNICODE )); then
		export NEED_UNICODE	# don't try this twice
		exec script -lns	# latin1, no typescript, login shell
	fi
d123 2
a124 2
	# reset arandom(4)
	( typeset -i8 x='RANDOM & 255'; print -n "\0${x#8#}" >/dev/arandom )
d137 2
a138 4
		([Ii]*)	/install
			;;
		([Uu]*)	/upgrade
			;;
d140 1
a140 2
		(*)	_forceloop=
			;;
@


1.29
log
@• sparc, i386: rmdir stuff only for i386-big
• sparc: add upgrade.sh
• move sparc bsd.rd from common+sparc to common/extra+sparc-big
• new sparc: stub for floppy building (experimental)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.28 2008/06/27 20:09:44 tg Exp $
d42 4
d47 1
a47 3
		(ulimit -T 60; exec /usr/bin/ftp -mvo /dev/arandom \
		    https://call.mirbsd.org/rn.cgi?bsdrdskg,seed=$RANDOM) \
		    >/dev/wrandom 2>&1
@


1.28
log
@stty on all ttys
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.27 2008/05/22 23:07:51 tg Exp $
d89 1
a89 1
	/usr/libexec/cprng -p
@


1.27
log
@• provide a $HOME, it’s kludgy to work with it unset
• while here: s/echo/print/, whitespace cleanup
• optimise: [[ $foo -ne 0 ]] → (( foo ))
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.26 2008/03/15 21:12:59 tg Exp $
d147 2
@


1.26
log
@prevent coredumps
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.25 2008/03/10 15:40:57 tg Exp $
d42 1
a42 1
		echo -n "ssh-keygen: generating new RSA host key... "
d48 3
a50 3
			echo done.
		  else
			echo failed.
d60 1
a60 1
export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/ PS1='$PWD # '
d66 1
a66 1
	if [[ $NEED_UNICODE -ne 0 ]]; then
d96 1
a96 1
	echo '
d109 1
a109 1
	echo 'erase ^?, werase ^W, kill ^U, intr ^C, status ^T'
d133 3
a135 3
		echo -n '(I)nstall'
		[ -f upgrade ] && echo -n ', (U)pgrade'
		echo -n ' or (S)hell? '
d138 1
a138 1
		[Ii]*)	/install
d140 1
a140 1
		[Uu]*)	/upgrade
d142 2
a143 2
		[Ss]*)	;;
		*)	_forceloop=
@


1.25
log
@unlock, MirOS #10-current 0AuA0, 2008
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.24 2008/03/04 23:48:58 tg Exp $
d62 1
@


1.24
log
@provide some of our own entropy to the randomness source server when asking
for some seed to help the own pool initialising
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.23 2008/02/24 14:47:56 tg Exp $
d96 1
a96 1
Welcome to MirOS #10!
@


1.24.2.1
log
@bump to #10-stable 0As81
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.24 2008/03/04 23:48:58 tg Exp $
d96 1
a96 1
Welcome to MirOS #10-stable!
@


1.24.2.2
log
@MFC: provide a $HOME
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.24.2.1 2008/03/12 19:11:20 tg Exp $
d60 1
a60 1
export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/ PS1='$PWD # ' HOME=/
@


1.24.2.3
log
@MFC:
• disable core dumps
• use rdate+ntpd instead of ntpd with ‘-s’ flag (deprecated)
• default the aperture question to ‘yes’ if an X11 server is installed
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.24.2.2 2008/05/22 23:08:22 tg Exp $
a60 1
ulimit -c 0
@


1.23
log
@help people who forget to 'passwd root' before 'sshd'
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.22 2007/09/28 22:54:07 tg Exp $
d5 1
a5 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007
d44 2
a45 1
		    https://call.mirbsd.org/rn.cgi?bsdrdskg) >/dev/wrandom 2>&1
@


1.22
log
@don’t hardcode herc.mirbsd.org
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.21 2007/09/28 20:46:54 tg Exp $
d37 4
@


1.21
log
@reduce writes to /dev/arandom, do them where necessary only
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.20 2007/09/01 10:51:49 tg Exp $
d40 1
a40 1
		    https://herc.mirbsd.org/rn.cgi?bsdrdskg) >/dev/wrandom 2>&1
@


1.20
log
@• remove the "this is the old installer" line, for now
• optimise, stylify
• ensure we only mount_mfs /tmp if we have enough memory
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.19 2007/07/26 10:49:47 tg Exp $
d85 1
a85 1
	     if=/dev/r${d%:*}d0c count=${d#*:} ${b:+bs=$b of=/dev/arandom}; \
d118 3
@


1.19
log
@modernise the cprng invocation
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.18 2007/07/07 20:32:06 tg Exp $
d77 3
a79 1
	mount_mfs -s $(($(sysctl -n hw.usermem)/512-8192)) swap /tmp
a91 1
This is the old installer, expect it to be replaced really soon.
d142 1
a142 1
print; print
@


1.18
log
@add cprng, a RNG feeding entropy generated from the oscillation differences
between the CPU clock and the mainboard/bus clock into /dev/urandom (by de-
fault and if run by root), or writing them to stdout (under quite high load
for the CPU), after whitening. The entropy is quite good (if you get enough
to feed ports/math/ent), only the χ² lets me worry.

Tested on my systems:
• nwt (80486DX-33): 7.3 bit per byte, but as bad as rand()
• demo (SPARCstaion 20): 7.4 bit per byte, not much better
• herc (Pentium 233 MMX): 7.6 bit per byte, quality sort of okay
• odem (Athlon XP 500): 7.8 bit per byte, quality very good
• odem (Athlon XP 1200): 7.8 bit per byte, no difference to clocked-down

Instead of adding more post-processing or other functions to improve output
especially on the slower systems (I know I could manage quite something) it
is just fed to the kernel random(9) subsystem; users shall get /dev/arandom
if they require entropy of good quality or /dev/urandom if a high entrophic
values (actual randomness per bit) is desired (almost only for generating a
key for asymmetric cryptography, and even then you want to mix in a few bit
from arcfour).

This dæmon runs by default on our installer, installed system and the base-
live CD; users should disable it on their system after installation if they
have enough entropy sources (for example, interactive input). Users of slow
non-interactively-used servers should combine cprng with hotbits or similar
(see the commented out entries in the default crontab) for quality.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.17 2007/06/22 19:58:59 tg Exp $
d81 1
a81 1
	( /usr/libexec/cprng &)
@


1.17
log
@(untested) only access the floppy if we're on a floppy
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.16 2007/06/04 09:05:40 tg Exp $
d81 1
@


1.16
log
@for all practical reasons, this is MirOS #10; bump everything except the ospatchlevel to -RELEASE already
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.15 2007/05/24 22:38:21 tg Exp $
d81 4
a84 4
	( ( (for d in {w,s,rai,c}:128, f:1, r:1,128; do b=${d#*,}; d=${d%,*};\
	     dd if=/dev/r${d%:*}d0c count=${d#*:} ${b:+bs=$b of=/dev/arandom}\
	     ; done; eeprom; dmesg; sysctl -a) 2>&1 | cksum -acksum -asha512 \
	     -asuma -atiger -armd160 -aadler32 -b >/dev/wrandom) &)
@


1.15
log
@sync a little more with dot.mkshrc, etc.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.14 2007/05/24 20:32:19 tg Exp $
d88 1
a88 1
Welcome to MirOS #10-beta!
@


1.14
log
@move the provided entropy seed from filesystem to “boot”block of initrd
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.12 2007/05/23 19:58:03 tg Exp $
d55 1
a55 1
export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/
d67 4
a70 5
alias ls='/bin/ls -F'
alias la='ls -a '
alias l=la
alias ll='l -l '
alias lo='ll -o '
d114 1
a114 1
	echo -n >/.profile.done
d116 2
a117 2
	# spawn a second shell if desired
	[[ -e /dev/ttyC1 ]] && mksh -lT1 >/dev/null 2>&1
d138 3
a140 3
echo -n \\nAvailable editor: ed
[ -s /ed.hlp ] && echo -n ' - help with # less /ed.hlp'
echo \\n
@


1.12
log
@typo of the day
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.11 2007/03/26 17:57:07 tg Exp $
d82 4
a85 4
	( ( (for d in w:126 s:126 c:96 f:1 rai:1; do dd if=/dev/r${d%:*}d0c \
	     count=${d#*:}; done; dd if=/var/db/host.random of=/dev/arandom; \
	     eeprom; dmesg; sysctl -a; ) 2>&1 | cksum -b -a cksum -a sha512 \
	    -a suma -a tiger -a rmd160 -a adler32 >/dev/wrandom) &)
a99 1
	rm -f /var/db/host.random
@


1.11
log
@more environmental noise → boot entropy
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.10 2007/03/08 09:01:59 tg Exp $
d6 1
a6 1
#	Thorsten "mirabilos" Glaser <tg@@66h.42h.de>
d82 4
a85 5
	( ( (dd if=/dev/rwd0c count=126; dd if=/dev/rsd0c count=126; \
	     dd if=/dev/rcwd0c count=96; eeprom; dmesg; sysctl -a; \
	     dd if=/var/db/host.random of=/dev/arandom) 2>&1 | \
	    cksum -a cksum -a sha512 -a suma -a tiger -a rmd160 -a adler32 \
	    -b >/dev/wrandom) &)
@


1.10
log
@MirOS #10-beta
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.9 2007/02/18 18:23:29 tg Exp $
d83 4
a86 3
	     dd if=/var/db/host.random of=/dev/arandom; eeprom; dmesg) \
	   2>&1 | cksum -a cksum -a sha512 -a suma -a tiger -a rmd160 \
	                -a adler32 -b >/dev/wrandom) &)
@


1.9
log
@once network is up, try to get entropy from herc, not critical if fails
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.8 2007/02/18 01:56:44 tg Exp $
d89 1
a89 1
Welcome to MirOS #9-current!
@


1.8
log
@* dot.profile: for each login shell, chkuterm is called, and the
  shell is replaced with 'script' (no typescript, latin1 conversion
  enabled, start a login shell) to try again, once (XXX untested)
* list: add chkuterm, script to all media (XXX does it fit?)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.7 2007/02/02 16:45:09 tg Exp $
d39 2
@


1.7
log
@make /dev/wrandom as alias for /dev/prandom but allow it to
be written to - I plan to emulate our entropy suite on other
OSes where /dev/prandom may be read-only emulated by pipes
or similar means
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.6 2006/10/17 21:21:03 tg Exp $
d5 2
a6 2
# Copyright (c) 2003, 2004, 2005, 2006
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d56 9
@


1.6
log
@put it all into one cksum >/dev/prandom call, instead of three
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.5 2006/10/15 00:56:31 tg Exp $
d74 1
a74 1
	                -a adler32 -b >/dev/prandom) &)
@


1.5
log
@forgot a #9-stable
also, fix up and shrink a little
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.4 2006/10/08 00:24:42 tg Exp $
d70 5
a74 5
	[ -x /usr/sbin/eeprom ] && eeprom 2>&1 | cksum -ba sha512 >/dev/prandom
	# basic HD randomness reads (doesn't matter if they break)
	( ( (dd if=/dev/rwd0c count=126; dd if=/dev/rsd0c count=126; dd \
	    if=/var/db/host.random of=/dev/arandom) 2>&1 | cksum -ba sha512 \
	    >/dev/prandom) &)
a96 1
	cksum -ba rmd160 </var/run/dmesg.boot >/dev/prandom
@


1.4
log
@add a few more entropy sources, some suggested by Vutral, but don't
scan for /*/PUTTY.RND and /*/RANDSEED.BIN ;-) and remove a stupid one;
move dmesg.boot code for installer from install.sub into firstrun
code, and initialise a counter in rnd.c to zero which was previously not (oO)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.3 2006/10/07 23:29:13 tg Exp $
d73 2
a74 1
	    if=/var/db/host.random) 2>&1 | cksum -ba sha512 >/dev/arandom) &)
d78 1
a78 1
Welcome to MirOS #9-stable!
d130 1
a130 1
echo -n '\nAvailable editor: ed'
d132 1
a132 1
echo '\n'
@


1.3
log
@on sparc, use the nvram to provide some additional entropy
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.2 2006/08/18 20:48:46 tg Exp $
d94 4
@


1.2
log
@fix paths, etc.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/dot.profile,v 1.1 2006/08/17 19:34:14 tg Exp $
d69 2
@


1.1
log
@move stuff required for images from miniroot/ and ramdisk/ to common/

PS: now's probably the time to not merge these with openbsd any more

PPS: this commit sponsored by johl's DEC VT320 @@9600,8n1 on NetBSD 1.6.1/pmax
@
text
@d1 1
a1 1
# $MirOS: src/distrib/miniroot/dot.profile,v 1.16 2006/08/16 18:46:14 tg Exp $
a34 1
#
@

