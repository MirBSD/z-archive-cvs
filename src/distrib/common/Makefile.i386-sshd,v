head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2013.03.29.16.49.53;	author tg;	state Exp;
branches;
next	1.4;
commitid	1005155C6496F66A629;

1.4
date	2012.09.02.22.14.45;	author tg;	state Exp;
branches;
next	1.3;
commitid	1005043DA6D20CE1B7A;

1.3
date	2010.08.06.15.40.01;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004C5C2C6D79827EDA;

1.2
date	2010.01.17.00.35.07;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004B525B3629110DD5;

1.1
date	2010.01.07.20.56.08;	author tg;	state Exp;
branches;
next	;
commitid	1004B464A630F817F6F;


desc
@@


1.5
log
@add brconfig(8) to the big i386 kernels; it’s a tight 20K but should work
@
text
@# $MirOS: src/distrib/common/Makefile.i386-sshd,v 1.4 2012/09/02 22:14:45 tg Exp $

IMAGESIZE=	8192
IMAGETYPE=	ipldisc

LISTADDS=	boot bridge cd9660 dhclient disktools ext2fs i386 isdn msdos \
		nettools nfs nfsd pager-less ppp-user pppoe-kernel \
		pppoe-user upgrade
MACHCONF:=	i386-big
LISTADDS+=	autosshd
LGRUBCFG=	extra

KERNEL_BUILD=	no
# uncompressed bsd.rd, so that people can change the rootpw easily
BSDRD_COMPR=	cat
#		(17,0) = rd0a
RAMDISK_PREP=	print 'rootdev 17 0\nquit' | config -ef $@@~

FLOPPY=		no
CDROM_OPTS+=	bootimage=i386\;eltorito.loo
CDROM_OPTS+=	no-emul-boot

.if defined(SERIALSPEED)
CDROM?=		cdsshd${SERIALSPEED}.iso
.endif
CDROM?=		cdsshd${OSrev}.iso

INST_FILES=	${CDROM}

bsd: ${BSDOBJDIR}/distrib/generic/bsd
	cp -f $> $@@

cdrom-mdcopy:
.if defined(SERIALSPEED)
	sed \
	    -e 's!^boot .*$$!boot /v${OSrev}/i386/bsd.rd!' \
	    -e 's/@@SPEED@@/${SERIALSPEED}/g' \
	    ${TOPDIR}/tools/boot.cfg.serial >${WRKDIR}/boot.cfg
.endif
	print ',g/@@TEXT@@/ka\\\n-1r' \
	    '${TOPDIR}/common/boot.cfg.sshd\\\n'\''ad\nwq' | \
	    ed -s ${WRKDIR}/boot.cfg
	dd if=/dev/arandom bs=2048 count=1 of=eltorito.loo

cdrom-mdboot:
	getextent_cd9660 -f ${CDROM} b_${MACHINE}.ldr | \
	    ${MKSH} ${BOOTSH} \
	    -g $$((#$$(stat -f %z ${CDROM}) / (512 * 32 * 16))):16:32 \
	    -A -M 4:0x96 -S 2 | \
	    dd of=${CDROM} conv=notrunc 2>/dev/null
	getextent_cd9660 -f ${CDROM} b_${MACHINE}.ldr | \
	    ${MKSH} ${BOOTSH} -B 11 | \
	    dd of=${CDROM} conv=notrunc bs=2048 seek=$$(getextent_cd9660 \
	    -f ${CDROM} -b '$$BootImage$$') 2>/dev/null
@


1.4
log
@ensure each invocation puts on different hostent, for real now
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.i386-sshd,v 1.3 2010/08/06 15:40:01 tg Exp $
d6 1
a6 1
LISTADDS=	boot cd9660 dhclient disktools ext2fs i386 isdn msdos \
@


1.3
log
@I promised «Jordan_U:#grml» our next version would have support for the
boot method via /boot/grub/loopback.cfg – voilà (untested)

In MirOS bsd4grml, all options except chaining to GRUB are available.
In MirOS bsd4me, the install and baselive images, only the standard
bootloader prompt going to the installer is available, although the
command line gives support for e.g. switching to serial console.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.i386-sshd,v 1.2 2010/01/17 00:35:07 tg Exp $
d17 1
a17 1
RAMDISK_PREP=	print 'rootdev 17 0\nquit' | config -ef $@@
@


1.2
log
@• modularise floppy configuration and let sparc/floppy use the common one,
  adding some to it
• nuke printf(1) we have mksh(1) print builtin
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.i386-sshd,v 1.1 2010/01/07 20:56:08 tg Exp $
d11 1
@


1.1
log
@add auto-network-and-sshd ISO variant, requested by Vutral
thanks for the good idea - we'll provide it by default from now
@
text
@d1 1
a1 1
# $MirOS: src/distrib/common/Makefile.i386-big,v 1.23 2009/08/15 18:30:09 tg Exp $
d6 5
a10 3
LISTS=		${TOPDIR}/common/listbeg.i386-big ${TOPDIR}/common/list \
		${TOPDIR}/common/listend.i386-big \
		${TOPDIR}/common/listadd.autosshd
@

