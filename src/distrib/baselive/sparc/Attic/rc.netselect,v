head	1.9;
access;
symbols;
locks; strict;
comment	@# @;


1.9
date	2008.10.21.21.03.34;	author tg;	state dead;
branches;
next	1.8;
commitid	10048FE43B158335A05;

1.8
date	2008.09.06.15.07.52;	author tg;	state Exp;
branches;
next	1.7;
commitid	10048C29C7F22578445;

1.7
date	2008.07.07.13.57.16;	author tg;	state Exp;
branches;
next	1.6;
commitid	100487220B36BA627AC;

1.6
date	2008.05.13.12.14.30;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004829863225D9AA36;

1.5
date	2007.06.22.20.37.18;	author tg;	state Exp;
branches;
next	1.4;
commitid	100467C32F947D6FB80;

1.4
date	2007.05.28.13.52.54;	author tg;	state Exp;
branches;
next	1.3;
commitid	100465ADEB968B06118;

1.3
date	2006.10.29.16.57.44;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004544DD9E2E5B2AAB;

1.2
date	2006.09.30.20.59.01;	author tg;	state Exp;
branches;
next	1.1;
commitid	100451EDAA579D5615D;

1.1
date	2006.08.18.22.18.26;	author tg;	state Exp;
branches;
next	;
commitid	10044E63CC77F985A26;


desc
@@


1.9
log
@modernise, simplify
commit before testing (as backup)
@
text
@# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.8 2008/09/06 15:07:52 tg Exp $
#-
# Copyright (c) 2006, 2007
#	Thorsten Glaser <tg@@mirbsd.de>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.

. /etc/rc.netselect.common

# Stuff to come *before* the shell escape possibility
do_before
print
print Welcome to the MirBSD/sparc baseLive CD
print =======================================
show_info
get_passwd

# The menu
print
print "Select the MirOS/sparc Live CD 'modus operandi'"
print "==============================================="
x=
while [[ $x != @@(1|2|3) ]]; do
	print '1) manual/no network, no graphics'
	print '2) automatic network (dhcp), no graphics'
	print '3) automatic network, XFree86 (wsfb) xdm/twm'
	print '9) temporarily escape into a shell (type "exit" to return)'
	if [[ $x =  ]]; then
		print
		print If you need to plug in any network devices, do it now.
	fi
	print -n "Your choice? "
	read x
	[[ $x = 9 ]] && do_shell
done

case $x {
(1)	# no network to configure
	do_netconf none
	;;
(2)	# configure the network
	ask_netconfig
	;;
(3)	# configure network and X
	ask_netconfig
	print xdm_flags= >>/etc/rc.conf.local
	;;
}
print

# Stuff to clean up
set_hostname
do_after
@


1.8
log
@add my new “you wanna shell? gimme root pw!” code to /etc/rc.netselect on
the baselive CD… for the archives (as my personal /etc/rc.netselect is not
publically versioned)

/etc/ttys on a live cd _should_ have a secure console, so it won’t trigger
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.7 2008/07/07 13:57:16 tg Exp $
@


1.7
log
@nuke more advertising clauses from me; also remove mine and TNF's original
one (not all the other nbsd related) from the list
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.6 2008/05/13 12:14:30 tg Exp $
d47 1
a47 4
	if [[ $x = 9 ]]; then
		HOME=/ /bin/mksh -l
		print
	fi
@


1.6
log
@nah, get rid of /dev/.root as root home directory entirely
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.5 2007/06/22 20:37:18 tg Exp $
a11 4
# Advertising materials mentioning features or use of this work must
# display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
@


1.5
log
@ugh, that error message was a good one… didn't know at first…
but ‘i’ is obviously an integer… so don't assign ^A to it…
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.4 2007/05/28 13:52:54 tg Exp $
d52 1
a52 1
		HOME=/dev/.root /bin/mksh -l
@


1.4
log
@re-display the “modus operandi choice” menu after shell escaping,
noticed by bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: src/share/misc/licence.template,v 1.20 2006/12/11 21:04:56 tg Rel $
d39 2
a40 2
i=
while [[ $i != @@(1|2|3) ]]; do
d45 1
a45 1
	if [[ $i =  ]]; then
d50 2
a51 2
	read i
	if [[ $i = 9 ]]; then
d57 1
a57 1
case $i {
@


1.3
log
@simplify
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.2 2006/09/30 20:59:01 tg Exp $
d3 1
a3 1
# Copyright (c) 2006
d6 5
a10 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d16 8
a23 8
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
d39 1
a39 7
print '1) manual/no network, no graphics'
print '2) automatic network (dhcp), no graphics'
print '3) automatic network, XFree86 (wsfb) xdm/twm'
print '9) temporarily escape into a shell (type "exit" to return)'
print
print If you need to plug in any network devices, do it now.
i=
d41 8
d51 4
a54 1
	[[ $i = 9 ]] && HOME=/dev/.root /bin/mksh -l
@


1.2
log
@simplify; commonise
@
text
@d1 1
a1 1
# $MirOS: src/distrib/baselive/sparc/rc.netselect,v 1.1 2006/08/18 22:18:26 tg Exp $
d30 5
a55 3
	show_info
	get_passwd
	set_hostname
a58 3
	show_info
	get_passwd
	set_hostname
a61 1
	show_info
a62 2
	get_passwd
	set_hostname
d68 1
@


1.1
log
@start sanitising
@
text
@d1 1
a1 1
# $MirOS: src/share/misc/licence.template,v 1.14 2006/08/09 19:35:23 tg Rel $
d26 1
a26 93
function show_info
{
	print
	print To get support, use lynx\(1\) with the following resources:
	print online man pages: http://www.mirbsd.org/cman/
	print interactive help: http://www.mirbsd.org/?irc
}

function get_passwd
{
	print
	print To login to the MirOS Live CD, a user \'live\' has been added.
	print Please enter a password to login with now \(default: \"live\"\).
	print Note: it is highly suggested to change the password, because
	print sshd\(8\) is started by default.
	passwd live
}

function set_hostname
{
	typeset -Uui36 rndval=$(date +%s)
	rndpfx=${rndval#36#}
	while (( ${#rndpfx} < 36 )); do
		typeset -Uui36 rndval=0x$(dd if=/dev/arandom bs=4 count=1 \
		    2>/dev/null | hexdump -e '4/1 "%02X"')
		rndpfx=${rndval#36#}$rndpfx
	done
	while (( ${#rndpfx} > 36 )); do
		rndpfx=${rndpfx#?}
	done
	# yes, the "livecd." comes first, trust me on this
	print livecd.$rndpfx.invalid.mirbsd.org >/etc/myname
	print ::1 livecd livecd.$rndpfx.invalid.mirbsd.org >>/etc/hosts
	print 127.0.0.1 livecd livecd.$rndpfx.invalid.mirbsd.org >>/etc/hosts
}

function get_net_ifnames
{
	local foo
	integer i

	set -A foo -- $(ifconfig -l)
	i=${#foo[*]}
	while (( i-- > 0 )); do
		[[ ${foo[i]} = @@(lo|bridge|enc|gif|gre|tun|vlan|irip|pflog|pfsync|plip|sl)+([0-9]) ]] && \
		    unset foo[i]
	done
	print ${foo[*]}
}

function ask_netconfig
{
	set -A all_ifnames -- $(get_net_ifnames)
	default_ifname=${all_ifnames[0]}
	if [[ -z $default_ifname ]]; then
		print
		print No network interface found, skipping.
		do_netconf none
		return
	fi
	print
	print "Available network interfaces: ${all_ifnames[*]}"
	if=
	while [[ -z $if ]]; do
		print -n "Interface to run a DHCP client on" \
		    "(or none/done) [$default_ifname]? "
		read ifname
		[[ $ifname = @@(d|n)one ]] && break
		[[ -z $ifname ]] && ifname=$default_ifname
		let i=0
		while (( i < ${#all_ifnames[*]} )); do
			[[ ${all_ifnames[i]} = $ifname ]] && \
			    if=${all_ifnames[i]}
			let ++i
		done
	done
	do_netconf ${if:-none}
}

function do_netconf
{
	if [[ $1 = none ]]; then
		:
		#XXX this is actually a bad idea, maybe the network
		#XXX is manually configured later; for now, just do
		#XXX not add the run of rdate (ntpd is run with -S)
		#print ntpd_flags=NO >>/etc/rc.conf.local
	else
		print dhcp >/etc/hostname.$1
		print rdate_flags=\"-nv ntp.mirbsd.org\" >>/etc/rc.conf.local
		print rtsold_flags=-am >>/etc/rc.conf.local
	fi
}
d29 1
a29 1
rm -f /etc/hosts
d33 6
a38 6
print Select the MirOS/sparc Live CD \'modus operandi\'
print ===============================================
print 1\) manual/no network, no graphics
print 2\) automatic network \(dhcp\), no graphics
print 3\) automatic network, XFree86 \(wsfb\) xdm/twm
print 9\) temporarily escape into a shell \(type \"exit\" to return\)
d72 1
a72 1
rm -f /etc/hostname.done
@

