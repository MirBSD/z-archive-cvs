head	1.103;
access;
symbols
	MIRBSD_10:1.19.0.2
	MIRBSD_10_BASE:1.19;
locks; strict;
comment	@# @;


1.103
date	2019.03.01.16.18.12;	author tg;	state Exp;
branches;
next	1.102;
commitid	1005C795B5E18CB9829;

1.102
date	2018.01.14.01.44.06;	author tg;	state Exp;
branches;
next	1.101;
commitid	1005A5AB5F87C24D8D1;

1.101
date	2017.08.29.13.38.27;	author tg;	state Exp;
branches;
next	1.100;
commitid	10059A56E5C5EA2D5AB;

1.100
date	2017.08.07.21.39.25;	author tg;	state Exp;
branches;
next	1.99;
commitid	1005988DE2644315248;

1.99
date	2017.04.28.00.33.14;	author tg;	state Exp;
branches;
next	1.98;
commitid	10059028DE5082E07FC;

1.98
date	2017.04.12.18.33.21;	author tg;	state Exp;
branches;
next	1.97;
commitid	10058EE730B10091C4D;

1.97
date	2017.04.02.14.14.09;	author tg;	state Exp;
branches;
next	1.96;
commitid	10058E106EA70D8ABF7;

1.96
date	2016.11.11.23.31.29;	author tg;	state Exp;
branches;
next	1.95;
commitid	100582654B972655F84;

1.95
date	2016.11.07.16.58.34;	author tg;	state Exp;
branches;
next	1.94;
commitid	1005820B2D404EF0433;

1.94
date	2016.08.25.16.21.26;	author tg;	state Exp;
branches;
next	1.93;
commitid	10057BF1B1D101BE102;

1.93
date	2016.08.10.18.20.19;	author tg;	state Exp;
branches;
next	1.92;
commitid	10057AB70790ACA1487;

1.92
date	2016.07.25.21.15.06;	author tg;	state Exp;
branches;
next	1.91;
commitid	100579681731C2416F2;

1.91
date	2016.03.04.18.28.39;	author tg;	state Exp;
branches;
next	1.90;
commitid	10056D9D3E84E42085B;

1.90
date	2016.01.21.18.24.32;	author tg;	state Exp;
branches;
next	1.89;
commitid	10056A12268001BF859;

1.89
date	2015.12.12.22.25.10;	author tg;	state Exp;
branches;
next	1.88;
commitid	100566C9EDD3DC6C239;

1.88
date	2015.10.24.19.45.22;	author tg;	state Exp;
branches;
next	1.87;
commitid	100562BDFBA097EA04B;

1.87
date	2015.10.05.17.58.55;	author tg;	state Exp;
branches;
next	1.86;
commitid	1005612BA62412FC278;

1.86
date	2015.07.09.20.52.34;	author tg;	state Exp;
branches;
next	1.85;
commitid	100559EDF161DEE9DD2;

1.85
date	2015.04.11.23.28.15;	author tg;	state Exp;
branches;
next	1.84;
commitid	1005529AD8D33CF99B9;

1.84
date	2014.11.25.21.13.17;	author tg;	state Exp;
branches;
next	1.83;
commitid	1005474F00E09321C83;

1.83
date	2014.10.07.15.22.11;	author tg;	state Exp;
branches;
next	1.82;
commitid	1005434053135366996;

1.82
date	2014.10.03.17.32.06;	author tg;	state Exp;
branches;
next	1.81;
commitid	100542EDD596FD5FBF9;

1.81
date	2014.09.03.19.22.47;	author tg;	state Exp;
branches;
next	1.80;
commitid	10054076A8136C0C0D1;

1.80
date	2014.06.24.20.47.40;	author tg;	state Exp;
branches;
next	1.79;
commitid	10053A9E3FD4EC55000;

1.79
date	2014.06.09.13.25.48;	author tg;	state Exp;
branches;
next	1.78;
commitid	1005395B5803902C8E9;

1.78
date	2014.05.27.13.22.40;	author tg;	state Exp;
branches;
next	1.77;
commitid	1005384911C31753F0C;

1.77
date	2014.01.05.21.57.20;	author tg;	state Exp;
branches;
next	1.76;
commitid	10052C9D445413B34DF;

1.76
date	2013.11.30.17.41.30;	author tg;	state Exp;
branches;
next	1.75;
commitid	100529A23520014334E;

1.75
date	2013.11.20.21.14.48;	author tg;	state Exp;
branches;
next	1.74;
commitid	100528D26524CF1F1DE;

1.74
date	2013.11.17.22.37.46;	author tg;	state Exp;
branches;
next	1.73;
commitid	1005289455135449DA1;

1.73
date	2013.09.10.17.32.55;	author tg;	state Exp;
branches;
next	1.72;
commitid	100522F57C13E265FDE;

1.72
date	2013.08.23.14.07.31;	author tg;	state Exp;
branches;
next	1.71;
commitid	10052176CB912FE954B;

1.71
date	2013.08.10.13.44.23;	author tg;	state Exp;
branches;
next	1.70;
commitid	100520643B4127D9BCA;

1.70
date	2013.07.21.18.47.13;	author tg;	state Exp;
branches;
next	1.69;
commitid	10051EC2CBD68BDF6A5;

1.69
date	2013.06.01.01.49.33;	author tg;	state Exp;
branches;
next	1.68;
commitid	10051A95345568F5E8E;

1.68
date	2013.05.02.21.59.43;	author tg;	state Exp;
branches;
next	1.67;
commitid	1005182E1E55272FF6B;

1.67
date	2013.04.27.18.12.36;	author tg;	state Exp;
branches;
next	1.66;
commitid	100517C152C6C287552;

1.66
date	2013.04.26.21.22.38;	author tg;	state Exp;
branches;
next	1.65;
commitid	100517AEF6C22DD1AE7;

1.65
date	2013.04.26.19.40.06;	author tg;	state Exp;
branches;
next	1.64;
commitid	100517AD81849062C68;

1.64
date	2013.03.24.00.56.32;	author tg;	state Exp;
branches;
next	1.63;
commitid	100514E4F1D5C90862C;

1.63
date	2013.03.05.15.41.43;	author tg;	state Exp;
branches;
next	1.62;
commitid	1005136124A171442C9;

1.62
date	2013.02.23.20.03.24;	author tg;	state Exp;
branches;
next	1.61;
commitid	1005129208E57646522;

1.61
date	2013.02.18.22.55.34;	author tg;	state Exp;
branches;
next	1.60;
commitid	1005122B16E6B48945B;

1.60
date	2013.02.17.05.40.10;	author tg;	state Exp;
branches;
next	1.59;
commitid	10051206D50560C037D;

1.59
date	2012.12.17.23.46.30;	author tg;	state Exp;
branches;
next	1.58;
commitid	10050CFAEEB2D5D31EB;

1.58
date	2012.11.30.20.49.10;	author tg;	state Exp;
branches;
next	1.57;
commitid	10050B91BDD34E31558;

1.57
date	2012.11.20.18.50.40;	author tg;	state Exp;
branches;
next	1.56;
commitid	10050ABD11751603401;

1.56
date	2012.06.28.20.17.31;	author tg;	state Exp;
branches;
next	1.55;
commitid	1004FECBBF10FC5C93C;

1.55
date	2012.05.04.22.44.30;	author tg;	state Exp;
branches;
next	1.54;
commitid	1004FA45BE357DA71DC;

1.54
date	2012.04.14.16.07.42;	author tg;	state Exp;
branches;
next	1.53;
commitid	1004F89A0D311D70891;

1.53
date	2012.04.07.11.19.44;	author tg;	state Exp;
branches;
next	1.52;
commitid	1004F8022E670BC1C0E;

1.52
date	2012.03.27.23.13.39;	author tg;	state Exp;
branches;
next	1.51;
commitid	1004F7249BA2221FCA0;

1.51
date	2012.03.27.22.36.47;	author tg;	state Exp;
branches;
next	1.50;
commitid	1004F7240673EAD3A5A;

1.50
date	2011.12.31.02.04.15;	author tg;	state Exp;
branches;
next	1.49;
commitid	1004EFE6D783E94B328;

1.49
date	2011.12.08.22.19.17;	author tg;	state Exp;
branches;
next	1.48;
commitid	1004EE137FB02A31BBD;

1.48
date	2011.11.26.00.39.51;	author tg;	state Exp;
branches;
next	1.47;
commitid	1004ED0356E7AC3BAA4;

1.47
date	2011.11.25.23.29.29;	author tg;	state Exp;
branches;
next	1.46;
commitid	1004ED0249F2884E13A;

1.46
date	2011.04.09.18.47.18;	author tg;	state Exp;
branches;
next	1.45;
commitid	1004DA0A9C665117993;

1.45
date	2011.02.11.01.18.06;	author tg;	state Exp;
branches;
next	1.44;
commitid	1004D548C4E66D17A12;

1.44
date	2011.01.30.02.28.32;	author tg;	state Exp;
branches;
next	1.43;
commitid	1004D44CCE6262193E2;

1.43
date	2011.01.29.19.07.18;	author tg;	state Exp;
branches;
next	1.42;
commitid	1004D44657A0535F27E;

1.42
date	2010.12.12.14.06.32;	author tg;	state Exp;
branches;
next	1.41;
commitid	1004D04D6F360C188AB;

1.41
date	2010.10.08.17.56.59;	author tg;	state Exp;
branches;
next	1.40;
commitid	1004CAF5B5A6D74E1C9;

1.40
date	2010.09.14.21.26.03;	author tg;	state Exp;
branches;
next	1.39;
commitid	1004C8FE654576B0E25;

1.39
date	2010.08.24.15.19.55;	author tg;	state Exp;
branches;
next	1.38;
commitid	1004C73E31577F0CD63;

1.38
date	2010.07.04.17.41.38;	author tg;	state Exp;
branches;
next	1.37;
commitid	1004C30C7E926089493;

1.37
date	2010.03.27.15.32.57;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004BAE25367BF23130;

1.36
date	2009.12.12.22.27.13;	author tg;	state Exp;
branches;
next	1.35;
commitid	1004B2418AF282F4231;

1.35
date	2009.06.08.20.34.36;	author tg;	state Exp;
branches;
next	1.34;
commitid	1004A2D75D22EFFE1BD;

1.34
date	2009.05.16.16.59.30;	author tg;	state Exp;
branches;
next	1.33;
commitid	1004A0EF0664EF4168D;

1.33
date	2009.04.03.09.39.00;	author tg;	state Exp;
branches;
next	1.32;
commitid	10049D5D94A2E5145F0;

1.32
date	2009.03.29.10.21.31;	author tg;	state Exp;
branches;
next	1.31;
commitid	10049CF4BC269144BAA;

1.31
date	2008.12.13.17.02.18;	author tg;	state Exp;
branches;
next	1.30;
commitid	1004943EAA830C0300B;

1.30
date	2008.11.02.22.42.38;	author tg;	state Exp;
branches;
next	1.29;
commitid	100490E2CEC2E888B81;

1.29
date	2008.10.28.14.32.35;	author tg;	state Exp;
branches;
next	1.28;
commitid	1004907226D3DEFCCD1;

1.28
date	2008.10.26.22.03.04;	author tg;	state Exp;
branches;
next	1.27;
commitid	1004904E922178B75F0;

1.27
date	2008.10.05.16.26.17;	author tg;	state Exp;
branches;
next	1.26;
commitid	10048E8EA7D6EAD401E;

1.26
date	2008.08.02.00.45.40;	author tg;	state Exp;
branches;
next	1.25;
commitid	1004893AE1364EF8187;

1.25
date	2008.07.11.19.51.22;	author tg;	state Exp;
branches;
next	1.24;
commitid	1004877B9A442EF6CF3;

1.24
date	2008.05.17.18.27.53;	author tg;	state Exp;
branches;
next	1.23;
commitid	100482F238341D5E08C;

1.23
date	2008.05.04.02.03.43;	author tg;	state Exp;
branches;
next	1.22;
commitid	100481D19961A19E48A;

1.22
date	2008.04.20.02.15.12;	author tg;	state Exp;
branches;
next	1.21;
commitid	100480AA7400A110D7D;

1.21
date	2008.03.27.22.44.17;	author tg;	state Exp;
branches;
next	1.20;
commitid	10047EC2345229AB68B;

1.20
date	2008.03.25.21.34.42;	author tg;	state Exp;
branches;
next	1.19;
commitid	10047E96EF5608C6FD5;

1.19
date	2008.03.05.18.49.14;	author tg;	state Exp;
branches
	1.19.2.1;
next	1.18;
commitid	10047CEEB2D48891B08;

1.18
date	2008.03.05.17.16.13;	author tg;	state Exp;
branches;
next	1.17;
commitid	10047CED56F1D19E4D5;

1.17
date	2008.03.05.17.06.49;	author tg;	state Exp;
branches;
next	1.16;
commitid	10047CED336427DBA32;

1.16
date	2007.10.14.13.36.40;	author tg;	state Exp;
branches;
next	1.15;
commitid	10047121B7A369F0F0F;

1.15
date	2007.08.24.14.25.33;	author tg;	state Exp;
branches;
next	1.14;
commitid	10046CEEA1D199F064A;

1.14
date	2007.08.24.14.19.58;	author tg;	state Exp;
branches;
next	1.13;
commitid	10046CEE8E817DEC27F;

1.13
date	2007.08.12.13.42.19;	author tg;	state Exp;
branches;
next	1.12;
commitid	10046BF0E4F7055959B;

1.12
date	2007.07.31.11.11.22;	author tg;	state Exp;
branches;
next	1.11;
commitid	10046AF18D74B1B5DF4;

1.11
date	2007.07.01.21.47.07;	author tg;	state Exp;
branches;
next	1.10;
commitid	100468820CD07282054;

1.10
date	2007.06.15.21.53.45;	author tg;	state Exp;
branches;
next	1.9;
commitid	10046730A8007AA7B07;

1.9
date	2007.06.05.21.47.47;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004665D9D956A3B2CA;

1.8
date	2007.06.05.19.48.45;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004665BE264E72FCFA;

1.7
date	2007.06.04.21.55.39;	author tg;	state Exp;
branches;
next	1.6;
commitid	10046648A710B86FCC9;

1.6
date	2007.04.24.10.42.01;	author tg;	state Exp;
branches;
next	1.5;
commitid	100462DDE7C6EC3BD7F;

1.5
date	2007.04.23.20.37.17;	author tg;	state Exp;
branches;
next	1.4;
commitid	100462D18E37B6B8D16;

1.4
date	2007.03.04.04.36.44;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045EA4CCF3ED98D2A;

1.3
date	2007.03.03.21.48.33;	author tg;	state Exp;
branches;
next	1.2;
commitid	10045E9ED4737C03C2B;

1.2
date	2007.02.18.16.24.11;	author tg;	state Exp;
branches;
next	1.1;
commitid	10045D87D7D0FC908BE;

1.1
date	2007.01.26.18.39.49;	author tg;	state Exp;
branches;
next	;
commitid	10045BA4AF5105CC93C;

1.19.2.1
date	2008.05.19.18.41.12;	author tg;	state Exp;
branches;
next	1.19.2.2;
commitid	1004831C9A63DA06745;

1.19.2.2
date	2008.07.18.13.29.39;	author tg;	state Exp;
branches;
next	1.19.2.3;
commitid	10048809AD278B142AC;

1.19.2.3
date	2008.12.14.00.08.57;	author tg;	state Exp;
branches;
next	;
commitid	10049444E5325915C76;


desc
@@


1.103
log
@bump
@
text
@# $MirOS: src/distrib/special/mksh/Makefile,v 1.101 2017/08/29 13:38:27 tg Exp $
#-
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
#		2011, 2012, 2013, 2014, 2015, 2016, 2017
#	mirabilos <m@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.
#-
# use CPPFLAGS=-DDEBUG __CRAZY=Yes to check for certain more stuff

.include <bsd.own.mk>

SRCDIR=		${BSDSRCDIR}/bin/mksh
.PATH: ${SRCDIR}

PROG=		mksh
SRCS=		edit.c eval.c exec.c expr.c funcs.c histrap.c jobs.c \
		lalloc.c lex.c main.c misc.c shf.c syn.c tree.c var.c
# env: HAVE_MKNOD=x
CPPFLAGS+=	-DMKSH_ASSUME_UTF8 -DMKSH_DISABLE_DEPRECATED -DMKSH_SMALL \
		-DHAVE_ATTRIBUTE_BOUNDED=1 -DHAVE_ATTRIBUTE_FORMAT=1 \
		-DHAVE_ATTRIBUTE_NORETURN=1 -DHAVE_ATTRIBUTE_PURE=1 \
		-DHAVE_ATTRIBUTE_UNUSED=1 -DHAVE_ATTRIBUTE_USED=1 \
		-DHAVE_SYS_TIME_H=1 -DHAVE_TIME_H=1 -DHAVE_BOTH_TIME_H=1 \
		-DHAVE_SYS_BSDTYPES_H=0 -DHAVE_SYS_FILE_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 -DHAVE_SYS_PARAM_H=1 \
		-DHAVE_SYS_RESOURCE_H=1 -DHAVE_SYS_SELECT_H=1 \
		-DHAVE_SYS_SYSMACROS_H=0 -DHAVE_BSTRING_H=0 -DHAVE_GRP_H=1 \
		-DHAVE_IO_H=0 -DHAVE_LIBGEN_H=1 -DHAVE_LIBUTIL_H=0 \
		-DHAVE_PATHS_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 \
		-DHAVE_TERMIOS_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
		-DHAVE_CAN_INTTYPES=1 -DHAVE_CAN_UCBINTS=1 \
		-DHAVE_CAN_INT8TYPE=1 -DHAVE_CAN_UCBINT8=1 -DHAVE_RLIM_T=1 \
		-DHAVE_SIG_T=1 -DHAVE_SYS_ERRLIST=1 -DHAVE_SYS_SIGNAME=1 \
		-DHAVE_SYS_SIGLIST=1 -DHAVE_FLOCK=1 -DHAVE_LOCK_FCNTL=1 \
		-DHAVE_GETRUSAGE=1 -DHAVE_GETSID=1 -DHAVE_GETTIMEOFDAY=1 \
		-DHAVE_KILLPG=1 -DHAVE_MEMMOVE=1 -DHAVE_MKNOD=1 -DHAVE_MMAP=1 \
		-DHAVE_FTRUNCATE=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
		-DHAVE_SELECT=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRERROR=0 -DHAVE_STRSIGNAL=0 -DHAVE_STRLCPY=1 \
		-DHAVE_FLOCK_DECL=1 -DHAVE_REVOKE_DECL=1 \
		-DHAVE_SYS_ERRLIST_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=571
CPPFLAGS+=	-D${${PROG:L}_tf:C/(Mir${MAN:E}{0,1}){2}/4/:S/x/mksh_BUILD/:U}
CPPFLAGS+=	-I.
CPPFLAGS+=	-DMIRBSD_BOOTFLOPPY
COPTS+=		-std=c89 -Wall

DEBUGFILE?=	No
.if ${DEBUGFILE:L} == "yes"
CPPFLAGS+=	-DDF=mksh_debugtofile
.endif

OPTGENS!=	cd ${SRCDIR:Q} && echo *.opt
.for _i in ${OPTGENS}
GENERATED+=	${_i:R}.gen
${_i:R}.gen: ${_i} ${SRCDIR}/Build.sh
	/bin/sh ${SRCDIR:Q}/Build.sh -G ${SRCDIR:Q}/${_i:Q}
.endfor
CLEANFILES+=	${GENERATED}

${PROG} beforedepend: ${GENERATED}

regress: ${PROG} check.pl check.t
	-rm -rf regress-dir
	mkdir -p regress-dir
	echo export FNORD=666 >regress-dir/.mkshrc
	HOME=$$(realpath regress-dir) perl ${SRCDIR}/check.pl \
	    -s ${SRCDIR}/check.t -v -p ./${PROG} \
	    -C shell:legacy-no,int:32,shell:textmode-no,shell:binmode-yes,smksh,no-histfile,fastbox

cleandir: clean-extra

clean-extra: .PHONY
	-rm -rf regress-dir

mksh_tf=xMakefile${OStype:S/${MACHINE_OS}/1/1g}${OSNAME}
.include <bsd.prog.mk>
@


1.102
log
@clean up
@
text
@d57 1
a57 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=563
@


1.101
log
@monkey-patch offsetof for a klibc/dietlibc warning; bump to R56b (bugfixes)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.97 2017/04/02 14:14:09 tg Exp $
d57 1
a57 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=562
@


1.100
log
@release
@
text
@d57 1
a57 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=561
@


1.99
log
@adjust
@
text
@d51 5
a55 4
		-DHAVE_NICE=0 -DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_SELECT=1 -DHAVE_SETRESUGID=1 \
		-DHAVE_SETGROUPS=1 -DHAVE_STRERROR=0 -DHAVE_STRSIGNAL=0 \
		-DHAVE_STRLCPY=1 -DHAVE_FLOCK_DECL=1 -DHAVE_REVOKE_DECL=1 \
d57 1
a57 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=551
d84 1
a84 1
	    -C shell:legacy-no,int:32,shell:ebcdic-no,shell:ascii-yes,shell:textmode-no,shell:binmode-yes,smksh,no-histfile,fastbox
@


1.98
log
@R55
@
text
@d83 1
a83 1
	    -C shell:legacy-no,int:32,shell:textmode-no,shell:binmode-yes,smksh,no-histfile,fastbox
@


1.97
log
@introduce the -T flag to set TEXTMODE (ASCII CR+LF newline support)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.94 2016/08/25 16:21:26 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=549
@


1.96
log
@collective R54 release preparation multi-merger:

install both lksh and mksh manpages from Build.sh (Martijn Dekker)
spelling fixes (Larry Hynes)
manpage improvements (Martijn Dekker)
initial port to Harvey-OS’ APEX (Ronald G. Minnich, Elbing Miss, Álvaro Jurado)
more from komh’s OS/2 port (KO Myung-Hun)
@
text
@d4 1
a4 1
#		2011, 2012, 2013, 2014, 2015, 2016
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=541
d83 1
a83 1
	    -C shell:legacy-no,int:32,smksh,no-histfile,fastbox
@


1.95
log
@bump
@
text
@d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=539
@


1.94
log
@outstanding bumps
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.91 2016/03/04 18:28:39 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=531
@


1.93
log
@bump, required by XTaran
@
text
@d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=530
@


1.92
log
@sync clog
@
text
@d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=529
@


1.91
log
@document upcoming set +o changes; bump
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.87 2015/10/05 17:58:55 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=523
d83 1
a83 1
	    -C shell:legacy-no,int:32,smksh,convfds,no-histfile,fastbox
@


1.90
log
@save 200 bytes off .text by revisiting string pooling

also, forgotten version bump
@
text
@d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=522
@


1.89
log
@update for recent changes
@
text
@d4 1
a4 1
#		2011, 2012, 2013, 2014, 2015
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=521
@


1.88
log
@save ~1½K from the bootfloppy by reusing MirBSD libkern wcwidth(3)
but don’t bother for this for the regular /bin/mksh either
to keep the generic code path tested well
@
text
@d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=511
@


1.87
log
@stop using issetugid(2) for ±p check as it’s probably not the right tool
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.86 2015/07/09 20:52:34 tg Exp $
d59 1
@


1.86
log
@harden the crlf vs lf tests even more; use binary mode explicitly on OS/2
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.84 2014/11/25 21:13:17 tg Exp $
d5 1
a5 1
#	Thorsten “mirabilos” Glaser <tg@@mirbsd.org>
d50 5
a54 6
		-DHAVE_ISSETUGID=1 -DHAVE_KILLPG=1 -DHAVE_MEMMOVE=1 \
		-DHAVE_MKNOD=1 -DHAVE_MMAP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
		-DHAVE_SELECT=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRERROR=0 -DHAVE_STRSIGNAL=0 -DHAVE_STRLCPY=1 \
		-DHAVE_FLOCK_DECL=1 -DHAVE_REVOKE_DECL=1 \
@


1.85
log
@Implement the “FKSH functions have local scope for shell options” feature
for mksh but not lksh; bump to R51-alpha.

While here, tweak build scripts a bit, fixup MirBSD-specific Makefile
things, remove part of a comment that’s uninteresting.
@
text
@d42 14
a55 13
		-DHAVE_LIBGEN_H=1 -DHAVE_LIBUTIL_H=0 -DHAVE_PATHS_H=1 \
		-DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_TERMIOS_H=1 \
		-DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 -DHAVE_CAN_INTTYPES=1 \
		-DHAVE_CAN_UCBINTS=1 -DHAVE_CAN_INT8TYPE=1 \
		-DHAVE_CAN_UCBINT8=1 -DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 \
		-DHAVE_SYS_ERRLIST=1 -DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 \
		-DHAVE_FLOCK=1 -DHAVE_LOCK_FCNTL=1 -DHAVE_GETRUSAGE=1 \
		-DHAVE_GETSID=1 -DHAVE_GETTIMEOFDAY=1 -DHAVE_ISSETUGID=1 \
		-DHAVE_KILLPG=1 -DHAVE_MEMMOVE=1 -DHAVE_MKNOD=1 -DHAVE_MMAP=1 \
		-DHAVE_NICE=0 -DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_SELECT=1 -DHAVE_SETRESUGID=1 \
		-DHAVE_SETGROUPS=1 -DHAVE_STRERROR=0 -DHAVE_STRSIGNAL=0 \
		-DHAVE_STRLCPY=1 -DHAVE_FLOCK_DECL=1 -DHAVE_REVOKE_DECL=1 \
d57 1
a57 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=510
@


1.84
log
@• Build.sh: fix NSIG detection for gcc-snapshot
• all: bump version to R50-current; add more comments; whitespace
• all: remove all mkssert(); we’ll do full re-runs of scan-build and,
  hopefully, Coverity Scan/Prevent
• check.t: fix a testcase (sed could exit false, but we don’t care)
• eval.c: fix tilde_ok data type (only unsigned may shl constantly)
• exec.c: fix shebang buf array accesses to always go via uint8_t *
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.83 2014/10/07 15:22:11 tg Exp $
d4 2
a5 2
#		2011, 2012, 2013, 2014
#	Thorsten Glaser <tg@@mirbsd.org>
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=509
d59 1
a59 1
COPTS+=		-std=c99 -Wall -fno-inline
@


1.83
log
@fix severe regression in field splitting (LP#1378208)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.82 2014/10/03 17:32:06 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=504
@


1.82
log
@overhaul IFS handling, fix bugs reported by Stephane Chazelas and mikeserv

now we’re at: 486 passed testsuite items, 0 failed
ifs.sh still: # tests 6856 passed 6856 failed 0
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.81 2014/09/03 19:22:47 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=503
@


1.81
log
@permit $1, $!, etc. to be nameref’d again ($_ was); spotted by Jb_boin, 10x!
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.80 2014/06/24 20:47:40 tg Exp $
d49 3
a51 3
		-DHAVE_GETSID=1 -DHAVE_GETTIMEOFDAY=1 -DHAVE_KILLPG=1 \
		-DHAVE_MEMMOVE=1 -DHAVE_MKNOD=1 -DHAVE_MMAP=1 -DHAVE_NICE=0 \
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=502
@


1.80
log
@bump
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.79 2014/06/09 13:25:48 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=501
@


1.79
log
@fix some of the signal stuff (still didn’t get rid of awk(1) and printf(1)
calls in Build.sh, we need HOSTCC for that… which we should do, using BER
or something encoded for integers, and pregenerated hashtables as planned)

also, bump to R50 beta, due to today’s language changes
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.78 2014/05/27 13:22:40 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=500
@


1.78
log
@fix LP#1277691 (“nameref RHS not syntax checked”) and the inability to
use errorf() while nameref states were being changed (by almost completely
eliminating the global variable) and the readonly first array variable
bypass (typo/refactoro); also, whitespace, one int → bool, and add a
comment wrt. the parser rewrite talked about with igli during a fever ;)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.77 2014/01/05 21:57:20 tg Exp $
d39 13
a51 13
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_RESOURCE_H=1 \
		-DHAVE_SYS_SELECT_H=1 -DHAVE_SYS_SYSMACROS_H=0 \
		-DHAVE_BSTRING_H=0 -DHAVE_GRP_H=1 -DHAVE_LIBGEN_H=1 \
		-DHAVE_LIBUTIL_H=0 -DHAVE_PATHS_H=1 -DHAVE_STDINT_H=1 \
		-DHAVE_STRINGS_H=1 -DHAVE_TERMIOS_H=1 -DHAVE_ULIMIT_H=0 \
		-DHAVE_VALUES_H=0 -DHAVE_CAN_INTTYPES=1 -DHAVE_CAN_UCBINTS=1 \
		-DHAVE_CAN_INT8TYPE=1 -DHAVE_CAN_UCBINT8=1 -DHAVE_RLIM_T=1 \
		-DHAVE_SIG_T=1 -DHAVE_SYS_ERRLIST=1 -DHAVE_SYS_SIGNAME=1 \
		-DHAVE_SYS_SIGLIST=1 -DHAVE_FLOCK=1 -DHAVE_LOCK_FCNTL=1 \
		-DHAVE_GETRUSAGE=1 -DHAVE_GETSID=1 -DHAVE_GETTIMEOFDAY=1 \
		-DHAVE_KILLPG=1 -DHAVE_MEMMOVE=1 -DHAVE_MKNOD=1 -DHAVE_MMAP=1 \
		-DHAVE_NICE=0 -DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=499
@


1.77
log
@• fix ${12345678901234567890} segfault (OOB access / integer overflow)
  ‣ not like oksh did, but using mksh’s built-in features
• handle suggested __pure additions
• revert cid 1004F7F096867C83CF0
  ‣ always use our wcwidth code
  ‣ only use our strlcpy code if none found
• fix a couple of gcc-snapshot and clang/scan-build warnings
• mksh R49~rc1
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.76 2013/11/30 17:41:30 tg Exp $
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=491
@


1.76
log
@detect getsid(2), also spotted by RT, this on MSYS
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.75 2013/11/20 21:14:48 tg Exp $
d4 1
a4 1
#		2011, 2012, 2013
d35 5
a39 4
		-DHAVE_ATTRIBUTE_NORETURN=1 -DHAVE_ATTRIBUTE_UNUSED=1 \
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_SYS_TIME_H=1 -DHAVE_TIME_H=1 \
		-DHAVE_BOTH_TIME_H=1 -DHAVE_SYS_BSDTYPES_H=0 \
		-DHAVE_SYS_FILE_H=1 -DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
d56 1
a56 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=489
@


1.75
log
@make this actually call getopt.sh, correctly, and Heirloom sh compatible
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.74 2013/11/17 22:37:46 tg Exp $
d48 3
a50 3
		-DHAVE_GETRUSAGE=1 -DHAVE_GETTIMEOFDAY=1 -DHAVE_KILLPG=1 \
		-DHAVE_MEMMOVE=1 -DHAVE_MKNOD=1 -DHAVE_MMAP=1 -DHAVE_NICE=0 \
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
d68 2
a69 2
${_i:R}.gen: ${_i} ${SRCDIR}/genopt.sh
	(srcfile=${SRCDIR:Q}/${_i}; . ${SRCDIR:Q}/genopt.sh)
@


1.74
log
@sync clog
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.73 2013/09/10 17:32:55 tg Exp $
d69 1
a69 1
	${MKSH} ${SRCDIR:Q}/genopt.sh ${SRCDIR:Q}/${_i}
@


1.73
log
@integrate latest changes from oksh: Wed Sep 4 15:49:19 2013 UTC by millert

Add a proper suspend builtin that saves/restores the tty and pgrp
as needed instead of an alias that just sends SIGSTOP.  Login shells
may be suspended if they are not running in an orphan process group.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.72 2013/08/23 14:07:31 tg Exp $
d57 1
d65 10
@


1.72
log
@SECURITY: Unbreak “set +p”, broken by OpenBSD ksh change.

TODO: I am seriously considering following Chet and changing
the way this works, by explicitly dropping privs unless the
shell is run with -p. Every other shell does it like mksh,
except Heirloom sh, which on the other hand doesn’t know any
explicit set -p or set +p (though it doesn’t know set +foo
for any foo either).

┌──┤ QUESTION: Do we need the ability to do this:
│ tg@@blau:~ $ ./suidmksh -p -c 'whoami; set +p; whoami'
│ root
│ tg

If not, I’m seriously considering to drop set ±p as well,
only parse -p on the command line, with +p being the default,
and dropping FPRIVILEGED.

Thanks to RT for noticing and jilles for initial follow-up
discussion, as well as Chet Ramey for doing the sane/secure
thing instead of following Debian.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.71 2013/08/10 13:44:23 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=483
@


1.71
log
@reduce amount of .bss memory needed; initialise via AEDIT at x_init
or even first run of x_vi
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.70 2013/07/21 18:47:13 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=481
@


1.70
log
@Fix most “set -x” problems (LP#1179287)

• “set -x” manually (cmdline too) snapshots fd#2 now
• “set -o inherit-xtrace” introduced; default still enabled
• reverted iodup printing to pre-R45 behaviour
• made Flag(FXTRACE) a proper state machine
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.69 2013/06/01 01:49:33 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=471
@


1.69
log
@forgot to commit this
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.68 2013/05/02 21:59:43 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=469
@


1.68
log
@implement VALSUBs
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.67 2013/04/27 18:12:36 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=461
@


1.67
log
@start next development iteration
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.66 2013/04/26 21:22:38 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=459
@


1.66
log
@Oh well… this looks well, is done done, and gcc-snapshot doesn’t complain:
• correct order of built-in commands; use POSIX special versus “all others”
  plus “keeps assignments” as distinction, no longer play POSIX regular vs.
  others game; sync manpage
• fix LP#1156707: map (( internally to “let]” which is no valid function
  name and so can’t be overridden but is unlikely to be used otherwhere
  and not strictly permitted (by POSIX) anyway
• we do not need -Wno-overflow any more, either
• bump to R45
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.65 2013/04/26 19:40:06 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=451
@


1.65
log
@now get rid of the run-time check, the idivwrapv nonsense, and straighten out lksh
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.64 2013/03/24 00:56:32 tg Exp $
d55 1
a55 1
		-DHAVE_PERSISTENT_HISTORY=0 -DMKSH_BUILD_R=449
@


1.64
log
@• let mksh “set -x” print whole TCOM trees
• plug some memory leaks in debug (“set -x”) and warning paths while here
• one from Florian (friend of Natureshadow) for WTF
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.63 2013/03/05 15:41:43 tg Exp $
d55 1
a55 2
		-DHAVE_PERSISTENT_HISTORY=0 -DHAVE_SILENT_IDIVWRAPV=0 \
		-DMKSH_BUILD_R=449
d70 1
a70 1
	    -C shell:legacy-no,int:32,smksh,convfds,nodeprecated,no-histfile,fastbox
@


1.63
log
@bump
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.62 2013/02/23 20:03:24 tg Exp $
d56 1
a56 1
		-DMKSH_BUILD_R=441
@


1.62
log
@both mksh(1) and POSIX say: "$@@" should always generate multiple words
issue in pdksh reported in IRC by engla, thanks!
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.61 2013/02/18 22:55:34 tg Exp $
d56 1
a56 1
		-DMKSH_BUILD_R=440
@


1.61
log
@put list of check_categories into Makefrag.inc generated; bump patchlevel
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.60 2013/02/17 05:40:10 tg Exp $
d56 1
a56 1
		-DMKSH_BUILD_R=431
@


1.60
log
@backpedal with $'…' and $"…" interpolation

it turns out this breaks more legacy scripts than anticipated
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.59 2012/12/17 23:46:30 tg Exp $
d56 1
a56 1
		-DMKSH_BUILD_R=430
@


1.59
log
@sync clog et al.
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.58 2012/11/30 20:49:10 tg Exp $
d4 1
a4 1
#		2011, 2012
d56 1
a56 1
		-DMKSH_BUILD_R=419
@


1.58
log
@regenerate Makefiles
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.57 2012/11/20 18:50:40 tg Exp $
d35 5
a39 4
		-DHAVE_ATTRIBUTE_NONNULL=1 -DHAVE_ATTRIBUTE_NORETURN=1 \
		-DHAVE_ATTRIBUTE_UNUSED=1 -DHAVE_ATTRIBUTE_USED=1 \
		-DHAVE_SYS_BSDTYPES_H=0 -DHAVE_SYS_FILE_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 -DHAVE_SYS_PARAM_H=1 \
d46 2
a47 2
		-DHAVE_SIG_T=1 -DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 \
		-DHAVE_STRSIGNAL=0 -DHAVE_FLOCK=1 -DHAVE_LOCK_FCNTL=1 \
d49 4
a52 3
		-DHAVE_MKNOD=1 -DHAVE_MMAP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
		-DHAVE_SELECT=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
d54 3
a56 2
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0 \
		-DHAVE_SILENT_IDIVWRAPV=0 -DMKSH_BUILD_R=419
@


1.57
log
@RT tells me Minix 2 (i386) also doesn’t have gettimeofday(2)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.56 2012/06/28 20:17:31 tg Exp $
d53 1
a53 1
		-DHAVE_SILENT_IDIVWRAPV=0 -DMKSH_BUILD_R=409
@


1.56
log
@(mksh) tighten 32-bit requirements; (lksh) switch to long; allow any bitness
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.55 2012/05/04 22:44:30 tg Exp $
d47 2
a48 2
		-DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 -DHAVE_MKNOD=1 \
		-DHAVE_MMAP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
@


1.55
log
@keep up
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.53 2012/04/07 11:19:44 tg Exp $
d68 1
a68 1
	    -C smksh,convfds,nodeprecated,no-histfile,fastbox
@


1.54
log
@rewrite maketemp() obsoleting tempnam(3) and mkstemp(3) external deps
@
text
@d42 2
a43 2
		-DHAVE_STRINGS_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
		-DHAVE_CAN_INTTYPES=1 -DHAVE_CAN_UCBINTS=1 \
@


1.53
log
@drop all deprecated code, you have been warned
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.52 2012/03/27 23:13:39 tg Exp $
d48 1
a48 1
		-DHAVE_MKSTEMP=1 -DHAVE_MMAP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
@


1.52
log
@pass the version to avoid stale Makefile.inc files
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.51 2012/03/27 22:36:47 tg Exp $
d47 2
a48 2
		-DHAVE_MMAP=1 -DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 \
		-DHAVE_MKNOD=1 -DHAVE_MKSTEMP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
d51 3
a53 4
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_FLOCK_DECL=1 \
		-DHAVE_REVOKE_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0 -DHAVE_SILENT_IDIVWRAPV=0 \
		-DMKSH_BUILD_R=409
@


1.51
log
@• implement fcntl(2)-based advisory locking as an alternative iff flock(2)
  is not found, from a suggestion by RT (LP: #912691)
• try harder (in a loop) to acquire a file lock if the locking mechanism
  documents EINTR is a possibility (fcntl always, flock on Linux not .Ox)
• use -std=c99 not -std=gnu99 if it must be at all
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.50 2011/12/31 02:04:15 tg Exp $
d53 2
a54 3
		-DHAVE_PERSISTENT_HISTORY=0
# probably differs between i386 and sparc
CPPFLAGS+=	-DHAVE_SILENT_IDIVWRAPV=0
@


1.50
log
@followup for cid 1004EE408E1382C1752 and 1004EE40DDD498FBB0D:
do a mirtoconf run-time check (ugh) to see whether the CPU designers
smoked/were brain-dead or if we don’t actually need the manual check
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.49 2011/12/08 22:19:17 tg Exp $
d3 2
a4 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011
d46 2
a47 1
		-DHAVE_STRSIGNAL=0 -DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 \
d56 7
a62 1
COPTS+=		-std=gnu99 -Wall -fno-inline
d77 1
@


1.49
log
@disable deprecated code on MirBSD-current mksh-current (note: next to deprecate is support for parsing $((010)) as octal, which is agreed gecko2@@ tonight at the Jugo already)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.48 2011/11/26 00:39:51 tg Exp $
d52 2
@


1.48
log
@fix calling the fastbox checks
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.47 2011/11/25 23:29:29 tg Exp $
d32 1
a32 1
CPPFLAGS+=	-DMKSH_ASSUME_UTF8 -DMKSH_SMALL \
d60 1
a60 1
	    -C smksh,convfds,no-histfile,fastbox
@


1.47
log
@add a -f option to test.sh that runs tests of class fastbox
plus a test in that category for a bug spotted during development of
https://evolvis.org/plugins/scmgit/cgi-bin/gitweb.cgi?p=shellsnippets/shellsnippets.git;a=blob;f=mksh/sysadmin/getjpics.cgi;h=d74018cbc1ae4e88408267ecc73a6df19aa4c99a;hb=HEAD
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.46 2011/04/09 18:47:18 tg Exp $
d59 2
a60 1
	    -s ${SRCDIR}/check.t -v -p ./${PROG} -f -C smksh,convfds,no-histfile
@


1.46
log
@sync… various things
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.45 2011/02/11 01:18:06 tg Exp $
d59 1
a59 1
	    -s ${SRCDIR}/check.t -v -p ./${PROG} -C smksh,convfds,no-histfile
@


1.45
log
@• more comment and int→bool cleanup, add and improve some comments
• in interactive mode, always look up {LC_{ALL,CTYPE},LANG} environment
  variables if setlocale/nl_langinfo(CODESET) doesn’t suffice
• add the ability to call any builtin (some don't make sense or wouldn't
  work) directly by analysing argv[0]
• for direct builtin calls, the {LC_{ALL,CTYPE},LANG} environment
  variables determine utf8-mode, even if MKSH_ASSUME_UTF8 was set
• when called as builtin, echo behaves POSIXish
• add domainname as alias for true on MirBSD only, to be able to link it
• sync mksh Makefiles with Build.sh output
• adjust manpage wrt release plans
• link some things to mksh now that we have callable builtins:
  bin/echo bin/kill bin/pwd bin/sleep (exact matches)
  bin/test bin/[ (were scripts before)
  bin/domainname=usr/bin/true usr/bin/false (move to /bin/ now)
• drop linked utilities and, except for echo and kill, their manpages
• adjust instbin and link a few more there as well
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.44 2011/01/30 02:28:32 tg Exp $
d37 10
a46 11
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_SELECT_H=1 \
		-DHAVE_SYS_SYSMACROS_H=0 -DHAVE_BSTRING_H=0 -DHAVE_GRP_H=1 \
		-DHAVE_LIBGEN_H=1 -DHAVE_LIBUTIL_H=0 -DHAVE_PATHS_H=1 \
		-DHAVE_STDBOOL_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 \
		-DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 -DHAVE_CAN_INTTYPES=1 \
		-DHAVE_CAN_UCBINTS=1 -DHAVE_CAN_INT8TYPE=1 \
		-DHAVE_CAN_UCBINT8=1 -DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 \
		-DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 \
		-DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 -DHAVE_MKNOD=1 \
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
@


1.44
log
@regen
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.43 2011/01/29 19:07:18 tg Exp $
d3 1
a3 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
d36 4
a39 2
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_FILE_H=1 -DHAVE_SYS_MKDEV_H=0 \
		-DHAVE_SYS_MMAN_H=1 -DHAVE_SYS_SYSMACROS_H=0 -DHAVE_GRP_H=1 \
d49 4
a52 3
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_FLOCK_DECL=1 -DHAVE_REVOKE_DECL=1 \
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0
@


1.43
log
@-DIN_MKSH is not used by anything
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.42 2010/12/12 14:06:32 tg Exp $
d36 10
a45 9
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
		-DHAVE_SYS_SYSMACROS_H=0 -DHAVE_GRP_H=1 -DHAVE_LIBGEN_H=1 \
		-DHAVE_LIBUTIL_H=0 -DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 \
		-DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_ULIMIT_H=0 \
		-DHAVE_VALUES_H=0 -DHAVE_CAN_INTTYPES=1 -DHAVE_CAN_UCBINTS=1 \
		-DHAVE_CAN_INT8TYPE=1 -DHAVE_CAN_UCBINT8=1 -DHAVE_RLIM_T=1 \
		-DHAVE_SIG_T=1 -DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 \
		-DHAVE_STRSIGNAL=0 -DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 \
		-DHAVE_MKNOD=1 -DHAVE_MKSTEMP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
@


1.42
log
@MKSH_SMALL need not imply !HAVE_REVOKE as default
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.41 2010/10/08 17:56:59 tg Exp $
d48 1
a48 1
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0 -DIN_MKSH
@


1.41
log
@mknod’s now demoted and only used as special-case builtin, in MirBSD only
built for the installer, to save time, as the original OpenBSD hack wanted
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.40 2010/09/14 21:26:03 tg Exp $
d31 1
a31 1
# env: HAVE_MKNOD=x HAVE_REVOKE=x
@


1.40
log
@• Address concerns of Chris Palmer from the Android security team
  – possible integer overflows in memory allocation, mostly
    ‣ multiplication: all are checked now
    ‣ addition: reviewed them, most were “proven” or guessed to be
      “almost” impossible to run over (e.g. when we have a string
      whose length is taken it is assumed that the length will be
      more than only a few bytes below SIZE_MAX, since code and
      stack have to fit); some are checked now (e.g. when one of
      the summands is an off_t); most of the unchecked ones are
      annotated now
    ⇒ cost (MirBSD/i386 static): +76 .text
    ⇒ cost (Debian sid/i386): +779 .text  -4 .data
  – on Linux targets, setuid() setresuid() setresgid() can fail
    with EAGAIN; check for that and, if so, warn once and retry
    infinitely (other targets to be added later once we know that
    they are “insane”)
    ⇒ cost (Debian sid/i386): +192 .text (includes .rodata)
• setmode.c: Do overflow checking for realloc() too; switch back
  from calloc() to a checked malloc() for simplification while there
• define -DIN_MKSH and let setmode.c look a tad nicer while here
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.39 2010/08/24 15:19:55 tg Exp $
d46 3
a48 4
		-DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_FLOCK_DECL=1 \
		-DHAVE_REVOKE_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0 -DIN_MKSH
@


1.39
log
@it’s ugly to write a ./stdint.h file if we can instead define the
types from sh.h; sync clog
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.38 2010/07/04 17:41:38 tg Exp $
d49 1
a49 1
		-DHAVE_PERSISTENT_HISTORY=0
@


1.38
log
@sync
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.37 2010/03/27 15:32:57 tg Exp $
d3 1
a3 1
# Copyright (c) 2003, 2004, 2005, 2006, 2007, 2008, 2009
d37 8
a44 7
		-DHAVE_SYS_SYSMACROS_H=0 -DHAVE_LIBGEN_H=1 -DHAVE_LIBUTIL_H=0 \
		-DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 -DHAVE_STRINGS_H=1 \
		-DHAVE_GRP_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
		-DHAVE_STDINT_H=1 -DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 \
		-DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 \
		-DHAVE_GETRUSAGE=1 -DHAVE_KILLPG=1 -DHAVE_MKNOD=1 \
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=0 -DHAVE_REVOKE=1 \
@


1.37
log
@disable BGNICE by default for MKSH_SMALL
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.36 2009/12/12 22:27:13 tg Exp $
d31 1
a31 1
# env: HAVE_MKNOD=x HAVE_REALPATH=x HAVE_REVOKE=x
a41 1
		-DHAVE_ARC4RANDOM=1 -DHAVE_ARC4RANDOM_PUSHB=1 \
d46 1
a46 2
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
		-DHAVE_ARC4RANDOM_PUSHB_DECL=1 -DHAVE_FLOCK_DECL=1 \
@


1.36
log
@re-vamp __attribute__ handling; let this pass on HP-UX bundled compiler
as well as HP aCC
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.35 2009/06/08 20:34:36 tg Exp $
d44 1
a44 1
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=1 -DHAVE_REVOKE=1 \
@


1.35
log
@• Check if killpg(3) is available; if not, use kill(2) with negative
  process ID and hope it works (is POSIXly killpg-endowed)
• bump version
• sync clog
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.34 2009/05/16 16:59:30 tg Exp $
d33 4
a36 3
		-DHAVE_ATTRIBUTE=1 -DHAVE_ATTRIBUTE_BOUNDED=1 \
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_SYS_PARAM_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
d44 4
a47 5
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=1 -DHAVE_REALPATH=1 \
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_SETMODE=1 \
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.34
log
@• sync distrib/special/mksh/Makefile with bin/mksh/Build.sh and
  fix the regression test’s results while here, which have been
  broken since cid 10049D9BE5254CE65B8
• get rid of separate copyright file which was intended for De-
  bian; track down commits in all files of oksh-mirbsd and mksh
  to get correct copyright years per-file, as is BSD custom
@
text
@d1 1
a1 1
# $MirOS: src/bin/mksh/Makefile,v 1.73 2009/04/03 09:39:03 tg Exp $
d31 1
a31 1
# env: HAVE_MKNOD=1 HAVE_REALPATH=1 HAVE_REVOKE=1
d42 6
a47 5
		-DHAVE_GETRUSAGE=1 -DHAVE_MKNOD=1 -DHAVE_MKSTEMP=1 \
		-DHAVE_NICE=1 -DHAVE_REALPATH=1 -DHAVE_REVOKE=1 \
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
		-DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.33
log
@(experimental) implement getrusage via times if not found
@
text
@d1 21
a21 2
# $MirOS: src/distrib/special/mksh/Makefile,v 1.32 2009/03/29 10:21:31 tg Exp $
# $miros: src/bin/mksh/Makefile,v 1.29 2007/01/18 16:05:05 tg Exp $
d50 1
a50 1
COPTS+=		-Wall -fno-inline
d57 6
a62 1
	    -s ${SRCDIR}/check.t -v -p ./${PROG} -C smksh,no-histfile
@


1.32
log
@sync
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.31 2008/12/13 17:02:18 tg Exp $
d22 6
a27 6
		-DHAVE_ARC4RANDOM=1 -DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKNOD=1 \
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=1 -DHAVE_REALPATH=1 \
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_SETMODE=1 \
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.31
log
@* back out almost all of the memory allocator related changes, as aalloc
  was hard to type and hard to fix, galloc is also hard to fix, and some
  things I learned will probably improve things more but make me use the
  original form as base (especially for space savings)
* let sizeofN die though, remove even more casts
* optimise, polish
* regen Makefiles
* sprinkle a few /* CONSTCOND */ while here
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.30 2008/11/02 22:42:38 tg Exp $
d10 2
a11 2
SRCS=		alloc.c edit.c eval.c exec.c expr.c funcs.c histrap.c \
		jobs.c lex.c main.c misc.c shf.c syn.c tree.c var.c
@


1.30
log
@regenerate CPPFLAGS
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.29 2008/10/28 14:32:35 tg Exp $
d24 2
a25 2
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=1 \
		-DHAVE_LANGINFO_CODESET=1 -DHAVE_SETMODE=1 \
@


1.29
log
@• rewrite code to no longer use statements-as-expressions
• optimise a little
• Build.sh: remove HAVE_EXPSTMT test
• Build.sh, */Makefile: sort tests, regenerate
• mksh.hts: sync clog
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.28 2008/10/26 22:03:04 tg Exp $
d18 10
a27 9
		-DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 -DHAVE_GRP_H=1 \
		-DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 -DHAVE_STDINT_H=1 \
		-DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 -DHAVE_SYS_SIGNAME=1 \
		-DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 -DHAVE_ARC4RANDOM=1 \
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKNOD=1 -DHAVE_MKSTEMP=1 \
		-DHAVE_NICE=1 -DHAVE_REALPATH=1 -DHAVE_REVOKE=1 \
		-DHAVE_SETLOCALE_CTYPE=1 -DHAVE_LANGINFO_CODESET=1 \
		-DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.28
log
@sync MirBSD-specific mksh Makefiles after recent Build.sh changes
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.27 2008/10/05 16:26:17 tg Exp $
d14 3
a16 3
		-DHAVE_EXPSTMT=1 -DHAVE_ATTRIBUTE=1 \
		-DHAVE_ATTRIBUTE_BOUNDED=1 -DHAVE_ATTRIBUTE_USED=1 \
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
d22 2
a23 1
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKSTEMP=1 -DHAVE_NICE=1 \
a24 1
		-DHAVE_MKNOD=1 -DHAVE_REALPATH=1 -DHAVE_REVOKE=1 \
@


1.27
log
@use mksh realpath builtin instead of readlink -f for canonicalisation

note: there’s still a readlink(1) call left in, for instance, mirmake;
this does not hurt because we initially assumed that readlink(1) does
exist anyway and bundled ours just because some do not have the ‘-f’
option for realpath(2)isation
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.26 2008/08/02 00:45:40 tg Exp $
d22 1
a22 1
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKSTEMP=1 \
@


1.26
log
@yay, optu*.c do not build, because, tadaa, with debugging cflags I had
-std=c99 enabled, with normal cflags not…

time to break ancient code which is not -std=c99 (well, -std=gnu99, with
extensions) clean (ISTR oldroff already sets -std=gnu89)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.25 2008/07/11 19:51:22 tg Exp $
d36 1
a36 1
	HOME=$$(readlink -nf regress-dir) perl ${SRCDIR}/check.pl \
@


1.25
log
@• Build.sh, check.t: bring back the 'smksh' check category, which was
  missing for a while yet its disappearance was unnoticed because…
• distrib/special/mksh/Makefile: sync check categories, this was missed
• mksh.hts: sync clog
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.24 2008/05/17 18:27:53 tg Exp $
d30 1
a30 1
COPTS+=		-std=gnu99 -Wall -fno-inline
@


1.24
log
@add new builtin “realpath” calling realpath(3) on its argument, skipping
over “--” for compatibility to Debian realpath(1) and possibly busybox’

“sounds handy” replaced@@TNF
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.23 2008/05/04 02:03:43 tg Exp $
d37 1
a37 1
	    -s ${SRCDIR}/check.t -v -p ./${PROG} -C pdksh,smksh,dutf
@


1.23
log
@regen
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.22 2008/04/20 02:15:12 tg Exp $
d12 1
a12 1
# env: HAVE_MKNOD=1 HAVE_REVOKE=1
d24 3
a26 3
		-DHAVE_MKNOD=1 -DHAVE_REVOKE=1 -DHAVE_SETMODE=1 \
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.22
log
@clean up unused defines
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.21 2008/03/27 22:44:17 tg Exp $
d23 1
a23 1
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
@


1.21
log
@• Build.sh: be a little more explicit about the unknown compilers
• Build.sh: add another one
• */Makefile: sync CPPFLAGS
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.20 2008/03/25 21:34:42 tg Exp $
d12 1
d22 1
a22 1
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_FLOCK_EX=1 -DHAVE_MKSTEMP=1 \
@


1.20
log
@• Add support for Ultrix 4.5 and ucode cc (?)
  ‣ I/O redirection seems broken:
    $ (date; date >/dev/null; date) | wc -l
    1 (expected: 2)
  ‣ other than that: working fine
  ‣ -YBSD (default) and -YSYSTEM_FIVE don’t work, just -YPOSIX, somehow
• Fix $(…) to `…` for OSF/1 V2.0 /bin/sh
  ‣ this compiler is FUBAR though:
	$ cat >t.c
	main() { return (foo()); }
	$ cc t.c
	ld:
	Unresolved :
	foo
	$ echo $?
	0
	$ ls -l a.out
	-rwxr-xr-x   1 mirbsd   users      10835 Jul 21 17:12 a.out
  ‣ it seems to have ucode, but man is not installed
• new mirtoconf check: mkstemp(3)
• if !HAVE_MKSTEMP (Ultrix), use tempnam(3)
• only use printf(1) if it exists (it doesn’t on Ultrix)
• a few more signals
• add S_ISLNK if the OS doesn’t define it
• add strcasecmp(3) proto for Ultrix (it _is_ in <portability.h>, but
  only for -YBSD I think)
• fgrep(1) on Ultrix doesn’t do “-e ① -e ②”

10x DEChengst:#UnixNL for giving access
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.19 2008/03/05 18:49:14 tg Exp $
d25 4
a28 3
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 -DHAVE_FLOCK_DECL=1 \
		-DHAVE_ARC4RANDOM_PUSHB_DECL=1 -DHAVE_REVOKE_DECL=1 \
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0
@


1.19
log
@• check for flock decl too (weird on OSF/1: if !POSIX and BSD)
• un-experimental Tru64
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.18 2008/03/05 17:16:13 tg Exp $
d21 1
a21 1
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_FLOCK_EX=1 \
@


1.19.2.1
log
@MFC: pull up mksh-R34β since it’ll be required by MirPorts soonish…
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.24 2008/05/17 18:27:53 tg Exp $
a11 1
# env: HAVE_MKNOD=1 HAVE_REALPATH=1 HAVE_REVOKE=1
d21 7
a27 8
		-DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKSTEMP=1 \
		-DHAVE_SETLOCALE_CTYPE=1 -DHAVE_LANGINFO_CODESET=1 \
		-DHAVE_MKNOD=1 -DHAVE_REALPATH=1 -DHAVE_REVOKE=1 \
		-DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 \
		-DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
		-DHAVE_ARC4RANDOM_PUSHB_DECL=1 -DHAVE_FLOCK_DECL=1 \
		-DHAVE_REVOKE_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0
@


1.19.2.2
log
@MFC: mksh R35b
@
text
@d1 1
a1 1
# $MirOS$
d37 1
a37 1
	    -s ${SRCDIR}/check.t -v -p ./${PROG} -C smksh,no-histfile
@


1.19.2.3
log
@MFC: mksh R36b
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.19.2.2 2008/07/18 13:29:39 tg Exp $
d14 3
a16 3
		-DHAVE_ATTRIBUTE=1 -DHAVE_ATTRIBUTE_BOUNDED=1 \
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_SYS_PARAM_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
d18 9
a26 10
		-DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 -DHAVE_STRINGS_H=1 \
		-DHAVE_GRP_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
		-DHAVE_STDINT_H=1 -DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 \
		-DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 \
		-DHAVE_ARC4RANDOM=1 -DHAVE_ARC4RANDOM_PUSHB=1 -DHAVE_MKNOD=1 \
		-DHAVE_MKSTEMP=1 -DHAVE_NICE=1 -DHAVE_REALPATH=1 \
		-DHAVE_REVOKE=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_SETMODE=1 \
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
d30 1
a30 1
COPTS+=		-Wall -fno-inline
@


1.18
log
@of course we have revoke(2) here
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.17 2008/03/05 17:06:49 tg Exp $
d25 1
a25 1
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
@


1.17
log
@OSF/1 doesn’t seem to declare revoke(2) anywhere
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.16 2007/10/14 13:36:40 tg Exp $
d23 1
a23 1
		-DHAVE_MKNOD=1 -DHAVE_REVOKE=0 -DHAVE_SETMODE=1 \
@


1.16
log
@sync w/ current Build.sh
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.15 2007/08/24 14:25:33 tg Exp $
d26 2
a27 2
		-DHAVE_ARC4RANDOM_PUSHB_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0
@


1.15
log
@revert the -std=gnu99–by–default change until programmes are ready, as this
is too much annoying (for now) – extra commit so that we have a changeset
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.14 2007/08/24 14:19:58 tg Exp $
d12 1
a12 1
CPPFLAGS+=	-DMKSH_SMALL -DMKSH_ASSUME_UTF8 -DMKSH_NEED_MKNOD \
d17 2
a18 2
		-DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 -DHAVE_STDINT_H=1 \
		-DHAVE_GRP_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
@


1.14
log
@• add -std=gnu99 to default CFLAGS
• first round of assorted fixes
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.13 2007/08/12 13:42:19 tg Exp $
d28 1
a28 1
COPTS+=		-Wall -fno-inline
@


1.13
log
@add “set -o arc4random”, RTFM for details
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.12 2007/07/31 11:11:22 tg Exp $
d28 1
a28 1
COPTS+=		-std=gnu99 -Wall -fno-inline
@


1.12
log
@• new way of checking for mknod & friends, due to tcc vs glibc weirdness
• bump vsn for the code restructuring
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.11 2007/07/01 21:47:07 tg Exp $
d21 1
a21 1
		-DHAVE_ARC4RANDOM_PUSH=1 -DHAVE_FLOCK_EX=1 \
d26 1
a26 1
		-DHAVE_ARC4RANDOM_PUSH_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
@


1.11
log
@• fix display problem
• add <libutil.h> if it exists – revoke(2) on UWIN
• add <stdlib.h> for NULL in test of mmap(2)
• regen CPPFLAGS for MirBSD native builds
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.10 2007/06/15 21:53:45 tg Exp $
d23 5
a27 4
		-DHAVE_REVOKE=0 -DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 \
		-DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 \
		-DHAVE_ARC4RANDOM_DECL=1 -DHAVE_ARC4RANDOM_PUSH_DECL=1 \
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0
@


1.10
log
@introduce regress target
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.9 2007/06/05 21:47:47 tg Exp $
d13 8
a20 8
		-DHAVE_ATTRIBUTE=1 -DHAVE_ATTRIBUTE_BOUNDED=1 \
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_EXPSTMT=1 -DHAVE_SYS_PARAM_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
		-DHAVE_SYS_SYSMACROS_H=0 -DHAVE_LIBGEN_H=1 -DHAVE_PATHS_H=1 \
		-DHAVE_STDBOOL_H=1 -DHAVE_STDINT_H=1 -DHAVE_GRP_H=1 \
		-DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 -DHAVE_RLIM_T=1 \
		-DHAVE_SIG_T=1 -DHAVE_SYS_SIGNAME=1 -DHAVE_SYS_SIGLIST=1 \
		-DHAVE_STRSIGNAL=0 -DHAVE_ARC4RANDOM=1 \
@


1.9
log
@with this, we don't need the special list of pre-known signal names
any more either, and can make use of code sharing between detection
of sys_siglist and sys_signame (and the underscored variants); nuke
the now-useless signames.c file too (merge struct into histrap.c)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.8 2007/06/05 19:48:45 tg Exp $
d6 3
a11 1
.PATH:		${BSDSRCDIR}/bin/mksh
d29 7
@


1.8
log
@fix for the SUNpro 8 on yofuh's E420:
cc: Sun C 5.8 Patch 121015-04 2007/01/10
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.7 2007/06/04 21:55:39 tg Exp $
d12 2
a13 2
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_EXPSTMT=1 \
		-DHAVE_SYS_PARAM_H=1 -DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
d17 8
a24 9
		-DHAVE_SIG_T=1 -DHAVE_MKSH_SIGNAME=0 -DHAVE_SYS_SIGNAME=1 \
		-DHAVE__SYS_SIGNAME=0 -DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 \
		-DHAVE_ARC4RANDOM=1 -DHAVE_ARC4RANDOM_PUSH=1 \
		-DHAVE_FLOCK_EX=1 -DHAVE_SETLOCALE_CTYPE=0 \
		-DHAVE_LANGINFO_CODESET=0 -DHAVE_REVOKE=0 -DHAVE_SETMODE=1 \
		-DHAVE_SETRESUGID=1 -DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 \
		-DHAVE_STRLCPY=1 -DHAVE_ARC4RANDOM_DECL=1 \
		-DHAVE_ARC4RANDOM_PUSH_DECL=1 -DHAVE_SYS_SIGLIST_DECL=1 \
		-DHAVE_PERSISTENT_HISTORY=0
@


1.7
log
@sync
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.6 2007/04/24 10:42:01 tg Exp $
d12 2
a13 2
		-DHAVE_ATTRIBUTE_USED=1 -DHAVE_SYS_PARAM_H=1 \
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_MMAN_H=1 \
@


1.6
log
@• arc4random, arc4random_push: use our own protos to check
  XXX u_int32_t is not ISO C99, but seems to work well enough
  XXX if it fails anywhere, we'll see in the build logs
  XXX apple doesn't have the standard uint32_t and API doesn't specify it
• sys_siglist_defn: rename to sys_siglist_decl as we're really checking
  for the declaration in the headers; change wording to “check if … does
  not need to be declared” since we don't need to declare if we don't use
• scan for arc4random, arc4random_push, confstr declarations too
• sh.h: confstr declaration is no longer #ifdef __sun__; sort
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.5 2007/04/23 20:37:17 tg Exp $
d24 2
a25 3
		-DHAVE_ARC4RANDOM_PUSH_DECL=1 -DHAVE_CONFSTR_DECL=1 \
		-DHAVE_SYS_SIGLIST_DECL=1 -DHAVE_PERSISTENT_HISTORY=0 \
		-DHAVE_MULTI_IDSTRING=1
@


1.5
log
@AIX has sys_siglist[] but doesn't define it anywhere, so add a means to
scan for defns and use it here; bug reported by Kurt Telep
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.4 2007/03/04 04:36:44 tg Exp $
d19 7
a25 5
		-DHAVE_ARC4RANDOM=1 -DHAVE_ARC4RANDOM_PUSH=1 -DHAVE_FLOCK_EX=1 \
		-DHAVE_SETLOCALE_CTYPE=0 -DHAVE_LANGINFO_CODESET=0 \
		-DHAVE_REVOKE=0 -DHAVE_SETMODE=1 -DHAVE_SETRESUGID=1 \
		-DHAVE_SETGROUPS=1 -DHAVE_STRCASESTR=1 -DHAVE_STRLCPY=1 \
		-DHAVE_SYS_SIGLIST_DEFN=1 -DHAVE_PERSISTENT_HISTORY=0 \
@


1.4
log
@• Minix 3 doesn't have <sys/mman.h>
• Some OSes might need <stdint.h> for int32_t (Minix 3 with GCC)
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.3 2007/03/03 21:48:33 tg Exp $
d23 2
a24 1
		-DHAVE_PERSISTENT_HISTORY=0 -DHAVE_MULTI_IDSTRING=1
@


1.3
log
@sync
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.2 2007/02/18 16:24:11 tg Exp $
d13 7
a19 7
		-DHAVE_SYS_MKDEV_H=0 -DHAVE_SYS_SYSMACROS_H=0 \
		-DHAVE_LIBGEN_H=1 -DHAVE_PATHS_H=1 -DHAVE_STDBOOL_H=1 \
		-DHAVE_GRP_H=1 -DHAVE_ULIMIT_H=0 -DHAVE_VALUES_H=0 \
		-DHAVE_RLIM_T=1 -DHAVE_SIG_T=1 -DHAVE_MKSH_SIGNAME=0 \
		-DHAVE_SYS_SIGNAME=1 -DHAVE__SYS_SIGNAME=0 \
		-DHAVE_SYS_SIGLIST=1 -DHAVE_STRSIGNAL=0 -DHAVE_ARC4RANDOM=1 \
		-DHAVE_ARC4RANDOM_PUSH=1 -DHAVE_FLOCK_EX=1 \
d23 1
a23 1
		-DHAVE_MULTI_IDSTRING=1 -DHAVE_PERSISTENT_HISTORY=0
a24 1
CDIAGFLAGS+=	-Wno-cast-qual
@


1.2
log
@• embed MKSH_ASSUME_UTF8 and MKSH_NEED_MKNOD in Build.sh
• have mksh with BSD makefiles always enable MKSH_ASSUME_UTF8
• sync BSD makefiles with Build.sh output
@
text
@d1 1
a1 1
# $MirOS: src/distrib/special/mksh/Makefile,v 1.1 2007/01/26 18:39:49 tg Exp $
d23 1
a23 1
		-DHAVE_MULTI_IDSTRING=1
@


1.1
log
@place a MKSH_SMALL on the i386 floppy and sparc floppy and miniroot
(not on the i386 bsd.rd)
@
text
@d1 1
a1 1
# $MirOS: src/bin/mksh/Makefile,v 1.29 2007/01/18 16:05:05 tg Exp $
d10 2
a11 1
CPPFLAGS+=	-DHAVE_ATTRIBUTE=1 -DHAVE_ATTRIBUTE_BOUNDED=1 \
d23 2
a24 1
		-DHAVE_MULTI_IDSTRING=1 -DMKSH_SMALL -DMKSH_NEED_MKNOD
a25 1
COPTS+=		-fno-inline
@

