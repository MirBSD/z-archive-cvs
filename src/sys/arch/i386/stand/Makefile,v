head	1.17;
access;
symbols
	tg-use_ldscript:1.16.0.2
	tg-beforemerge-ksrc10:1.1.1.3
	cvs-200808011000:1.1.1.3
	MIRBSD_10:1.12.0.2
	MIRBSD_10_BASE:1.12
	MIRBSD_9_BASE:1.8
	MIRBSD_8:1.5.0.2
	MIRBSD_8_BASE:1.5
	cvs-200507032030:1.1.1.2
	cvs-200505050030:1.1.1.2
	cvs-200504291700:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.17
date	2010.01.10.02.02.49;	author tg;	state Exp;
branches;
next	1.16;
commitid	1004B49355A7B299C53;

1.16
date	2009.01.17.11.50.48;	author tg;	state Exp;
branches;
next	1.15;
commitid	1004971C625483500FC;

1.15
date	2009.01.11.14.40.26;	author tg;	state Exp;
branches;
next	1.14;
commitid	100496A04CF0C3726C0;

1.14
date	2008.08.01.15.43.45;	author tg;	state Exp;
branches;
next	1.13;
commitid	10048932F424C3503E1;

1.13
date	2008.08.01.11.24.57;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004892F2924667C00D;

1.12
date	2007.02.26.02.11.32;	author tg;	state Exp;
branches;
next	1.11;
commitid	10045E241DC524D9D5F;

1.11
date	2007.02.26.00.13.26;	author tg;	state Exp;
branches;
next	1.10;
commitid	10045E226230C5AAABC;

1.10
date	2006.07.23.23.41.27;	author tg;	state Exp;
branches;
next	1.9;
commitid	10044C409313E5D0B2B;

1.9
date	2006.06.30.23.18.05;	author tg;	state Exp;
branches;
next	1.8;
commitid	10044A5B12A66F53B0F;

1.8
date	2006.05.15.20.47.05;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004468E8C548985FB8;

1.7
date	2006.04.10.19.10.50;	author tg;	state Exp;
branches;
next	1.6;
commitid	100443AADBE25E05304;

1.6
date	2006.04.06.11.07.30;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004434F66517D09156;

1.5
date	2005.12.04.17.50.20;	author tg;	state Exp;
branches;
next	1.4;
commitid	7a7843932c649625;

1.4
date	2005.04.29.18.34.57;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.14.22.12.38;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.21.27.02;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.29.17.05.46;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2008.08.01.10.28.37;	author tg;	state Exp;
branches;
next	;
commitid	1004892E54805BE97AB;


desc
@@


1.17
log
@√©t voil√†
@
text
@# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.16 2009/01/17 11:50:48 tg Exp $
# $OpenBSD: Makefile,v 1.15 2007/11/25 18:25:31 deraadt Exp $

.if ${MACHINE_ARCH} == "i386"
  SUBDIR+=	etc
  SUBDIR+=	libsa
  SUBDIR+=	bootxx
  SUBDIR+=	bootxx_ustarfs
  SUBDIR+=	mbr
  SUBDIR+=	fdboot
.endif
.if make(obj) || make(clean) || make(cleandir)
  SUBDIR+=	liveboot
.endif
  SUBDIR+=	boot
  SUBDIR+=	installboot

TEST_DEVS= fd0 svnd0 svnd1

.for _i in ${TEST_DEVS}
test-${_i}:
	${SUDO} mount /dev/${_i}a /mnt
	${SUDO} cp /usr/mdec/boot /mnt
	${SUDO} /usr/mdec/installboot -vh2 -s18 /mnt/boot /usr/mdec/bootxx ${_i}
	${SUDO} umount /mnt

zero-${_i}:
	${SUDO} dd if=/dev/zero of=/dev/r${_i}a count=144 bs=10240

prep-${_i}:
	${SUDO} disklabel -rw ${_i} floppy
#	${SUDO} newfs -O 0 -m 0 -o space -i 3000 -c 80 /dev/r${_i}a
	${SUDO} newfs -O -m 0 -o space -i 3000 -c 80 /dev/r${_i}a
.endfor

prereq: _SUBDIRUSE

.include <bsd.subdir.mk>
@


1.16
log
@do not descend into liveboot, save for make obj, clean, cleandir
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.15 2009/01/11 14:40:26 tg Exp $
d8 1
@


1.15
log
@move the pxe_command_buf to lower memory (between bounce_buf and stack),
as it's a rather large yet non-static structure

this marks the point where pxeboot(8) can/will no longer be built
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.14 2008/08/01 15:43:45 tg Exp $
d5 5
a9 3
  SUBDIR+=	etc libsa
  SUBDIR+=	bootxx mbr
  SUBDIR+=	fdboot liveboot
d11 5
a15 1
  SUBDIR+=	boot installboot #pxeboot
@


1.14
log
@switch i386 bootloader to kern zlib
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.13 2008/08/01 11:24:57 tg Exp $
d9 1
a9 1
  SUBDIR+=	boot installboot pxeboot
@


1.13
log
@merge and reduce diff to obsd
XXX not yet tested
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.12 2007/02/26 02:11:32 tg Exp $
d5 1
a5 1
  SUBDIR+=	etc libsa libz
@


1.12
log
@switch to a newer, more compact, PBR as well
@
text
@d1 2
a2 2
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.11 2007/02/26 00:13:26 tg Exp $
# $OpenBSD: Makefile,v 1.12 2004/06/23 00:29:56 tom Exp $
d25 1
@


1.11
log
@re-order the MBR stuff and improve functionality and comments;
actually check for usability of LBA functions before using them
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.10 2006/07/23 23:41:27 tg Exp $
d6 2
a7 1
  SUBDIR+=	fdboot ldsec liveboot mbr
@


1.10
log
@rename ldsec to bootxx to match all other arches
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.9 2006/06/30 23:18:05 tg Exp $
d6 1
a6 1
  SUBDIR+=	fdboot ldsec liveboot mbrldr mbrmgr
@


1.9
log
@check MACHINE_ARCH not MACHINE for same-userland stuff
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.8 2006/05/15 20:47:05 tg Exp $
d16 1
a16 1
	${SUDO} /usr/mdec/installboot -vh2 -s18 /mnt/boot /usr/mdec/ldsec ${_i}
@


1.8
log
@save us almost 3 kB of code on the boot floppy
which won't ever be used as "no emulation" image
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.7 2006/04/10 19:10:50 tg Exp $
d4 1
a4 1
.if ${MACHINE} == "i386"
@


1.7
log
@fix hook stuff, enable liveboot
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.6 2006/04/06 11:07:30 tg Exp $
d5 2
a6 1
  SUBDIR+= etc ldsec libsa libz liveboot mbrldr mbrmgr
d8 1
a8 2
  SUBDIR+= boot installboot
  SUBDIR+= pxeboot
@


1.6
log
@rename ffspbr to ldsec - it's not UFS specific anyway,
it's just the loading sector with map (· la lilo)

also simplify
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.5 2005/12/04 17:50:20 tg Exp $
d5 1
a5 1
  SUBDIR+= etc ldsec libsa libz mbrldr mbrmgr
@


1.5
log
@make make include include under systrace
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.4 2005/04/29 18:34:57 tg Exp $
d5 1
a5 1
  SUBDIR+= etc libsa libz mbrldr mbrmgr pbr
d16 1
a16 2
	${SUDO} /usr/mdec/installboot -vh2 -s18 \
	    /mnt/boot /usr/mdec/ffspbr ${_i}
@


1.4
log
@(tentative) merge, more to come
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.3 2005/03/14 22:12:38 tg Exp $
d28 2
@


1.3
log
@move MBR loader and bootmanager here from sbin
doesn't belong there after all
@
text
@d1 2
a2 2
# $MirOS: src/sys/arch/i386/stand/Makefile,v 1.2 2005/03/06 21:27:02 tg Exp $
# $OpenBSD: Makefile,v 1.11 2004/03/19 13:48:18 tom Exp $
@


1.2
log
@* merge src/sys/
  (at least the better part of it)
* revert IPv6 networking to OpenBSD, since
  I didn't get IPV4_MAPPED addresses working :(
@
text
@d1 1
a1 1
# $MirOS$
d5 1
a5 1
  SUBDIR+= etc libsa libz pbr
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile,v 1.11 2004/03/19 13:48:18 tom Exp $
d5 1
a5 1
SUBDIR=	etc libsa libz mbr
d7 2
a8 1
SUBDIR+= biosboot installboot boot pxeboot
d10 17
a26 12
test-fd0:
	sudo mount /dev/fd0a /mnt
	sudo cp /usr/mdec/boot /mnt
	sudo /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot fd0
	sudo umount /mnt

zero-fd0:
	sudo dd if=/dev/zero of=/dev/rfd0a count=144 bs=10240

prep-fd0:
	sudo disklabel -rw fd0 floppy
	sudo newfs -O -m 0 -o space -i 3000 -c 80 /dev/rfd0a
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@improve my Frankenstein OS (*wink* you know who you are) further
sans wchar_t of course

this is the essence of reading >1200 commit messages which suck
due to not having the new format of ours...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2004/06/23 00:29:56 tom Exp $
d4 1
a4 1
SUBDIR=	etc libsa libz mbr cdbr
d6 1
a6 1
SUBDIR+= biosboot installboot boot pxeboot cdboot
@


1.1.1.3
log
@import bootloader-related pieces from openbsd, as first part of the
aspired 4.4 merge‚Ä¶ and something else
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2007/11/25 18:25:31 deraadt Exp $
d19 1
a19 1
	sudo newfs -O 0 -m 0 -o space -i 3000 -c 80 /dev/rfd0a
@


