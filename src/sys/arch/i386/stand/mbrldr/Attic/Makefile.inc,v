head	1.6;
access;
symbols
	MIRBSD_9_BASE:1.5
	MIRBSD_8:1.4.0.2
	MIRBSD_8_BASE:1.4;
locks; strict;
comment	@# @;


1.6
date	2007.02.26.00.13.28;	author tg;	state dead;
branches;
next	1.5;
commitid	10045E226230C5AAABC;

1.5
date	2006.06.15.18.25.16;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004491A61A59C31B19;

1.4
date	2005.10.20.12.47.53;	author tg;	state Exp;
branches;
next	1.3;
commitid	353f43579208719c;

1.3
date	2005.03.15.17.25.54;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.14.22.26.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.14.22.12.39;	author tg;	state Exp;
branches;
next	;


desc
@@


1.6
log
@re-order the MBR stuff and improve functionality and comments;
actually check for usability of LBA functions before using them
@
text
@# $MirOS: src/sys/arch/i386/stand/mbrldr/Makefile.inc,v 1.5 2006/06/15 18:25:16 tg Exp $

.ifndef MODSRC_SYS_ARCH_I386_STAND_MBRLDR_MAKEFILE_INC
MODSRC_SYS_ARCH_I386_STAND_MBRLDR_MAKEFILE_INC=1

SRCS+=		mbr.S
.PATH:		${.CURDIR}/../mbrldr

NOMAN?=		Yes
INSTALL_STRIP=	# set to empty value
LDFLAGS=	-nostdlib -Ttext 0 -N -x -Bstatic
INSTALL_BIN?=	Yes

CLEANFILES+=	mbrcode.h

all: mbrcode.h

mbrcode.h: ${PROG}
	print '/* $$Mir''OS$$ */\n/*-\n * Automatically' \
	    'generated, do not edit!\n * ${PROG} Version' \
	    '${V} for ${MACHINE}\n */' >$@@
	hexdump -ve '8/1 "0x%02X, " "\n"' ${.ALLSRC} >>$@@

.if defined(INSTALL_BIN)
${PROG}: ${OBJS} ${DPADD}
	${LD} ${LDFLAGS} -o ${PROG} ${OBJS} ${LDADD}
	@@size ${PROG}
	@@cp ${PROG} ${PROG}.elf
	objcopy -O binary ${PROG} ${PROG}.bin
.  if ${INSTALL_BIN:L} == "yes"
	@@cp ${PROG}.bin ${PROG}
	@@ls -l ${.OBJDIR}/${PROG}
.  endif

disasm: ${PROG}
	ndisasm -b 16 ${PROG}.bin >${.CURDIR}/disasm

CLEANFILES+=	${.CURDIR}/disasm ${PROG}.elf ${PROG}.bin
.endif

.if exists(../Makefile.inc)
.  include "../Makefile.inc"
.endif

.endif
@


1.5
log
@remove DEBUGPROGS remnants, that flag is long dead
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbrldr/Makefile.inc,v 1.4 2005/10/20 12:47:53 tg Exp $
@


1.4
log
@fix up DEBUGLIBS and DEBUGPROGS
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbrldr/Makefile.inc,v 1.3 2005/03/15 17:25:54 tg Exp $
a12 1
DEBUGPROGS=	No
@


1.3
log
@fix the RCS ID
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbrldr/Makefile.inc,v 1.2 2005/03/14 22:26:03 tg Exp $
d13 1
@


1.2
log
@fix mbr generation
fix structure packing issue (very machdep)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbrldr/Makefile.inc,v 1.1 2005/03/14 22:12:39 tg Exp $
d19 1
a19 1
	print '/* $$Mir''BSD$$ */\n/*-\n * Automatically' \
@


1.1
log
@move MBR loader and bootmanager here from sbin
doesn't belong there after all
@
text
@d1 1
a1 1
# $MirOS: src/sbin/bootsys/i386/mbrldr/Makefile.inc,v 1.1.7.1 2005/03/06 16:33:40 tg Exp $
d20 1
a20 1
	    'generated, do not edit!\n * mbrldr Version' \
d24 17
@

