head	1.27;
access;
symbols
	tg-use_ldscript:1.21.0.2
	tg-beforemerge-ksrc10:1.1.1.3
	cvs-200808011000:1.1.1.3
	MIRBSD_10:1.6.0.2
	MIRBSD_10_BASE:1.6
	MIRBSD_9_BASE:1.4
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507032030:1.1.1.2
	cvs-200505050030:1.1.1.2
	cvs-200504291700:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.27
date	2018.10.07.01.10.57;	author tg;	state Exp;
branches;
next	1.26;
commitid	1005BB95CA10BF418E8;

1.26
date	2018.04.28.02.14.35;	author tg;	state Exp;
branches;
next	1.25;
commitid	1005AE3D91A742324FF;

1.25
date	2015.10.09.15.03.21;	author tg;	state Exp;
branches;
next	1.24;
commitid	1005617D74B4E09587B;

1.24
date	2010.08.06.15.04.40;	author tg;	state Exp;
branches;
next	1.23;
commitid	1004C5C24940786B670;

1.23
date	2009.10.27.17.06.33;	author tg;	state Exp;
branches;
next	1.22;
commitid	1004AE728B17E1CC927;

1.22
date	2009.10.27.16.00.05;	author tg;	state Exp;
branches;
next	1.21;
commitid	1004AE718FF2242033D;

1.21
date	2009.10.27.13.54.27;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004AE6FB9F32247080;

1.20
date	2009.10.24.16.25.36;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004AE32A925943C1E1;

1.19
date	2009.08.09.20.18.20;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004A7F2E856560BF86;

1.18
date	2009.02.01.10.31.15;	author tg;	state Exp;
branches;
next	1.17;
commitid	100498579EA106BEEDE;

1.17
date	2009.01.20.21.30.58;	author tg;	state Exp;
branches;
next	1.16;
commitid	1004976429D05A67A43;

1.16
date	2009.01.20.21.11.27;	author tg;	state Exp;
branches;
next	1.15;
commitid	10049763E0E7BAFFE5D;

1.15
date	2009.01.10.13.41.17;	author tg;	state Exp;
branches;
next	1.14;
commitid	1004968A59443A02B58;

1.14
date	2009.01.02.16.18.20;	author tg;	state Exp;
branches;
next	1.13;
commitid	100495E3E645EC888FF;

1.13
date	2009.01.02.16.08.54;	author tg;	state Exp;
branches;
next	1.12;
commitid	100495E3C115F392CC6;

1.12
date	2009.01.02.02.58.29;	author tg;	state Exp;
branches;
next	1.11;
commitid	100495D82281166886E;

1.11
date	2009.01.02.02.44.26;	author tg;	state Exp;
branches;
next	1.10;
commitid	100495D7E981967E72B;

1.10
date	2009.01.02.01.42.07;	author tg;	state Exp;
branches;
next	1.9;
commitid	100495D70FE181F1D55;

1.9
date	2009.01.01.23.29.00;	author tg;	state Exp;
branches;
next	1.8;
commitid	100495D51D05535E102;

1.8
date	2008.12.28.20.43.24;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004957E4FE2868C881;

1.7
date	2008.08.01.11.24.58;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004892F2924667C00D;

1.6
date	2006.10.13.19.18.03;	author tg;	state Exp;
branches;
next	1.5;
commitid	100452FE67757921301;

1.5
date	2006.07.23.23.41.28;	author tg;	state Exp;
branches;
next	1.4;
commitid	10044C409313E5D0B2B;

1.4
date	2006.04.06.11.07.31;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004434F66517D09156;

1.3
date	2005.04.29.18.34.57;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.21.27.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.29.17.05.46;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2008.08.01.10.28.37;	author tg;	state Exp;
branches;
next	;
commitid	1004892E54805BE97AB;


desc
@@


1.27
log
@spelling cleanup: ‚Äúprogramme‚Äù is distinct from ‚Äúprogram‚Äù; even in
British English, the latter is used for computer programs, while
the former serves for things like the TV programme, or a programme
to plant trees
@
text
@.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.26 2018/04/28 02:14:35 tg Exp $
.\"-
.\" Copyright (c) 2009, 2010, 2015, 2018
.\"	mirabilos <m@@mirbsd.org>
.\"
.\" Provided that these terms and disclaimer and all copyright notices
.\" are retained or reproduced in an accompanying document, permission
.\" is granted to deal in this work without restriction, including un-
.\" limited rights to use, publicly perform, distribute, sell, modify,
.\" merge, give away, or sublicence.
.\"
.\" This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
.\" the utmost extent permitted by applicable law, neither express nor
.\" implied; without malicious intent or gross negligence. In no event
.\" may a licensor, author or contributor be held liable for indirect,
.\" direct, other damage, loss, or other issues arising in any way out
.\" of dealing in the work, even if advised of the possibility of such
.\" damage or existence of a defect, except proven that it results out
.\" of said person's immediate fault when using the work as intended.
.\"-
.Dd $Mdocdate: April 28 2018 $
.Dt BOOT 8 i386
.Os
.Sh NAME
.Nm boot ,
.Nm boot.cfg ,
.Nm ldbsd.com ,
.Nm pxeboot
.Nd
i386 second-stage boot loader
.Sh DESCRIPTION
The
.Nm
system program, often called
.Nm ldbsd.com ,
aims to load the system kernel into core memory from disc or network
and run it, as well as do some auxiliary functions, while dealing
with the problems arising from the history of the i386 architecture
since 1978, incompatibilities, extensions, bugs, El Torito booting,
Intel's Preboot Execution Environment (PXE) for network boot, the
Multiboot Specification, etc.
.Mx
floppies use a specially limited version optimised for size, lacking
support for any filesystem other than 4.2FFS and most commands.
.Pp
It can be loaded either directly from the BIOS (most commonly via
PXE; earlier versions could also be loaded using El Torito), the
.Nm bootxx
first stage boot loader (from floppy, hard disc, compact flash card,
USB stick, and the likes; recently, since
.Nm bootxx
itself was made El Torito capable, this has become the desired method
for El Torito boot), any bootloader compliant with the Multiboot
specification (as
.Nm
is a Multiboot compliant OS Kernel image), or after renaming to
.Nm ldbsd.com
by any bootloader implementing the COMBOOT API (specified by SYSLINUX,
EXTLINUX, ISOLINUX, PXELINUX) or MS-DOS\(rg (unless DOS occupies the HMA).
Once loaded, it can be used, in a more or less limited fashion, to boot a
.Mx
kernel from a supported filesystem (4.2FFS, ISO 9660, FAT12, FAT16, FAT28,
TFTP, NFS, and a pseudo filesystem called lmbmfs), inspect the filesystems,
get or set machine information, or
load other bootloaders (see below for details).
It can inflate
.Xr gzip 1
compressed files (with LZMA compression planned), set up serial console,
and provides an interactive prompt.
.Pp
Basic operation procedure is as follows:
.Pp
.Bl -enum
.It
Be loaded.
However this is done, as the first thing we write a RETF instruction
to 0000:0000 and CALL FAR it (from 16-bit code), or write a RET instruction
to 0x00000000 and CALL it (from 32-bit code), backing up the previous
content of course, so that qemu+gdb users can intercept via
.Dq b *0 .
.Pp
.Bl -tag -width Multiboot
.It BIOS
We are loaded to 0x07C00.
The drive used to load us from is passed in the DL register.
The ES:BX and DS:SI registers and the stack contain additional data.
While we do not care about the actual address, we expect to be whole.
.It Nm bootxx
We are loaded at the final address.
The drive used to load us from is passed in a special memory location.
The DS:SI registers are set up if we were loaded from a HDD partition.
The Master Boot Record
.Po Pa /usr/mdec/mbrldr No or Pa /usr/mdec/mbrmgr Pc
takes care to set these up correctly.
.It PXE
The NIC's PXE boot ROM initialises the NIC, network driver, UNDI and
PXE interfaces, contacts a DHCP server by broadcasting an IPv4 request on
the network, gets an IP address and the name of a file to load from the
DHCP server, and downloads the file indicated via TFTP to 0x07C00.
That would be
.Nm boot .
Control is then passed to address 0x07C00 with ES:BX and the stack set up.
.Pp
PXE booting is useful for
.Xr diskless 8
clients or initial download and execution of the installation kernel,
.Pa bsd.rd ,
or for rescue system purposes.
.It DOS
We are loaded to xxxx:0100h with no drive or PXE information set up.
The interrupt vectors are hooked by DOS, so if we overwrite any memory in
use by DOS, we lose.
That would be the case if xxxx is larger than our final address, any hooks
point to an address between our final address and 9000:0000h, the HMA is in
use (because that's where the kernel is loaded to), or somesuch.
This also implies we cannot chain any other bootloader.
Furthermore, we require the machine to be in Real Mode, not in VM86 mode,
so EMM386.SYS, Win32 or similar must not be active.
We ask DOS for the current drive to use this information later.
DOS has set up a PSP (Program Segment Prefix) for us, which may contain
a command line which we store away for later perusal if it is not empty.
.It COMBOOT
We are loaded in a similar way as from DOS, except the machine
state is not changed as much from the initial state.
After determining that we are in fact loaded via COMBOOT and not DOS,
we ask SYSLINUX to terminate after gathering information about the boot
drive, partition, or PXE; the UNDI and PXE stacks are kept active if any.
The COMBOOT API has set up a PSP like DOS as well, which we handle the same.
.It Multiboot
We request to be loaded to 0x00100000 (the HMA) due to GNU GRUB's
limitations, save the boot device off the MBI structure, copy ourselves
to the final location, and switch back to Real Mode.
Modules passed to us by the Multiboot compliant boot loader will be moved
off to just above 20 MiB in memory; their dirnames as well as any command
lines to the Multiboot modules are discarded.
If a command line is passed to the Multiboot OS kernel, i.e. this
bootloader, the pathname of the loader is skipped; it is then cut off
after a certain size limit (currently, 256 bytes) and stored away for
later use.
The modules are made available as regular files using the virtual lmbm
.Pq Loadable Multiboot Modules
device and filesystem (in-RAM file store, really).
.El
.Pp
During the initial operation, the stack is located about 80 KiB behind
the start of our own memory area, and switched to the final location if
the position in memory is known to be correct early.
.It
System information (boot drive, potential partition table entry,
PXENV+ and !PXE structure pointers, multiboot module information) are
stored in safe locations.
.It
The code is relocated to the final address once or twice if needed.
The final address is 4000:0000h with the stack beginning at 3000:FF7Ch.
The 128 bytes in between, from 3000:FF80h onwards, contains a potentially
stored away PSP command line, before it is moved to the buffer after the
bss and ssbss sections have been initialised (zeroed out).
The stack is shared between Real Mode and 32-bit Virtual Protected Address Mode.
The code is mostly organised using the small memory model, with everything
within 64 KiB (although the real limit is more than 256 bytes less than that
due to initial loading issues), except some rather large uninitialised areas
and the disc I/O bounce buffer, which begin at 3000:0000 and grow upwards,
nicknamed the ssbss section.
The heap begins after the bss section and grows up to just short of 9000:0000h.
.It
If the bootloader is compiled to do so, for example on a Live CD, it displays
a boot menu unless the shift key is pressed, and retains the numeric return
value for later, to replace the cfg suffix of the configuration file with it,
unless a (non-empty) command line is passed.
.It
The system is switched to Protected Mode.
.It
If a command line was passed, it is moved from its original (Multiboot, above
1 MiB or way below in the real mode area) or temporary (0x3FF80) location to
.Ic cmd_buf .
.It
The hardware is probed:
.Pp
.Bl -bullet -compact
.It
Console devices: the default BIOS console (INT 10h, which may be a
MDA/MGA/Hercules, CGA/EGA or VGA CRT/LCD, plus DIN or PS/2 or emulated
keyboard) as well as up to four serial ports (via the BIOS interface).
.It
Memory: ask the BIOS and probe page by page through the address space,
in case the BIOS reports wrong information.
.It
APM support
.It
PXE support
.It
Loadable Multiboot Modules (if any, they are moved off to safe locations
and the virtual lmbm device and lmbmfs are set up)
.It
Floppy disc drives
.It
Hard disc drives, including El Torito CD-ROM drives
.El
.It
If a command line was passed, it is executed.
If it contained a
.Nm boot
command, the kernel is attempted to be loaded; otherwise, or if it
fails, execution flow continues at the command prompt (see below)
with no timeout or auto-boot enabled.
.It
Unless a control key is held or a command line was passed, the files
.Pa /x.x.x.x/boot.cfg
if loaded via PXE
.Pq where x.x.x.x is our own IPv4 address
and
.Pa /boot.cfg ,
with
.Dq cfg
possibly replaced from the Live CD menu,
are read and executed as if the commands had been entered on the loader prompt.
.It
The bootloader prompt
.Pp
.Dl boot> _
.Pp
is issued, and a command line is read.
If no key is pressed within five seconds, the kernels
.Pa /bsd
and
.Pa /bsd.old
are tried, in order, to be booted with the current parameters; if
unsuccessful or any key is pressed, the timeout is disabled (it can
be manipulated from the configuration file or command line).
The system will be unable to boot if no suitable kernel image is found.
.El
.Pp
Commands from the configuration file and the loader prompt are read
line by line and executed as read.
Empty lines and lines beginning with the comment character,
.Sq \&# ,
are ignored when reading from the configuration file.
Just entering an empty line at the loader prompt, however, will do
the default action of booting a kernel with the current parameters.
To pass multiple commands on a line, use the U+0060 character,
.Sq \&\` ,
as delimiter.
To pass multiple commands into a macro definition, use the tilde,
.Sq \*(TI ,
as delimiter.
Leading and trailing whitespace is ignored.
.Sh COMMANDS
The following commands are accepted at the loader prompt:
.Bl -tag -width reboot
.It Cm boot Op Ar image Op Fl acds
Boots the kernel image specified by
.Ar image
with any options given.
If the
.Ar image
file specification, or one of its
.Ar device
or
.Ar filename
parts (see below) is omitted, values from variables will be used.
.Bl -tag -width XaX
.It Fl a
Causes the kernel to ask for the root filesystem to use.
.It Fl c
Causes the kernel to go into
.Xr UKC 8
before performing
.Xr autoconf 4 .
.It Fl D
Skips loading debugging symbols from the disc.
.It Fl d
Causes the kernel to drop into
.Xr ddb 4
at the earliest convenient point.
.It Fl s
Attempts to boot into single-user mode.
.El
.It Cm cat Ar image
Displays the file onto the console.
Output is paginated every 24 lines.
.It Cm echo
Displays the arguments onto the console.
.It Cm env
On i386, this command is not used.
.It Cm help
Prints a list of available commands.
.It Cm ls Op Ar dirspec
Prints the content of the specified directory in long format.
Output is paginated every 24 lines.
.Pp
The cd9660, tftp and nfs filesystems do not support this command.
They will either always fail or always succeed with sane but unusable results.
The FAT12, FAT16 and FAT28 filesystems have hardcoded perms and uid/gid.
.It Cm machine Op Ar command
Issues machine-specific commands:
.Bl -tag -width diskinfo
.It Cm boot Ar dev
Load a bootsector (MBR or PBR) from the indicated device and boot it.
Possible devices are fd0 (floppy boot), hd0 (MBR), hd0a, hd0b, hd0c,
hd0d (PBR), and some more useless combinations.
.It Cm diskinfo
Display a list of probed floppy and hard disc drives including BIOS
and geometry information.
.It Cm exec dos
Execute INT 21h, AH=4Ch, to return to DOS or SYSLINUX, if possible.
This will not always work and may hang your system.
.It Cm exec Ar type image
Load a bootsector or other bootloader from an
.Ar image
file and execute it.
Currently known values for
.Ar type :
.Bl -tag -width sector
.It Cm grub
GNU GRUB 0.9x
.Pa stage2
file
.br
GNU GRUB 0.9x
.Pa stage2_eltorito
file
.br
GNU GRUB2
.Pa core.img
file
.It Cm sector
Boot sector or image, loaded to 0000:7C00h
.br
.Mx
.Nm
second-stage loader
.El
.It Cm label Op Ar device
Displays the idea
.Nm
has about the disklabel of the currently active or the specified
.Ar device .
.It Cm memory Op Ar arg
If used without any arguments, print the current idea
.Nm
has about the memory configuration taken from BIOS or probed.
Arguments having the form of
.Pp
.Dl [+\-]<size>@@<address>
.Pp
add (+) or exempt (\-) the specified amount of memory.
Both size and base address can be specified in decimal, octal or
hexadecimal, using standard C prefixes.
.Pp
Memory segments are not required to be adjacent to each other;
the only requirement is that there is real physical memory under
the range added.
The following example adds 32 MiB of memory right after the first 16 MiB:
.Bd -unfilled -offset indent
boot> machine mem +0x2000000@@0x01000000
.Ed
.Pp
Another useful command is to withdraw a range of memory from OS usage, which
may have been wrongfully reported as useful by the BIOS.
This example excludes the 15\(en16 MiB range from the map of useful memory:
.Bd -unfilled -offset indent
boot> machine mem \-0x100000@@0x00F00000
.Ed
.It Cm oldbios
Enable or disable the so-called
.Dq Old BIOS / Soekris helper ,
which restricts
.Nm
from loading more than one sector at a time from disc.
.It Cm pxe
Forcibly scan for a PXE boot ROM.
.It Cm regs
Debugging command displaying register dumps.
.El
.It Cm macro
Displays the names of all currently defined macros.
Up to four can be defined, holding up to 256 characters.
.It Cm macro Ar name Op Ar cmd
Deletes the macro
.Ar name ,
or defines it to
.Ar cmd .
.It Cm reboot
Initiates a warm machine reboot.
.It Cm set Op Ar name Op Ar value
If invoked without arguments, prints a list of variables and their values.
If only a
.Ar name
is given, the value of that variable is displayed.
Otherwise, the variable is set to the new
.Ar value .
The following variables are defined:
.Bl -tag -width timeout
.It Cm addr
Address at which to load the kernel
.It Cm debug
Debug flag
.It Cm device
Boot device name (see below)
.It Cm doboot
.Dq 0
disables automatic boot on entering an empty line
.It Cm howto
Options passed to the loaded kernel, see
.Cm boot
.It Cm image
File name containing the kernel
.Ar image
.It Cm timeout
Number of seconds to wait for human intervention before auto-booting
.It Cm tty
Name of the active console device, for example:
.Bl -bullet -compact
.It
com0
.It
com1
.It
pc0
.El
.El
.It Cm stty Op Ar device Op Ar speed
Displays or sets the
.Ar speed
for a console
.Ar device .
If the baudrate for the currently active console device is changed,
.Nm
offers you five seconds of grace period to switch your terminal to match.
If the baudrate for an inactive device is changed, it will only become
active on the
.Em next
switch to a serial console device; it is not used on the PC CRT console.
.Pp
The default baudrate is 9600 bps.
.Nm
uses eight data bits, no parity, one stop bit.
.It Cm time
Displays the system date and time.
.El
.Sh IMAGE SPECIFICATIONS
An image specification consists of two parts, the device name and
a pathname, separated by a colon
.Pq So : Sc .
In most circumstances, both can be omitted, and pathnames do not
need to begin with a leading slash even if they are absolute.
Note that, for some filesystems, you are limited to an 8.3 character
naming scheme with case insensitive (mapped to lowercase) filenames.
Other filesystems may not provide directory listing information or
the ability to stat files (especially remote filesystems).
.Pp
Examples of valid image specifications are:
.Bl -bullet -compact
.It
fd0a:/bsd
.It
hd0o:/bsd.rd
.It
/
.Pq for Dq Cm ls
.It
hd0a:/
.Pq for Dq Cm ls
.It
lmbm:/
.Pq for Dq Cm ls
.It
cd0a:/boot/grub/stage2
.It
tftp:/bsd.rd.i386
.It
lmbm:/bsd4grml
.It
/bsd
.El
.Pp
Disklabels are read from hard discs (BIOS drive >= 80h) by searching
for a primary
.Mx
partition first.
The default partition type, 0x27, can be changed at
.Xr installboot 8
time, where it is hardcoded into the partition boot record.
If no suitable MBR partition was found or we're on a floppy, the
disklabel is searched at the beginning of the drive instead.
The label offset for the i386 architecture is one 512-byte sector.
On
.Mx
.Tn DuaLive
CDs, it may be embedded in the first-stage sparc bootloader.
If no disklabel can be read from the disc, one is faked.
The device size
.Pq So c Sc slice
defaults to the size of an 1440 KiB floppy disc, but if any MBR primary
partitions are found which span more space, their values are used instead.
The
.Sq d ,
.Sq e ,
.Sq f
and
.Sq g
slices are filled with the four MBR primary partitions, if any.
The
.Sq a
slice is filled, in this order, with: the partition passed via DS:SI
if plausible, the first non-empty MBR partition
.Po \*(sLd\*(sR-\*(sLg\*(sR slices Pc ,
the whole disc
.Po So c Sc slice Pc .
.Sh FILES
.Bl -tag -compact -width /tftpboot/boot.cfg
.It Pa /usr/mdec/bootxx
first stage bootloader (PBR)
.It Pa /usr/mdec/boot
second stage bootloader
.It Pa /usr/mdec/mbrldr
hard disc MBR, simple version
.It Pa /usr/mdec/mbrmgr
MBR, bootmanager version
.It Pa /boot
usual location of installed loader
.It Pa ldbsd.com
alternative name for
.Nm
.It Pa /boot.cfg
.Nm
configuration file
.It Pa /bsd
standard kernel image
.It Pa /bsd.rd
kernel image for installation/recovery
.It Pa /bsd.old
alternative kernel image
.It Pa /etc/dhcpd.conf
.Xr dhcpd 8
configuration file
.It Pa /tftpboot/boot
standard location of
.Nm
for netboot
.It Pa /tftpboot/boot.cfg
common/shared
.Nm
configuration file on the TFTP server;
.Pa /tftpboot/10.11.12.13/boot.cfg
contains peer-specific configuration to be used instead
.It Pa /tftpboot/bsd
kernel image
.It Pa /tftpboot/pxeboot
deprecated, no longer in use
.El
.Sh EXAMPLES
A sample configuration file for
.Xr dhcpd 8
is already contained with
.Mx
and might look as follows:
.Bd -literal -offset indent
shared\-network KICKSTART {
	subnet 172.23.42.0 netmask 255.255.255.0 {
		option routers 172.23.42.1;
		filename "boot";
		range 172.23.42.10 172.23.42.199;
	}
}
.Ed
.Pp
Boot the default kernel:
.Pp
.Dl boot> boot
.Pp
Remove the 5 second pause at boot-time permanently, causing
.Nm
to load the kernel immediately without prompting:
.Pp
.Dl # echo \&"boot\&" >/boot.cfg
.Pp
Remove the 5 second pause at boot-time permanently, causing
.Nm
to do nothing automatically:
.Pp
.Dl # echo \&"set timeout 0\&" >/boot.cfg
.Pp
Use serial console.
A null modem cable should connect the specified serial port to a terminal.
Useful for debugging.
.Pp
.Dl boot> set tty com0
.Pp
Invoke the serial console at every boot:
.Pp
.Dl # echo \&"set tty com0\&" >/boot.cfg
.Pp
Multiple commands on one line are useful for machines whose serial
console is unusable from within the boot loader, but the only way
to talk to the kernel, e.g. for installation on a Soekris/WRAP:
.Pp
.Bd -literal -offset indent
boot> stty com0 38400 \` set tty com0 \` boot /bsd.rd
.Ed
.Pp
Boot the kernel named
.Pa /bsd
from the second hard disc in
.Dq User Kernel Configuration
mode (see
.Xr boot_config 8 ) .
This mechanism allows for the explicit enabling and disabling of devices
during the current boot sequence, as well as the modification
of device parameters.
Once booted, such changes can be made permanent by using
.Xr config 8 Ns 's
.Fl e
option.
.Pp
.Dl boot> boot hd1a:/bsd \-c
.Sh SEE ALSO
.Xr gzip 1 ,
.Xr compress 3 ,
.Xr autoconf 4 ,
.Xr ddb 4 ,
.Xr dhcpd.conf 5 ,
.Xr boot_config 8 ,
.Xr boot_i386 8 ,
.Xr dhcpd 8 ,
.Xr diskless 8 ,
.Xr fdisk 8 ,
.Xr httpd 8 ,
.Xr inetd 8 ,
.Xr installboot 8 ,
.Xr reboot 8 ,
.Xr tftpd 8
.Rs
.%T Preboot Execution Environment (PXE) Specification
.%N Version 2.1
.%D September 20, 1999
.%A Intel Corporation
.Re
.Rs
.%T Multiboot Specification
.%N Version 0.6.93
.%A Free Software Foundation, Inc.
.Re
.Sh HISTORY
.An -nosplit
This bootloader is based on code written by
.An Michael Shalayeff
for
.Ox 2.1 .
The separate
.Nm pxeboot
command first appeared in
.Ox 3.5 ,
based upon work from
.Nx .
In
.Ox
and
.Mx 7
and below, the
.Pa boot.cfg
file was called
.Pa boot.conf ,
it has been renamed for ISO 9660 and FAT compatibility.
A version called
.Nm cdboot
appeared in
.Mx 8
and went away for
.Mx 10 .
The separate versions got merged into one bootloader,
DOS, COMBOOT, Multiboot support (including modules), pagination, macros, the
.Cm machine exec
and
.Cm cat
commands, working chainbooting of bootsectors and GNU GRUB,
faked disklabels (if none exist on disc), FAT filesystem support,
and many more things were added or rewritten for
.Mx 11
and MirOS bsd4grml by
.An Thorsten Glaser .
.Sh CAVEATS
The default location of the kernels and the
.Pa boot.cfg
file can be changed at compile time.
.Ss FILESYSTEM SPECIFIC NOTES
.Bl -tag -width tftpxxnfs
.It ISO 9660
Filesystems above 4 GiB in size definitively do not work.
We do not know at this time if there is a 2 GiB or 4 GiB limit,
nor if this affects any other filesystems.
.Pp
The
.Cm ls
command does not work.
.It lmbmfs
This filesystem and device will only appear if loaded via a Multiboot
compliant boot loader, masquerading as Multiboot compliant OS kernel,
and when modules are passed.
.Cm ls
is possible only on the root directory
.Po Do / Dc , Do /. Dc Pc .
Files keep the names passed by the Multiboot boot loader, but have the
directory part stripped, and can be accessed with any directory leading.
If they have no names, they are given an enumerated hex number as name.
.It tftp, nfs
These filesystems and devices will only appear of loaded via PXE.
They obviously do not support
.Cm ls .
.It http
There are plans to support this if
.Nm pxebsd.0
is loaded from gPXE, but no code yet.
For now, gPXE can load
.Nm
using Multiboot, and any passed modules are handled via lmbmfs.
.It ustarfs
This filesystem is currently only usable with the boot floppy
and assumes that the entire floppy disc (except, on sparc, the
MD disklabel) is a valid ustar archive.
.El
@


1.26
log
@i386 and documentation part for -D argument to boot
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.25 2015/10/09 15:03:21 tg Exp $
d21 1
a21 1
.Dd $Mdocdate: October 9 2015 $
d34 1
a34 1
system programme, often called
@


1.25
log
@fix authors breaking (.An -nosplit)
@
text
@d1 1
a1 1
.\" $MirOS: src/share/misc/licence.template,v 1.28 2008/11/14 15:33:44 tg Rel $
d3 1
a3 1
.\" Copyright (c) 2009, 2010, 2015
d21 1
a21 1
.Dd $Mdocdate: October 27 2009 $
d269 2
@


1.24
log
@ustarfs *was* already implemented. (need more details for TFM tho‚Ä¶)
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.23 2009/10/27 17:06:33 tg Exp $
d3 2
a4 2
.\" Copyright (c) 2009, 2010
.\"	Thorsten Glaser <tg@@mirbsd.org>
d643 1
@


1.23
log
@sort
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.22 2009/10/27 16:00:05 tg Exp $
d3 1
a3 1
.\" Copyright (c) 2009
d715 3
a717 1
This filesystem will be implemented soon.
@


1.22
log
@set the breakpoint at 0000:0000h (16-bit) or 0x00000000 (32-bit), with
a RETF (16-bit) or RET (32-bit) but backing up the old content

tested
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.21 2009/10/27 13:54:27 tg Exp $
a361 2
.It Cm regs
Debugging command displaying register dumps.
d370 2
@


1.21
log
@new command "machine pxe", although I somehow don't think it helps much‚Ä¶
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.20 2009/10/24 16:25:36 tg Exp $
d21 1
a21 1
.Dd $Mdocdate: October 24 2009 $
d76 5
@


1.20
log
@sync and fix formatting bugs
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.19 2009/08/09 20:18:20 tg Exp $
d21 1
a21 1
.Dd $Mdocdate: August 9 2009 $
d365 2
@


1.19
log
@sync with reality:
‚Ä¢ IDT is pre-fixup‚Äôd
‚Ä¢ lmbmfs and the lmbm pseudo-device
‚Ä¢ document the tftp and nfs pseudo-devices a little, too
‚Ä¢ document which filesystems don‚Äôt do ‚Äúls‚Äù
‚Ä¢ document the (confirmed) 4 GiB limit on cd9660, and that we don‚Äôt
  know if it‚Äôs a 2 GiB or 4 GiB limit, nor which filesystems it affects
‚Ä¢ mention ustarfs (in planning) and LZMA decompression (similar)
‚Ä¢ flesh out a little more
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.18 2009/02/01 10:31:15 tg Exp $
d21 1
a21 1
.Dd $Mdocdate: February 1 2009 $
d115 2
d123 1
d130 5
a134 2
lines (to the Multiboot OS kernel, i.e. this bootloader, as well as to the
Multiboot modules) are discarded.
d149 4
a152 1
The final address is 4000:0000h with the stack beginning at 3000:FFFCh.
d157 2
a158 1
and the disc I/O bounce buffer, which begin at 3000:0000 and grow upwards.
d163 2
a164 1
value for later, to replace the cfg suffix of the configuration file with it.
d168 4
d195 8
a202 1
Unless a control key is held, the files
d245 1
a245 1
.It boot Op Ar image Op Fl acds
d271 1
a271 1
.It cat Ar image
d274 1
a274 1
.It echo
d276 1
a276 1
.It env
d278 1
a278 1
.It help
d280 1
a280 1
.It ls Op Ar dirspec
d287 1
a287 1
.It machine Op Ar command
d290 1
a290 1
.It Nm boot Ar dev
d294 1
a294 1
.It Nm diskinfo
d297 4
a300 1
.It Nm exec Ar type image
d326 1
a326 1
.It Nm label Op Ar device
d331 1
a331 1
.It Nm memory Op Ar arg
d357 1
a357 1
.It regs
d359 1
a359 1
.It oldbios
d366 1
a366 1
.It macro
d369 1
a369 1
.It macro Ar name Op Ar cmd
d374 1
a374 1
.It reboot
d376 1
a376 1
.It set Op Ar name Op Ar value
d385 1
a385 1
.It addr
d387 1
a387 1
.It debug
d389 1
a389 1
.It device
d391 1
a391 1
.It doboot
d394 1
a394 1
.It howto
d397 1
a397 1
.It image
d400 1
a400 1
.It timeout
d402 1
a402 1
.It tty
d413 1
a413 1
.It stty Op Ar device Op Ar speed
d429 1
a429 1
.It time
d700 7
@


1.18
log
@allow the user to change the default location of boot.cfg etc.
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.17 2009/01/20 21:30:58 tg Exp $
d21 1
a21 1
.Dd $Mdocdate: January 20 2009 $
d40 2
a41 1
Intel's Preboot Execution Environment (PXE) for network boot, etc.
d63 2
a64 1
TFTP, NFS), inspect the filesystems, get or set machine information, or
d68 2
a69 1
compressed files, set up serial console, and provides an interactive prompt.
d125 7
d139 2
a140 1
PXENV+ and !PXE structure pointers) are stored in safe locations.
a154 2
The IDT for the Protected Mode is set up.
.It
d171 7
d182 1
d185 4
a188 2
.Pa /boot.cfg
.Pq with cfg possibly replaced from the menu
d264 1
a264 1
The FAT12, FAt16 and FAT28 filesystems have hardcoded perms and uid/gid.
d428 6
d435 6
d605 5
d637 1
a637 1
DOS, COMBOOT, Multiboot support, pagination, macros, the
d645 1
a645 1
and grml by
d651 27
@


1.17
log
@‚Ä¢ more verbosity
‚Ä¢ mention MBR
‚Ä¢ fix UTF-8 abuse
@
text
@d1 1
a1 1
.\" $MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.16 2009/01/20 21:11:27 tg Exp $
d611 4
@


1.16
log
@WTF we have a manpage!
@
text
@d1 1
a1 1
.\" $MirOS: src/share/misc/licence.template,v 1.28 2008/11/14 15:33:44 tg Rel $
d21 1
a21 1
.Dd $Mdocdate$
d84 3
d107 1
a107 1
use (because that‚Äôs where the kernel is loaded to), or somesuch.
d419 1
a419 1
If no suitable MBR partition was found or we're talking floppy, the
d422 4
d427 4
a430 6
The device size defaults to the size of an 1440 KiB floppy disc,
but if any MBR primary partitions are found which span more space,
these values are used instead.
The
.Sq c
slice is filled appropriately.
d441 4
a444 1
if plausible, the first non-empty MBR partition, the whole disc.
d451 4
@


1.15
log
@new memory layout, part 1
@
text
@d1 4
a4 2
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.14 2009/01/02 16:18:20 tg Exp $
.\"	$OpenBSD: boot.8,v 1.47 2007/05/31 19:20:03 jmc Exp $
d6 5
a10 3
.\" Copyright (c) 2002-2009 Thorsten Glaser
.\" Copyright (c) 1997-2001 Michael Shalayeff
.\" All rights reserved.
d12 10
a21 23
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR OR HIS RELATIVES BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF MIND, USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
.\" THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\"
.Dd $Mdocdate: January 2 2009 $
d26 3
a28 1
.Nm boot.cfg
d30 1
a30 1
i386-specific second-stage bootstrap
d32 35
a66 11
The main purpose of this program is to load the system kernel while dealing
with the downfalls of the PC BIOS architecture, as well as with problems
arising during an El Torito boot from a CD-ROM drive on broken hardware.
.Pp
By renaming it to
.Pa boot.com
and placing on a FAT filesystem, it can be called directly from the DOS
operating system (if running without a virtual memory manager such as
EMM386.SYS or Windows\(rg 386, 3.x, 9x) or from SYSLINUX (and ISOLINUX,
PXELINUX, EXTLINUX) as a module.
This provides a convenient way to load the kernel.
d68 1
a68 2
.Nm
is also a Multiboot compliant OS Image.
d70 3
a72 19
As described in
.Xr boot_i386 8 ,
this program is loaded by the
.Xr bootxx 8
primary bootstrap loader if loaded from a floppy, hard disc or CD drive.
This programme acts as an enhanced boot monitor for PC systems, providing
a common interface for the kernel to start from.
.Pp
To boot from an ISO 9660 filesystem via El Torito, set the mode to
.Dq 0 - No Emulation
and use the
.Fl B Ar 11
option to
.Pa bootxx.sh
to install the primary bootloader into the boot image sector, whose
size must be exactly 2048 bytes; use
.Xr getextent_cd9660 1
to determine where to binary-patch the filesystem image.
The load address is \fB0x07C0:0x0000\fR.
d74 46
a119 1
Basic operations include:
d121 19
a139 1
.Bl -bullet -compact
d141 1
a141 1
Detecting and switching between multiple consoles.
d143 1
a143 1
Loading kernels from any device supported by your system BIOS.
d145 3
a147 2
Loading kernels compressed by
.Xr gzip 1 .
d149 3
a151 1
Passing system parameters queried from the BIOS to the kernel.
d153 2
a154 15
Providing an interactive command line.
.El
.Pp
The sequence of its operation is as follows: initialisation,
parsing the configuration file, then an interactive command line.
While at the command line you have 5 seconds to type any commands, if needed.
If time expires, the kernel will be loaded according to
the current variable settings (see the
.Nm set
command).
Each time a kernel load fails, the timeout is increased by one second.
The sequence of
.Nm
operations is as follows:
.Bl -enum
d156 1
a156 36
If called from SYSLINUX, detect which hard disc and partition, if any,
we were loaded from, disable any El Torito FDD/HDD emulation, restore
text mode and undo all changes SYSLINUX did to the machine state.
If called from Multiboot, get the BIOS drive number and switch to a
Real Mode environment.
If called from MS-DOS\(rg, set the BIOS drive number to 0x80.
Calling directly from El Torito is no longer supported, use
.Nm bootxx.sh .
If called from
.Nm bootxx ,
save the BIOS drive number (but not, yet, the partition info).
.It
Relocate ourselves to \fB0x4000:0x0000\fR.
Probe the BIOS boot drive for El Torito (No Emulation) extensions, and
do another few checks and preparations in Real Mode.
Optionally, display a menu included at compile time.
.It
Set up a protected mode environment which catches and reports processor
exceptions and provides a simple protected-mode BIOS interface.
.It
Probe for console devices, which includes the (default) PC VGA+Keyboard
console
.Pq Li pc0
and up to four serial consoles
.Pf ( Li com0
through
.Li com3 )
connected to the serial ports.
Display messages to the default console about the devices found.
.It
Detect memory.
Conventional memory is detected by querying the BIOS.
Extended memory is detected by probing page-by-page through the address
space, rather than asking the BIOS; many BIOS's cannot report larger than
64M of memory.
All memory found is reported to the default console device.
d158 2
a159 2
Probe for APM support in the BIOS.
Display a message if support is present.
d161 4
a164 1
If the file
d166 2
a167 12
exists on the filesystem
.Nm
was loaded from, open and parse it.
This file may contain any commands
.Nm
accepts at the interactive prompt.
Though default settings usually suffice, they can be changed here.
.Pp
.Pa boot.cfg
processing can be skipped by holding down either Control key as
.Nm
starts.
d169 1
a169 1
The header line
d171 1
a171 2
.Dl >> MirBSD boot mmnn
.Dl booting from device 80h = hd0a
d173 9
a181 19
is displayed to the active console, where
.Ar x.xx
is the version number of the
.Nm
program and
.Ar 80h
is the BIOS idea of the drive
.Nm
was booted from, followed by the
.Pp
.Dl boot>
.Pp
prompt, which means you are in interactive mode and may enter commands.
There may be machine-specific output in between the greeting
message and the boot prompt.
If you do not,
.Nm
will proceed to load the kernel with the current parameters after the
timeout period has expired.
d184 14
a197 6
By default,
.Nm
attempts to load the kernel executable
.Pa /bsd .
If it fails to find the kernel and no alternative kernel image has
been specified, the system will be unable to boot.
d199 2
a200 4
The following commands are accepted at the
.Nm
prompt:
.Bl -tag -width shorten
d205 3
a207 8
Image specification consists of a pair
.Ar device : Ns Ar filename ;
either or both can be omitted (`:' is not needed if both are omitted),
in which case values from
.Nm
variables will be used.
.Pp
When selecting the
d209 4
a212 15
to boot from,
.Nm
makes no distinction between SCSI and IDE type drives;
they are detected as
.Sq hd
devices.
Therefore, to boot kernel
.Pa /bsd
from slice
.Sq a
on the first hard drive
.Pq irrespective of device type ,
specify
.Dq boot hd0a:/bsd .
.Bl -tag -width _a_
d214 1
a214 3
Causes the kernel to ask for the
.Nm root
device to use.
d217 1
a217 1
.Xr boot_config 8
d219 1
a219 2
.Xr autoconf 4
procedures.
d225 1
a225 1
Causes the kernel to boot single-user.
d227 7
a233 7
.It cat Ar file
Displays the file argument loaded from the currently active
filesystem or the one given, if any.
.It echo Op Ar args
Displays
.Ar args
on the console device.
d235 8
a242 2
Prints a list of available commands and machine dependent
commands, if any.
d244 1
a244 2
Issues machine-dependent commands.
These are defined for i386 architecture:
d246 4
d251 8
a258 8
Prints a list of hard disks installed on your system including:
BIOS device number, and the BIOS geometry.
.It Nm exec
Load a bootsector or supported other bootloader and execute it.
Note: MS-DOS\(rg 7.10 bootsectors currently do not work, somehow
the machine state deviates from the initial one in an incompatible way.
.Pp
Possible types are, at the moment:
d279 16
a294 20
.It Nm label
Displays the disklabel read from the disc or faked for the
currently active device, or the device given.
.It Nm memory
If used without any arguments, this command will print out
the memory configuration as determined through BIOS routines.
Otherwise the arguments specify how to modify the
memory configuration.
They take the form of:
.Pp
.Dl [+-]<size>@@<address>
.Pp
Meaning to add(+) or exempt(-) the amount of memory specified by
.Ar <size>
at the location specified by
.Ar <address> .
Both size and base address can be specified as octal,
decimal, or hexadecimal numbers, as accepted by the
.Xr strtoul 3
routine.
d299 1
a299 2
The following example
adds 32M of memory right after the first 16M:
d301 1
a301 1
machine mem +0x2000000@@0x1000000
d304 3
a306 5
Another useful command is to withdraw a range
of memory from OS usage (it may have been wrongfully reported as
useful by the BIOS).
This example
effectively excludes the 15\(en16M range from the map of useful memory:
d308 1
a308 1
machine mem -0x100000@@0xf00000
d310 4
a313 2
.It Nm oldbios
Turns on the so-called
d317 10
a326 10
from requesting more than one sector a time.
.It Nm regs
Prints contents of processor registers if compiled with
.Em DEBUG .
.El
.It ls Op Ar directory
Prints contents of the specified
.Ar directory
in long format including: attributes and file type, owner, group,
size, filename.
d328 2
a329 2
Reboots the machine by initiating a warm boot procedure.
.It set Op Ar varname Op Ar value
d331 34
a364 33
If only
.Ar varname
is specified, displays contents of that variable.
If
.Ar varname
and
.Ar value
are both specified, sets that variable to the given value.
Variables include:
.Pp
.Bl -tag -compact -width boothow
.It Nm addr
Address at which to load the kernel.
.It Nm debug
Debug flag if
.Nm
was compiled with DEBUG defined.
.It Nm device
Boot device name (e.g.,
.Li fd0a ,
.Li hd0a ) .
.It Nm howto
Options to pass to the loaded kernel.
.It Nm image
File name containing the kernel image.
.It Nm timeout
Number of seconds boot will wait for human intervention before
booting the default kernel image.
.It Nm tty
Active console device name (e.g.,
.Li com0 ,
.Li com1 ,
.Li pc0 ) .
d371 1
a371 1
If changing the baudrate for the currently active console,
d373 3
a375 5
offers you five seconds of grace time before committing the change
to allow you to change your terminal's speed to match.
If changing speed
.Em not
for the active console, the baudrate is set for the
d377 1
a377 4
time you switch to a serial console.
The baudrate value is not used for the
.Li pc0
console.
d379 3
a381 1
The default baudrate is 9600bps.
d383 24
a406 1
Displays system time and date.
d408 29
d438 1
a438 1
.Bl -tag -width /usr/mdec/biosbootxx -compact
d440 3
a442 3
first stage bootstrap
.It Pa /usr/mdec/pxeboot
PXE bootstrap
d444 4
a447 1
system bootstrap
d449 2
a450 1
system bootstrap's startup file
d452 1
a452 1
kernel image
d455 19
d476 15
d499 7
a505 1
.Dl # echo \&"boot\&" > /boot.cfg
d517 3
a519 6
You can place multiple commands in one line with the
.Sq \`
character.
Most prominent use would be on machines whose serial console
is unusable from within the boot loader, but the only way to
talk to the kernel, e.g. for installation on a WRAP:
d521 3
a523 1
.Dl boot> set tty com0 \` boot /bsd.rd
d527 1
a527 1
from the second hard disk in
d539 1
a539 28
.Dl boot> boot hd1a:/bsd -c
.Pp
Attention: the ISO 9660 and FAT filesystem interfaces support only
.Dq short
(i.e. MS-DOS like 8.3) file names.
.Pp
Supported filesystems are: 4.2FFS, ISO 9660, FAT12, FAT16, FAT28.
.Pp
If a disklabel cannot be read from a device, either via an MBR
partition (BIOS discs >= 0x80 only) or as Superfloppy (BIOS hard
discs only if no MBR partition can be found), one is faked.
The device size defaults to the size of an 1440 KiB floppy disc,
but if any MBR primary partitions are found which span more space,
these values are used instead.
The
.Sq c
slice is filled appropriately.
The
.Sq d ,
.Sq e ,
.Sq f
and
.Sq g
slices are filled with the four MBR primary partitions, if any.
The
.Sq a
slice is filled, in this order, with: the partition passed to
SYSLINUX in DS:SI, the first non-empty MBR partition, the whole disc.
d542 1
d545 1
a545 1
.\"Xr biosboot 8 ,
d548 2
d551 2
d554 8
a561 7
.Xr pxeboot 8 ,
.Xr reboot 8
.Pp
RFC 1950 describes the zlib library interface.
.Pp
The official home page for the version of zlib used in this
operating system is at http://www.gzip.org/zlib/.
d563 3
a565 1
This program was written by Michael Shalayeff for
d567 7
a573 5
The
.Nm cdboot
version appeared in
.Mx 8 .
Up to, and including,
d575 4
a578 4
(all versions) and
.Mx 7 ,
the
.Nm boot.cfg
d580 5
a584 3
.Nm boot.conf
instead.
The change for
d586 13
a598 5
was done to accommodate CD-ROM and MS-DOS based booting.
Starting with
.Mx 11 ,
FAT filesystems are supported, disklabels faked if none exist,
and SYSLINUX, Multiboot, machine exec support appeared.
@


1.14
log
@add more comments
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.13 2009/01/02 16:08:54 tg Exp $
d115 1
a115 1
Relocate ourselves to \fB0x4012:0x0000\fR.
@


1.13
log
@‚Ä¢ ‚Äúmachine exec sector foo‚Äù works on boot(8/i386) too
‚Ä¢ straighten out the docs a little
‚Ä¢ mention Multiboot
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.12 2009/01/02 02:58:29 tg Exp $
d4 1
d80 1
a80 4
Loading kernels from any device supported by your system BIOS,
including bootable CD-ROM drives if the
.Nm bootxx
first-stage boot loader is used by El Torito.
d103 17
@


1.12
log
@they do not might work, they do do work, grub-legacy just has its issues
with NetBSD¬Æ makefs(8)‚Ä¶ unless -o rockridge is not given *W*T*F*
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.11 2009/01/02 02:44:26 tg Exp $
d50 3
d57 1
a57 2
primary bootstrap loader if loaded from a floppy or hard disc drive.
If being loaded from CD, that action is taken directly by the BIOS.
d81 2
a82 2
.Nm
programme itself acts as a boot image.
d92 1
a92 1
The sequence of its operation is as follows: initialization,
d254 4
a260 4
.Pp
Note: the El Torito cases seem to be exactly the same except for
the part of the loader we skip because we read in the entire file
anyway, so these variants work as well.
d263 4
d506 1
a506 1
and SYSLINUX support appeared.
@


1.11
log
@document that, except for the first 512 bytes, stage2 and stage2_eltorito
do not differ (they just use INT13,4B01 to ask‚Ä¶ something we could do as
well later) and as such, should work too

I have bad luck though, neither with -cdrom nor with -hda does it work for
me, but because of this I think it just doesn‚Äôt do ISO 9660 for some rea-
son or the other. (Maybe it tries to parse the Sun disklabel? Nah, that
isn‚Äôt it either. WTF.)
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.10 2009/01/02 01:42:07 tg Exp $
d258 1
a258 1
anyway, so these variants might work as well.
@


1.10
log
@add ‚Äúmachine exec grub <file>‚Äù
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.9 2009/01/01 23:29:00 tg Exp $
d29 1
a29 1
.Dd $Mdocdate: January 1 2009 $
d250 1
a250 1
file (not El Torito)
d255 4
@


1.9
log
@new command: machine exec
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.8 2008/12/28 20:43:24 tg Exp $
d29 1
a29 1
.Dd $Mdocdate: December 28 2008 $
d244 14
@


1.8
log
@document all that new cool stuff
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.7 2008/08/01 11:24:58 tg Exp $
d29 1
a29 1
.Dd $Mdocdate: August 1 2008 $
d240 4
@


1.7
log
@merge and reduce diff to obsd
XXX not yet tested
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.6 2006/10/13 19:18:03 tg Exp $
d42 8
a55 2
It can also be started as if it were a native MS-DOS .COM executable.
This provides a convenient way to load the kernel.
d59 1
a59 4
The
.Nm
programme can be loaded by the BIOS directly from an ISO9660 filesystem.
The emulation mode must be set to
d61 8
a68 4
for this programme to work correctly.
Some hardware needs in addition to that a specification that only the
first sector (first four virtual sectors, 2048 Bytes) of the file are
to be loaded, because they cannot load more.
d143 2
a144 2
.Dl >> MirBSD boot x.xx
.Dl booting from device 80h
d223 3
d240 3
d389 9
d414 1
a414 1
Attention: the ISO 9660 filesystem interface supports only
d417 23
d475 4
@


1.6
log
@move /etc/boot.cfg and friends to /
agreed bsiegert@@
@
text
@d1 2
a2 2
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.5 2006/07/23 23:41:28 tg Exp $
.\"	$OpenBSD: boot.8,v 1.41 2005/02/18 15:26:23 robert Exp $
d29 1
a29 1
.Dd September 1, 1997
d128 5
d164 2
a165 7
If that fails, it will attempt to load
.Pa /obsd
and then
.Pa /bsd.old .
If it fails to find any of these files,
and no alternative kernel image has been specified,
the system will be unable to boot.
d231 1
a231 1
If used without any arguments this command will print out
d233 1
a233 1
Otherwise the arguments would specify the expressions to modify the
d235 1
a235 1
The expression would have a form of:
d239 1
a239 1
Meaning to add(+) or exempt(-) the specified by the
d241 3
a243 4
amount of memory at the location specified by the
.Ar <address>
argument.
Both size and base address could be specified as octal,
d247 2
a248 1
Memory segments are not required to be adjacent to each other,
d251 2
a252 1
For example:
d257 2
a258 3
would add 32M of memory right after the first 16M.
The other useful command would be to withdraw a range
of memory from OS usage (might be wrongfully reported as
d260 2
a264 2
.Pp
which effectively excludes 15-16M range from the map of useful memory.
d352 2
@


1.5
log
@rename ldsec to bootxx to match all other arches
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.4 2006/04/06 11:07:31 tg Exp $
d120 1
a120 1
.Pa /etc/boot.cfg
d348 1
a348 1
.It Pa /etc/boot.cfg
d362 1
a362 1
.Dl # echo \&"boot\&" > /etc/boot.cfg
d372 1
a372 1
.Dl # echo \&"set tty com0\&" > /etc/boot.cfg
@


1.4
log
@rename ffspbr to ldsec - it's not UFS specific anyway,
it's just the loading sector with map (· la lilo)

also simplify
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.3 2005/04/29 18:34:57 tg Exp $
d45 1
a45 1
.Xr ldsec 8
d342 1
a342 1
.It Pa /usr/mdec/ldsec
@


1.3
log
@(tentative) merge, more to come
@
text
@d1 1
a1 1
.\"	$MirOS: src/sys/arch/i386/stand/boot/boot.8,v 1.2 2005/03/06 21:27:03 tg Exp $
d45 1
a45 1
.Xr ffspbr 8
d342 1
a342 1
.It Pa /usr/mdec/ffspbr
@


1.2
log
@* merge src/sys/
  (at least the better part of it)
* revert IPv6 networking to OpenBSD, since
  I didn't get IPV4_MAPPED addresses working :(
@
text
@d1 2
a2 2
.\"	$MirOS$
.\"	$OpenBSD: boot.8,v 1.39 2004/04/03 10:15:37 jmc Exp $
a316 3
Currently, only the first serial port
.Pq Li com0
is supported for console on i386.
d408 1
a408 1
operating system is at http://quest.jpl.nasa.gov/zlib/.
@


1.1
log
@Initial revision
@
text
@d1 1
d34 1
a34 1
.Nm boot.conf
d39 2
a40 1
with the downfalls of the PC BIOS architecture.
d45 6
a50 3
.Xr biosboot 8
primary bootstrap loader and provides a convenient way to load the kernel.
This program acts as an enhanced boot monitor for PC systems, providing
d53 11
d70 4
a73 1
Loading kernels from any device supported by your system BIOS.
d120 1
a120 1
.Pa /etc/boot.conf
d131 2
a132 1
.Dl >> OpenBSD/i386 BOOT [x.xx]
d138 5
a142 1
program, followed by the
d147 2
d265 6
d345 1
a345 1
.It Pa /usr/mdec/biosboot
d351 1
a351 1
.It Pa /etc/boot.conf
d365 1
a365 1
.Dl # echo \&"boot\&" > /etc/boot.conf
d375 1
a375 1
.Dl # echo \&"set tty com0\&" > /etc/boot.conf
d392 4
d400 1
a400 1
.Xr biosboot 8 ,
d415 16
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@improve my Frankenstein OS (*wink* you know who you are) further
sans wchar_t of course

this is the essence of reading >1200 commit messages which suck
due to not having the new format of ours...
@
text
@d1 1
a1 1
.\"	$OpenBSD: boot.8,v 1.41 2005/02/18 15:26:23 robert Exp $
d285 3
d375 1
a375 1
operating system is at http://www.gzip.org/zlib/.
@


1.1.1.3
log
@import bootloader-related pieces from openbsd, as first part of the
aspired 4.4 merge‚Ä¶ and something else
@
text
@d1 1
a1 1
.\"	$OpenBSD: boot.8,v 1.47 2007/05/31 19:20:03 jmc Exp $
d28 1
a28 1
.Dd $Mdocdate: May 31 2007 $
a108 5
.Pp
.Pa boot.conf
processing can be skipped by holding down either Control key as
.Nm
starts.
d133 7
a139 2
If it fails to find the kernel and no alternative kernel image has
been specified, the system will be unable to boot.
d205 1
a205 1
If used without any arguments, this command will print out
d207 1
a207 1
Otherwise the arguments specify how to modify the
d209 1
a209 1
They take the form of:
d213 1
a213 1
Meaning to add(+) or exempt(-) the amount of memory specified by
d215 4
a218 3
at the location specified by
.Ar <address> .
Both size and base address can be specified as octal,
d222 1
a222 2
.Pp
Memory segments are not required to be adjacent to each other;
d225 1
a225 2
The following example
adds 32M of memory right after the first 16M:
d230 3
a232 2
Another useful command is to withdraw a range
of memory from OS usage (it may have been wrongfully reported as
a233 2
This example
effectively excludes the 15\(en16M range from the map of useful memory:
d237 2
a319 4
.It Pa /bsd.mp
kernel image for multiprocessor machines
.It Pa /bsd.rd
kernel image for installation/recovery
@


