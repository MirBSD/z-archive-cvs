head	1.35;
access;
symbols
	tg-use_ldscript:1.32.0.2
	tg-beforemerge-ksrc10:1.1.1.2
	cvs-200808011000:1.1.1.2
	MIRBSD_10:1.12.0.2
	MIRBSD_10_BASE:1.12
	MIRBSD_9_BASE:1.7
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507032030:1.1.1.1
	cvs-200505050030:1.1.1.1
	cvs-200504291700:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.35
date	2016.02.06.17.09.05;	author tg;	state Exp;
branches;
next	1.34;
commitid	10056B628C31FA73C0D;

1.34
date	2010.01.10.19.21.35;	author tg;	state Exp;
branches;
next	1.33;
commitid	1004B4A28CB0F23DD4D;

1.33
date	2009.12.26.15.09.00;	author tg;	state Exp;
branches;
next	1.32;
commitid	1004B3626F70ADEB9B5;

1.32
date	2009.08.30.14.16.31;	author tg;	state Exp;
branches;
next	1.31;
commitid	1004A9A89BA3643FC73;

1.31
date	2009.08.09.19.39.39;	author tg;	state Exp;
branches;
next	1.30;
commitid	1004A7F259B3D7C9644;

1.30
date	2009.02.01.16.16.30;	author tg;	state Exp;
branches;
next	1.29;
commitid	1004985CAF60EA15845;

1.29
date	2009.02.01.10.31.14;	author tg;	state Exp;
branches;
next	1.28;
commitid	100498579EA106BEEDE;

1.28
date	2009.01.31.18.49.26;	author tg;	state Exp;
branches;
next	1.27;
commitid	10049849D4960BA3BC3;

1.27
date	2009.01.12.21.54.40;	author tg;	state Exp;
branches;
next	1.26;
commitid	100496BBC367E14F1B5;

1.26
date	2009.01.12.17.52.44;	author tg;	state Exp;
branches;
next	1.25;
commitid	100496B83820C3AEE64;

1.25
date	2009.01.11.14.13.41;	author tg;	state Exp;
branches;
next	1.24;
commitid	1004969FEAA724AC3D0;

1.24
date	2009.01.11.13.09.21;	author tg;	state Exp;
branches;
next	1.23;
commitid	1004969EF8A0591EE40;

1.23
date	2009.01.10.22.18.52;	author tg;	state Exp;
branches;
next	1.22;
commitid	10049691EDB67E0F5CA;

1.22
date	2009.01.10.18.11.22;	author tg;	state Exp;
branches;
next	1.21;
commitid	1004968E4DC15B90396;

1.21
date	2009.01.10.17.48.29;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004968DF8128EF8855;

1.20
date	2009.01.10.14.49.03;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004968B5690CAD8165;

1.19
date	2009.01.10.13.41.17;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004968A59443A02B58;

1.18
date	2009.01.10.11.58.00;	author tg;	state Exp;
branches;
next	1.17;
commitid	10049688D4C6703171F;

1.17
date	2009.01.03.13.42.11;	author tg;	state Exp;
branches;
next	1.16;
commitid	100495F6B482F181E34;

1.16
date	2008.12.31.16.38.36;	author tg;	state Exp;
branches;
next	1.15;
commitid	100495BA02136D7BE32;

1.15
date	2008.08.01.15.43.46;	author tg;	state Exp;
branches;
next	1.14;
commitid	10048932F424C3503E1;

1.14
date	2008.08.01.12.39.07;	author tg;	state Exp;
branches;
next	1.13;
commitid	100489303F432B4030A;

1.13
date	2008.08.01.11.24.58;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004892F2924667C00D;

1.12
date	2007.05.24.21.03.53;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004655FDBB3A9243EA;

1.11
date	2006.10.15.01.35.53;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004531907179DB61BE;

1.10
date	2006.08.19.12.45.47;	author tg;	state Exp;
branches;
next	1.9;
commitid	10044E7080820F3E8BE;

1.9
date	2006.07.23.23.41.28;	author tg;	state Exp;
branches;
next	1.8;
commitid	10044C409313E5D0B2B;

1.8
date	2006.06.30.23.18.05;	author tg;	state Exp;
branches;
next	1.7;
commitid	10044A5B12A66F53B0F;

1.7
date	2006.06.15.18.25.16;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004491A61A59C31B19;

1.6
date	2006.04.19.21.48.48;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004446B02429A381DE;

1.5
date	2006.04.19.11.03.29;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004446191144DDF7FC;

1.4
date	2006.04.05.22.12.16;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004434408D12C01CCC;

1.3
date	2005.10.20.12.47.51;	author tg;	state Exp;
branches;
next	1.2;
commitid	353f43579208719c;

1.2
date	2005.03.06.21.27.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.28;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2008.08.01.10.28.37;	author tg;	state Exp;
branches;
next	;
commitid	1004892E54805BE97AB;


desc
@@


1.35
log
@fixup permissions of the files inside /usr/mdec/
@
text
@# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.34 2010/01/10 19:21:35 tg Exp $

SMALL_BOOT?=	No
BOOTLDR_PATH?=	${.CURDIR}

.include "${.CURDIR}/../Makefile.inc"

S=${.CURDIR}/../../../..
SADIR=${.CURDIR}/..

.include "${KERNBASE}/Makefile.inc"

CPPFLAGS+=	${DEBUGFLAGS}
CPPFLAGS+=	${SACFLAGS:M-[DI]*}
COPTS+=		${SACFLAGS:N-[DI]*}

.if defined(MBSD_PREFIX) && !empty(MBSD_PREFIX)
CPPFLAGS+=	-DMBSD_PREFIX=\"${MBSD_PREFIX:Q}\"
.endif

#AFLAGS+=	-Wa,-R
#AFLAGS+=	-Wa,-a

MAN=		boot.8
MLINKS+=	boot.8 boot.cfg.5
MLINKS+=	boot.8 pxeboot.8

.if ${MACHINE_ARCH} == "i386"
PROG=		boot
LD?=		ld
SIZE?=		size
INSTALL_STRIP=
.PATH:		${S}/stand/boot ${.CURDIR}/../pxeboot

LDFLAGS+=	${BOOTLDFLAGS}
SRCS=		srt0.S

.if defined(BOOTSELECT_HOOK) && (${BOOTSELECT_HOOK:L} != "no")
SRCS+=		hook.S
CPPFLAGS+=	-DBOOTSELECT_HOOK
.endif

CLEANFILES+=	testmkr ${PROG}.{elf,nm,tmp} ld.out
SRCS+=		boot.c bootarg.c cmd.c conf.c vars.c
LDADD+=		${LLIBSA}
DPADD+=		${DLIBSA}

.if ${SMALL_BOOT:L} == "no"
# comment this out if trouble
CPPFLAGS+=	-DUSE_PXE -DIN_PXEBOOT
SRCS+=		net.c
# comment this out if trouble
CPPFLAGS+=	-DUSE_DOSFS -DUSE_DOSFS_LETTERS
# comment this out if trouble
#CPPFLAGS+=	-DUSE_USTARFS
.else
CPPFLAGS+=	-DSMALL_BOOT
V=		${REAL_V}-small
.endif

all:		${PROG}

${PROG}:	$(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) $(OBJS) --start-group $(LDADD) --end-group \
	    -o ${PROG}.elf 2>&1 | tee ld.out
	@@if fgrep 'undefined reference' ld.out; then \
		echo "*** Attention: undefined references found!"; \
		rm -f $@@; \
		exit 1; \
	fi
	@@$(SIZE) ${PROG}.elf
	objcopy -x -R .comment ${PROG}.elf ${PROG}.tmp
	nm ${PROG}.tmp >${PROG}.nm
	${MKSH} ${BOOTLDR_PATH}/idt_fixup.sh ${PROG}.tmp ${PROG}
	@@-rm -f ${PROG}.tmp

TESTMBR?=	mbrldr
testmkr: ${PROG}
	print 2 $$(( size = ($$(stat -f %z ${PROG}) + 511) / 512 + 1 )) | \
	    ${MKSH} $$(realpath ${.OBJDIR})/../bootxx/bxinst | \
	    cat /usr/mdec/${TESTMBR} - ${PROG} | dd conv=osync of=$@@
	print -n '\x80\x0\x2\x0\xDB\x4\x2\x0\x1\x0\x0\x0\x81\x0\x0\x0' | \
	    dd conv=notrunc bs=1 seek=462 of=$@@
.else
NOPROG=		Yes
.endif

BOOTXX_TAR?=	/usr/mdec/bootxx.tar
KERNEL_TAR?=	bsd.rd
CLEANFILES+=	boot.cfg ${KERNEL_TAR}
testtar: .PHONY ${PROG}
	echo 'echo Hello, Testtar!' >boot.cfg
	tar -b 1 -M uidgid -cf - ${PROG} boot.cfg ${KERNEL_TAR} | \
	    cat ${BOOTXX_TAR} - >$@@
	tar -tvvf $@@

.include <bsd.prog.mk>
BINMODE=	${SHAREMODE}
@


1.34
log
@new ustarfs for the bootloader (fdboot only ATM, since boot’s too huge)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.33 2009/12/26 15:09:00 tg Exp $
d98 1
@


1.33
log
@new “dosfs” filesystem, for things like
• boot> cat c:\x
• boot> cat dos:c:\x
• boot> cat dos:c:/x
• boot> b c:/bsd

sadly, MirBSD doesn’t boot in dosbox (illegal opcode trap)…
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.32 2009/08/30 14:16:31 tg Exp $
d54 2
d88 9
@


1.32
log
@begin an experimental MirOS bsd4me, derived from MirOS bsd4grml, for
something Christian Hofstaedtler «ch:#grml» told us…
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.31 2009/08/09 19:39:39 tg Exp $
d52 2
@


1.31
log
@we absolutely needed to save space (cf. liveboot numbers below), so use an
mksh script (endian-neutral) to pre-fixup the IDT instead of generating one
at run/initialisation time from 16 bit code

XXX I wonder how the LZMA decompressor and ustarfs will fit… it’d probably
XXX be best to indeed compress the 32-bit code part with a rather simple
XXX algorithm to separate the 16-bit setup code part, multiboot kernel,
XXX coloured bootselection code, etc. from what’ll really be needed later

   text    data     bss     dec     hex filename
  59466    2024    3716   65206    feb6 boot.elf
  57778    2024    3716   63518    f81e boot.elf
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.30 2009/02/01 16:16:30 tg Exp $
d38 1
a38 1
.ifdef BOOTSELECT_HOOK
@


1.30
log
@small boot announce as such
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.29 2009/02/01 10:31:14 tg Exp $
d4 1
d67 2
a68 1
	objcopy -x ${PROG}.elf ${PROG}.tmp
d70 1
a70 3
	@@$(SIZE) ${PROG}.elf
	strip --strip-all -R .comment ${PROG}.tmp
	objcopy -O binary ${PROG}.tmp ${PROG}
@


1.29
log
@allow the user to change the default location of boot.cfg etc.
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.28 2009/01/31 18:49:26 tg Exp $
d51 3
@


1.28
log
@make testing more flexible
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.27 2009/01/12 21:54:40 tg Exp $
d16 4
@


1.27
log
@add a pxeboot(8/i386) MLINK to provide an upgrade path (not removing
pxeboot.8 just yet) and switch pxeboot→boot in all sensible places

mention MirOS /boot is unified, local disc and network capable, for
all architectures now (and add “ldbsd.com” commonly-known-alias name)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.26 2009/01/12 17:52:44 tg Exp $
d66 1
d70 1
a70 1
	    cat /usr/mdec/mbrldr - ${PROG} | dd conv=osync of=$@@
@


1.26
log
@clean up some
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.25 2009/01/11 14:13:41 tg Exp $
d20 2
a21 1
MLINKS=		boot.8 boot.cfg.5
@


1.25
log
@fix link order
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.24 2009/01/11 13:09:21 tg Exp $
a12 3
#CPPFLAGS+=	-DLOUD #-DEXTRALOUD
#CPPFLAGS+=	-DUTEST #-DUHARD #-DUANAL
#CPPFLAGS+=	-DDEBUG_OFS
@


1.24
log
@join in more pxeboot functionality
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.23 2009/01/10 22:18:52 tg Exp $
a18 6
.if ${SMALL_BOOT:L} == "no"
# comment this out if trouble
CPPFLAGS+=	-DUSE_PXE -DIN_PXEBOOT
SRCS+=		net.c
.endif

d33 1
a33 1
SRCS+=		srt0.S
d45 6
@


1.23
log
@more work towards unifying devices (and network)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.22 2009/01/10 18:11:22 tg Exp $
d21 2
a22 1
CPPFLAGS+=	-DUSE_PXE
d36 1
a36 1
.PATH:		${S}/stand/boot
@


1.22
log
@a testmkr with partition table
@
text
@d1 3
a3 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.21 2009/01/10 17:48:29 tg Exp $
d19 5
d38 1
a38 1
SRCS=		srt0.S
@


1.21
log
@better testmkr
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.20 2009/01/10 14:49:03 tg Exp $
d61 1
a61 1
	print 1 $$(( size = ($$(stat -f %z ${PROG}) + 511) / 512 )) | \
d63 3
a65 2
	    cat - ${PROG} | dd conv=osync of=$@@

@


1.20
log
@comment out tori stuff, will be merged into biosdev access
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.19 2009/01/10 13:41:17 tg Exp $
d61 3
a63 3
	cat /usr/mdec/mbrldr ${PROG} | dd conv=osync of=$@@
	let size=$$(stat -f %z $@@); /usr/mdec/installboot -v -i 1 \
	    $$(( (size - 1) / 512)) /usr/mdec/bootxx $@@
@


1.19
log
@new memory layout, part 1
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.18 2009/01/10 11:58:00 tg Exp $
a10 1
#CPPFLAGS+=	-DWANT_ELTORITO_CHECK
@


1.18
log
@LINKADDR, LINKSEG, LOADADDR, LOADSEG, SA_{LINK,LOAD}{ADDR,SEG} cleanup
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.17 2009/01/03 13:42:11 tg Exp $
a6 1
RL_VAL=0x17
d10 1
a10 1
CPPFLAGS+=	${DEBUGFLAGS} -DRL_VAL=${RL_VAL}
a27 1
LDFLAGS+=	-nostdlib -Bstatic --no-undefined
d31 1
a31 1
LDFLAGS+=	-Ttext $(M_LINKADDR) -N -noinhibit-exec
a55 9
	@@if [ x"$$(fgrep 'T _rval' ${PROG}.nm)" != \
	    x"00040170 T _rval" ]; then \
		echo "ERROR: Value of RL_VAL (${RL_VAL}) must be adjusted!"; \
		echo "  Example: 00040170 T _rval => 0x17 (take the two"; \
		echo "   digits before the last 0 in hexadecimal); place"; \
		echo "   that in Makefile and adjust the \$${PROG} rule!"; \
		echo "  The problematic sym: $$(fgrep 'T _rval' ${PROG}.nm)"; \
		exit 1; \
	fi
@


1.17
log
@assist in nm'ing
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.16 2008/12/31 16:38:36 tg Exp $
d33 1
a33 1
LDFLAGS+=	-Ttext $(LINKADDR) -N -noinhibit-exec
d41 1
a41 1
CLEANFILES+=	${.CURDIR}/disasm testmkr ${PROG}.{elf,nm,tmp} ld.out
a71 5
disasm:	${.CURDIR}/disasm

${.CURDIR}/disasm:	${PROG}
	ndisasm -b16 -o${LINKADDR} ${PROG} >${.CURDIR}/disasm

@


1.16
log
@shrink fdboot, nuke unused junk
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.15 2008/08/01 15:43:46 tg Exp $
d33 1
a33 1
LDFLAGS+=	-Ttext $(LINKADDR) -N -x -noinhibit-exec
d41 1
a41 1
CLEANFILES+=	${.CURDIR}/disasm testmkr ${PROG}.nm ld.out
d50 1
a50 1
	    -o ${PROG} 2>&1 | tee ld.out
d53 1
d55 3
a57 2
	  else exit 0; fi
	nm ${PROG} >${PROG}.nm
d67 4
a70 3
	@@$(SIZE) ${PROG}
	strip --strip-all -R .comment ${PROG}
	objcopy -O binary ${PROG}
@


1.15
log
@switch i386 bootloader to kern zlib
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.14 2008/08/01 12:39:07 tg Exp $
d22 2
a23 2
MAN=	boot.8
MLINKS=	boot.8 boot.cfg.5
a33 1
CLEANFILES+=	crt0.o
@


1.14
log
@remove unused code (for testing the bootloader on unix)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.13 2008/08/01 11:24:58 tg Exp $
d9 2
d44 2
a45 2
LDADD+=		${LLIBSA} ${LLIBZ}
DPADD+=		${DLIBSA} ${DLIBZ}
@


1.13
log
@merge and reduce diff to obsd
XXX not yet tested
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.12 2007/05/24 21:03:53 tg Exp $
a30 4
.if defined(DEBUGFLAGS) && !empty(DEBUGFLAGS:M-D_TEST)
CLEANFILES+=	srt0.o
SRCS=		crt0.c
.else
a33 1
.endif
@


1.12
log
@maybe optimise for size: don't use /path/to/libfoo.a but -L/path/to -lfoo
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.11 2006/10/15 01:35:53 tg Exp $
d21 1
a21 1
MLINKS=	boot.8 boot.cfg.8
@


1.11
log
@* add -fno-omit-frame-pointer to boot blocks too -> unbreaks
* add COPTS and CFLAGS and CPPFLAGS correctly and in correct order
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.10 2006/08/19 12:45:47 tg Exp $
d47 2
a48 2
LDADD=		${LIBSA} ${LIBZ}
DPADD=		${LIBSA} ${LIBZ}
@


1.10
log
@attempt at shrinking the floppy
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.9 2006/07/23 23:41:28 tg Exp $
d14 2
a15 1
CPPFLAGS+=	$(SACFLAGS)
@


1.9
log
@rename ldsec to bootxx to match all other arches
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.8 2006/06/30 23:18:05 tg Exp $
d26 1
a26 1
LDFLAGS+=	-nostdlib -Bstatic
d52 2
a53 1
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD) 2>&1 | tee ld.out
@


1.8
log
@check MACHINE_ARCH not MACHINE for same-userland stuff
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.7 2006/06/15 18:25:16 tg Exp $
d79 1
a79 1
	    $$(( (size - 1) / 512)) /usr/mdec/ldsec $@@
@


1.7
log
@remove DEBUGPROGS remnants, that flag is long dead
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.6 2006/04/19 21:48:48 tg Exp $
d22 1
a22 1
.if ${MACHINE} == "i386"
@


1.6
log
@even if it's only for testing, fix a potential off-by-one (div 512) bug
(I use size-1 here, the correct one would be (size-512)+511 because
size-512 is the size of the loader (512 is size of PBR) and 511 is the
number we divide by minus one)
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.5 2006/04/19 11:03:29 tg Exp $
a26 1
DEBUGPROGS=	No
@


1.5
log
@add a 'test' mode
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.4 2006/04/05 22:12:16 tg Exp $
d80 1
a80 1
	    $$((size / 512)) /usr/mdec/ldsec $@@
@


1.4
log
@add the ability to hook something into the (CD) boot loader,
and select a different 'boot.cfg' file (boot.%d) based upon it
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.3 2005/10/20 12:47:51 tg Exp $
d45 1
a45 1
CLEANFILES+=	${.CURDIR}/disasm ${PROG}.nm ld.out
d77 5
@


1.3
log
@fix up DEBUGLIBS and DEBUGPROGS
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/boot/Makefile,v 1.2 2005/03/06 21:27:03 tg Exp $
d40 5
@


1.2
log
@* merge src/sys/
  (at least the better part of it)
* revert IPv6 networking to OpenBSD, since
  I didn't get IPV4_MAPPED addresses working :(
@
text
@d1 1
a1 1
# $MirOS$
d27 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.31 2003/04/17 12:06:05 mickey Exp $
d5 14
d20 1
a20 1
MLINKS=	boot.8 boot.conf.8
d23 6
a28 4
PROG=	boot
LD?=	ld
SIZE?=	size
LDFLAGS+=-nostdlib -Bstatic
d32 1
a32 1
SRCS=	crt0.c
d34 1
a34 1
LDFLAGS+=-Ttext $(LINKADDR) -N -x -noinhibit-exec
d36 1
a36 1
SRCS=	srt0.S
d39 26
a64 6
SRCS+=	boot.c cmd.c vars.c bootarg.c conf.c
S	=${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..

LDADD=	${LIBSA} ${LIBZ}
DPADD=	${LIBSA} ${LIBZ}
d66 1
a66 1
.PATH:	${S}/stand/boot
d68 2
a69 6
boot.bin: boot
	objcopy -v -O binary ${PROG} boot.bin

${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD)
	@@$(SIZE) ${PROG}
d72 1
a72 1
NOPROG=
a75 7

CPPFLAGS+=-DBOOTMAGIC=$(BOOTMAGIC) ${DEBUGFLAGS}
CPPFLAGS+=-DLINKADDR=${LINKADDR}
CFLAGS+=$(SACFLAGS)
#AFLAGS+=-Wa,-R
# AFLAGS+=-Wa,-a

@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@import bootloader-related pieces from openbsd, as first part of the
aspired 4.4 merge… and something else
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.34 2007/11/25 18:25:31 deraadt Exp $
d6 1
a6 1
MLINKS=	boot.8 boot.conf.5
a31 3
.PATH:	${S}/lib/libkern/arch/i386 ${S}/lib/libkern
SRCS+=	strlcpy.c moddi3.c divdi3.c qdivrem.c

@

