head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2016.02.06.17.09.06;	author tg;	state Exp;
branches;
next	1.4;
commitid	10056B628C31FA73C0D;

1.4
date	2010.01.16.22.34.25;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004B523F0824260F54;

1.3
date	2010.01.10.12.43.55;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004B49CB980BD545E2;

1.2
date	2010.01.10.02.02.51;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004B49355A7B299C53;

1.1
date	2010.01.10.01.28.50;	author tg;	state Exp;
branches;
next	;
commitid	1004B492D5519935373;


desc
@@


1.5
log
@fixup permissions of the files inside /usr/mdec/
@
text
@# $MirOS: src/sys/arch/i386/stand/bootxx_ustarfs/Makefile,v 1.4 2010/01/16 22:34:25 tg Exp $

PROG=		bootxx.tar
SRCS+=		bootxx.S
NOMAN=		Yes
INSTALL_STRIP=	# empty
LDFLAGS=	-nostdlib -Ttext 0xFE00 -N -Bstatic -e _start
CPPFLAGS+=	${DEBUGFLAGS}
CLEANFILES+=	${PROG}.elf ${PROG}.tmp ${.CURDIR}/disasm

all: ${PROG}

${PROG}: ${OBJS} ${DPADD}
	${LD} ${LDFLAGS} -o $@@.elf ${OBJS} ${LDADD}
	@@size $@@.elf
	objcopy -O binary $@@.elf $@@.tmp
	print -n "$$(${MKSH} ${.CURDIR}/tarcksum $@@.tmp)\\0" | \
	    dd of=$@@.tmp bs=1 seek=148 conv=notrunc
	mv -f $@@.tmp $@@

disasm: ${.CURDIR}/disasm

${.CURDIR}/disasm: ${PROG}
	(cat ${PROG}; dd if=/dev/zero count=2 2>&-) | tar -tvvf -
	objdump -dS -Mintel,i8086 ${PROG}.elf >$@@

.include <bsd.prog.mk>
BINMODE=	${SHAREMODE}
@


1.4
log
@optimise
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/bootxx_ustarfs/Makefile,v 1.3 2010/01/10 12:43:55 tg Exp $
d28 1
@


1.3
log
@since this will inevitably end up on the CD, we need 8.3 filenames
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/bootxx_ustarfs/Makefile,v 1.2 2010/01/10 02:02:51 tg Exp $
d17 1
a17 1
	printf '%s\0' "$$(${MKSH} ${.CURDIR}/tarcksum $@@.tmp)" | \
@


1.2
log
@ét voilà
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/bootxx/Makefile,v 1.16 2009/06/29 20:50:59 tg Exp $
d3 1
a3 1
PROG=		bootxx_ustarfs
@


1.1
log
@first draft of ustarfs primary bootloader (aka bootsector)
not complete, different approach will follow
@
text
@d7 1
a7 1
LDFLAGS=	-nostdlib -Ttext 0xFC00 -N -Bstatic -e _start
d24 1
a24 1
	-(cat ${PROG}; dd if=/dev/zero count=3 2>&-) | tar -tvvf -
@

