head	1.5;
access;
symbols
	tg-use_ldscript:1.4.0.2
	MIRBSD_10:1.1.0.2
	MIRBSD_10_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.02.06.17.09.06;	author tg;	state Exp;
branches;
next	1.4;
commitid	10056B628C31FA73C0D;

1.4
date	2009.01.31.23.39.55;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004984E12E32956022;

1.3
date	2009.01.31.15.50.44;	author tg;	state Exp;
branches;
next	1.2;
commitid	100498472F85954CA8E;

1.2
date	2008.08.01.12.41.42;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004893049657828A43;

1.1
date	2007.02.26.00.13.27;	author tg;	state Exp;
branches;
next	;
commitid	10045E226230C5AAABC;


desc
@@


1.5
log
@fixup permissions of the files inside /usr/mdec/
@
text
@# $MirOS: src/sys/arch/i386/stand/mbr/Makefile.inc,v 1.4 2009/01/31 23:39:55 tg Exp $

.ifndef MODSRC_SYS_ARCH_I386_STAND_MBR_MAKEFILE_INC
MODSRC_SYS_ARCH_I386_STAND_MBR_MAKEFILE_INC=	# defined

SRCS+=		mbr.S
.PATH:		${.CURDIR}/..

NOMAN=		Yes
INSTALL_STRIP=	# empty
LDFLAGS=	-nostdlib -Ttext 0x0600 -N -Bstatic -e _start
CLEANFILES+=	${PROG}.elf ${PROG}.tmp ${.CURDIR}/disasm

${PROG}: ${OBJS} ${DPADD}
	${LD} ${LDFLAGS} -o $@@.elf ${OBJS} ${LDADD}
	@@size $@@.elf
	@@objcopy -O binary $@@.elf $@@

disasm: ${.CURDIR}/disasm

${.CURDIR}/disasm: ${PROG}
#	ndisasm -b 16 $> >$@@
	objdump -d -Mintel,i8086 ${PROG}.elf >$@@

.if exists(../Makefile.inc)
.  include "../Makefile.inc"
.endif

V=		${REAL_V}
BINMODE=	${SHAREMODE}

.endif
@


1.4
log
@easier compilation/linkage process; no binary change
inspired by bootxx, but still looking somewhat awkward
(it’s much easier with gas, ld & co. when starting at 0)

fun though, both MBR and PBR code shrunk during the rewrite…
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbr/Makefile.inc,v 1.3 2009/01/31 15:50:44 tg Exp $
d30 1
@


1.3
log
@completely (almost) rewritten MBR to address the Parallels Desktop bug

current agenda is to have robust tools doing one-sector-at-a-time xfer
automatically if no manual way to enable them exists, and simply using
LBA xfers if talking to a hdd or CD by default without checking for it
to be supported by the BIOS, falling back to CHS if failing ONLY
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbr/Makefile.inc,v 1.2 2008/08/01 12:41:42 tg Exp $
d11 1
a11 1
LDFLAGS=	-nostdlib -Ttext 0 -N -Bstatic
d16 2
a17 3
	@@objcopy -O binary $@@.elf $@@.tmp
	@@dd if=${PROG}.tmp bs=1 skip=0x0600 of=$@@ 2>&-
	@@size --target=binary $@@
@


1.2
log
@we do not bump the version for the MBR
@
text
@d1 1
a1 1
# $MirOS: src/sys/arch/i386/stand/mbr/Makefile.inc,v 1.1 2007/02/26 00:13:27 tg Exp $
d12 1
a12 1
CLEANFILES+=	${PROG}.elf ${.CURDIR}/disasm
d15 4
a18 5
	${LD} ${LDFLAGS} -o ${PROG} ${OBJS} ${LDADD}
	@@size ${PROG}
	mv ${PROG} ${PROG}.elf
	objcopy -O binary ${PROG}.elf ${PROG}
	@@ls -l ${.OBJDIR}/${PROG}
@


1.1
log
@re-order the MBR stuff and improve functionality and comments;
actually check for usability of LBA functions before using them
@
text
@d1 1
a1 1
# $MirOS$
d31 2
@

