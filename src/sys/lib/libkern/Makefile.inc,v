head	1.5;
access;
symbols
	tg-beforemerge-ksrc10:1.1.1.1
	MIRBSD_10:1.5.0.2
	MIRBSD_10_BASE:1.5
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.2.0.2
	MIRBSD_8_BASE:1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2007.02.08.19.01.04;	author tg;	state Exp;
branches;
next	1.4;
commitid	10045CB736D032D8DFB;

1.4
date	2007.02.06.18.49.40;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045C8CDCD643D2975;

1.3
date	2006.02.01.19.22.45;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043E10A9443E7BBB3;

1.2
date	2005.03.06.21.28.05;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.28.54;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.28.54;	author tg;	state Exp;
branches;
next	;


desc
@@


1.5
log
@build libkern as .a static library, not as .o reloadable object file
results in unneeded functions not being pulled into the kernel
@
text
@#	$MirOS: src/sys/lib/libkern/Makefile.inc,v 1.4 2007/02/06 18:49:40 tg Exp $
#	$OpenBSD: Makefile.inc,v 1.11 2000/06/29 16:28:29 mickey Exp $
#	$NetBSD: Makefile.inc,v 1.22 1996/09/30 15:54:35 ws Exp $
#
#	NOTE: $S must correspond to the top of the 'sys' tree

KERNDIR=	$S/lib/libkern

KERNDST?=	${.OBJDIR}/lib/kern
KERN_AS?=	library		# or obj

.if (${KERN_AS} == "library")
KERNLIB=	${KERNDST}/libkern.a
.else
KERNLIB=	${KERNDST}/libkern.o
.endif

KERNMAKE= \
	cd ${KERNDIR} && MAKEOBJDIR=${KERNDST} ${MAKE} S=${S:Q} \
	    CC=${CC:Q} CFLAGS=${CFLAGS:Q} AS=${AS:Q} AFLAGS=${AFLAGS:Q} \
	    LD=${LD:Q} STRIP=${STRIP:Q} CPP=${CPP:Q} STRIP=${STRIP:Q} \
	    AR=${AR:Q} NM=${NM:Q} LORDER=${LORDER:Q} XMACHINE=${MACHINE:Q} \
	    XMACHINE_ARCH=${MACHINE_ARCH:Q} KERNDIR=${KERNDIR} COPTS= \
	    KERNCPPFLAGS=${CPPFLAGS:S@@^-I.@@-I../../.@@g:Q}

${KERNLIB}:		.NOTMAIN __always_make_kernlib
	@@echo making sure the kern library is up to date...
.if (${KERN_AS} == "library")
	@@${KERNMAKE} libkern.a
.else
	@@${KERNMAKE} libkern.o
.endif

clean::			.NOTMAIN __always_make_kernlib
	@@echo cleaning the kern library objects
	@@${KERNMAKE} clean

depend:: 		.NOTMAIN __always_make_kernlib
	@@echo depending the kern library objects
	@@${KERNMAKE} depend

__always_make_kernlib:	.NOTMAIN
	-mkdir -p ${KERNDST}
@


1.4
log
@* pass $S to libkern/Makefile
* while here, fix quoting: '${x}' -> ${x:Q}
@
text
@d1 1
a1 1
#	$MirOS: src/sys/lib/libkern/Makefile.inc,v 1.3 2006/02/01 19:22:45 tg Exp $
d10 1
a10 1
KERN_AS?=	obj
@


1.3
log
@make kernels build with -fhonour-copts correctly
@
text
@d1 1
a1 1
#	$MirOS: src/sys/lib/libkern/Makefile.inc,v 1.2 2005/03/06 21:28:05 tg Exp $
d19 6
a24 6
	cd ${KERNDIR} && MAKEOBJDIR=${KERNDST} ${MAKE} \
	    CC='${CC}' CFLAGS='${CFLAGS}' AS='${AS}' AFLAGS='${AFLAGS}' \
	    LD='${LD}' STRIP='${STRIP}' CPP='${CPP}' STRIP='${STRIP}' \
	    AR='${AR}' NM='${NM}' LORDER='${LORDER}' XMACHINE='${MACHINE}' \
	    XMACHINE_ARCH='${MACHINE_ARCH}' KERNDIR=${KERNDIR} COPTS= \
	    KERNCPPFLAGS='${CPPFLAGS:S@@^-I.@@-I../../.@@g}'
@


1.2
log
@* merge src/sys/
  (at least the better part of it)
* revert IPv6 networking to OpenBSD, since
  I didn't get IPV4_MAPPED addresses working :(
@
text
@d1 1
a1 1
#	$MirOS$
d23 1
a23 1
	    XMACHINE_ARCH='${MACHINE_ARCH}' KERNDIR=${KERNDIR} \
@


1.1
log
@Initial revision
@
text
@d1 1
a13 1
KERNLIB_PROF=	${KERNDST}/libkern_p.a
a15 1
KERNLIB_PROF=	${KERNDST}/libkern.po
a33 8
${KERNLIB_PROF}:	.NOTMAIN __always_make_kernlib
	@@echo making sure the profiled kern library is up to date...
.if (${KERN_AS} == "library")
	@@${KERNMAKE} libkern_p.a
.else
	@@${KERNMAKE} libkern.po
.endif

@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
