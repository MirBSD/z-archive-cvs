head	1.5;
access;
symbols
	tg-beforemerge-ksrc10:1.1.1.1
	MIRBSD_10:1.4.0.2
	MIRBSD_10_BASE:1.4
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.2.0.2
	MIRBSD_8_BASE:1.2
	cvs-200507032030:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2008.10.05.16.26.20;	author tg;	state Exp;
branches;
next	1.4;
commitid	10048E8EA7D6EAD401E;

1.4
date	2007.02.08.19.00.23;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045CB7354560F7BF1;

1.3
date	2006.02.01.19.22.45;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043E10A9443E7BBB3;

1.2
date	2005.03.06.21.27.28;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.27.43;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.27.43;	author tg;	state Exp;
branches;
next	;


desc
@@


1.5
log
@use mksh realpath builtin instead of readlink -f for canonicalisation

note: there’s still a readlink(1) call left in, for instance, mirmake;
this does not hurt because we initially assumed that readlink(1) does
exist anyway and bundled ours just because some do not have the ‘-f’
option for realpath(2)isation
@
text
@# $MirOS: src/sys/compat/common/Makefile.inc,v 1.4 2007/02/08 19:00:23 tg Exp $
# $OpenBSD: Makefile.inc,v 1.7 2002/07/14 09:20:24 mdw Exp $
# $NetBSD: Makefile.inc,v 1.5 1996/05/20 17:23:59 mrg Exp $
#
#	NOTE: $S must correspond to the top of the 'sys' tree

PWD!=		realpath .
COMPATDIR!=	realpath $S/compat/common
COMPATDST?=	lib/compat
COMPATLIB=	${COMPATDST}/libcompat.a

COMPATMAKE= \
	cd ${COMPATDST} && ${MAKE} -f ${COMPATDIR}/Makefile \
	    CC=${CC:Q} CFLAGS=${CFLAGS:S/-I./-I${PWD}\/./g:Q} \
	    LD=${LD:Q} AR=${AR:Q} RANLIB=${RANLIB:Q} LORDER=${LORDER:Q} \
	    NM=${NM:Q} COPTS= \
	    XMACHINE=${MACHINE:Q} XMACHINE_ARCH=${MACHINE_ARCH:Q} \
	    CPPFLAGS=${CPPFLAGS:S/-I./-I${PWD}\/./g:Q} \
	    COMPATDIR=${COMPATDIR:Q}

${COMPATLIB}:		.NOTMAIN __always_make_compatlib
	@@echo making sure the compat library is up to date...
	@@${COMPATMAKE} libcompat.a

clean:: 		.NOTMAIN __always_make_compatlib
	@@echo cleaning the compat library objects
	@@${COMPATMAKE} clean

depend:: 		.NOTMAIN __always_make_compatlib
	@@echo depending the compat library objects
	@@${COMPATMAKE} depend

__always_make_compatlib:	.NOTMAIN
	@@mkdir -p ${COMPATDST}
@


1.4
log
@while here, use realpath not pwd, quote properly
@
text
@d1 1
a1 1
# $MirOS: src/sys/compat/common/Makefile.inc,v 1.3 2006/02/01 19:22:45 tg Exp $
d7 2
a8 2
PWD!=		readlink -nf .
COMPATDIR!=	readlink -nf $S/compat/common
@


1.3
log
@make kernels build with -fhonour-copts correctly
@
text
@d1 1
a1 1
# $MirOS: src/sys/compat/common/Makefile.inc,v 1.2 2005/03/06 21:27:28 tg Exp $
d7 2
a8 2
PWD!=		pwd
COMPATDIR!=	cd $S/compat/common; pwd
d14 6
a19 6
	    CC="${CC}" CFLAGS="${CFLAGS:S/-I./-I${PWD}\/./g}" \
	    LD="${LD}" AR="${AR}" RANLIB="${RANLIB}" LORDER="${LORDER}" \
	    NM="${NM}" COPTS= \
	    XMACHINE='${MACHINE}' XMACHINE_ARCH='${MACHINE_ARCH}' \
	    CPPFLAGS="${CPPFLAGS:S/-I./-I${PWD}\/./g}" \
	    COMPATDIR="${COMPATDIR}"
@


1.2
log
@* merge src/sys/
  (at least the better part of it)
* revert IPv6 networking to OpenBSD, since
  I didn't get IPV4_MAPPED addresses working :(
@
text
@d1 1
a1 1
# $MirOS$
d16 1
a16 1
	    NM="${NM}" \
@


1.1
log
@Initial revision
@
text
@d1 3
a3 2
#	$OpenBSD: Makefile.inc,v 1.7 2002/07/14 09:20:24 mdw Exp $
#	$NetBSD: Makefile.inc,v 1.5 1996/05/20 17:23:59 mrg Exp $
a10 1
COMPATLIB_PROF=	${COMPATDST}/libcompat_p.a
a24 4
${COMPATLIB_PROF}:	.NOTMAIN __always_make_compatlib
	@@echo making sure the profiled compat library is up to date...
	@@${COMPATMAKE} libcompat_p.a

@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
