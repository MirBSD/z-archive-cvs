head	1.9;
access;
symbols
	MIRBSD_10:1.6.0.2
	MIRBSD_10_BASE:1.6
	MIRBSD_9_BASE:1.6
	MIRBSD_8:1.4.0.2
	MIRBSD_8_BASE:1.4
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2018.10.07.01.10.22;	author tg;	state Exp;
branches;
next	1.8;
commitid	1005BB95CA10BF418E8;

1.8
date	2008.11.29.17.03.53;	author tg;	state Exp;
branches;
next	1.7;
commitid	100493175607A689D2F;

1.7
date	2008.06.07.20.25.42;	author tg;	state Exp;
branches;
next	1.6;
commitid	100484AEEAE37268011;

1.6
date	2006.06.02.00.01.47;	author tg;	state Exp;
branches;
next	1.5;
commitid	100447F7FEF0B9AFA43;

1.5
date	2006.01.11.00.40.01;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043C453E962681783;

1.4
date	2005.12.16.23.37.43;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043A34FCD5DE67A4E;

1.3
date	2005.12.16.16.09.45;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043A2E6BF072740FB;

1.2
date	2005.03.06.19.23.58;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.26.19;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.26.19;	author tg;	state Exp;
branches;
next	;


desc
@@


1.9
log
@spelling cleanup: “programme” is distinct from “program”; even in
British English, the latter is used for computer programs, while
the former serves for things like the TV programme, or a programme
to plant trees
@
text
@# $MirOS: src/libexec/anoncvssh/Makefile,v 1.8 2008/11/29 17:03:53 tg Exp $

# Note: you DO want to compile this, as well as the anoncvsbin
# and rsync, statically. It is not possible, however, to do that
# when your system uses PAM authentication. That's why, use of
# systems with PAM (such as GNU libc based systems) is strongly
# disrecommended - better alternatives such as BSD auth exist.

# The following line defines where your CVS Root (repository) lives.
DEFS+=		-DLOCALROOT=\"/cvs\"

# Two ways to specify the user/host part of $CVSROOT:
# a) Simple - just specify user@@host
#DEFS+=		-DHOSTNAME=\"_anoncvs@@host.domain.com\"
# b) Split - define user and host (default)
#    Advantage: a warning will be issued if someone
#    other than the user specified (or root) invokes us.
#DEFS+=		-DANONCVS_USER=\"_anoncvs\" -DFQDN=\"host.domain.com\"
DEFS+=		-DANONUSERLIST='"_anoncvs", "_rsync", "anoncvs", "rsync"'

# Enable rsync for the user.
# Warning: this also makes rsync writes possible
# if the file ownership and permissions don't forbid it!
DEFS+=		-DACCESS_RSYNC
# if not using the standard path...
#DEFS+=		-DRSYNC=\"/bin/rsync\"

# Specify if you *DON'T* want to set CVSREADONLYFS=1.
# This can be used if you want to give a user CVS
# read/write access, but no shell account. Use with care!
#DEFS+=		-DACCESS_READWRITE

# If there is more than one person with ACCESS_READWRITE
# and the OS does not implement nullfs correctly (vnodes
# just don't like to show up in more than one place) put
# all of their homes and the CVS Root into a common dir,
# ensure nobody else can write to it (the common dir can
# still be the _anoncvs user's home) and define this:
#XXX rework this some time
#DEFS+=		-DCHROOT_PARENT_DIR

# Specify this if you want to allow :pserver: access.
# *Not recommended* because pserver is a security hole!
#DEFS+=		-DACCESS_PSERVER

# Specify this if you want to log :pserver: connections
# and unauthorised access.
DEFS+=		-DUSE_SYSLOG

# Name of this program. Set e.g. to "anoncvssh.mirbsd"
# if running more than one anoncvs user, and for read-
# write users, to "anoncvs-username" (thus you can place
# them in the common parent dir).
PROG?=		anoncvssh${PROGSUFF}

# Use 'chflags uchg /usr/libexec/anoncvssh' to prevent the
# generated file from being overwritten once you customised
# this Makefile. Use ...nouchg... to disable the protection
# whenever you are going to update this.

CPPFLAGS+=	${DEFS} -DANONCVSSH_NAME=\"${PROG}\"
CDIAGFLAGS+=	-Wno-cast-qual
BINOWN=		root
BINGRP=		_anoncvs
BINMODE=	4110
BINDIR?=	/usr/libexec
LDFLAGS+=	-static
SRCS=		anoncvssh.c
NOMAN=		yes

anoncvssh.o: Makefile

.include <bsd.prog.mk>
@


1.8
log
@move anoncvs stub from /var/anoncvs/anoncvs to /var/anoncvs,
shell from /var/anoncvs/anoncvssh to /usr/libexec/anoncvssh,
devices are now on mfs, fix some typos etc. while here

=> /var/anoncvs and its subdirectories can now be mounted
   with nodev and nosuid

condition on the mfs mount: at least one user must exist
whose home directory is /var/anoncvs (or one of its sub-
directories), whose shell is /usr/libexec/anoncvssh, and
whose password is not empty ('*'); /var/anoncvs/dev will
be filled with arandom, null and zero.

also enforce stricter perms on cvs and rsync binaries in
the chroot (0110 root:_anoncvs)

do not change anything pertaining to the MirOS mirrors
yet, as these will have to be changed to match the new
default values with some OS upgrade later
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.7 2008/06/07 20:25:42 tg Exp $
d50 1
a50 1
# Name of this programme. Set e.g. to "anoncvssh.mirbsd"
@


1.7
log
@allow not only "_anoncvs" but also "_rsync" (legacy) and the variants
"anoncvs" and "rsync" anonymous cvs/rsync access by default

thanks again to gecko2@@ for forcing kludges on us due to non-standard
setup on exactly one mirror…
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.6 2006/06/02 00:01:47 tg Exp $
d9 2
a10 2
# The following line defines where your CVS Root lives.
DEFS+=	-DLOCALROOT=\"/cvs\"
d14 1
a14 1
#DEFS+=	-DHOSTNAME=\"_anoncvs@@host.domain.com\"
d18 2
a19 2
#DEFS+=	-DANONCVS_USER=\"_anoncvs\" -DFQDN=\"host.domain.com\"
DEFS+=	-DANONUSERLIST='"_anoncvs", "_rsync", "anoncvs", "rsync"'
d23 2
a24 2
# if the file ownership and permissions don't forbit it!
DEFS+=	-DACCESS_RSYNC
d26 1
a26 1
#DEFS+=	-DRSYNC=\"/bin/rsync\"
d31 1
a31 1
#DEFS+=	-DACCESS_READWRITE
d39 2
a40 1
#DEFS+=	-DCHROOT_PARENT_DIR
d44 1
a44 1
#DEFS+=	-DACCESS_PSERVER
d48 1
a48 1
DEFS+=	-DUSE_SYSLOG
d54 1
a54 1
PROG?=	anoncvssh${PROGSUFF}
d56 2
a57 2
# Use 'chflags uchg /var/anoncvs/anoncvssh' to prevent the
# generated file from being overwritten once you customized
d66 1
a66 1
BINDIR?=	/var/anoncvs
@


1.6
log
@* allow /usr/bin or /bin to prefix cvs/rsync path
* cleaner implementation
* almost __CRAZY clean
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.5 2006/01/11 00:40:01 tg Exp $
d19 1
@


1.5
log
@standardise on _anoncvs@@mirbsd.org:/cvs (which will be up soon)
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.4 2005/12/16 23:37:43 tg Exp $
d60 1
@


1.4
log
@* some debugging more
* some more output to syslog
* fix anonRSYNC
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.3 2005/12/16 16:09:45 tg Exp $
d14 2
a15 2
#DEFS+=	-DHOSTNAME=\"_anoncvs@@mirsolutions.de\"
# b) Split - define user and host
d18 1
a18 1
DEFS+=	-DANONCVS_USER=\"_anoncvs\" -DFQDN=\"host.domain.com\"
@


1.3
log
@Implement forwarding of "readonlyfs" (acquired by either cvs -R or
export CVSREADONLYFS=1) to an :ext: server, after YEARS of cursing.
@
text
@d1 1
a1 1
# $MirOS: src/libexec/anoncvssh/Makefile,v 1.2 2005/03/06 19:23:58 tg Exp $
d61 1
a61 1
BINGRP?=	_anoncvs
@


1.2
log
@merge src/libexec
@
text
@d1 1
a1 1
# $MirOS$
d14 1
a14 1
#DEFS+=	-DHOSTNAME=\"mirbsd-cvs@@mirbsd.bsdadvocacy.org\"
d25 1
a25 1
#DEFS+=	-DRSYNC=\"/usr/bin/rsync\"
@


1.1
log
@Initial revision
@
text
@d1 68
a68 6
#CVSROOT=anoncvs@@anoncvs1.usa.openbsd.org:/cvs
PROG=   anoncvssh
BINOWN= root
BINMODE=4111
BINDIR=/open
NOMAN=
a70 1

@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@
