head	1.5;
access;
symbols
	MIRBSD_10:1.3.0.4
	MIRBSD_10_BASE:1.3
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2009.10.19.20.43.50;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004ADCCF9364982506;

1.4
date	2009.10.03.17.38.12;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004AC78BE14BC9F752;

1.3
date	2005.11.23.18.04.18;	author tg;	state Exp;
branches;
next	1.2;
commitid	af74384af2ab463;

1.2
date	2005.07.07.13.39.58;	author tg;	state Exp;
branches;
next	1.1;
commitid	331742cd306446f9;

1.1
date	2005.02.05.17.29.51;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.29.51;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.21.21.00.19;	author tg;	state Exp;
branches;
next	;
commitid	560042e0092f571e;


desc
@@


1.5
log
@ensure we have (*) cases
@
text
@#!/bin/mksh
# $MirOS: src/usr.bin/spell/spell.ksh,v 1.4 2009/10/03 17:38:12 tg Exp $
# $OpenBSD: spell.ksh,v 1.9 2005/07/06 07:08:05 jmc Exp $
#
# Copyright (c) 2001, 2003 Todd C. Miller <Todd.Miller@@courtesan.com>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#
# Sponsored in part by the Defense Advanced Research Projects
# Agency (DARPA) and Air Force Research Laboratory, Air Force
# Materiel Command, USAF, under agreement number F39502-99-1-0512.
#
SPELLPROG=/usr/libexec/spellprog
DICT=/usr/share/dict/words
LOCAL_DICT=/usr/local/share/dict/words
STOP=/usr/share/dict/stop
LOCAL_STOP=/usr/local/share/dict/stop
AMERICAN=/usr/share/dict/american
BRITISH=/usr/share/dict/british
LANG=$AMERICAN
STOP_LANG=$BRITISH
EXTRA=
FLAGS=
DEROFF="deroff -w"
HISTFILE=
TMP=`mktemp /tmp/spell.XXXXXXXX` || exit 1
VTMP=
USAGE="usage: spell [-biltvx] [-d list] [-h spellhist] [-m a | e | l | m | s]\n\t[-s stop] [+extra_list] [file ...]"

OPTIND=1		# force getopts to reset itself

trap "rm -f $TMP $VTMP; exit 0" 0 1 2 15

# Use local word/stop lists if they exist
if [ -f $LOCAL_DICT ]; then
	DICT="$DICT $LOCAL_DICT"
fi
if [ -f $LOCAL_STOP ]; then
	STOP="$STOP $LOCAL_STOP"
fi

while getopts "biltvxd:h:m:s:" c; do
	case $c in
	b)	LANG=$BRITISH
		STOP_LANG=$AMERICAN
		FLAGS[${#FLAGS[@@]}]="-b"
		;;
	i)	DEROFF="$DEROFF -i"
		;;
	l)	DEROFF="delatex"
		;;
	m)	DEROFF="$DEROFF -m $OPTARG"
		;;
	t)	DEROFF="detex"
		;;
	v)	VTMP=`mktemp /tmp/spell.XXXXXXXX` || {
			rm -f ${TMP}
			exit 1
		}
		FLAGS[${#FLAGS[@@]}]="-v"
		FLAGS[${#FLAGS[@@]}]="-o"
		FLAGS[${#FLAGS[@@]}]="$VTMP"
		;;
	x)	FLAGS[${#FLAGS[@@]}]="-x"
		;;
	d)	DICT="$OPTARG"
		LANG=
		;;
	s)	STOP="$OPTARG"
		STOP_LANG=
		LOCAL_STOP=
		;;
	h)	HISTFILE="$OPTARG"
		;;
	*)	echo "$USAGE" 1>&2
		exit 1
		;;
	esac
done
shift $(( $OPTIND - 1 ))

while test $# -ne 0; do
	case "$1" in
		+*)	EXTRA="$EXTRA ${1#+}"
			shift
			;;
		*)	break
			;;
	esac
done

# Any parameters left are files to be checked, pass them to deroff
DEROFF="$DEROFF $@@"

if [ -n "$HISTFILE" ]; then
	$DEROFF | sort -u | $SPELLPROG -o $TMP $STOP $STOP_LANG | \
	    $SPELLPROG ${FLAGS[*]} $DICT $LANG $EXTRA | sort -u -k1f - $TMP | \
	    tee -a $HISTFILE
	who -m >> $HISTFILE
else
	$DEROFF | sort -u | $SPELLPROG -o $TMP $STOP $STOP_LANG | \
	    $SPELLPROG ${FLAGS[*]} $DICT $LANG $EXTRA | sort -u -k1f - $TMP
fi

if [ -n "$VTMP" ]; then
	sort -u -k2f -k1 $VTMP
fi

exit 0
@


1.4
log
@make sure that no shell script uses
• integer foo[n] (currently the same as integer foo, but not for
  much longer…)
• set ±o posix (replaced by set ±o sh)
any more
@
text
@d2 1
a2 1
# $MirOS: src/usr.bin/spell/spell.ksh,v 1.3 2005/11/23 18:04:18 tg Exp $
a39 1
#set -o posix		# set POSIX mode to prevent +foo in getopts
@


1.3
log
@fastmerge remainder of src/usr.bin
@
text
@d2 1
a2 1
# $MirOS: src/usr.bin/spell/spell.ksh,v 1.2 2005/07/07 13:39:58 tg Exp $
d40 1
a40 1
set -o posix		# set POSIX mode to prevent +foo in getopts
@


1.2
log
@/bin/sh and /bin/ksh -> /bin/mksh

This should cover most uses.
@
text
@d2 2
a3 2
# $MirOS$
# $OpenBSD: spell.ksh,v 1.8 2004/02/02 22:36:50 fgsch Exp $
d38 1
a38 1
USAGE="usage: spell [-biltvx] [-d list] [-h spellhist] [-s stop] [+extra_list] [file ...]"
@


1.1
log
@Initial revision
@
text
@d1 2
a2 2
#!/bin/ksh -
#
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d3 1
a3 1
# $OpenBSD: spell.ksh,v 1.9 2005/07/06 07:08:05 jmc Exp $
d38 1
a38 1
USAGE="usage: spell [-biltvx] [-d list] [-h spellhist] [-m a | e | l | m | s]\n\t[-s stop] [+extra_list] [file ...]"
@

