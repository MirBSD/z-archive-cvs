head	1.3;
access;
symbols
	cvs-200804031830:1.1.1.2
	MIRBSD_10:1.1.1.2.0.2
	MIRBSD_10_BASE:1.1.1.2
	cvs-200803022030:1.1.1.2
	cvs-200709131337:1.1.1.2
	cvs-200709021830:1.1.1.2
	cvs-200708201200:1.1.1.2
	cvs-200706161500:1.1.1.2
	cvs-200705192215:1.1.1.2
	cvs-200704292000:1.1.1.2
	cvs-200703080900:1.1.1.2
	cvs-200701251600:1.1.1.2
	cvs-200612111600:1.1.1.2
	cvs-200611090230:1.1.1.2
	OPENBSD_4_0:1.1.1.2
	MIRBSD_9_BASE:1.1.1.1
	cvs-200606162342:1.1.1.1
	cvs-200606022000:1.1.1.1
	cvs-200604191000:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.3
date	2008.12.16.22.09.56;	author tg;	state Exp;
branches;
next	1.2;
commitid	100494827410CE656F5;

1.2
date	2008.12.16.20.55.23;	author tg;	state dead;
branches;
next	1.1;
commitid	100494815C97ECEEDBF;

1.1
date	2006.04.19.10.15.03;	author tg;	state Exp;
branches
	1.1.1.1;
next	;
commitid	10044460DB21E1F715C;

1.1.1.1
date	2006.04.19.10.15.03;	author tg;	state Exp;
branches;
next	1.1.1.2;
commitid	10044460DB21E1F715C;

1.1.1.2
date	2006.09.20.19.06.48;	author tg;	state Exp;
branches;
next	;
commitid	10045119150397FC669;


desc
@@


1.3
log
@add back; this is required until we update OpenSSL
@
text
@/* $OpenBSD: md-sha256.c,v 1.3 2006/03/25 13:17:02 djm Exp $ */
/*
 * Copyright (c) 2005 Damien Miller <djm@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

/* EVP wrapper for SHA256 */

#include <openssl/evp.h>
#include <sha2.h>
#include <string.h>

/* helper until OpenSSL 0.9.8h+ upgrade */
__RCSID("$MirOS$");

const EVP_MD *evp_ssh_sha256(void);

static int
ssh_sha256_init(EVP_MD_CTX *ctxt)
{
	SHA256_Init(ctxt->md_data);
	return (1);
}

static int
ssh_sha256_update(EVP_MD_CTX *ctxt, const void *data, unsigned long len)
{
	SHA256_Update(ctxt->md_data, data, len);
	return (1);
}

static int
ssh_sha256_final(EVP_MD_CTX *ctxt, unsigned char *digest)
{
	SHA256_Final(digest, ctxt->md_data);
	return (1);
}

static int
ssh_sha256_cleanup(EVP_MD_CTX *ctxt)
{
	memset(ctxt->md_data, 0, sizeof(SHA256_CTX));
	return (1);
}

const EVP_MD *
evp_ssh_sha256(void)
{
	static EVP_MD ssh_sha256;

	memset(&ssh_sha256, 0, sizeof(ssh_sha256));
	ssh_sha256.type = NID_undef;
	ssh_sha256.md_size = SHA256_DIGEST_LENGTH;
	ssh_sha256.init = ssh_sha256_init;
	ssh_sha256.update = ssh_sha256_update;
	ssh_sha256.final = ssh_sha256_final;
	ssh_sha256.cleanup = ssh_sha256_cleanup;
	ssh_sha256.block_size = SHA256_BLOCK_LENGTH;
	ssh_sha256.ctx_size = sizeof(SHA256_CTX);

	return (&ssh_sha256);
}
@


1.2
log
@fastmerge, do not use yet!
@
text
@a19 1
#include "includes.h"
d22 1
d24 2
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@I decided we'd better upgrade OpenSSH before releasing to the general public
@
text
@@


1.1.1.2
log
@import a few security-wise relevant changes right now
@
text
@d1 1
a1 1
/* $OpenBSD: md-sha256.c,v 1.5 2006/08/03 03:34:42 deraadt Exp $ */
d20 1
a20 2
#include <sys/types.h>

d22 1
a23 2
#include <sha2.h>
#include <string.h>
@

