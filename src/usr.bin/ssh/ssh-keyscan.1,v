head	1.5;
access;
symbols
	cvs-200910041320:1.1.1.7
	cvs-200903221200:1.1.1.7
	cvs-200812162015:1.1.1.6
	cvs-200804031830:1.1.1.5
	MIRBSD_10:1.3.0.2
	MIRBSD_10_BASE:1.3
	cvs-200803022030:1.1.1.5
	cvs-200709131337:1.1.1.5
	cvs-200709021830:1.1.1.5
	cvs-200708201200:1.1.1.5
	cvs-200706161500:1.1.1.5
	cvs-200705192215:1.1.1.4
	cvs-200704292000:1.1.1.4
	cvs-200703080900:1.1.1.4
	cvs-200701251600:1.1.1.4
	cvs-200612111600:1.1.1.4
	cvs-200611090230:1.1.1.4
	OPENBSD_4_0:1.1.1.3
	MIRBSD_9_BASE:1.1.1.3
	cvs-200606162342:1.1.1.3
	cvs-200606022000:1.1.1.3
	cvs-200604191000:1.1.1.3
	cvs-200602220045:1.1.1.3
	MIRBSD_8:1.1.1.3.0.2
	MIRBSD_8_BASE:1.1.1.3
	cvs-200512201942:1.1.1.3
	cvs-200511231930:1.1.1.3
	cvs-200507211800:1.1.1.2
	cvs-200506221550:1.1.1.2
	cvs-200505050030:1.1.1.2
	cvs-200504291700:1.1.1.2
	cvs-200504261445:1.1.1.2
	cvs-200504141900:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.5
date	2009.03.22.15.01.21;	author tg;	state Exp;
branches;
next	1.4;
commitid	10049C652CD5CCC321F;

1.4
date	2008.12.16.20.55.29;	author tg;	state Exp;
branches;
next	1.3;
commitid	100494815C97ECEEDBF;

1.3
date	2007.06.16.15.41.51;	author tg;	state Exp;
branches;
next	1.2;
commitid	100467404D10F2EE204;

1.2
date	2006.10.13.18.40.51;	author tg;	state Exp;
branches;
next	1.1;
commitid	100452FDDB7190872BF;

1.1
date	2005.02.05.17.29.55;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.29.55;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.04.14.19.33.29;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2005.11.23.19.34.15;	author tg;	state Exp;
branches;
next	1.1.1.4;
commitid	116a4384c4467ffc;

1.1.1.4
date	2006.11.09.02.38.01;	author tg;	state Exp;
branches;
next	1.1.1.5;
commitid	100455294981A6201C8;

1.1.1.5
date	2007.06.16.15.11.13;	author tg;	state Exp;
branches;
next	1.1.1.6;
commitid	1004673FD85114A3F32;

1.1.1.6
date	2008.12.16.20.15.34;	author tg;	state Exp;
branches;
next	1.1.1.7;
commitid	10049480C7A2701F5C0;

1.1.1.7
date	2009.03.22.12.03.00;	author tg;	state Exp;
branches;
next	;
commitid	10049C6290649163EA3;


desc
@@


1.5
log
@merge and tweak ciphers and MACs
@
text
@.\"	$OpenBSD: ssh-keyscan.1,v 1.26 2008/12/29 01:12:36 stevesk Exp $
.\"
.\" Copyright 1995, 1996 by David Mazieres <dm@@lcs.mit.edu>.
.\"
.\" Modification and redistribution in source and binary forms is
.\" permitted provided that due credit is given to the author and the
.\" OpenBSD project by leaving this copyright notice intact.
.\"
.Dd $Mdocdate: March 22 2009 $
.Dt SSH-KEYSCAN 1
.Os
.Sh NAME
.Nm ssh-keyscan
.Nd gather ssh public keys
.Sh SYNOPSIS
.Nm ssh-keyscan
.Bk -words
.Op Fl 46Hv
.Op Fl f Ar file
.Op Fl p Ar port
.Op Fl T Ar timeout
.Op Fl t Ar type
.Op Ar host | addrlist namelist
.Ar ...
.Ek
.Sh DESCRIPTION
.Nm
is a utility for gathering the public ssh host keys of a number of
hosts.
It was designed to aid in building and verifying
.Pa ssh_known_hosts
files.
.Nm
provides a minimal interface suitable for use by shell and perl
scripts.
.Pp
.Nm
uses non-blocking socket I/O to contact as many hosts as possible in
parallel, so it is very efficient.
The keys from a domain of 1,000
hosts can be collected in tens of seconds, even when some of those
hosts are down or do not run ssh.
For scanning, one does not need
login access to the machines that are being scanned, nor does the
scanning process involve any encryption.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl 4
Forces
.Nm
to use IPv4 addresses only.
.It Fl 6
Forces
.Nm
to use IPv6 addresses only.
.It Fl f Ar file
Read hosts or
.Pa addrlist namelist
pairs from this file, one per line.
If
.Pa -
is supplied instead of a filename,
.Nm
will read hosts or
.Pa addrlist namelist
pairs from the standard input.
.It Fl H
Hash all hostnames and addresses in the output.
Hashed names may be used normally by
.Nm ssh
and
.Nm sshd ,
but they do not reveal identifying information should the file's contents
be disclosed.
.It Fl p Ar port
Port to connect to on the remote host.
.It Fl T Ar timeout
Set the timeout for connection attempts.
If
.Pa timeout
seconds have elapsed since a connection was initiated to a host or since the
last time anything was read from that host, then the connection is
closed and the host in question considered unavailable.
Default is 5 seconds.
.It Fl t Ar type
Specifies the type of the key to fetch from the scanned hosts.
The possible values are
.Dq rsa1
for protocol version 1 and
.Dq rsa
or
.Dq dsa
for protocol version 2.
Multiple values may be specified by separating them with commas.
The default is
.Dq rsa .
.It Fl v
Verbose mode.
Causes
.Nm
to print debugging messages about its progress.
.El
.Sh SECURITY
If an ssh_known_hosts file is constructed using
.Nm
without verifying the keys, users will be vulnerable to
.Em man in the middle
attacks.
On the other hand, if the security model allows such a risk,
.Nm
can help in the detection of tampered keyfiles or man in the middle
attacks which have begun after the ssh_known_hosts file was created.
.Sh FILES
.Pa Input format:
.Bd -literal
1.2.3.4,1.2.4.4 name.my.domain,name,n.my.domain,n,1.2.3.4,1.2.4.4
.Ed
.Pp
.Pa Output format for rsa1 keys:
.Bd -literal
host-or-namelist bits exponent modulus
.Ed
.Pp
.Pa Output format for rsa and dsa keys:
.Bd -literal
host-or-namelist keytype base64-encoded-key
.Ed
.Pp
Where
.Pa keytype
is either
.Dq ssh-rsa
or
.Dq ssh-dss .
.Pp
.Pa /etc/ssh/ssh_known_hosts
.Sh EXAMPLES
Print the
.Pa rsa
host key for machine
.Pa hostname :
.Bd -literal
$ ssh-keyscan hostname
.Ed
.Pp
Find all hosts from the file
.Pa ssh_hosts
which have new or different keys from those in the sorted file
.Pa ssh_known_hosts :
.Bd -literal
$ ssh-keyscan -t rsa,dsa -f ssh_hosts | \e
	sort -u - ssh_known_hosts | diff ssh_known_hosts -
.Ed
.Sh SEE ALSO
.Xr ssh 1 ,
.Xr sshd 8
.Sh AUTHORS
.An -nosplit
.An David Mazieres Aq dm@@lcs.mit.edu
wrote the initial version, and
.An Wayne Davison Aq wayned@@users.sourceforge.net
added support for protocol version 2.
.Sh BUGS
It generates "Connection closed by remote host" messages on the consoles
of all the machines it scans if the server is older than version 2.9.
This is because it opens a connection to the ssh port, reads the public
key, and drops the connection as soon as it gets the key.
@


1.4
log
@fastmerge, do not use yet!
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.25 2008/11/01 11:14:36 sobrado Exp $
d9 1
a9 1
.Dd $Mdocdate: December 16 2008 $
d140 1
a140 1
.Pa rsa1
@


1.3
log
@sync’n’bump
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.23 2007/05/31 19:20:16 jmc Exp $
d9 1
a9 1
.Dd $Mdocdate: June 16 2007 $
d24 1
a24 1
.Op Ar ...
d97 1
a97 1
.Dq rsa1 .
@


1.2
log
@merge the 4.0 equivalent of 015_ssh.patch
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.22 2006/09/25 04:55:38 ray Exp $
d9 1
a9 1
.Dd January 1, 1996
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.18 2004/07/12 23:34:25 brad Exp $
d18 2
a19 1
.Op Fl v46
a22 1
.Op Fl f Ar file
d49 27
a97 11
.It Fl f Ar filename
Read hosts or
.Pa addrlist namelist
pairs from this file, one per line.
If
.Pa -
is supplied instead of a filename,
.Nm
will read hosts or
.Pa addrlist namelist
pairs from the standard input.
a102 8
.It Fl 4
Forces
.Nm
to use IPv4 addresses only.
.It Fl 6
Forces
.Nm
to use IPv6 addresses only.
d105 1
a105 1
If a ssh_known_hosts file is constructed using
d159 1
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@OpenSSH-current
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.20 2005/03/01 15:47:14 jmc Exp $
d18 1
a18 2
.Op Fl 46Hv
.Op Fl f Ar file
d22 1
a48 27
.It Fl 4
Forces
.Nm
to use IPv4 addresses only.
.It Fl 6
Forces
.Nm
to use IPv6 addresses only.
.It Fl f Ar file
Read hosts or
.Pa addrlist namelist
pairs from this file, one per line.
If
.Pa -
is supplied instead of a filename,
.Nm
will read hosts or
.Pa addrlist namelist
pairs from the standard input.
.It Fl H
Hash all hostnames and addresses in the output.
Hashed names may be used normally by
.Nm ssh
and
.Nm sshd ,
but they do not reveal identifying information should the file's contents
be disclosed.
d71 11
d87 8
@


1.1.1.3
log
@Import current OpenSSH
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.21 2005/09/30 20:34:26 jaredy Exp $
a158 1
.An -nosplit
@


1.1.1.4
log
@OpenSSH 4.5 (security)
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.22 2006/09/25 04:55:38 ray Exp $
d105 1
a105 1
If an ssh_known_hosts file is constructed using
@


1.1.1.5
log
@Import latest OpenSSH and OpenBSD-libssl
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.23 2007/05/31 19:20:16 jmc Exp $
d9 1
a9 1
.Dd $Mdocdate$
@


1.1.1.6
log
@OpenSSH-current
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.25 2008/11/01 11:14:36 sobrado Exp $
d9 1
a9 1
.Dd $Mdocdate: November 1 2008 $
d24 1
a24 1
.Ar ...
d97 1
a97 1
.Dq rsa .
@


1.1.1.7
log
@OpenSSH 5.2, or so
@
text
@d1 1
a1 1
.\"	$OpenBSD: ssh-keyscan.1,v 1.26 2008/12/29 01:12:36 stevesk Exp $
d9 1
a9 1
.Dd $Mdocdate: December 29 2008 $
d140 1
a140 1
.Pa rsa
@


