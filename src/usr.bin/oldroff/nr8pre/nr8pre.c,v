head	1.4;
access;
symbols
	MIRBSD_10:1.3.0.4
	MIRBSD_10_BASE:1.3
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	mirbsd:1.1.7;
locks; strict;
comment	@ * @;


1.4
date	2008.11.08.23.04.39;	author tg;	state Exp;
branches;
next	1.3;
commitid	10049161AB22DF5DFC5;

1.3
date	2005.12.17.05.46.29;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043A3A3E65E20A413;

1.2
date	2005.04.16.03.22.00;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.06.16.56.02;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.06.16.56.02;	author tg;	state Exp;
branches;
next	;


desc
@@


1.4
log
@more mass conversions, including ancient eMail addresses
@
text
@/* $MirOS: src/usr.bin/oldroff/nr8pre/nr8pre.c,v 1.3 2005/12/17 05:46:29 tg Exp $ */

/*-
 * Copyright (c) 2004, 2005
 *	Thorsten "mirabilos" Glaser <tg@@mirbsd.org>
 *
 * Licensee is hereby permitted to deal in this work without restric-
 * tion, including unlimited rights to use, publicly perform, modify,
 * merge, distribute, sell, give away or sublicence, provided all co-
 * pyright notices above, these terms and the disclaimer are retained
 * in all redistributions or reproduced in accompanying documentation
 * or other materials provided with binary redistributions.
 *
 * All advertising materials mentioning features or use of this soft-
 * ware must display the following acknowledgement:
 *	This product includes material provided by Thorsten Glaser.
 *
 * Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
 * express, or implied, to the maximum extent permitted by applicable
 * law, without malicious intent or gross negligence; in no event may
 * licensor, an author or contributor be held liable for any indirect
 * or other damage, or direct damage except proven a consequence of a
 * direct error of said person and intended use of this work, loss or
 * other issues arising in any way out of its use, even if advised of
 * the possibility of such damage or existence of a nontrivial bug.
 */

#include <sys/param.h>
#include <stdio.h>
#include <unistd.h>

__RCSID("$MirOS: src/usr.bin/oldroff/nr8pre/nr8pre.c,v 1.3 2005/12/17 05:46:29 tg Exp $");

#define	putstr(x)	fputs((x), stdout)

int
main(int argc, char *argv[])
{
	uint8_t c = 0;
	int i, v = 0, status = 0, max = 127;

	if ((argc > 1) && (argv[1][0] == '-'))
		switch(argv[1][1]) {
		case '7':
			max = 255;
			break;
		}

	setvbuf(stdin, NULL, _IOFBF, 0);
	setvbuf(stdout, NULL, _IOFBF, 0);

	while (read(0, &c, 1) == 1)
		switch (status) {
		case 4:
		case 3:
			if (c == '\'') {
				status = 0;
				c = v;
				goto special;
			}
			if (status == 4)
				break;
			if ((c < '0') || (c > '9')) {
				status = 4;
				break;
			}
			v = (v * 10) + (c - '0');
			break;
		case 2:
			if (c == '\'') {
				status = 3;
				v = 0;
				break;
			}
			status = 0;
			putchar('\\');
			putchar('N');
			goto regular;
			break;
		case 1:
			if (c == 'N') {
				status = 2;
				break;
			}
			status = 0;
			putchar('\\');
			goto regular;
			break;
		case 0:
			if (c == '\\') {
				status = 1;
				break;
			}
		regular:
			if (c < max)
				putchar(c);
			else {
			special:
				putstr("\\(88");
				for (i = 128 | 32768; i > 128; i >>= 1)
					if (c & (i & 255))
						putstr("\\(81");
					else
						putstr("\\(80");
			}
			break;
		}

	return 0;
}
@


1.3
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d1 1
a1 1
/* $MirOS: src/usr.bin/oldroff/nr8pre/nr8pre.c,v 1.2 2005/04/16 03:22:00 tg Exp $ */
d5 1
a5 1
 *	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d32 1
a32 1
__RCSID("$MirOS: src/usr.bin/oldroff/nr8pre/nr8pre.c,v 1.2 2005/04/16 03:22:00 tg Exp $");
@


1.2
log
@* new option: nrcon -e
  works like "nrcon -8" but also gives nr8pre the option -7
* new option: nr8pre -7
  prevents escaping of hi-bit7 characters from nroff
  (kind of compatibility mode)
* change default behaviour of nr8pre: implement GNU groff extension
  to change "\N'xxx'" to the character whose ASCII code is xxx, given
  in decimals. Our implementation doesn't handle escaping the \N and
  ignores everything between "xxx" and the closing "'". The character
  (escape sequence) is emitted at the closing "'". This is a feasible
  way to escape characters like the double quotes, if you can afford
  to run nr8post afterwards. If using nr8pre -7, it is otherwise fully
  compatible to nrcon without a special flag.
@
text
@d1 1
a1 1
/* $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $ */
d18 8
a25 7
 * Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
 * any kind, expressed or implied, to the maximum extent permitted by
 * applicable law, but with the warranty of being written without ma-
 * licious intent or gross negligence; in no event shall licensor, an
 * author or contributor be held liable for any damage, direct, indi-
 * rect or other, however caused, arising in any way out of the usage
 * of this work, even if advised of the possibility of such damage.
d32 1
a32 1
__RCSID("$MirOS: src/usr.bin/oldroff/nr8pre/nr8pre.c,v 1.1.7.1 2005/03/06 16:56:02 tg Exp $");
@


1.1
log
@Initial revision
@
text
@d4 1
a4 1
 * Copyright (c) 2004
d14 4
d31 1
a31 1
__RCSID("$MirOS$");
d36 1
a36 1
main()
d39 8
a46 1
	int i;
d52 54
a105 9
		if (c < 127)
			putchar(c);
		else {
			putstr("\\(88");
			for (i = 128 | 32768; i > 128; i >>= 1)
				if (c & (i & 255))
					putstr("\\(81");
				else
					putstr("\\(80");
@


1.1.7.1
log
@4.4BSD-Alpha based nroff
@
text
@@
