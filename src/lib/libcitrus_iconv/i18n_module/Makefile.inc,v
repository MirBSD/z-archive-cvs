head	1.8;
access;
symbols
	MIRBSD_10:1.5.0.2
	MIRBSD_10_BASE:1.5
	MIRBSD_9_BASE:1.4
	cvs-200601311430:1.1.3.1
	netbsd:1.1.3;
locks; strict;
comment	@# @;


1.8
date	2013.03.18.19.14.50;	author tg;	state Exp;
branches;
next	1.7;
commitid	1005147677453E2E982;

1.7
date	2013.03.01.12.32.46;	author tg;	state Exp;
branches;
next	1.6;
commitid	10051309FCF20ABA5B3;

1.6
date	2009.08.30.18.04.10;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004A9ABF0C29F10D97;

1.5
date	2006.09.29.21.59.55;	author tg;	state Exp;
branches;
next	1.4;
commitid	100451D976E2EA68231;

1.4
date	2006.04.06.22.10.49;	author tg;	state Exp;
branches;
next	1.3;
commitid	100443591E51B9FE52E;

1.3
date	2006.01.31.17.27.30;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043DF9E08278D9A57;

1.2
date	2006.01.31.16.43.24;	author tg;	state Exp;
branches;
next	1.1;
commitid	10043DF93C24D68C04F;

1.1
date	2006.01.31.14.39.41;	author tg;	state Exp;
branches
	1.1.3.1;
next	;
commitid	10043DF76B526997FF9;

1.1.3.1
date	2006.01.31.14.39.41;	author tg;	state Exp;
branches;
next	;
commitid	10043DF76B526997FF9;


desc
@@


1.8
log
@invent a new library type “extension” that is between DLL and plugin:
usually versioned, has LDADD and no-undefined, but not normally¹ -lc

① for now it has, but we add --as-needed here

XXX maybe, eventually, we should always use --as-needed?
XXX bsd makefiles as we know them are not suitable for today's environment
XXX anyway; in addition, using gcc adds -lc for SSP which pcc doesn't, etc
@
text
@# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.7 2013/03/01 12:32:46 tg Exp $
# $NetBSD: Makefile.inc,v 1.8 2004/05/17 05:49:54 lukem Exp $

.include <bsd.own.mk>
.include "../Makefile.inc"

SHLIB_TYPE=	extension
.include "shlib_version"
SHLIB_VERSION?=	${major}.${minor}
LDFLAGS+=	-L${.OBJDIR:C!i18n_module/[^/]*/!!}
LDADD+=		-liconv

LIBDIR=		/usr/lib/i18n
CPPFLAGS+=	-I${NBLIBC}/citrus
CPPFLAGS+=	-DLIBC_SCCS
BASENAME=	${.CURDIR:T}
LIB=		${BASENAME}
SRCS_1=		${SRCPRE}${BASENAME}.c
SRCS_2!=	echo '${SRCS_1}' | tr '[:upper:]' '[:lower:]'
SRCS?=		${SRCS_2}

.PATH:	${NBLIBC}/citrus/modules
@


1.7
log
@SHLIB_TYPE=plugin causes python/gajim to segfault because some of these
plugins are not self-contained, and the load order doesn’t seem to be in
order; linking them against libiconv fixes this for me
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.6 2009/08/30 18:04:10 tg Exp $
d7 1
a7 1
# versioned(!) plugins
@


1.6
log
@add experimental support for distinguishing between DLLs and plugins
to <bsd.lib.mk> – both versioned and unversioned

needs to be tested on GNU (Interix) and DyLD (Darwin, Mac OSX)

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.5 2006/09/29 21:59:55 tg Exp $
d10 2
a11 1
SHLIB_TYPE=	plugin
@


1.5
log
@use new _LIBS_STATIC=No
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.4 2006/04/06 22:10:49 tg Exp $
a3 5
NOLINT=		# defined
NOPICINSTALL=	# defined
_LIBS_STATIC=	No
NOPROFILE=	# defined

d7 1
a7 1
# versioned(!) bundles
d10 1
@


1.4
log
@I don't know whether we'd want to patch <bsd.lib.mk> and
add some configurational variable instead... but this
should work, for now

@@@@ -22,3 +22,7 @@@@ SRCS_2!=      echo '${SRCS_1}' | tr '[:upper:
 SRCS?=         ${SRCS_2}

 .PATH: ${NBLIBC}/citrus/modules
+
+afterinstall:
+       # These are bundles, no dylibs
+       -rm -f ${DESTDIR}${LIBDIR}/lib${LIB}.a
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.3 2006/01/31 17:27:30 tg Exp $
d6 1
a25 4

afterinstall:
	# These are bundles, no dylibs
	-rm -f ${DESTDIR}${LIBDIR}/lib${LIB}.a
@


1.3
log
@slowly proceed in creating a library
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/i18n_module/Makefile.inc,v 1.2 2006/01/31 16:43:24 tg Exp $
d25 4
@


1.2
log
@initial MirOSification
@
text
@d1 1
a1 1
# $MirOS$
d11 4
a19 1
SHLIB_SONAME=	lib${LIB}.so.4.4	# versioned(!) bundle
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
#	$NetBSD: Makefile.inc,v 1.8 2004/05/17 05:49:54 lukem Exp $
d9 1
a10 1
SHLIB_VERSION_FILE=	${NETBSDSRCDIR}/lib/i18n_module/shlib_version
d12 1
a12 4
SHLIBDIR=	/usr/lib/i18n
SHLIBINSTALLDIR=/usr/lib/i18n
CPPFLAGS+=	-I${NETBSDSRCDIR}/lib/libc/citrus
CPPFLAGS+=	-DLOCALEMOD_MAJOR=${SHLIB_MAJOR}
d16 4
a19 1
SRCS?=		${SRCPRE:tl}${BASENAME:tl}.c
d21 1
a21 1
.PATH:	${NETBSDSRCDIR}/lib/libc/citrus/modules
@


1.1.3.1
log
@Import some TNF sources for citrus, to be stripped down into an iconv(3) lib
@
text
@@
