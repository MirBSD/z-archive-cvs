head	1.5;
access;
symbols
	MIRBSD_10:1.5.0.2
	MIRBSD_10_BASE:1.5
	MIRBSD_9_BASE:1.5;
locks; strict;
comment	@# @;


1.5
date	2006.02.01.16.25.21;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043E0E107209169FB;

1.4
date	2006.02.01.16.22.47;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043E0E000252DA80E;

1.3
date	2006.02.01.14.40.13;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043E0C82F27B079A6;

1.2
date	2006.01.31.19.13.42;	author tg;	state Exp;
branches;
next	1.1;
commitid	10043DFB6DF5492A8E6;

1.1
date	2006.01.31.17.27.29;	author tg;	state Exp;
branches;
next	;
commitid	10043DF9E08278D9A57;


desc
@@


1.5
log
@sync CLEANFILES
@
text
@# $MirOS: src/lib/libcitrus_iconv/Makefile,v 1.4 2006/02/01 16:22:47 tg Exp $

.include <bsd.own.mk>
.include "Makefile.inc"
.include "i18n_module/shlib_version"
SHLIB_VERSION?=	${major}.${minor}

SUBDIR+=	i18n_module
.if make(obj) || make(clean) || make(cleandir)
SUBDIR+=	test
.endif

.PATH: ${NBLIBC}/citrus ${NBLIBC}/citrus/modules ${NBLIBC}/iconv

LIB=		iconv
DPADD+=		${.CURDIR}/iconv.exp
LDFLAGS+=	-Wl,--version-script,${.CURDIR}/iconv.exp
SRCS=		citrus_bcs.c citrus_csmapper.c citrus_db.c \
		citrus_db_hash.c citrus_esdb.c citrus_hash.c \
		citrus_iconv.c citrus_lookup.c citrus_mapper.c \
		citrus_memstream.c citrus_mmap.c citrus_module.c \
		citrus_none.c citrus_stdenc.c iconv.c
MAN=		iconv.3

MLINKS+=	iconv.3 iconv_open.3 \
		iconv.3 iconv_close.3

# fake Libtool
lt_current!=	print $$((${SHLIB_VERSION:R} + ${SHLIB_VERSION:E}))
lt_age=		${SHLIB_VERSION:E}

all: libiconv.la
CLEANFILES+=	libiconv.la

libiconv.la: iconv.la
	sed -e 's!@@SHLIB_VERSION@@!${SHLIB_VERSION}!g' \
	    -e 's!@@LIBDIR@@!${LIBDIR}!g' \
	    -e 's!@@current@@!${lt_current}!g' \
	    -e 's!@@age@@!${lt_age}!g' \
	    <$> >$@@

afterinstall:
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${SHAREMODE} \
	    libiconv.la ${DESTDIR}${LIBDIR}/

.include <bsd.lib.mk>
@


1.4
log
@help ports to pick us up

XXX GNU lib-link.m4 looks for 'libiconv.so' then 'libiconv.a' and
XXX obviously only finds the latter; if a Makefile then uses
XXX ${LTLIBICONV} instead of ${LIBICONV} it should work nonetheless
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/Makefile,v 1.3 2006/02/01 14:40:13 tg Exp $
d33 1
@


1.3
log
@Install as libiconv.{a,so.4.4} because it's compatible with GNU libiconv,
the functions are weak, and the internal functions are namespace'd with
_citrus. For everything else, add a symbol versioning script which doesn't
really version, just set visibility (global/local) of symbols.
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/Makefile,v 1.2 2006/01/31 19:13:42 tg Exp $
d28 17
@


1.2
log
@commit a working, stripped-down (may be cleaning up the attic later,
but not for now) BSD-licenced libiconv replacement
@
text
@d1 1
a1 1
# $MirOS: src/lib/libcitrus_iconv/Makefile,v 1.1 2006/01/31 17:27:29 tg Exp $
d15 3
a17 1
LIB=		citrus_iconv
@


1.1
log
@slowly proceed in creating a library
@
text
@d1 1
a1 1
# $MirOS$
d8 4
a11 1
SUBDIR+=	i18n_module/iconv_std
a25 9
CPPFLAGS+=	-I${NBLIBC}/citrus -I${NBLIBC}/citrus/modules \
		-I${BSDSRCDIR}/lib/libc/include -I${NBLIBC}

CPPFLAGS+=	-D'_PATH_CSMAPPER="/usr/share/i18n/csmapper"' \
		-D'_PATH_ESDB="/usr/share/i18n/esdb"' \
		-D'_PATH_ICONV="/usr/share/i18n/iconv"' \
		-DI18NMODULE_MAJOR=${major} \
		-DCITRUS -DCITRUS_ICONV

@

