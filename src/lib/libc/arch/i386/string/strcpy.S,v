head	1.6;
access;
symbols
	MIRBSD_10:1.5.0.4
	MIRBSD_10_BASE:1.5
	MIRBSD_9_BASE:1.5
	MIRBSD_8:1.5.0.2
	MIRBSD_8_BASE:1.5
	cvs-200509212000:1.1.1.3
	cvs-200507211800:1.1.1.2
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2014.03.23.20.36.09;	author tg;	state Exp;
branches;
next	1.5;
commitid	100532F45B47A810412;

1.5
date	2005.10.21.10.53.23;	author tg;	state Exp;
branches;
next	1.4;
commitid	43a64358c889b118;

1.4
date	2005.09.22.20.06.18;	author tg;	state Exp;
branches;
next	1.3;
commitid	6f1343330ecb365c;

1.3
date	2005.04.16.19.52.21;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.06.20.28.30;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.24.37;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.24.37;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2005.07.21.20.52.16;	author tg;	state Exp;
branches;
next	1.1.1.3;
commitid	560042e0092f571e;

1.1.1.3
date	2005.09.21.20.34.16;	author tg;	state Exp;
branches;
next	;
commitid	20cd4331c3c732a2;


desc
@@


1.6
log
@• <machine/asm.h>: add "REF! " to __warn_references equivalent
• strc??.S: use WARN_REFERENCES() macro
@
text
@/* $MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.5 2005/10/21 10:53:23 tg Exp $ */
/*
 * Written by J.T. Conklin <jtc@@netbsd.org>.
 * Public domain.
 */

#include <machine/asm.h>

WARN_REFERENCES(strcpy, "strcpy() is almost always misused, consider using strlcpy()")

	.section .comment
	.asciz	"$MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.5 2005/10/21 10:53:23 tg Exp $"

	.text

/*
 * NOTE: I've unrolled the loop eight times: large enough to make a
 * significant difference, and small enough not to totally trash the
 * cache.
 */

ENTRY(strcpy)
	movl	4(%esp),%ecx		/* dst address */
	movl	8(%esp),%edx		/* src address */
	pushl	%ecx			/* push dst address */

	.align 2,0x90
L1:	movb	(%edx),%al		/* unroll loop, but not too much */
	movb	%al,(%ecx)
	testb	%al,%al
	jz	L2
	movb	1(%edx),%al
	movb	%al,1(%ecx)
	testb	%al,%al
	jz	L2
	movb	2(%edx),%al
	movb	%al,2(%ecx)
	testb	%al,%al
	jz	L2
	movb	3(%edx),%al
	movb	%al,3(%ecx)
	testb	%al,%al
	jz	L2
	movb	4(%edx),%al
	movb	%al,4(%ecx)
	testb	%al,%al
	jz	L2
	movb	5(%edx),%al
	movb	%al,5(%ecx)
	testb	%al,%al
	jz	L2
	movb	6(%edx),%al
	movb	%al,6(%ecx)
	testb	%al,%al
	jz	L2
	movb	7(%edx),%al
	movb	%al,7(%ecx)
	addl	$8,%edx
	addl	$8,%ecx
	testb	%al,%al
	jnz	L1
L2:	popl	%eax			/* pop dst address */
	ret
@


1.5
log
@* remove duplicate "warning: " prefix (ABIWARN)
* fix strerror after NLS removal
* bcmp -> memcmp (one occurence)
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.4 2005/09/22 20:06:18 tg Exp $ */
d9 1
a9 5
#APP
	.section .gnu.warning.strcpy
	.ascii "strcpy() is almost always misused, consider using strlcpy()"
	.text
#NO_APP
d12 1
a12 1
	.asciz	"$MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.4 2005/09/22 20:06:18 tg Exp $"
@


1.4
log
@merge
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.3 2005/04/16 19:52:21 tg Exp $ */
d11 1
a11 1
	.ascii "warning: strcpy() is almost always misused, consider using strlcpy()"
d16 1
a16 1
	.asciz	"$MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.3 2005/04/16 19:52:21 tg Exp $"
@


1.3
log
@make ABIWARNs greppable:
| warning:.*(.*).*consider
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/arch/i386/string/strcpy.S,v 1.2 2005/03/06 20:28:30 tg Exp $ */
a14 1
#ifdef LIBC_SCCS
d16 1
a16 2
	.asciz	"$MirOS$"
#endif
@


1.2
log
@merge src/lib
@
text
@d1 1
a1 1
/* $MirOS$ */
d15 5
a20 3
#if defined(LIBC_SCCS)
	.asciz "$OpenBSD: strcpy.S,v 1.4 2003/06/11 21:07:03 deraadt Exp $"
#endif
@


1.1
log
@Initial revision
@
text
@d1 1
a8 1
#if defined(APIWARN)
d10 3
a12 2
	.stabs "warning: strcpy() is almost always misused, consider using strlcpy()",30,0,0,0
	.stabs "_strcpy",1,0,0,0
a13 1
#endif
d15 1
d17 1
a17 2
	.text
	.asciz "$OpenBSD: strcpy.S,v 1.5 2003/07/24 01:15:42 deraadt Exp $"
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@Import almost everything (no ancontrol, ifconfig, pfctl, wicontrol)
of (the undeleted parts of) OpenBSD-current's userland of about 3 hours ago.
Warning: this introduces major breakage!
@
text
@d10 2
a11 2
	.section .gnu.warning.strcpy
	.ascii "warning: strcpy() is almost always misused, please use strlcpy()"
d17 1
a17 1
	.asciz "$OpenBSD: strcpy.S,v 1.7 2005/03/25 22:22:30 kettenis Exp $"
@


1.1.1.3
log
@Import OpenBSD's libc as of today, minus some of the locale stuff,
and with brk malloc instead of mmap malloc
@
text
@a0 1
/*	$OpenBSD: strcpy.S,v 1.8 2005/08/07 11:30:38 espie Exp $ */
d15 5
@


