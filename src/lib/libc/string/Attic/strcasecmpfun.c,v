head	1.7;
access;
symbols
	MIRBSD_10:1.6.0.2
	MIRBSD_10_BASE:1.6;
locks; strict;
comment	@ * @;


1.7
date	2010.01.10.20.18.52;	author tg;	state dead;
branches;
next	1.6;
commitid	1004B4A3588743BF0D3;

1.6
date	2007.08.08.20.57.41;	author tg;	state Exp;
branches;
next	1.5;
commitid	10046BA2E54570E080B;

1.5
date	2007.02.02.17.43.55;	author tg;	state Exp;
branches;
next	1.4;
commitid	10045C378640FBCD085;

1.4
date	2006.11.21.03.16.01;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045626F790AFBE40F;

1.3
date	2006.11.21.02.40.39;	author tg;	state Exp;
branches;
next	1.2;
commitid	100456267237794E11F;

1.2
date	2006.11.21.02.38.32;	author tg;	state Exp;
branches;
next	1.1;
commitid	100456266AC5E94A8E9;

1.1
date	2006.11.21.01.25.10;	author tg;	state Exp;
branches;
next	;
commitid	1004562556214E26914;


desc
@@


1.7
log
@• kern: new KERNISUSR (defined by libc and libmdsup, but not by either
  bootloader or kernel), enables new NUSRCS, UIF_NUSRCS
• move MD strncmp() to kern
• move MI {str,wcs}case{,n}cmp to kern
• make wcs* functions NU not KU as we don’t need them in the kernel YET
• move __main to NU (it’s a joke anyway, I think)
• bootloader: make devsw_prefix_match case-insensitive
@
text
@/* $MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.6 2007/08/08 20:57:41 tg Exp $ */

/*-
 * Copyright (c) 2006, 2007
 *	Thorsten Glaser <tg@@mirbsd.de>
 *
 * Provided that these terms and disclaimer and all copyright notices
 * are retained or reproduced in an accompanying document, permission
 * is granted to deal in this work without restriction, including un-
 * limited rights to use, publicly perform, distribute, sell, modify,
 * merge, give away, or sublicence.
 *
 * Advertising materials mentioning features or use of this work must
 * display the following acknowledgement:
 *	This product includes material provided by Thorsten Glaser.
 *
 * This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
 * the utmost extent permitted by applicable law, neither express nor
 * implied; without malicious intent or gross negligence. In no event
 * may a licensor, author or contributor be held liable for indirect,
 * direct, other damage, loss, or other issues arising in any way out
 * of dealing in the work, even if advised of the possibility of such
 * damage or existence of a defect, except proven that it results out
 * of said person's immediate fault when using the work as intended.
 */

#undef c_size
#undef c_wide
#ifdef WCSNCASECMP
#define c_size
#define c_wide
#endif
#ifdef WCSCASECMP
#define c_wide
#endif
#ifdef STRNCASECMP
#define c_size
#endif

#ifdef c_wide
#include <wctype.h>
#define CHAR		wchar_t
#define	LC(x)		L ## x
#define x_tolower	towlower
#define strcasecmp	wcscasecmp
#define strncasecmp	wcsncasecmp
#else
#include <ctype.h>
#include <string.h>
#define	CHAR		char
#define	LC(x)		x
#define	x_tolower	tolower
#endif

__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.6 2007/08/08 20:57:41 tg Exp $");

#ifndef c_size
int
strcasecmp(const CHAR *s1, const CHAR *s2)
{
	while (x_tolower(*s1) == x_tolower(*s2))
		if (*s1++ == LC('\0'))
			return (0);
		else
			s2++;
	return (x_tolower(*s1) - x_tolower(*s2));
}
#else
int
strncasecmp(const CHAR *s1, const CHAR *s2, size_t n)
{
	while (n--) {
		if (x_tolower(*s1) != x_tolower(*s2))
			return (x_tolower(*s1) - x_tolower(*s2));
		if (*s1++ == LC('\0'))
			break;
		s2++;
	}
	return (0);
}
#endif
@


1.6
log
@replace some unifdef(1) catastrophes
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.5 2007/02/02 17:43:55 tg Exp $ */
d55 1
a55 1
__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.5 2007/02/02 17:43:55 tg Exp $");
@


1.5
log
@SUSv3 says _tolower is a macro, but it also says its argument
must be an uppercase letter
@
text
@d1 1
a1 1
/* $MirOS: src/share/misc/licence.template,v 1.20 2006/12/11 21:04:56 tg Rel $ */
d27 11
a37 8
#if defined(WCSNCASECMP)
#define CMP	4
#elif defined(WCSCASECMP)
#define CMP	3
#elif defined(STRNCASECMP)
#define CMP	2
#else
#define CMP	1
d40 1
a40 1
#if CMP > 2
d55 1
a55 1
__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.4 2006/11/21 03:16:01 tg Exp $");
d57 1
a57 1
#if CMP & 1
d68 1
a68 3
#endif

#if !(CMP & 1)
@


1.4
log
@sometimes, unifdef(1) gets on my nerves
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.3 2006/11/21 02:40:39 tg Exp $ */
d4 1
a4 1
 * Copyright (c) 2006
d7 5
a11 6
 * Licensee is hereby permitted to deal in this work without restric-
 * tion, including unlimited rights to use, publicly perform, modify,
 * merge, distribute, sell, give away or sublicence, provided all co-
 * pyright notices above, these terms and the disclaimer are retained
 * in all redistributions or reproduced in accompanying documentation
 * or other materials provided with binary redistributions.
d17 8
a24 8
 * Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
 * express, or implied, to the maximum extent permitted by applicable
 * law, without malicious intent or gross negligence; in no event may
 * licensor, an author or contributor be held liable for any indirect
 * or other damage, or direct damage except proven a consequence of a
 * direct error of said person and intended use of this work, loss or
 * other issues arising in any way out of its use, even if advised of
 * the possibility of such damage or existence of a defect.
d49 1
a49 1
#define	x_tolower	_tolower
d52 1
a52 1
__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.3 2006/11/21 02:40:39 tg Exp $");
@


1.3
log
@unmerge lib/libc/string/strcasecmpfun.c and sys/lib/libkern/strncasecmp.c,
for simplicity
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.2 2006/11/21 02:38:32 tg Exp $ */
d28 6
a33 4
#if defined(WCSCASECMP)
#define WIDEC 1
#elif defined(WCSNCASECMP)
#define WIDEC 1
d35 1
a35 1
#define WIDEC 0
d38 1
a38 1
#if WIDEC
d41 1
a41 1
#define	LC		L
d49 1
a49 1
#define	LC		/* nothing */
d53 1
a53 1
__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.2 2006/11/21 02:38:32 tg Exp $");
d55 1
a55 1
#if defined(STRCASECMP) || defined(WCSCASECMP)
d60 1
a60 1
		if (*s1++ == LC '\0')
d68 1
a68 1
#if defined(STRNCASECMP) || defined(WCSNCASECMP)
d75 1
a75 1
		if (*s1++ == LC '\0')
@


1.2
log
@don't pack the kernel overly with RCS IDs or SCCS IDs,
should save a few bytes on the floppies
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.1 2006/11/21 01:25:10 tg Exp $ */
a43 3
#if defined(_KERNEL) || defined(_STANDALONE)
#include <lib/libkern/libkern.h>
#else
a45 1
#endif
d51 1
a51 3
#if !defined(_KERNEL) && !defined(_STANDALONE)
__RCSID("$MirOS: src/lib/libc/string/strcasecmpfun.c,v 1.1 2006/11/21 01:25:10 tg Exp $");
#endif
@


1.1
log
@save even more source files by using common code
(could be done for almost all of the wide* functions, but it still sucks)

this is cool because, if you spot a bug, you only fix it in one place,
not in n places
@
text
@d1 1
a1 1
/* $MirOS: src/share/misc/licence.template,v 1.14 2006/08/09 19:35:23 tg Rel $ */
d55 3
a57 1
__RCSID("$MirOS: src/lib/libc/string/strcasecmp.c,v 1.4 2006/11/21 01:04:10 tg Exp $");
@

