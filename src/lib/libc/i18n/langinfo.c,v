head	1.16;
access;
symbols
	MIRBSD_10:1.16.0.2
	MIRBSD_10_BASE:1.16
	MIRBSD_9_BASE:1.11
	MIRBSD_8:1.5.0.2
	MIRBSD_8_BASE:1.5;
locks; strict;
comment	@ * @;


1.16
date	2007.02.02.21.06.20;	author tg;	state Exp;
branches;
next	1.15;
commitid	10045C3A79F53A9E808;

1.15
date	2007.02.02.19.28.33;	author tg;	state Exp;
branches;
next	1.14;
commitid	10045C390D6140801E9;

1.14
date	2006.11.05.12.06.33;	author tg;	state Exp;
branches;
next	1.13;
commitid	100454DD3D331B1F3CC;

1.13
date	2006.11.01.18.31.11;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004548E7F474876706;

1.12
date	2006.09.07.17.13.15;	author tg;	state Exp;
branches;
next	1.11;
commitid	100450052C75BFF95AD;

1.11
date	2006.05.30.10.45.57;	author tg;	state Exp;
branches;
next	1.10;
commitid	100447C2250486BC3B8;

1.10
date	2006.05.21.12.38.39;	author tg;	state Exp;
branches;
next	1.9;
commitid	10044705F485836CDB8;

1.9
date	2006.05.21.12.12.29;	author tg;	state Exp;
branches;
next	1.8;
commitid	100447059215CDB3530;

1.8
date	2006.01.31.19.56.36;	author tg;	state Exp;
branches;
next	1.7;
commitid	10043DFC10402EA5B1A;

1.7
date	2006.01.31.19.55.33;	author tg;	state Exp;
branches;
next	1.6;
commitid	10043DFC0C9444BA9E1;

1.6
date	2006.01.31.19.51.34;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043DFBFD41D701215;

1.5
date	2005.12.17.05.46.14;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043A3A3E65E20A413;

1.4
date	2005.09.30.22.15.08;	author tg;	state Exp;
branches;
next	1.3;
commitid	2f9c433db8f943be;

1.3
date	2005.09.30.22.13.55;	author tg;	state Exp;
branches;
next	1.2;
commitid	3c62433db87ae478;

1.2
date	2005.09.30.21.45.26;	author tg;	state Exp;
branches;
next	1.1;
commitid	1c3c433db1f25546;

1.1
date	2005.09.22.21.21.09;	author tg;	state Exp;
branches;
next	;
commitid	57fb4333204cad7f;


desc
@@


1.16
log
@switch to a one-locale system; "the" locale is UTF-8 encoded 'C' now;
inline many simpler functions for reduced code size / imports / speed
and optimise a little - XXX untested
@
text
@/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.15 2007/02/02 19:28:33 tg Exp $ */

/*-
 * Copyright (c) 2003, 2004, 2005, 2006, 2007
 *	Thorsten Glaser <tg@@mirbsd.de>
 * Derived from work placed into the public domain by
 *	J.T. Conklin <jtc@@netbsd.org>
 *
 * Provided that these terms and disclaimer and all copyright notices
 * are retained or reproduced in an accompanying document, permission
 * is granted to deal in this work without restriction, including un-
 * limited rights to use, publicly perform, distribute, sell, modify,
 * merge, give away, or sublicence.
 *
 * Advertising materials mentioning features or use of this work must
 * display the following acknowledgement:
 *	This product includes material provided by Thorsten Glaser.
 *
 * This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
 * the utmost extent permitted by applicable law, neither express nor
 * implied; without malicious intent or gross negligence. In no event
 * may a licensor, author or contributor be held liable for indirect,
 * direct, other damage, loss, or other issues arising in any way out
 * of dealing in the work, even if advised of the possibility of such
 * damage or existence of a defect, except proven that it results out
 * of said person's immediate fault when using the work as intended.
 *-
 * Fake locale support, just enough to fool people. Functions are de-
 * fined weak in case someone wants to override these.
 */

#define _LOCALE_CONST_LCONV
#include <sys/param.h>
#include <sys/localedef.h>
#include <langinfo.h>
#include <locale.h>
#include <stdlib.h>

__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.15 2007/02/02 19:28:33 tg Exp $");

/* fake locale support */

struct lconv *__weak_localeconv(void);
/* const for gcc's sake */
const char *__weak_nl_langinfo(nl_item);

_TimeLocale _DefaultTimeLocale = {
	{ "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"	},
	{ "Sunday", "Monday", "Tuesday", "Wednesday",
	  "Thursday", "Friday", "Saturday"			},
	{ "Jan", "Feb", "Mar", "Apr", "May", "Jun",
	  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"		},
	{ "January", "February", "March", "April",
	  "May", "June", "July", "August", "September",
	  "October", "November", "December"			},
	{ "AM", "PM"						},
	"%a %b %d %H:%M:%S %Y", "%m/%d/%y",
	"%H:%M:%S", "%I:%M:%S %p"
};

struct lconv _DefaultLocaleConv = {
	".", "", "", "", "", "", "", "", "", "",
	CHAR_MAX, CHAR_MAX, CHAR_MAX, CHAR_MAX,
	CHAR_MAX, CHAR_MAX, CHAR_MAX, CHAR_MAX
};

struct lconv *
__weak_localeconv(void)
{
	return ((struct lconv *)&_DefaultLocaleConv);
}

const char *
__weak_nl_langinfo(nl_item item)
{
	const char *s;

	switch (item) {
	case CODESET:
		s = "UTF-8";
		break;
	case D_T_FMT:
		s = _DefaultTimeLocale.d_t_fmt;
		break;
	case D_FMT:
		s = _DefaultTimeLocale.d_fmt;
		break;
	case T_FMT:
		s = _DefaultTimeLocale.t_fmt;
		break;
	case T_FMT_AMPM:
		s = _DefaultTimeLocale.t_fmt_ampm;
		break;
	case AM_STR:
	case PM_STR:
		s = _DefaultTimeLocale.am_pm[item - AM_STR];
		break;
	case DAY_1:
	case DAY_2:
	case DAY_3:
	case DAY_4:
	case DAY_5:
	case DAY_6:
	case DAY_7:
		s = _DefaultTimeLocale.day[item - DAY_1];
		break;
	case ABDAY_1:
	case ABDAY_2:
	case ABDAY_3:
	case ABDAY_4:
	case ABDAY_5:
	case ABDAY_6:
	case ABDAY_7:
		s = _DefaultTimeLocale.abday[item - ABDAY_1];
		break;
	case MON_1:
	case MON_2:
	case MON_3:
	case MON_4:
	case MON_5:
	case MON_6:
	case MON_7:
	case MON_8:
	case MON_9:
	case MON_10:
	case MON_11:
	case MON_12:
		s = _DefaultTimeLocale.mon[item - MON_1];
		break;
	case ABMON_1:
	case ABMON_2:
	case ABMON_3:
	case ABMON_4:
	case ABMON_5:
	case ABMON_6:
	case ABMON_7:
	case ABMON_8:
	case ABMON_9:
	case ABMON_10:
	case ABMON_11:
	case ABMON_12:
		s = _DefaultTimeLocale.abmon[item - ABMON_1];
		break;
	case RADIXCHAR:
		s = _DefaultLocaleConv.decimal_point;
		break;
	case YESSTR:
		s = "yes";
		break;
	case YESEXPR:
		s = "^[Yy]";
		break;
	case NOSTR:
		s = "no";
		break;
	case NOEXPR:
		s = "^[Nn]";
		break;
	case THOUSEP:
	case CRNCYSTR:
	default:
		s = _DefaultLocaleConv.thousands_sep;
		break;
	}

	return (s);
}

__weak_alias(localeconv, __weak_localeconv);
__weak_alias(nl_langinfo, __weak_nl_langinfo);
@


1.15
log
@second step: get rid of all the MIR18N_* configurable constants
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.14 2006/11/05 12:06:33 tg Exp $ */
d4 1
a4 1
 * Copyright (c) 2003, 2004, 2005, 2006
d9 5
a13 6
 * Licensee is hereby permitted to deal in this work without restric-
 * tion, including unlimited rights to use, publicly perform, modify,
 * merge, distribute, sell, give away or sublicence, provided all co-
 * pyright notices above, these terms and the disclaimer are retained
 * in all redistributions or reproduced in accompanying documentation
 * or other materials provided with binary redistributions.
d19 8
a26 8
 * Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
 * express, or implied, to the maximum extent permitted by applicable
 * law, without malicious intent or gross negligence; in no event may
 * licensor, an author or contributor be held liable for any indirect
 * or other damage, or direct damage except proven a consequence of a
 * direct error of said person and intended use of this work, loss or
 * other issues arising in any way out of its use, even if advised of
 * the possibility of such damage or existence of a defect.
d39 1
a39 3
#include "mir18n.h"

__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.14 2006/11/05 12:06:33 tg Exp $");
d80 1
a80 2
		/* "UTF-8" should actually be "CESU-8" but who groks THAT? */
		s = __locale_is_utf8 ? "UTF-8" : "ISO_646.irv:1991";
@


1.14
log
@SUSv3 says that <nl_types.h> isn't required here
so say I ;)
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.13 2006/11/01 18:31:11 tg Exp $ */
d42 1
a42 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.13 2006/11/01 18:31:11 tg Exp $");
d84 1
a84 1
		s = __locale_is_utf8 ? "UTF-8" : MIR18N_CCODESET;
@


1.13
log
@switch nl_langinfo(CODESET) response appropriate to MIR18N_C_CSET defn
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.12 2006/09/07 17:13:15 tg Exp $ */
a37 1
#include <nl_types.h>
d42 1
a42 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.12 2006/09/07 17:13:15 tg Exp $");
@


1.12
log
@add CESU-8 as alias for UTF-8 since that is what we actually
use system-wide, outside of citrus (since our wchar_t is BMP
only)

XXX add CESU-8 read/write to citrus_utf8.c, no explicit op-
XXX tion to switch CESU-8 write on, just use wchar size

yes I know, CESU-8 "should not be used to interchange data",
but there is no way (outside of citrus) within mirbsd to in-
terchange UCS-4 data other than as UTF-16 (wchar_t *) or
CESU-8 (char *) strings, or convert them.
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.11 2006/05/30 10:45:57 tg Exp $ */
d43 1
a43 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.11 2006/05/30 10:45:57 tg Exp $");
d84 2
a85 4
		/* if MIR18N_SB_{MAX,CVT} are both 0xFF, we in fact
		 * have ISO-8859-1 character set, but we don't care
		 * because we're on the path to a CESU8-only system */
		s = __locale_is_utf8 ? "UTF-8" : "ISO_646.irv:1991";
@


1.11
log
@* use MIR18N_MB_MAX, MIR18N_SB_{MAX,CVT}
* __CRAZY=Yes cleanup
* as a bonus, get rid of a little casting session
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.10 2006/05/21 12:38:39 tg Exp $ */
d16 2
a17 2
 * All advertising materials mentioning features or use of this soft-
 * ware must display the following acknowledgement:
d27 1
a27 1
 * the possibility of such damage or existence of a nontrivial bug.
d43 1
a43 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.10 2006/05/21 12:38:39 tg Exp $");
d86 1
a86 1
		 * because we're on the path to a full UTF-8 system */
@


1.10
log
@a little KNF
btowc/wctob: sync, optimise

all except multibyte.c are no stubs but "the real thing" already
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.9 2006/05/21 12:12:29 tg Exp $ */
d33 1
d43 1
a43 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.9 2006/05/21 12:12:29 tg Exp $");
d84 3
@


1.9
log
@make MB_LEN_CUR overridable (weak function) too, in case
someone wants to plug in support for more than 2 locales
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.8 2006/01/31 19:56:36 tg Exp $ */
d42 1
a42 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.8 2006/01/31 19:56:36 tg Exp $");
d73 1
a73 1
	return (struct lconv *)&_DefaultLocaleConv;
d82 1
a82 1
	  case CODESET:
d85 1
a85 1
	  case D_T_FMT:
d88 1
a88 1
	  case D_FMT:
d91 1
a91 1
	  case T_FMT:
d94 1
a94 1
	  case T_FMT_AMPM:
d97 2
a98 2
	  case AM_STR:
	  case PM_STR:
d101 7
a107 7
	  case DAY_1:
	  case DAY_2:
	  case DAY_3:
	  case DAY_4:
	  case DAY_5:
	  case DAY_6:
	  case DAY_7:
d110 7
a116 7
	  case ABDAY_1:
	  case ABDAY_2:
	  case ABDAY_3:
	  case ABDAY_4:
	  case ABDAY_5:
	  case ABDAY_6:
	  case ABDAY_7:
d119 12
a130 12
	  case MON_1:
	  case MON_2:
	  case MON_3:
	  case MON_4:
	  case MON_5:
	  case MON_6:
	  case MON_7:
	  case MON_8:
	  case MON_9:
	  case MON_10:
	  case MON_11:
	  case MON_12:
d133 12
a144 12
	  case ABMON_1:
	  case ABMON_2:
	  case ABMON_3:
	  case ABMON_4:
	  case ABMON_5:
	  case ABMON_6:
	  case ABMON_7:
	  case ABMON_8:
	  case ABMON_9:
	  case ABMON_10:
	  case ABMON_11:
	  case ABMON_12:
d147 1
a147 1
	  case RADIXCHAR:
d150 1
a150 1
	  case YESSTR:
d153 1
a153 1
	  case YESEXPR:
d156 1
a156 1
	  case NOSTR:
d159 1
a159 1
	  case NOEXPR:
d162 3
a164 3
	  case THOUSEP:
	  case CRNCYSTR:
	  default:
@


1.8
log
@newbie's stupidity, missing break
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.7 2006/01/31 19:55:33 tg Exp $ */
d40 3
a42 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.7 2006/01/31 19:55:33 tg Exp $");
@


1.7
log
@was missing an include
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.6 2006/01/31 19:51:34 tg Exp $ */
d40 1
a40 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.6 2006/01/31 19:51:34 tg Exp $");
d82 1
@


1.6
log
@implement nl_langinfo(CODESET)
@
text
@d1 1
a1 1
/* $MirOS: src/share/misc/licence.template,v 1.6 2006/01/24 22:24:02 tg Rel $ */
d38 1
d40 1
a40 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.5 2005/12/17 05:46:14 tg Exp $");
@


1.5
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.4 2005/09/30 22:15:08 tg Exp $ */
d4 2
a5 2
 * Copyright (c) 2003, 2004, 2005
 *	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d16 4
d39 1
a39 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.4 2005/09/30 22:15:08 tg Exp $");
d79 2
@


1.4
log
@oops, deleted some includes too much
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.3 2005/09/30 22:13:55 tg Exp $ */
d16 8
a23 7
 * Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
 * any kind, expressed or implied, to the maximum extent permitted by
 * applicable law, but with the warranty of being written without ma-
 * licious intent or gross negligence; in no event shall licensor, an
 * author or contributor be held liable for any damage, direct, indi-
 * rect or other, however caused, arising in any way out of the usage
 * of this work, even if advised of the possibility of such damage.
d35 1
a35 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.3 2005/09/30 22:13:55 tg Exp $");
@


1.3
log
@replace __libc_mb_cur_max variable by the (__locale_is_utf8 ? 3 : 1)
equation in the MB_CUR_MAX macro; expose MB_LEN_MAX in <stdlib.h> too,
prevent duplicate definitions. Adjust includes appropriately - <locale.h>
is not needed any more.
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.2 2005/09/30 21:45:26 tg Exp $ */
d31 1
d34 1
a34 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.2 2005/09/30 21:45:26 tg Exp $");
@


1.2
log
@* write mbrtowc and wcrtomb (mostly according to POSIX spec)
  so our libc at least builds again
* fix all files for __CRAZY=yes build
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/i18n/langinfo.c,v 1.1 2005/09/22 21:21:09 tg Exp $ */
a30 1
#include <locale.h>
d33 1
a33 1
__RCSID("$MirOS: src/lib/libc/i18n/langinfo.c,v 1.1 2005/09/22 21:21:09 tg Exp $");
@


1.1
log
@split gen/i18n.c into categorised files, no functional change
@
text
@d1 1
a1 1
/* $MirOS: src/lib/libc/gen/i18n.c,v 1.1.7.1 2005/03/06 16:33:39 tg Exp $ */
d34 1
a34 1
__RCSID("$MirOS: src/lib/libc/gen/i18n.c,v 1.1.7.1 2005/03/06 16:33:39 tg Exp $");
d38 5
a42 1
const _TimeLocale _DefaultTimeLocale = {
d56 1
a56 1
const struct lconv _DefaultLocaleConv = {
d68 1
a68 1
char *
d158 1
a158 1
	return (char *)s;
@

