head	1.6;
access;
symbols
	MIRBSD_10:1.6.0.2
	MIRBSD_10_BASE:1.6
	cvs-200703091200:1.1.1.2
	MIRBSD_9_BASE:1.3
	MIRBSD_8:1.3.0.2
	MIRBSD_8_BASE:1.3
	cvs-200507211800:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2007.05.17.18.38.33;	author tg;	state Exp;
branches;
next	1.5;
commitid	100464CA0BC3310E768;

1.5
date	2007.04.28.00.12.44;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004632918E6CE6474D;

1.4
date	2007.03.09.13.05.07;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045F15B4849447B32;

1.3
date	2005.10.21.11.02.50;	author tg;	state Exp;
branches;
next	1.2;
commitid	6c0b4358cac0ef88;

1.2
date	2005.03.06.20.29.14;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.05.17.25.22;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.05.17.25.22;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2007.03.09.12.43.55;	author tg;	state Exp;
branches;
next	;
commitid	10045F1569B28D21CEC;


desc
@@


1.6
log
@more includes-target overhaul:
• document it
• do it for <bsd.prog.mk> too
• move it to <bsd.sys.mk>, handle generation by <bsd.subdir.mk>
• add /usr/include/openssl to mtree(8) base system tree file
• have all libs and flex use the generic target
• clean them up; repair a few bugs
@
text
@# $MirOS: src/lib/libpcap/Makefile,v 1.5 2007/04/28 00:12:44 tg Exp $
# $OpenBSD: Makefile,v 1.19 2006/09/18 18:18:17 jmc Exp $
# $NetBSD: Makefile,v 1.3 1996/05/10 21:54:24 cgd Exp $

SHLIB_VERSION?=	6.0
LIB=	pcap
MAN=	pcap.3
MLINKS=	pcap.3 pcap_open_live.3 pcap.3 pcap_open_offline.3 \
        pcap.3 pcap_dump_open.3 pcap.3 pcap_lookupdev.3 pcap.3 \
        pcap_lookupnet.3 pcap.3 pcap_dispatch.3 pcap.3 pcap_loop.3 \
        pcap.3 pcap_dump.3 pcap.3 pcap_inject.3 pcap.3 pcap_compile.3 \
        pcap.3 pcap_setfilter.3 pcap.3 pcap_next.3 pcap.3 pcap_datalink.3 \
        pcap.3 pcap_snapshot.3 pcap.3 pcap_is_swapped.3 pcap.3 \
        pcap_major_version.3 pcap.3 pcap_minor_version.3 pcap.3 \
        pcap_stats.3 pcap.3 pcap_file.3 pcap.3 pcap_fileno.3 pcap.3 \
        pcap_get_selectable_fd.3 pcap.3 pcap_perror.3 pcap.3 pcap_geterr.3 \
        pcap.3 pcap_strerror.3 pcap.3 pcap_close.3 pcap.3 pcap_dump_close.3 \
	pcap.3 pcap_freecode.3 pcap.3 pcap_breakloop.3 \
	pcap.3 pcap_findalldevs.3 pcap.3 pcap_freealldevs.3 \
	pcap.3 pcap_getnonblock.3 pcap.3 pcap_setnonblock.3 \
	pcap.3 pcap_set_datalink.3 pcap.3 pcap_list_datalinks.3 \
	pcap.3 pcap_open_dead.3 pcap.3 pcap_lib_version.3 \
	pcap.3 pcap_datalink_val_to_name.3 \
	pcap.3 pcap_datalink_val_to_description.3 \
	pcap.3 pcap_datalink_name_to_val.3 pcap.3 pcap_dump_fopen.3 \
	pcap.3 pcap_sendpacket.3 pcap.3 pcap_next_ex.3 \
	pcap.3 pcap_setdirection.3 pcap.3 pcap_dump_file.3 \
	pcap.3 pcap_dump_ftell.3 pcap.3 pcap_fopen_offline.3

DEFS=	-DHAVE_SYS_IOCCOM_H -DHAVE_SYS_SOCKIO_H -DHAVE_ETHER_HOSTTON \
	-DHAVE_STRERROR -DHAVE_SOCKADDR_SA_LEN -DLBL_ALIGN -DHAVE_IFADDRS_H \
	-DINET6

CPPFLAGS+=	-I. -Dyylval=pcap_yylval ${DEFS}
YFLAGS=		-d -ppcap_yy
LFLAGS=		-Ppcap_yy

HDRS=	pcap.h pcap-int.h pcap-namedb.h
SRCS=	pcap.c inet.c gencode.c optimize.c nametoaddr.c etherent.c \
	savefile.c bpf_filter.c bpf_image.c grammar.y scanner.l \
	pcap-bpf.c version.c fad-getad.c
.PATH:	${.CURDIR}/../../sys/net

CLEANFILES+=	version.c

version.c: ${.CURDIR}/VERSION
	@@rm -f $@@
	sed 's/.*/char pcap_version[] = "&";/' ${.CURDIR}/VERSION >$@@

.include <bsd.lib.mk>
@


1.5
log
@more lex/yacc overhaul, tentatively
@
text
@d1 1
a1 1
# $MirOS: src/lib/libpcap/Makefile,v 1.4 2007/03/09 13:05:07 tg Exp $
a49 9
includes:
	@@cd ${.CURDIR}; for i in $(HDRS); do \
	    j="cmp -s $$i ${DESTDIR}/usr/include/$$i || \
		${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 $$i \
		${DESTDIR}/usr/include"; \
	    echo $$j; \
	    eval "$$j"; \
	done

@


1.4
log
@sync spamd upgrades and libpcap, and some /etc stuff; read
• http://undeadly.org/cgi?action=article&sid=20070304035922&mode=expanded
• http://www.openbsd.org/faq/current.html#20070226
for details. In short:
• change rc.conf[.local]
• spamd.conf now lies in /etc/mail/
• greylisting is on by default
• the database has a new format
• there's some database sync stuff
@
text
@d1 1
a1 1
# $MirOS: src/lib/libpcap/Makefile,v 1.3 2005/10/21 11:02:50 tg Exp $
a6 1
WANTLINT=
d34 3
a36 1
CPPFLAGS+=-I. -Dyylval=pcap_yylval ${DEFS}
d44 1
a44 8
CLEANFILES+= grammar.c scanner.c grammar.tab.h version.c

grammar.c: grammar.y
	${YACC.y} -ppcap_yy -b ${.TARGET:R} ${.ALLSRC}
	mv ${.TARGET:R}.tab.c ${.TARGET}

scanner.c: scanner.l grammar.c
	${LEX.l} -Ppcap_yy -o${.TARGET} ${.CURDIR}/scanner.l
d48 1
a48 1
	sed 's/.*/char pcap_version[] = "&";/' ${.CURDIR}/VERSION > $@@
@


1.3
log
@* merge bin and lib completely
* convert some ancient RCSID styles etc. to more modern stuff
* fix use of CDIAGFLAGS+=, CFLAGS+= and COPTS+= to the correct
  variant (include bsd.own.mk _then_ COPTS+=) so they're added
  after any user-specified flags
  (this is probably lurking in more places than I can imagine)
* fix some indenting, comments, etc.
* make stuff compile (fix warnings/errors)
* add script to review _all_ shlib_version after an openbsd import
* remove two more obsolete /usr/lib/debug/ references
* bin/ps: comment out some SMP code
@
text
@d1 2
a2 2
# $MirOS: src/lib/libpcap/Makefile,v 1.2 2005/03/06 20:29:14 tg Exp $
# $OpenBSD: Makefile,v 1.15 2003/02/20 03:20:09 deraadt Exp $
d5 1
a5 1
SHLIB_VERSION?=	5.0
d7 1
d17 13
a29 3
        pcap_perror.3 pcap.3 pcap_geterr.3 pcap.3 pcap_strerror.3 \
        pcap.3 pcap_close.3 pcap.3 pcap_dump_close.3 \
	pcap.3 pcap_freecode.3 
d40 1
a40 1
	pcap-bpf.c version.c
@


1.2
log
@merge src/lib
@
text
@d1 1
a1 1
# $MirOS$
d5 1
a5 1
SHLIB_VERSION?=	4.0
@


1.1
log
@Initial revision
@
text
@d1 3
a3 2
#	$OpenBSD: Makefile,v 1.15 2003/02/20 03:20:09 deraadt Exp $
#	$NetBSD: Makefile,v 1.3 1996/05/10 21:54:24 cgd Exp $
d5 1
d24 1
a24 1
CFLAGS+=-I. -I${.CURDIR} -Dyylval=pcap_yylval ${DEFS}
@


1.1.1.1
log
@Import the OpenBSD foundation of MirOS BSD
@
text
@@


1.1.1.2
log
@spamd-current needs libpcap-current…
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2006/09/18 18:18:17 jmc Exp $
a4 1
WANTLINT=
d14 3
a16 13
        pcap_get_selectable_fd.3 pcap.3 pcap_perror.3 pcap.3 pcap_geterr.3 \
        pcap.3 pcap_strerror.3 pcap.3 pcap_close.3 pcap.3 pcap_dump_close.3 \
	pcap.3 pcap_freecode.3 pcap.3 pcap_breakloop.3 \
	pcap.3 pcap_findalldevs.3 pcap.3 pcap_freealldevs.3 \
	pcap.3 pcap_getnonblock.3 pcap.3 pcap_setnonblock.3 \
	pcap.3 pcap_set_datalink.3 pcap.3 pcap_list_datalinks.3 \
	pcap.3 pcap_open_dead.3 pcap.3 pcap_lib_version.3 \
	pcap.3 pcap_datalink_val_to_name.3 \
	pcap.3 pcap_datalink_val_to_description.3 \
	pcap.3 pcap_datalink_name_to_val.3 pcap.3 pcap_dump_fopen.3 \
	pcap.3 pcap_sendpacket.3 pcap.3 pcap_next_ex.3 \
	pcap.3 pcap_setdirection.3 pcap.3 pcap_dump_file.3 \
	pcap.3 pcap_dump_ftell.3 pcap.3 pcap_fopen_offline.3
d27 1
a27 1
	pcap-bpf.c version.c fad-getad.c
@

