head	1.21;
access;
symbols;
locks; strict;
comment	@# @;


1.21
date	2012.10.18.17.24.49;	author tg;	state Exp;
branches;
next	1.20;
commitid	10050803B7600807AB4;

1.20
date	2010.01.28.15.59.40;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004B61B46E06215C45;

1.19
date	2009.08.16.17.19.18;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004A883C9B4C196B76;

1.18
date	2009.06.21.09.37.08;	author tg;	state Exp;
branches;
next	1.17;
commitid	1004A3DFF2C0799F22F;

1.17
date	2008.05.02.15.43.05;	author tg;	state Exp;
branches;
next	1.16;
commitid	100481B369B1599EEFF;

1.16
date	2007.03.31.21.14.20;	author tg;	state Exp;
branches;
next	1.15;
commitid	100460ECF437A87ECCA;

1.15
date	2007.02.22.23.11.48;	author tg;	state Exp;
branches;
next	1.14;
commitid	10045DE234A10F41991;

1.14
date	2007.02.02.12.01.38;	author tg;	state Exp;
branches;
next	1.13;
commitid	10045C3282E074C7393;

1.13
date	2006.12.26.18.01.34;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004591638417047041;

1.12
date	2006.02.21.17.40.12;	author tg;	state Exp;
branches;
next	1.11;
commitid	10043FB50754527AE5B;

1.11
date	2006.02.21.16.48.29;	author tg;	state Exp;
branches;
next	1.10;
commitid	10043FB44457CFBADEF;

1.10
date	2006.01.25.19.00.48;	author tg;	state Exp;
branches;
next	1.9;
commitid	10043D7CAA0016209B3;

1.9
date	2006.01.25.12.48.04;	author tg;	state Exp;
branches;
next	1.8;
commitid	10043D773676CAD7990;

1.8
date	2006.01.01.04.14.49;	author tg;	state Exp;
branches;
next	1.7;
commitid	10043B75745267D3BDB;

1.7
date	2005.09.11.02.34.16;	author tg;	state Exp;
branches;
next	1.6;
commitid	773e432397611c14;

1.6
date	2005.08.21.11.50.39;	author tg;	state Exp;
branches;
next	1.5;
commitid	3af74308676450c3;

1.5
date	2005.05.06.17.46.47;	author tg;	state Exp;
branches;
next	1.4;
commitid	2afb427bad90dedb;

1.4
date	2005.05.04.15.42.23;	author tg;	state Exp;
branches;
next	1.3;
commitid	798a4278ed64dc86;

1.3
date	2005.04.10.21.51.47;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.27.22.20.23;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.18.16.00.00;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.16.00.00;	author tg;	state Exp;
branches;
next	;


desc
@@


1.21
log
@unbreak the IMAP module and the phpxs script
@
text
@# $MirOS: ports/www/php/Makefile.inc,v 1.20 2010/01/28 15:59:40 tg Exp $
# $OpenBSD: Makefile.inc,v 1.1.1.1 2004/10/02 11:32:35 robert Exp $

.include <mirports.sys.mk>

# This port currently only works with archs supporting dynamic loading
# and has a httpd that supports DSOs.
NOT_FOR_PLATFORM=	${NOPIC_PLATFORMS}

VSN=			5.0.5
HV=			0.4.8
DASH_VER=		6
DISTNAME=		php-${VSN}
CATEGORIES=		www lang
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.de>
HOMEPAGE=		http://www.php.net/ \
			http://www.hardened-php.net/
MASTER_SITES=		http://museum.php.net/php5/
MASTER_SITES0=		http://www.hardened-php.net/
PATCHFILES=		hardening-patch-${VSN}-${HV}.patch.gz:0
PATCH_DIST_STRIP=	-p1

# UPGRADERS: please read BOTH the PHP and Zend licenses
# and make sure they are safe before an upgrade
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_PACKAGE_CDROM=	"modified versions must not be called PHP"
PERMIT_PACKAGE_FTP=	"modified versions must not be called PHP"

PHP_CONFIG_PATH=	${WWW_PREFIX}/conf
PHP_CONFIG_FILE=	${PHP_CONFIG_PATH}/php.ini

# where the main php module is stored (outside the chroot)
HTTPD_MODULE_SUBDIR=	lib/php
HTTPD_MODULE_DIR=	${LOCALBASE}/${HTTPD_MODULE_SUBDIR}

# where the PEAR and extension modules are (inside the chroot)
CHROOT_DIR?=		${WWW_PREFIX}
PEAR_DIR?=		${CHROOT_DIR}/pear
MODULES_SUBDIR=		lib/php/modules
MODULES_DIR=		${CHROOT_DIR}/${MODULES_SUBDIR}

CONFIGURE_STYLE=	autogen
AUTOGEN=		${MKSH} ${PORTSDIR}/www/php/files/autogen.sh
CONFIGURE_ENV+=		EXTENSION_DIR=${MODULES_DIR}
EXTRA_MAKE_ENV+=	${CONFIGURE_ENV}

CONFIGURE_ARGS+=	--enable-shared \
			--disable-static \
			--disable-short-tags \
			--with-config-file-path=${PHP_CONFIG_PATH:Q} \
			--with-config-file-scan-dir=${PHP_CONFIG_PATH:Q}/php \
			--enable-inline-optimization \
			--with-libxml-dir=${LOCALBASE:Q} \
			--with-iconv=${ICONV_PREFIX:Q} \
			--with-sqlite=${LOCALBASE:Q} \
			--with-libedit \
			--without-gettext \
			--disable-sqlite-utf8 \
			--with-apxs=/usr/sbin/apxs \
			--without-mysql \
			--enable-xml \
			--enable-wddx \
			--enable-cli \
			--enable-dio \
			--with-pear=${PEAR_DIR:Q} \
			--enable-bcmath \
			--enable-session \
			--enable-trans-sid \
			--enable-calendar \
			--enable-ctype \
			--enable-ftp \
			--enable-mbstring \
			--with-pcre-regex \
			--with-posix \
		 	--with-openssl \
			--with-zlib \
			--enable-sockets \
			--enable-sysvsem \
			--enable-sysvshm \
			--enable-exif \
			--with-pic

.if ${OStype} == "MirBSD"
CONFIGURE_ARGS+=	--disable-yp
.else
CONFIGURE_ARGS+=	--enable-yp
.endif

MODULES+=		converters/libiconv
CORE_DEPENDENCY=	:php-core-${VSN}-${DASH_VER}:www/php/core
CORE_LIB_DEPENDS+=	xml2::textproc/libxml \
			sqlite::databases/sqlite2

CONFIGURE_ENV+=		TERM=vt100

REGRESS_TARGET=		test
REGRESS_FLAGS=		NO_INTERACTION=1

CHECKSUM_FILE?=		${PORTSDIR}/www/php/distinfo
PATCH_LIST=		${PORTSDIR}/www/php/patches/patch-* \
			patch-*

post-extract:
	@@rm -f ${WRKSRC}/ext/standard/*.orig
@


1.20
log
@use at least _some_ ksh code, since getopt doesn’t work like this with
POSIX conformant shells
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.19 2009/08/16 17:19:18 tg Exp $
d12 1
a12 1
DASH_VER=		5
@


1.19
log
@change all V to VSN (ok bsiegert@@) and some DASH_VER while here
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.18 2009/06/21 09:37:08 tg Exp $
d12 1
a12 2
DASH_VER=		4
DASH_VER-gd=		5
@


1.18
log
@Fix php-gd extension again, bump its patchlevel: it shall use its own
libgd2 because libgd1 is what we have in MirPorts, linked against the
XFree86®’s freetype2 not libttf which libgd1 links against.
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.17 2008/05/02 15:43:05 tg Exp $
d10 1
a10 1
V=			5.0.5
d14 1
a14 1
DISTNAME=		php-${V}
d21 1
a21 1
PATCHFILES=		hardening-patch-${V}-${HV}.patch.gz:0
d92 1
a92 1
CORE_DEPENDENCY=	:php-core-${V}-${DASH_VER}:www/php/core
@


1.17
log
@…aaand bump dash ver
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.16 2007/03/31 21:14:20 tg Exp $
d13 1
@


1.16
log
@simplify (goal was to try if imap builds with recent libtool change, it still does not)
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.15 2007/02/22 23:11:48 tg Exp $
d12 1
a12 1
PV=			3
d91 1
a91 1
CORE_DEPENDENCY=	:php-core-${V}-${PV}:www/php/core
@


1.15
log
@unbreak php/extensions (except few)
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.14 2007/02/02 12:01:38 tg Exp $
d4 2
d18 3
a20 6
MASTER_SITES=		\
			http://museum.php.net/php5/
MASTER_SITES0=		\
			http://www.hardened-php.net/
PATCHFILES=		\
			hardening-patch-${V}-${HV}.patch.gz:0
d57 25
d84 10
a93 3
# default included extensions
CONFIGURE_ARGS+= 	--with-openssl \
			--with-zlib
@


1.14
log
@fix packaging list
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.13 2006/12/26 18:01:34 tg Exp $
d55 3
@


1.13
log
@these f.cktards changed the download URIs
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.12 2006/02/21 17:40:12 tg Exp $
d10 1
a10 1
PV=			2
@


1.12
log
@* fix pulling in sqlite2 (5.0.5-1 took its own, ancient, version)
* while here, fix citrus libiconv version number display
* bump to 5.0.5-2
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.11 2006/02/21 16:48:29 tg Exp $
d17 1
a17 4
			http://no.php.net/distributions/ \
			http://uk.php.net/distributions/ \
			http://se.php.net/distributions/ \
			http://us2.php.net/distributions/
@


1.11
log
@* sync patches and their location
* move SQLite2 to base to endorse its use (again, do NOT
  enable utf-8 support for sqlite2, it's BROKEN!)
* unbreak iconv'd build
* bump patchlevel
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.10 2006/01/25 19:00:48 tg Exp $
d10 1
a10 1
PV=			1
@


1.10
log
@* Makefile.inc:
  - style, quotes
  - enable rpath
  - disable short tags (sync with reality)
  - add TERM=vt100 to configuration env to please GNU shtool
* extensions/Makefile:
  - try without GNU gettext
* extensions:
  - mbstring is part of core
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.9 2006/01/25 12:48:04 tg Exp $
d10 1
a10 1
PV=			0
@


1.9
log
@first step in upgrading php:
* mark as broken - upgrade in progress
* sync with OpenBSD
* update hardened-php patch version

note: we use php 5.0.5 not 5.1.2 like I would, because the
OpenBSD team has experienced problems with the 5.1 series,
and I don't want to dig deeper into that again
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.8 2006/01/01 04:14:49 tg Exp $
d50 1
a50 1
MAKE_ENV+=		${CONFIGURE_ENV}
d54 3
a56 3
			--disable-rpath \
			--with-config-file-path=${PHP_CONFIG_PATH} \
			--with-config-file-scan-dir=${PHP_CONFIG_PATH}/php \
d64 2
@


1.8
log
@simply adding -0 is BAD BAD BAD
(this needs to be updated anyway)
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.7 2005/09/11 02:34:16 tg Exp $
d8 3
a10 3
V=			5.0.4
HV=			0.2.7
PV=			1
d13 1
a13 1
RESPONSIBLE=		Thorsten Glaser <tg@@66h.42h.de>
d24 1
a24 1
			hardened-php-${V}-${HV}.patch.gz:0
d48 1
a48 1
AUTOGEN=		${SHELL} ${PORTSDIR}/www/php/files/autogen.sh
@


1.7
log
@convert /var/www to ${WWW_PREFIX} more or less mechanically
this breaks some ports, but most of the breakage can be solved
by converting to @@sample and the rest should be some basic
adding of substitution (SUBST_VARS and/or ed/sed)...
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.6 2005/08/21 11:50:39 tg Exp $
d10 1
a10 1
PV=			p0
@


1.6
log
@_DOMAIN_DU_JOUR dies
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.5 2005/05/06 17:46:47 tg Exp $
d34 1
a34 1
PHP_CONFIG_PATH=	/var/www/conf
d42 1
a42 1
CHROOT_DIR?=		/var/www
@


1.5
log
@bsiegert@@ said to me "always bump the patchlevel if the package changes"
some time ago. oops.
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.4 2005/05/04 15:42:23 tg Exp $
d13 1
a13 1
RESPONSIBLE=		Thorsten Glaser <tg@@${_DOMAIN_DU_JOUR}>
@


1.4
log
@update php core and pear to 5.0.4 + hardened-php 0.2.7
php extensions to follow
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.3 2005/04/10 21:51:47 tg Exp $
d10 1
a10 1
#PV=			p0
@


1.3
log
@NOPIC_PLATFORMS, LP64_PLATFORMS and general change of
{NOT,ONLY}_FOR_{ARCH{,E,ES},OS} to {NOT,ONLY}_FOR_PLATFORM

some fallout maybe, I hope not
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.2 2005/03/27 22:20:23 tg Exp $
d8 3
a10 3
V=			5.0.3
HV=			0.2.6
PV=			p0
@


1.2
log
@php5 => php
@
text
@d1 1
a1 1
# $MirOS: ports/www/php/Makefile.inc,v 1.1.7.1 2005/03/18 16:00:00 tg Exp $
d6 1
a6 1
NOT_FOR_ARCHS=		${NO_SHARED_ARCHS}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $MirOS$
d6 1
a6 1
NOT_FOR_ARCHS=	${NO_SHARED_ARCHS}
d8 18
a25 18
V=		5.0.3
HV=		0.2.6
PV=		p0
DISTNAME=	php-${V}
CATEGORIES=	www lang
RESPONSIBLE=	Thorsten Glaser <tg@@${_DOMAIN_DU_JOUR}>
HOMEPAGE=	http://www.php.net/ \
		http://www.hardened-php.net/
MASTER_SITES=	\
		http://no.php.net/distributions/ \
		http://uk.php.net/distributions/ \
		http://se.php.net/distributions/ \
		http://us2.php.net/distributions/
MASTER_SITES0=	\
		http://www.hardened-php.net/
PATCHFILES=	\
		hardened-php-${V}-${HV}.patch.gz:0
PATCH_DIST_STRIP= -p1
d37 1
a37 1
# where the main php5 module is stored (outside the chroot)
d48 1
a48 1
AUTOGEN=		${SHELL} ${PORTSDIR}/www/php5/patches/autogen.sh
d67 2
a68 2
CHECKSUM_FILE?=		${PORTSDIR}/www/php5/distinfo
PATCH_LIST=		${PORTSDIR}/www/php5/patches/patch-* \
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
