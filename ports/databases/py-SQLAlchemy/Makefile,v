head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2008.09.30.09.42.11;	author tg;	state Exp;
branches;
next	1.3;
commitid	10048E1F4645BC5DD02;

1.3
date	2008.09.12.08.56.09;	author tg;	state Exp;
branches;
next	1.2;
commitid	10048CA2EA75116DF9D;

1.2
date	2008.09.10.09.55.55;	author tg;	state Exp;
branches;
next	1.1;
commitid	10048C7999E002F0617;

1.1
date	2008.09.02.09.55.07;	author tg;	state Exp;
branches;
next	;
commitid	10048BD0D8A7F3D5EF6;


desc
@@


1.4
log
@I managed again to break py-SQLAlchemy ☺ Apply upstream fix, which is a
little more broad than mine, which was:

--- lib/sqlalchemy/orm/session.py.orig	Thu Sep 11 21:03:44 2008
+++ lib/sqlalchemy/orm/session.py	Tue Sep 30 09:36:08 2008
@@@@ -438,6 +438,7 @@@@ class SessionTransaction(object):
     def __exit__(self, type, value, traceback):
         if self.session.transaction is None:
             return
+        newsess = self.session if not self.session.autocommit else none
         if type is None:
             try:
                 self.commit()
@@@@ -446,6 +447,8 @@@@ class SessionTransaction(object):
                 raise
         else:
             self.rollback()
+        if newsess is not None:
+            newsess.begin()

 class Session(object):
     """Manages persistence operations for ORM-mapped objects.
@
text
@# $MirOS: ports/databases/py-SQLAlchemy/Makefile,v 1.3 2008/09/12 08:56:09 tg Exp $
# $OpenBSD: Makefile,v 1.11 2008/08/30 02:10:13 fgsch Exp $

COMMENT=		database toolkit for Python
MODPY_EGG_VERSION=	0.5.0rc1
DASH_VER=		1
DISTNAME=		SQLAlchemy-${MODPY_EGG_VERSION}
PKGNAME=		py-${DISTNAME}-${DASH_VER}
CATEGORIES=		databases
HOMEPAGE=		http://www.sqlalchemy.org/

# MIT
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=sqlalchemy/}

MODULES+=		lang/python
MODPY_SETUPTOOLS=	Yes

# Other DB connectors would work, too.
#XXX python2.5 comes with SQLite
#REGRESS_DEPENDS=	::databases/py-sqlite2

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/{doc,examples}/py-sqlalchemy
	cd ${WRKSRC}/doc && pax -rw * $ ${PREFIX}/share/doc/py-sqlalchemy/
	cd ${WRKSRC}/examples && \
	    pax -rw * $ ${PREFIX}/share/examples/py-sqlalchemy/

do-regress:
	@@cd ${WRKSRC} && ${MAKE_ENV} \
	    PYTHONPATH=test ${MODPY_BIN} test/alltests.py --db sqlite

.include <bsd.port.mk>
@


1.3
log
@Upgrade to yesterday’s 0.5.0rc1 *sigh* just after I pulled out the
fixes from their svn…
@
text
@d1 1
a1 1
# $MirOS: ports/databases/py-SQLAlchemy/Makefile,v 1.2 2008/09/10 09:55:55 tg Exp $
d6 1
@


1.2
log
@add two patches from svn trunk required for supporting “old-style” classes,
which, despite going away in Python 2.6, are required for CORBA mappings…

spare me having to comment on this, please
@
text
@d1 1
a1 1
# $MirOS: ports/databases/py-SQLAlchemy/Makefile,v 1.1 2008/09/02 09:55:07 tg Exp $
d5 1
a5 2
MODPY_EGG_VERSION=	0.5.0beta3
DASH_VER=		1
@


1.1
log
@more evilish python crap… from obsd again
@
text
@d1 1
a1 1
# $MirOS$
d6 1
@

