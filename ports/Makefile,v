head	1.39;
access;
symbols
	MIRBSD_8_BASE:1.12;
locks; strict;
comment	@# @;


1.39
date	2018.07.15.13.41.18;	author tg;	state Exp;
branches;
next	1.38;
commitid	1005B4B4F0B4ECDB6D4;

1.38
date	2016.03.12.14.01.30;	author tg;	state Exp;
branches;
next	1.37;
commitid	10056E421475835FCAC;

1.37
date	2016.03.06.19.30.48;	author tg;	state Exp;
branches;
next	1.36;
commitid	10056DC85705AA21C1D;

1.36
date	2014.12.06.15.20.59;	author tg;	state Exp;
branches;
next	1.35;
commitid	10054831EF433C0C3EE;

1.35
date	2014.12.06.15.14.37;	author tg;	state Exp;
branches;
next	1.34;
commitid	10054831D750436958C;

1.34
date	2009.02.24.17.58.44;	author bsiegert;	state Exp;
branches;
next	1.33;
commitid	10049A4356261D26A8C;

1.33
date	2008.12.14.19.27.56;	author tg;	state Exp;
branches;
next	1.32;
commitid	10049455E4500CA1D9C;

1.32
date	2008.11.19.23.26.40;	author tg;	state Exp;
branches;
next	1.31;
commitid	1004924A0C3455A23A0;

1.31
date	2008.11.08.23.03.29;	author tg;	state Exp;
branches;
next	1.30;
commitid	10049161AC72620EAF0;

1.30
date	2008.10.21.18.54.07;	author tg;	state Exp;
branches;
next	1.29;
commitid	10048FE253E7E7A1CBE;

1.29
date	2008.09.11.21.34.40;	author tg;	state Exp;
branches;
next	1.28;
commitid	10048C98EFC2B42D35A;

1.28
date	2008.06.08.13.41.45;	author bsiegert;	state Exp;
branches;
next	1.27;
commitid	100484BE185182C307A;

1.27
date	2007.08.24.14.54.15;	author tg;	state Exp;
branches;
next	1.26;
commitid	10046CEF119517FE815;

1.26
date	2007.03.22.17.54.20;	author tg;	state Exp;
branches;
next	1.25;
commitid	1004602C2C039E36BC5;

1.25
date	2007.02.22.15.18.32;	author tg;	state Exp;
branches;
next	1.24;
commitid	10045DDB44D0010B664;

1.24
date	2007.01.26.20.31.51;	author tg;	state Exp;
branches;
next	1.23;
commitid	10045BA65395CE5338A;

1.23
date	2006.12.31.17.03.16;	author tg;	state Exp;
branches;
next	1.22;
commitid	1004597ED530A62698E;

1.22
date	2006.11.17.00.18.45;	author tg;	state Exp;
branches;
next	1.21;
commitid	100455CFFCE67E80D73;

1.21
date	2006.11.16.23.34.21;	author tg;	state Exp;
branches;
next	1.20;
commitid	100455CF59227B9B530;

1.20
date	2006.10.17.21.08.04;	author tg;	state Exp;
branches;
next	1.19;
commitid	100453545C2041E7641;

1.19
date	2006.09.20.22.24.50;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004511BFAD3427E1F6;

1.18
date	2006.07.23.20.43.07;	author tg;	state Exp;
branches;
next	1.17;
commitid	10044C3DF6963C1D581;

1.17
date	2006.02.21.18.04.47;	author tg;	state Exp;
branches;
next	1.16;
commitid	10043FB56500905E35A;

1.16
date	2006.02.14.22.02.38;	author tg;	state Exp;
branches;
next	1.15;
commitid	10043F2538B2BCBBAAC;

1.15
date	2006.02.01.16.29.13;	author tg;	state Exp;
branches;
next	1.14;
commitid	10043E0E1DF0CB99A78;

1.14
date	2006.01.02.03.29.12;	author tg;	state Exp;
branches;
next	1.13;
commitid	10043B89E1E59C4A1A8;

1.13
date	2005.12.28.17.28.57;	author tg;	state Exp;
branches;
next	1.12;
commitid	10043B2CB33562F1CEB;

1.12
date	2005.12.20.00.35.24;	author tg;	state Exp;
branches;
next	1.11;
commitid	10043A751DC7E8EB708;

1.11
date	2005.12.17.05.46.17;	author tg;	state Exp;
branches;
next	1.10;
commitid	10043A3A3E65E20A413;

1.10
date	2005.12.06.19.19.11;	author tg;	state Exp;
branches;
next	1.9;
commitid	75c94395e42114d5;

1.9
date	2005.11.15.21.10.19;	author tg;	state Exp;
branches;
next	1.8;
commitid	37ad437a4ec2064b;

1.8
date	2005.11.15.18.06.56;	author tg;	state Exp;
branches;
next	1.7;
commitid	64c4437a23af2eb8;

1.7
date	2005.11.09.20.38.48;	author tg;	state Exp;
branches;
next	1.6;
commitid	5fcc43725da1e6f0;

1.6
date	2005.09.14.21.13.09;	author tg;	state Exp;
branches;
next	1.5;
commitid	4b7a432892494874;

1.5
date	2005.09.14.16.03.11;	author bsiegert;	state Exp;
branches;
next	1.4;
commitid	4395432849aeb25c;

1.4
date	2005.07.05.20.08.28;	author tg;	state Exp;
branches;
next	1.3;
commitid	6fe042cae8bb6f4d;

1.3
date	2005.07.05.19.42.28;	author tg;	state Exp;
branches;
next	1.2;
commitid	355f42cae2ae3be5;

1.2
date	2005.03.19.22.26.37;	author bsiegert;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.18.15.42.39;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.42.39;	author tg;	state Exp;
branches;
next	;


desc
@@


1.39
log
@further limit the amount of mailto links we’re giving out
@
text
@# $MirOS: ports/Makefile,v 1.38 2016/03/12 14:01:30 tg Exp $
# $OpenBSD: Makefile,v 1.43 2003/12/15 17:56:40 espie Exp $
# $FreeBSD: Makefile,v 1.36 1997/10/04 15:54:31 jkh Exp $
#-
# Copyright (c) 2004, 2005, 2006, 2007, 2014, 2016
#	The MirOS Project and its contributors
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.
#-
# For a complete list of people who contributed to MirPorts read the
# CVS ChangeLog, and the (historic, ancient) OpenBSD CVS ChangeLogs.
# For a list of MirOS Project members please read the documentation,
# it comes with a standard MirOS installation and is available via a
# CVSweb mirror (src/share/doc/legal/1stREAD) as well.
# All patches except forward ed(1) diffs are also covered by the li-
# cence of the file to be patched. Some of the files in the MirPorts
# Framework are covered by different terms of use. Ports are not co-
# vered by specific terms since they're too small to be worth it.


PKGPATH=
.if defined(key) || defined(name) || defined(category) || defined(author)

# set up subdirs from the index, assume it's up-to-date
_CMD=perl ${.CURDIR}/infrastructure/scripts/index-retrieve index='${.CURDIR}/INDEX'
.  if defined(key)
_CMD+=key=${key:Q}
.  endif
.  if defined(name)
_CMD+=maintainer=${name:Q}
.  endif
.  if defined(category)
_CMD+=category=${category:Q}
.  endif
.  if defined(maintainer)
_CMD+=maintainer=${maintainer:Q}
.  endif
SUBDIR!=	${_CMD}
_MANUAL_SUBDIR=	yes
.endif
.if defined(SUBDIRLIST)
SUBDIR!=	sed -e 's,[   ]*\#.*,,' -e '/^[       ]*$$/d' ${SUBDIRLIST}
_MANUAL_SUBDIR=	yes
.endif

PORTSTOP?=	yes

.if !make(setup) && !make(nfo)
.  include <bsd.port.subdir.mk>
.endif
.ifndef BSD_OWN_MK
.  include <bsd.own.mk>
.endif

index:
	@@rm -f ${.CURDIR}/INDEX
	@@${MAKE} ${.CURDIR}/INDEX
	@@echo "$$(fgrep -c '' INDEX) ($$(fgrep -c '(broken)' INDEX) broken)"

${.CURDIR}/INDEX:
	@@echo "Generating INDEX..."
	@@${MAKE} USE_ICONV=port USE_CCACHE=No OStype=MirBSD OSNAME=MirBSD \
	    OSver=10.160 MACHINE_OS=BSD MACHINE=i386 MACHINE_ARCH=i386 \
	    USE_COMPILER=system USE_CCACHE=no \
	    describe ECHO_MSG="echo 1>&2" >${.CURDIR}/INDEX
	@@echo "Done."

print-index:	${.CURDIR}/INDEX
	@@awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\n\n", $$1, $$2, $$4, $$7, $$8, $$9, $$10, $$11); }' < ${.CURDIR}/INDEX

print-licences: ${.CURDIR}/INDEX
	@@printf "Port                                    PC PF DC DF Maint\n"
	@@awk -F\| '{printf("%-40.39s%-3.2s%-3.2s%-3.2s%-3.2s%-25.25s\n",$$2,$$13,$$14,$$15,$$16,$$7);}' < ${.CURDIR}/INDEX

search:	${.CURDIR}/INDEX
.if !defined(key) && !defined(name)
	@@echo "The search target requires a keyword or name parameter,"
	@@echo "e.g.: \"mmake search key=somekeyword\" \"mmake search name=somename\""
.else
. if defined(key)
	@@egrep -i -- ${key:Q} ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }'
. else
	@@awk -F\| '$$1 ~ /${name}/ { printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }' ${.CURDIR}/INDEX
. endif
.endif


MIRROR_MK?= ${.CURDIR}/Distfiles/Makefile

mirror-maker:
	@@mkdir -p ${MIRROR_MK:H}
# Indirection needed for broken OSes that don't grok this exec
	@@echo "EXEC=exec" >${MIRROR_MK}
	@@echo "default:: ftp cdrom" >>${MIRROR_MK}
	@@echo ".PHONY: default all ftp cdrom" >>${MIRROR_MK}
	@@_DONE_FILES=$$(mktemp /tmp/depends.XXXXXXXXX|| exit 1); \
	export _DONE_FILES; \
	trap "rm -f $${_DONE_FILES}" 0 1 2 3 5 13 15; \
	${MAKE} fetch-makefile \
		ECHO_MSG='echo >&2' \
		>>${MIRROR_MK}

homepages.html:
	@@echo '<html><ul>' >$@@
	@@${MAKE} homepage-links ECHO_MSG='echo >&2' >>$@@
	@@echo '</ul></html>' >>$@@

DISTFILES_DB?=${.CURDIR}/infrastructure/db/locate.database

distfiles-update-locatedb:
	@@PORTSDIR=${.CURDIR} ${SHELL} \
	    ${.CURDIR}/infrastructure/scripts/distfiles-update-locatedb \
	    ${DISTFILES_DB}

bulk-build:
	if [[ ! -e ${.CURDIR}/Bulk ]]; then \
		${SUDO} mkdir -m 0775 Bulk; \
	fi
	if [[ ! -e ${.CURDIR}/Logs ]]; then \
		${SUDO} mkdir -m 0775 Logs; \
	fi
	env BIN_PACKAGES=Yes TRUST_PACKAGES=Yes BULK=Yes BATCH=Yes \
	    ${MAKE} package clean 2>&1 | \
	    perl ${.CURDIR}/infrastructure/scripts/portslogger ${.CURDIR}/Logs

portupgrade: index
	@@PORTSDIR=${.CURDIR} ${SHELL} \
	    ${.CURDIR}/infrastructure/scripts/out-of-date

# Yes, this does hardcode /bin/sh and that's correct.
setup: Setup.sh
	@@rv=1; if [[ -d /usr/mpkg/db/pkg ]]; then \
		cd /usr/mpkg/db/pkg && for x in pkgtools-*; do \
			rv=1; [[ -e $$x ]] && break; rv=0; \
		done; \
		(( rv )) && echo Do not call '"make setup"' if \
		    the package utilities are already installed!; \
	    else rv=0; fi; exit $$rv
	@@echo 'Use "mmake nfo" to generate documentation!'
	@@sleep 3
	cd ${.CURDIR:Q}; \
	    for dir in {Distfiles,Packages}{,/{CDROM,FTP}}; do \
		[[ -e $$dir ]] || ${SUDO} mkdir -m 0775 $$dir; \
	done
	print '/@@@@local/d\ni\n    usr\n\tmpkg\n.\n%p\nQ' | \
	    ed -s ${.CURDIR}/infrastructure/templates/fake.mtree | \
	    ${SUDO} mtree -U -e -d -n -p /
.if exists(/etc/X11/app-defaults)
	[[ -L /usr/mpkg/lib/X11/app-defaults ]] || \
	    if [[ -d /usr/mpkg/lib/X11/app-defaults ]]; then \
		${SUDO} mv /usr/mpkg/lib/X11/app-defaults/* \
		    /etc/X11/app-defaults/ || true; \
		${SUDO} rmdir /usr/mpkg/lib/X11/app-defaults; \
	fi
	${SUDO} ln -sf /etc/X11/app-defaults /usr/mpkg/lib/X11/app-defaults
.endif
	${SUDO} rm -rf /usr/mpkg/.sst /etc/.mirports.test.*
	(echo "Policy: /usr/bin/env, Emulation: native"; \
	    cat ${.CURDIR}/infrastructure/templates/systrace.filter) \
	    | ${SUDO} dd of=/usr/mpkg/.sst
	printf '%s\n%s\n%s\n%s\n%s\nwq\n' '%g!PORTSDIR!d' '%g!PKG_TMPDIR!d' \
	    '%g!TMPDIR!s!..TMPDIR.!/etc/.mirports.test.*!g' '%g!DISTDIR!d' \
	    '%g!WRKDIR!s!..WRKDIR.!/usr/mpkg!g' | ${SUDO} ed -s /usr/mpkg/.sst
	/bin/systrace -e -i -a -f /usr/mpkg/.sst /usr/bin/env CC=${CC:Q} \
	    SHELL=${MKSH:Q} MKSH=${MKSH:Q} NO_SYSTRACE=bootstrap \
	    ${SUDO} /bin/sh ${.CURDIR}/Setup.sh -T
	${SUDO} rm -rf /usr/mpkg/.sst /etc/.mirports.test.*

nfo: Setup.sh.nfo
.if exists(${BSDSRCDIR}/scripts/roff2htm)
nfo: Setup.sh.htm
.endif

Setup.sh.man: Setup.sh.8
	${NROFF} -mdoc <$> >$@@ || (rm -f $@@; false)

Setup.sh.nfo: Setup.sh.man
	col -b <$> | sed "s!\$$!$$(printf \\r)!" >$@@ || (rm -f $@@; false)

Setup.sh.htm: Setup.sh.man
	(. ${BSDSRCDIR}/scripts/roff2htm; do_conversion Setup.sh 8) <$> >$@@

.if exists(/cvs/CVSROOT/config)
CVSROOT?=	/cvs
.endif
CVSROOT?=	${_MIROS_ANONCVS}

cvsup:
	cd ${.CURDIR} && umask 002 && cvs -Rqz3 -d ${CVSROOT} up -PAd

.PHONY: mirror-maker index search distfiles-update-locatedb \
	print-licences print-index portupgrade setup cvsup nfo
@


1.38
log
@urgs, forgot to drop debugging code before committing, broke the build
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.37 2016/03/06 19:30:48 tg Exp $
d6 1
a6 2
#	The MirOS Project <miros-discuss@@mirbsd.org>
#	and its contributors
@


1.37
log
@prevent 'make setup' if pkgutl are already installed, to avoid later error
spotted by Natureshadow
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.34 2009/02/24 17:58:44 bsiegert Exp $
a152 1
	@@echo ok; exit 1
@


1.36
log
@also create {CDROM,FTP} subdirectories for those created in commitid 75c94395e42114d5 (to the day, 9 years ago); bug spotted by lewellyn
@
text
@d5 1
a5 1
# Copyright (c) 2004, 2005, 2006, 2007, 2014
d146 8
@


1.35
log
@fix /bin/sh to $MKSH conversion that slipped in in commitid 10048FE253E7E7A1CBE, as /bin/sh use here is deliberate, cf. comment above that block
@
text
@d5 1
a5 1
# Copyright (c) 2004, 2005, 2006, 2007
d148 4
a151 6
	if [[ ! -e ${.CURDIR}/Distfiles ]]; then \
		${SUDO} mkdir -m 0775 Distfiles; \
	fi
	if [[ ! -e ${.CURDIR}/Packages ]]; then \
		${SUDO} mkdir -m 0775 Packages; \
	fi
@


1.34
log
@make's -k option is broken in ports, so do not use it anymore. Workaround
will be committed in next commit.
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.33 2008/12/14 19:27:56 tg Exp $
d175 1
a175 1
	    ${SUDO} ${MKSH} ${.CURDIR}/Setup.sh -T
@


1.33
log
@by Vutral’s request, improve “mmake cvsup”
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.32 2008/11/19 23:26:40 tg Exp $
d137 1
a137 1
	    ${MAKE} -k package clean 2>&1 | \
@


1.32
log
@more normalisation for the index
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.31 2008/11/08 23:03:29 tg Exp $
d192 5
a196 1
CVSROOT?=/cvs
d198 1
a198 1
	cd ${.CURDIR} && cvs -Rqz3 -d ${CVSROOT} up -PAd
@


1.31
log
@more mass conversions, including ancient eMail addresses
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.30 2008/10/21 18:54:07 tg Exp $
d78 1
@


1.30
log
@in 100455CFFCE67E80D73 I systraced “make setup”, but this _may_ lead to
recursive systracing, which breaks, as spotted by bsiegert@@:

18:31⎜«benz» systrace: attach: Device busy
18:31⎜«benz» bei Extracting for pkgtools
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.29 2008/09/11 21:34:40 tg Exp $
d6 1
a6 1
#	The MirOS Project <miros-discuss@@66h.42h.de>
@


1.29
log
@clean up after the mac fanboy bsiegert@@:
• allow for safer regeneration of index (my system is still authoritative☺)
• we use ${FOO:L} == "yes" for boolean checks, not ${FOO:L:Myes}… since the
  value "yes no" can fool (for the same reasons, some variables are checked
  ==yes and !=yes while others are checked ==no and !=no but *no* variables
  are checked ==yes and ==no or so…)
• the USE_CXX check is ① bogus and ② too early; move the entire block of if
  USE_CCACHE to much further below when CXX and NO_CXX have been determined
• no package, not even your beloved ccache, can (build-)depend on itself
• didn’t we decide ${HOME}/.etc/ccache is a much nicer place for that stuff
  than ${HOME}/.ccache ? (XXX fix this in the port too, for default?)
• make overriding ${CCACHE_DIR} work at all (with systrace)
• clean up the ccache port Makefile after the mac fanboy tyler@@ while here…
  XXX CONFIGURE_STYLE=gnu is almost always wrong (editors/joe and all auto-
  XXX conf/automake ports themselves being notable exceptions, and a couple
  XXX of ports, like GNU m4, on e.g. Interix)
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.28 2008/06/08 13:41:45 bsiegert Exp $
d173 2
a174 1
	    SHELL=${MKSH} MKSH=${MKSH} ${SUDO} /bin/sh ${.CURDIR}/Setup.sh -T
@


1.28
log
@Add a "bulk-build" target that sets the appropriate options, creates dirs
for logs and bulk cookies (mmm, cookies) and does the right command line(s).
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.27 2007/08/24 14:54:15 tg Exp $
d76 3
a78 2
	@@USE_ICONV=port \
	    ${MAKE} describe ECHO_MSG="echo 1>&2" >${.CURDIR}/INDEX
@


1.27
log
@bugreport from wbx@@mirbsd.org – “mmake nfo” can only build HTML version of
man page if src tree scripts dir was checked out
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.26 2007/03/22 17:54:20 tg Exp $
d127 11
@


1.26
log
@for “make setup” don't assume X11 is installed
from Archite (D. Adam Karim) via IRC
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.25 2007/02/22 15:18:32 tg Exp $
d164 4
a167 1
nfo: Setup.sh.nfo Setup.sh.htm
@


1.25
log
@bring back SUBDIRLIST, ports/infrastructure/scripts/out-of-date needs it
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.24 2007/01/26 20:31:51 tg Exp $
d144 1
d152 1
@


1.24
log
@make it possible to 'make SUBONLY="foo/bar baz"' like with gcc module
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.23 2006/12/31 17:03:16 tg Exp $
d55 4
@


1.23
log
@bump to 2007
(yes, I'll commit that now because I'm bored, and it won't
make its way to the anoncvs mirrors before anything sensible
has been committed in addition anyway; these are the most
strategic places only)
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.22 2006/11/17 00:18:45 tg Exp $
d52 1
a52 4
SUBDIR != ${_CMD}
_MANUAL_SUBDIR=	yes
.elif defined(SUBDIRLIST)
SUBDIR != sed -e 's,[ 	]*\#.*,,' -e '/^[ 	]*$$/d' ${SUBDIRLIST}
@


1.22
log
@systrace the 'make setup' so it only writes to /usr/mpkg
(and temporarily to /etc) during operation
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.21 2006/11/16 23:34:21 tg Exp $
d5 1
a5 1
# Copyright (c) 2004, 2005, 2006
d9 5
a13 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d15 8
a22 8
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
d25 1
a25 1
# CVS ChangeLog, and the OpenBSD CVS ChangeLogs.
@


1.21
log
@proper quoting
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.20 2006/10/17 21:08:04 tg Exp $
d151 10
a160 2
	env CC=${CC:Q} SHELL=${MKSH} MKSH=${MKSH} \
	    ${SUDO} /bin/sh ${.CURDIR}/Setup.sh -T
@


1.20
log
@* setup.ksh: add -T option to Setup.sh(8) to use the checked-out copy of
  the package tools instead of downloading a distfile, document it and
  why (mostly for people who install from a CD, want to pkg_add binary
  packages and don't bother with the other stuff and downloading, e.g.
  in a restricted / non-networked environment)
* Makefile: use -T for 'make setup'

Note:	-T isn't something "mere users" should use at all. If you have
	used -T during your setup, it's highly recommended to execute
	$ cd $portsdir/essentials/pkgtools; mmake repackage reupgrade clean
	if and as soon as you can.
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.19 2006/09/20 22:24:50 tg Exp $
d42 1
a42 1
_CMD+=key='${key}'
d45 1
a45 1
_CMD+=maintainer='${name}'
d48 1
a48 1
_CMD+=category='${category}'
d51 1
a51 1
_CMD+=maintainer='${maintainer}'
d93 1
a93 1
	@@egrep -i -- "${key}" ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }'
d151 1
a151 1
	env CC='${CC}' SHELL=${SHELL} MKSH=${MKSH} \
@


1.19
log
@catch signal 5 too, idea from original lynx "oldlynx" sample script, thanks TD
while here, update licences where I can
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.18 2006/07/23 20:43:07 tg Exp $
d152 1
a152 1
	    ${SUDO} /bin/sh ${.CURDIR}/Setup.sh
@


1.18
log
@weirdness... [[ -d ... ]] follows links?
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.17 2006/02/21 18:04:47 tg Exp $
d23 1
a23 1
# the possibility of such damage or existence of a nontrivial bug.
d110 1
a110 1
	trap "rm -f $${_DONE_FILES}" 0 1 2 3 13 15; \
@


1.17
log
@add stats to 'mmake index'
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.16 2006/02/14 22:02:38 tg Exp $
d144 2
a145 1
	if [[ -d /usr/mpkg/lib/X11/app-defaults ]]; then \
@


1.16
log
@unbreak 'make setup' in clean chroot'd install
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.15 2006/02/01 16:29:13 tg Exp $
d72 1
@


1.15
log
@for 'make index' force USE_ICONV=port to unify dependencies
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.14 2006/01/02 03:29:12 tg Exp $
d140 3
d145 1
a145 1
		    /etc/X11/app-defaults/; \
@


1.14
log
@un-out-of-date, welcome to 2006
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.13 2005/12/28 17:28:57 tg Exp $
d75 2
a76 1
	@@${MAKE} describe ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
@


1.13
log
@* Makefile: /etc/X11/app-defaults is the place to go for 'em
* setup.ksh: add XAPPLRESDIR override to SetEnv files
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.12 2005/12/20 00:35:24 tg Exp $
d5 1
a5 1
# Copyright (c) 2004, 2005
d24 1
a24 1
#
@


1.12
log
@make -> mmake in descriptive texts
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.11 2005/12/17 05:46:17 tg Exp $
d139 6
@


1.11
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.10 2005/12/06 19:19:11 tg Exp $
d88 1
a88 1
	@@echo "e.g.: \"make search key=somekeyword\" \"make search name=somename\""
d131 1
a131 1
	@@echo 'Use "make nfo" to generate documentation!'
@


1.10
log
@create 0775 ./Distfiles and ./Packages if they don't yet exist
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.9 2005/11/15 21:10:19 tg Exp $
d16 8
a23 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
@


1.9
log
@fix typo in roff2htm and use it to auto-generate the HTML version as well
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.8 2005/11/15 18:06:56 tg Exp $
d132 6
@


1.8
log
@* now I'm content with the manual page
* add target for generation of docs
  - one for *nix systems
  - one for DOS fanboys
* nuke unneeded script
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.7 2005/11/09 20:38:48 tg Exp $
d135 1
a135 1
nfo: Setup.sh.nfo
d143 3
@


1.7
log
@bsiegert@@ plays too much with tcsh... anyway

* Hardcode /bin/sh in the call to Setup.sh since it divines the path
  to mksh anyway
* Pass ${MKSH} and ${SHELL} unmodified to the script (this aids these
  people who set it in command line before)

Note that "make setup" is only one specific way to invoke the
new installer (Setup.sh + setup.ksh), and the latter should be
run only once (or after grave changes, but it's stabilised a
lot recently); afterwards, all stuff installed (MirMake, mksh,
package tools, nroff, cksum, and whatnot) ought to be upgraded
by means of ports! (Yes, we're lacking some.)
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.6 2005/09/14 21:13:09 tg Exp $
d61 1
a61 1
.if !make(setup)
d130 2
d135 8
d148 1
a148 1
	print-licences print-index portupgrade setup cvsup
@


1.6
log
@* sync Setup.sh usage with reality

I'm thinking of removing the target altogether - since it
overwrites some files I rather think it's dangerous.

Or, for the sake of compatibility, refuse to run if
SetEnv.* already exist unless overridden.
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.5 2005/09/14 16:03:11 bsiegert Exp $
d128 1
d130 2
a131 1
	env CC='${CC}' ${SUDO} ${SHELL} ${.CURDIR}/Setup.sh
@


1.5
log
@infrastructure/install/Setup.sh -> Setup.sh
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.4 2005/07/05 20:08:28 tg Exp $
d129 1
a129 2
	env ourCC='${CC}' MAKE='${MAKE}' SHELL='${SHELL}' ${SUDO} \
	    ${SHELL} ${.CURDIR}/Setup.sh
@


1.4
log
@* capitalise the initial letter on Distfiles, Packages, etc.
* slightly change the Packages layout

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.3 2005/07/05 19:42:28 tg Exp $
d128 1
a128 1
setup: infrastructure/install/Setup.sh
d130 1
a130 1
	    ${SHELL} ${.CURDIR}/infrastructure/install/Setup.sh
@


1.3
log
@fix a 0x60 stray, and the INDEX columns
@
text
@d1 1
a1 1
# $MirOS: ports/Makefile,v 1.2 2005/03/19 22:26:37 bsiegert Exp $
d97 1
a97 1
MIRROR_MK?= ${.CURDIR}/distfiles/Makefile
@


1.2
log
@Change paths after infrastructure reshuffling. "make setup" works.
@
text
@d1 1
a1 1
# $MirOS$
d78 1
a78 1
	@@awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10); }' < ${.CURDIR}/INDEX
d80 1
a80 1
print-licenses: ${.CURDIR}/INDEX
d82 1
a82 1
	@@awk -F\| '{printf("%-40.39s%-3.2s%-3.2s%-3.2s%-3.2s%-25.25s\n",$$2,$$12,$$13,$$14,$$15,$$6);}' < ${.CURDIR}/INDEX
d105 1
a105 1
	@@_DONE_FILES=`mktemp /tmp/depends.XXXXXXXXX|| exit 1`; \
d137 1
a137 1
	print-licenses print-index portupgrade setup cvsup
@


1.1
log
@Initial revision
@
text
@d39 1
a39 1
_CMD=perl ${.CURDIR}/infrastructure/build/index-retrieve index='${.CURDIR}/INDEX'
d121 1
a121 1
	    ${.CURDIR}/infrastructure/fetch/distfiles-update-locatedb \
d126 1
a126 1
	    ${.CURDIR}/infrastructure/build/out-of-date
d128 1
a128 1
setup: infrastructure/stools/Setup.sh
d130 1
a130 1
	    ${SHELL} ${.CURDIR}/infrastructure/stools/Setup.sh
d132 1
a132 1
CVSROOT?=/ocvs
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
