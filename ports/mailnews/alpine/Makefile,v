head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2018.10.07.01.10.00;	author tg;	state Exp;
branches;
next	1.7;
commitid	1005BB95CA10BF418E8;

1.7
date	2017.08.07.20.16.06;	author tg;	state Exp;
branches;
next	1.6;
commitid	1005988C69344442E37;

1.6
date	2009.02.02.20.15.46;	author bsiegert;	state Exp;
branches;
next	1.5;
commitid	1004987546E0CC457E2;

1.5
date	2008.05.07.22.48.30;	author tg;	state Exp;
branches;
next	1.4;
commitid	100482231C374D9CA0B;

1.4
date	2008.05.07.22.34.00;	author tg;	state Exp;
branches;
next	1.3;
commitid	10048222E6A1882B1C1;

1.3
date	2008.05.07.22.28.39;	author tg;	state Exp;
branches;
next	1.2;
commitid	10048222D25548B7FFA;

1.2
date	2008.03.09.17.23.04;	author tg;	state Exp;
branches;
next	1.1;
commitid	10047D41CAA7E715397;

1.1
date	2008.02.17.15.29.32;	author bsiegert;	state Exp;
branches;
next	;
commitid	10047B852F400009784;


desc
@@


1.8
log
@spelling cleanup: “programme” is distinct from “program”; even in
British English, the latter is used for computer programs, while
the former serves for things like the TV programme, or a programme
to plant trees
@
text
@# $MirOS: ports/mailnews/alpine/Makefile,v 1.7 2017/08/07 20:16:06 tg Exp $

ONLY_FOR_PLATFORM=	Darwin:*:*

COMMENT=		program for Internet News and eMail, curses interface
COMMENT-web=		program for Internet News and eMail, web interface
COMMENT-cclient=	University of Washington c-client eMail access routines
COMMENT-daemon=		University of Washington IMAP4rev1/POP2/POP3 mail servers
COMMENT-mailutil=	University of Washington eMail management utility
COMMENT-pico=		small text editor embedded in alpine
COMMENT-pilot=		filesystem browser embedded in alpine
CATEGORIES=		devel editors mail mailnews net news sysutils
HOMEPAGE=		http://www.washington.edu/alpine/
VERSION=		2.00
CCLIENT_VERSION=	2007c
PICO_VERSION=		5.04
PILOT_VERSION=		2.99
DASH_VER=		0	# must be the highest out of these
DASH_VER-cclient=	0
DASH_VER-picolot=	0
DISTNAME=		alpine-${VERSION}
PKGNAME-web=		alpine-web-${VERSION}-${DASH_VER}
PKGNAME-cclient=	c-client-${CCLIENT_VERSION}-${DASH_VER-cclient}
PKGNAME-daemon=		imap-uw-${CCLIENT_VERSION}-${DASH_VER-cclient}
PKGNAME-mailutil=	mailutil-uw-${CCLIENT_VERSION}-${DASH_VER-cclient}
FULLPKGNAME-pico=	pico-${PICO_VERSION}-${DASH_VER-picolot}
FULLPKGNAME-pilot=	pilot-${PILOT_VERSION}-${DASH_VER-picolot}
MASTER_SITES=		ftp://ftp.cac.washington.edu/alpine/ \
			ftp://ftp.cac.washington.edu/alpine/old/ \
			ftp://ftp.fu-berlin.de/unix/mail/alpine/ \
			ftp://ftp.fu-berlin.de/unix/mail/alpine/old/
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.de>

# Apache Licence v2.0
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes

.include <mirports.sys.mk>

FLAVOURS=		ldap
FLAVOUR?=

MULTI_PACKAGES=		-cclient -daemon -mailutil -pico -pilot #-web
SUBPACKAGE?=

# no TCL on Darwin yet
#TCL_VERSION?=		8.4
#BUILD_DEPENDS+=		:tcl-${TCL_VERSION}*:lang/tcl/${TCL_VERSION}

#.if defined(PACKAGING) && (${SUBPACKAGE} == "-web")
#LIB_DEPENDS+=		tcl::lang/tcl/${TCL_VERSION}
#.endif

.if defined(PACKAGING) && (${SUBPACKAGE} != "-cclient") && \
    (${SUBPACKAGE} != "-pico") && (${SUBPACKAGE} != "-pilot")
# no shlib yet
#LIB_DEPENDS+=		c-client::mailnews/alpine,-cclient
.endif

.if ${FLAVOUR:L:Mldap}
BUILD_DEPENDS+=		:openldap-client-*:databases/openldap
.  if defined(PACKAGING) && (${SUBPACKAGE} != "-web") && \
    (${SUBPACKAGE} != "-pico") && (${SUBPACKAGE} != "-pilot")
LIB_DEPENDS+=		ldap::databases/openldap
.  endif
.endif

.if ${OStype} == "Darwin"
ccOStype=		oxp
USE_CA_CERTIFICATES=	Yes
.elif ${OStype} == "Interix"
# untested
ccOStype=		sua
USE_CA_CERTIFICATES=	No		#XXX for now
.elif ${OStype} == "MidnightBSD"
# untested
ccOStype=		bsg
USE_CA_CERTIFICATES=	Yes
.elif ${OStype} == "MirBSD"
# untested
ccOStype=		bsm
USE_CA_CERTIFICATES=	No
.elif ${OStype} == "OpenBSD"
# untested
ccOStype=		bso
USE_CA_CERTIFICATES=	Yes
.endif

CONFIGURE_STYLE=	autoconf detectheader
AUTOCONF_NEW=		Yes
#MODGNU_RECURSE_DIRS=	${WRKSRC}/web/src/cgi.tcl-1.10 ${WRKSRC}
CONFIGURE_ARGS+=	${CONFIGURE_SHARED} \
			--enable-static \
			--with-system-pinerc=${SYSCONFDIR:Q}/pine.conf \
			--with-system-fixed-pinerc=${SYSCONFDIR:Q}/pine.conf.fixed \
			--with-debug-file=.etc/pine-debug \
			--with-default-signature-file=.etc/sig \
			--with-default-addressbook=.etc/addressbook \
			--with-passfile=.etc/ssh/pine.pwd \
			--with-ssl-dir=/usr \
			--with-ssl-certs-dir=/etc/ssl/certs \
			--with-tcl-lib=tcl${TCL_VERSION:S/.//} \
			--with-tcl-include=${LOCALBASE:Q}/include/tcl${TCL_VERSION} \
			--with-c-client-target=${ccOStype} \
			--disable-nls
CONFIGURE_ARGS+=	--without-tcl	#XXX for now

.if ${OStype} == "Interix"
CONFIGURE_ARGS+=	--without-ipv6 \
			--without-ssl	#XXX for now
.endif

.if (${OStype} == "MidnightBSD") || (${OStype} == "OpenBSD")
CONFIGURE_ARGS+=	--with-krb5-dir=/usr
.else
CONFIGURE_ARGS+=	--without-krb5
.endif

.if ${FLAVOUR:L:Mldap}
# untested
CONFIGURE_ARGS+=	--with-ldap-dir=${LOCALBASE:Q}
.else
CONFIGURE_ARGS+=	--without-ldap
.endif

.if ${USE_CA_CERTIFICATES:L} == "yes"
CONFIGURE_ARGS+=	--with-ssl-certs-dir=${LOCALBASE:Q}/share/ca-certificates
BUILD_DEPENDS+=		:ca-certificates-*:essentials/ca-certificates
.  if defined(PACKAGING) && \
    (${SUBPACKAGE} != "-pico") && (${SUBPACKAGE} != "-pilot")
RUN_DEPENDS+=		:ca-certificates-*:essentials/ca-certificates
.  endif
.endif

SUBST_VARS+=		VERSION TCL_VERSION
WEBALPINEDIR=		${PREFIX}/share/${PKGNAME-web}

REPLVARS=		MKSH TRUEPREFIX SYSCONFDIR
REPLDATA=
EXTRASCRIPTS=		mbxfix #pgpencrypt pgpdecode pgpsign \
#			pine.smime pine.smime.init

post-extract:
	cd ${FILESDIR} && pax -vrw . ${WRKSRC}/
	@@-rm -f ${WRKDIR}/REPLSCRIPT
.for _i in ${REPLVARS}
	@@print ,g@@${_i:Q}@@s${${_i}:Q}g >>${WRKDIR}/REPLSCRIPT
.endfor
	@@print wq >>${WRKDIR}/REPLSCRIPT

pre-build:
.for _f in ${EXTRASCRIPTS} ${REPLDATA}
	cd ${WRKBUILD} && ed -s ${_f:Q} <${WRKDIR}/REPLSCRIPT
.endfor

#post-build:
#	cd ${WRKBUILD}/web/src && exec ${_SYSTRACE_CMD} ${SETENV} ${MAKE_ENV} \
#	    ${MAKE_PROGRAM} ${MAKE_FLAGS} -f ${MAKE_FILE} ${ALL_TARGET}

post-install:
#	cd ${WRKBUILD}/web/src && exec ${SUDO} ${_SYSTRACE_CMD} \
#	    ${SETENV} ${MAKE_ENV} ${_FAKE_SETUP} \
#	    ${MAKE_PROGRAM} ${FAKE_FLAGS} -f ${MAKE_FILE} ${FAKE_TARGET}
#	${INSTALL_DATA_DIR} ${WEBALPINEDIR}
#	cd ${WRKBUILD}/web/src && pax -rw . ${WEBALPINEDIR}/
#	rm -rf ${WEBALPINEDIR}/src
	${INSTALL_DATA_DIR} ${PREFIX}/include/c-client \
	    ${PREFIX}/share/doc/{alpine,c-client}
	cd ${WRKSRC}/imap && \
	    ${INSTALL_PROGRAM} dmail/dmail imapd/imapd ipopd/ipop2d \
	    ipopd/ipop3d mailutil/mailutil mlock/mlock tmail/tmail \
	    ${PREFIX}/libexec/ && \
	    cd src && \
	    ${INSTALL_MAN} dmail/dmail.1 mailutil/mailutil.1 tmail/tmail.1 \
	    ${PREFIX}/man/man1/ && \
	    ${INSTALL_MAN} imapd/imapd.8 ipopd/ipopd.8 ${PREFIX}/man/man8/
	mv ${PREFIX}/libexec/mailutil ${PREFIX}/bin/
	cd ${PREFIX}/man/man8 && mv ipopd.8 ipop2d.8 && ln ipop2d.8 ipop3d.8
	${INSTALL_DATA} ${WRKSRC}/{NOTICE,README} \
	    ${WRKSRC}/doc/{brochure,tech-notes}.txt ${PREFIX}/share/doc/alpine/
	cd ${WRKSRC}/imap/docs && ${INSTALL_DATA} \
	    ../{LICENSE.txt,NOTICE,README,SUPPORT} CONFIG FAQ.html FAQ.txt \
	    IPv6.txt RELNOTES SSLBUILD Y2K FAQ.txt IPv6.txt bugs.txt \
	    calendar.txt commndmt.txt drivers.txt formats.txt imaprc.txt \
	    internal.txt locking.txt md5.txt mixfmt.txt naming.txt \
	    ${PREFIX}/share/doc/c-client/
	cd ${WRKSRC}/imap/c-client && ${INSTALL_DATA} c-client.h dummy.h \
	    env.h env_unix.h fdstring.h flstring.h fs.h ftl.h imap4r1.h \
	    linkage.h mail.h misc.h netmsg.h newsrc.h nl.h nntp.h osdep.h \
	    pseudo.h rfc822.h smtp.h sslio.h tcp.h tcp_unix.h unix.h utf8.h \
	    utf8aux.h ${PREFIX}/include/c-client/
	${INSTALL_DATA} ${WRKBUILD}/imap/c-client/c-client.a \
	    ${PREFIX}/lib/libc-client.a
	cd ${WRKBUILD} && ${INSTALL_SCRIPT} ${EXTRASCRIPTS} ${PREFIX}/bin/

.include <bsd.port.mk>
@


1.7
log
@filesystem
@
text
@d1 1
a1 1
# $MirOS: ports/mailnews/alpine/Makefile,v 1.6 2009/02/02 20:15:46 bsiegert Exp $
d5 2
a6 2
COMMENT=		programme for Internet News and eMail, curses interface
COMMENT-web=		programme for Internet News and eMail, web interface
@


1.6
log
@Update to 2.00, yay!
@
text
@d1 1
a1 1
# $MirOS: ports/mailnews/alpine/Makefile,v 1.5 2008/05/07 22:48:30 tg Exp $
d11 1
a11 1
COMMENT-pilot=		file system browser embedded in alpine
@


1.5
log
@• replace MODGNU_CONFIG_GUESS_DIRS with MODGNU_RECURSE_DIRS
• always place ${WRKSRC} itself at the end of MODGNU_RECURSE_DIRS due to
  recursion issues inside of autoconf itself
• if MODGNU_RECURSE_DIRS=${WRKSRC} stood in the Makefile, nuke it (default)
• remove dead reference to MODGNU_TWIDDLE_DIRS
@
text
@d1 1
a1 1
# $MirOS: ports/mailnews/alpine/Makefile,v 1.4 2008/05/07 22:34:00 tg Exp $
d14 3
a16 3
VERSION=		1.10
CCLIENT_VERSION=	2007a
PICO_VERSION=		5.01
@


1.4
log
@set ONLY_FOR_PLATFORM for now
@
text
@d1 1
a1 1
# $MirOS: ports/mailnews/alpine/Makefile,v 1.3 2008/05/07 22:28:39 tg Exp $
d93 1
a93 1
#MODGNU_CONFIG_GUESS_DIRS= ${WRKSRC}/web/src/cgi.tcl-1.10 ${WRKSRC}
@


1.3
log
@Replace the Darwin-only Alpine-only port with one not based upon, but
designed to match (and eventually replace) the current Pine port.

Missing:
• Support for SUA, BSG, BSM, BSO (i.e., everything other than OXP)
• TCL support for Web Alpine (no TCL on Darwin yet)
• Various other imap/c-client support patches
• ~/.etc support (this will go in later, break compatibility with
  current Alpine ports – which are Darwin only anyway – and restore
  compatibility with Pine ports – as Alpine 1.x = Pine 5.x)
• PGP and S/MIME support
• shared libc-client (required e.g. for PHP)
• …
@
text
@d1 3
a3 1
# $MirOS$
@


1.2
log
@bulk convert FLAVOR to FLAVOUR; nuke unused file; convert to $Mdocdate
@
text
@d1 1
a1 2
# $MirOS: ports/mailnews/alpine/Makefile,v 1.1 2008/02/17 15:29:32 bsiegert Exp $
# $OpenBSD: Makefile,v 1.56 2003/10/05 21:42:29 jakob Exp $
d3 16
a18 5
ONLY_FOR_PLATFORM=	Darwin:*:*

COMMENT=		alpine messaging system
CATEGORIES=		mailnews
VERSION=		1.00
d20 6
d27 4
a30 3
			ftp://ftp.cac.washington.edu/alpine/old
EXTRACT_SUFX=		.tar.bz2
HOMEPAGE=		http://www.washington.edu/alpine/
d32 3
a34 1
# Apache Licence v2
a36 2
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d38 1
a38 1
NO_REGRESS=		Yes
d40 1
a40 1
FLAVOURS=		tcl
d43 79
a121 2
.if ${FLAVOUR:L:Mtcl}
LIB_DEPENDS+=		tcl::lang/tcl/8.4
d123 10
a132 1
CONFIGURE_ARGS+=	--without-tcl
d135 60
a194 2
CONFIGURE_STYLE=	autoconf
AUTOCONF_NEW=		Yes
@


1.1
log
@Very bare-bones port of alpine-1.00: no patches, no shared c-client, etc.
Does not work on MirOS for now.
@
text
@d1 1
a1 1
# $MirOS: ports/mailnews/pine/Makefile,v 1.22 2006/09/20 22:24:50 tg Exp $
d23 2
a24 2
FLAVORS=		tcl
FLAVOR?=
d26 1
a26 1
.if ${FLAVOR:L:Mtcl}
@

