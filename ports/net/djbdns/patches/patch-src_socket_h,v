head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2016.03.26.17.29.24;	author tg;	state Exp;
branches;
next	1.3;
commitid	10056F6C535787D61F0;

1.3
date	2008.05.01.00.52.34;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004819145953F55377;

1.2
date	2006.07.27.00.58.16;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044C80EE124197593;

1.1
date	2005.05.14.23.21.05;	author tg;	state Exp;
branches
	1.1.201.1;
next	;
commitid	1e94428687d39445;

1.1.201.1
date	2005.05.14.23.21.05;	author tg;	state Exp;
branches;
next	;
commitid	1e94428687d39445;


desc
@@


1.4
log
@complete overhaul of djbdns port:

• merge t4/t6 flavours back into one binary
  ‣ greatly simplify IPv6 handling, too; drop code for v6-less OSes
• merge v4/v6 dnsroots back into one, update all of them
• improve documentation a bit
• apply two patches from http://www.your.org/dnscache/ (SECURITY):
  ‣ merge identical outgoing requests
  ‣ allow caching SOA responses
• update to Fefe’s djbdns-1.05-test27.diff.bz2
  ‣ fixes recursively resolving hosts behind IPv6-only nameservers;
    spotted by Natureshadow (for Teckids’ Lunatics network) and via
    http://serverfault.com/q/627912/189656 (which I’ll answer RSN)
  ⚠ fix with “one second” CDB validity patch
  ⚠ adapt for OpenBSD-style IPv6
• drop ip6.int. reverse v6 DNS for good
• improve dealing with mixing v4/v6 transport
  ⇒ TODO add IP4SEND/IP6SEND support; currently; if IPSEND is v6
    but we send to a v4 server, we use INADDR_ANY for outgoing,
    as automatic fallback address
@
text
@$MirOS: ports/net/djbdns/patches/patch-src_socket_h,v 1.3 2008/05/01 00:52:34 tg Exp $
--- src/socket.h.orig	Sun Feb 11 21:11:23 2001
+++ src/socket.h	Sat Mar 26 15:18:58 2016
@@@@ -1,22 +1,59 @@@@
+/* $MirOS: ports/net/djbdns/patches/patch-src_socket_h,v 1.3 2008/05/01 00:52:34 tg Exp $ */
+
+/*-
+ * Most of the patches contained in the MirPorts Framework are
+ * Copyright (c) 2004, 2005, 2006, 2016
+ *	mirabilos <m@@mirbsd.org>
+ *
+ * Provided that these terms and disclaimer and all copyright notices
+ * are retained or reproduced in an accompanying document, permission
+ * is granted to deal in this work without restriction, including un-
+ * limited rights to use, publicly perform, distribute, sell, modify,
+ * merge, give away, or sublicence.
+ *
+ * This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
+ * the utmost extent permitted by applicable law, neither express nor
+ * implied; without malicious intent or gross negligence. In no event
+ * may a licensor, author or contributor be held liable for indirect,
+ * direct, other damage, loss, or other issues arising in any way out
+ * of dealing in the work, even if advised of the possibility of such
+ * damage or existence of a defect, except proven that it results out
+ * of said person's immediate fault when using the work as intended.
+ */
+
 #ifndef SOCKET_H
 #define SOCKET_H
 
 #include "uint16.h"
+#include "uint32.h"
 
 extern int socket_tcp(void);
 extern int socket_udp(void);
+extern int socket_tcp6(void);
+extern int socket_udp6(void);
 
 extern int socket_connect4(int,const char *,uint16);
+extern int socket_connect6(int s,const char ip[16],uint16 port,uint32 scope_id);
 extern int socket_connected(int);
-extern int socket_bind4(int,char *,uint16);
+extern int socket_bind4(int,const char *,uint16);
 extern int socket_bind4_reuse(int,char *,uint16);
+extern int socket_bind6(int s,const char *ip,uint16 port,uint32 scope_id);
+extern int socket_bind6_reuse(int s,const char *ip,uint16 port,uint32 scope_id);
 extern int socket_listen(int,int);
 extern int socket_accept4(int,char *,uint16 *);
+extern int socket_accept6(int s,char *ip,uint16 *port,uint32 *scope_id);
 extern int socket_recv4(int,char *,int,char *,uint16 *);
 extern int socket_send4(int,const char *,int,const char *,uint16);
+extern int socket_recv6(int s,char *buf,unsigned int len,char *ip,uint16 *port,uint32 *scope_id);
+extern int socket_send6(int s,const char *buf,unsigned int len,const char *ip,uint16 port,uint32 scope_id);
 extern int socket_local4(int,char *,uint16 *);
 extern int socket_remote4(int,char *,uint16 *);
+extern int socket_local6(int s,char *ip,uint16 *port,uint32 *scope_id);
+extern int socket_remote6(int s,char *ip,uint16 *port,uint32 *scope_id);
 
 extern void socket_tryreservein(int,int);
+
+extern const char* socket_getifname(uint32 interface);
+extern uint32 socket_getifidx(const char *ifname);
 
 #endif
@


1.3
log
@remove the advertising clause from all of my contributions
to the MirPorts Framework
@
text
@d1 1
a1 1
$MirOS: ports/net/djbdns/patches/patch-src_socket_h,v 1.2 2006/07/27 00:58:16 tg Exp $
d3 3
a5 3
+++ src/socket.h	Thu May  1 00:49:59 2008
@@@@ -1,22 +1,61 @@@@
+/* $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $ */
d9 2
a10 2
+ * Copyright (c) 2004, 2005, 2006
+ *	Thorsten Glaser <tg@@mirbsd.de>
a62 2
+
+extern int noipv6;
@


1.2
log
@* make zonenotify connect to IPv6 (DNS or numeric) too
* make zonenotify connect to all IPs of the hostname given
* make axfrdns log IPv6 addresses (have to move it though)
  XXX pending making DJB_V6ONLY the default and only case
* put fromhex into common file while here
* centralise licence info for my diffs while here
* bump patchlevel

new zonenotify loosely tested, new axfrdns log format seems okay
thanks gecko2 for providing bind9 backup NS on ipv6
@
text
@d1 1
a1 1
$MirOS: ports/net/djbdns/patches/patch-src_socket_h,v 1.1.201.1 2005/05/14 23:21:05 tg Exp $
d3 3
a5 3
+++ src/socket.h	Wed Jul 26 23:44:19 2006
@@@@ -1,22 +1,66 @@@@
+/* $MirOS: src/share/misc/licence.template,v 1.12 2006/07/22 14:44:37 tg Draft $ */
d8 1
a8 1
+ * Most of the patches contained in the MirPorts Framework is
d12 5
a16 6
+ * Licensee is hereby permitted to deal in this work without restric-
+ * tion, including unlimited rights to use, publicly perform, modify,
+ * merge, distribute, sell, give away or sublicence, provided all co-
+ * pyright notices above, these terms and the disclaimer are retained
+ * in all redistributions or reproduced in accompanying documentation
+ * or other materials provided with binary redistributions.
d18 8
a25 12
+ * All advertising materials mentioning features or use of this soft-
+ * ware must display the following acknowledgement:
+ *	This product includes material provided by Thorsten Glaser.
+ *
+ * Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
+ * express, or implied, to the maximum extent permitted by applicable
+ * law, without malicious intent or gross negligence; in no event may
+ * licensor, an author or contributor be held liable for any indirect
+ * or other damage, or direct damage except proven a consequence of a
+ * direct error of said person and intended use of this work, loss or
+ * other issues arising in any way out of its use, even if advised of
+ * the possibility of such damage or existence of a defect.
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$MirOS$
d3 31
a33 2
+++ src/socket.h	Sat May 14 22:27:18 2005
@@@@ -2,21 +2,37 @@@@
@


1.1.201.1
log
@New djbdns port, #ifdef'd, "original" and "no_ipv6" flavours removed
"no_ipv4" non-functional at the moment, will follow later after
redesign using crunchgen(1) and crunchide(1)
@
text
@@
