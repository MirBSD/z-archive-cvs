head	1.23;
access;
symbols;
locks; strict;
comment	@# @;


1.23
date	2017.04.04.20.21.50;	author tg;	state Exp;
branches;
next	1.22;
commitid	10058E4007338A06D93;

1.22
date	2017.04.04.19.49.31;	author tg;	state Exp;
branches;
next	1.21;
commitid	10058E3F8A62F08813C;

1.21
date	2012.01.04.23.16.38;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004F04DDE925150E8F;

1.20
date	2009.05.17.17.51.07;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004A104EA2271C2AD8;

1.19
date	2008.12.30.03.01.32;	author tg;	state Exp;
branches;
next	1.18;
commitid	10049598F0E37360586;

1.18
date	2008.11.29.17.03.48;	author tg;	state Exp;
branches;
next	1.17;
commitid	100493175607A689D2F;

1.17
date	2008.11.08.23.04.01;	author tg;	state Exp;
branches;
next	1.16;
commitid	10049161AC72620EAF0;

1.16
date	2008.07.20.21.35.41;	author tg;	state Exp;
branches;
next	1.15;
commitid	1004883AFBC35EA6B9A;

1.15
date	2008.07.20.00.02.39;	author tg;	state Exp;
branches;
next	1.14;
commitid	100488280A578FB127A;

1.14
date	2008.04.12.20.36.04;	author tg;	state Exp;
branches;
next	1.13;
commitid	10048011D213F226D2C;

1.13
date	2008.04.02.00.06.03;	author tg;	state Exp;
branches;
next	1.12;
commitid	10047F2CD0D74098805;

1.12
date	2008.03.09.17.23.22;	author tg;	state Exp;
branches;
next	1.11;
commitid	10047D41CAA7E715397;

1.11
date	2007.09.02.19.55.51;	author tg;	state Exp;
branches;
next	1.10;
commitid	10046DB154E5284945A;

1.10
date	2007.02.17.20.49.06;	author tg;	state Exp;
branches;
next	1.9;
commitid	10045D76A5967EACE0B;

1.9
date	2006.09.14.00.12.15;	author tg;	state Exp;
branches;
next	1.8;
commitid	10045089C0E234154C3;

1.8
date	2006.06.21.21.21.06;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004499B8504FD5A37E;

1.7
date	2006.02.09.09.36.11;	author tg;	state Exp;
branches;
next	1.6;
commitid	10043EB0C94610EDE76;

1.6
date	2005.09.23.11.06.15;	author tg;	state Exp;
branches;
next	1.5;
commitid	6b014333e19a3a57;

1.5
date	2005.09.23.11.04.36;	author tg;	state Exp;
branches;
next	1.4;
commitid	2d504333e14ab7ab;

1.4
date	2005.09.21.19.36.16;	author tg;	state Exp;
branches;
next	1.3;
commitid	26a04331b62ea702;

1.3
date	2005.08.21.11.49.50;	author tg;	state Exp;
branches;
next	1.2;
commitid	3af74308676450c3;

1.2
date	2005.05.04.13.21.11;	author tg;	state Exp;
branches;
next	1.1;
commitid	3ac34278cc5d4086;

1.1
date	2005.03.18.15.49.02;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.49.02;	author tg;	state Exp;
branches;
next	;


desc
@@


1.23
log
@et voil√†
@
text
@# $MirOS: ports/net/rsync/Makefile,v 1.22 2017/04/04 19:49:31 tg Exp $
# $OpenBSD: Makefile,v 1.77 2016/04/06 21:17:29 sthen Exp $

COMMENT=		mirroring/synchronisation over low bandwidth links
VERSION=		3.1.2
CATEGORIES=		net
HOMEPAGE=		http://rsync.samba.org/
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.org>

FLAVOURS=		static
FLAVOUR?=

DISTNAME=		rsync-${VERSION}
FULLPKGNAME=		rsync${FLAVOUR_EXT}-${VERSION}-${DASH_VER}

# GNU GPLv3
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=		http://rsync.samba.org/ftp/rsync/ \
			http://rsync.samba.org/ftp/rsync/old-versions/ \
			http://rsync.samba.org/ftp/rsync/src-previews/ \
			http://ftp.funet.fi/pub/mirrors/samba.org/pub/rsync/src/

# regression tests do more with 'sudo mmake regress'

SUBST_VARS+=		TRUEPREFIX
CONFIGURE_STYLE=	autoconf
AUTOCONF_NEW=		Yes
CONFIGURE_SCRIPT=	configure.sh
AUTOCONF=		autoconf -o ${CONFIGURE_SCRIPT}
REORDER_DEPENDENCIES+=	rsyncam.dep
CONFIGURE_ENV+=		HAVE_YODL2MAN=0
CONFIGURE_ARGS+=	--with-included-popt \
			--with-rsyncd-conf=${SYSCONFDIR:Q}/rsyncd.conf \
			--with-rsh="ssh -T" \
			--with-nobody-group=_rsync

.if ${FLAVOUR:L} == "static"
CONFIGURE_ENV+=		ac_cv_header_iconv_h=no
CONFIGURE_ARGS+=	--disable-debug \
			--disable-locale \
			--disable-iconv-open \
			--disable-iconv
LDSTATIC=		-static
PLIST=			${PKGDIR}/PLIST-static
.else
MODULES+=		converters/libiconv
USE_ICONV?=		any
USE_ICONV+=		oldm4
.endif

.if ${FLAVOUR:L} == "static"
post-extract:
	@@print 'AC_DEFUN([AM_ICONV], [])' >${WRKSRC:Q}/iconv.m4
.endif

post-install:
.if ${FLAVOUR:L} == "static"
	mv -f ${PREFIX:Q}/bin/rsync ${PREFIX:Q}/bin/rsync-static
	-rm -f ${PREFIX:Q}/man/man*/*
.else
	${SUBST_CMD} ${PREFIX:Q}/man/man5/rsyncd.conf.5
	${INSTALL_DATA_DIR} ${PREFIX:Q}/share/doc/rsync
	cd ${WRKSRC:Q} && ${INSTALL_DATA} NEWS OLDNEWS README TODO \
	    csprotocol.txt rsync3.txt tech_report.tex doc/rsync.sgml \
	    ${PREFIX:Q}/share/doc/rsync/
.endif

.include <bsd.port.mk>
@


1.22
log
@pretty straight-forward update of rsync:

‚Ä¢ add most OpenBSD patches (but ignore rrsync)
‚Ä¢ add a patch from Debian (adding -4/-6 to ssh on rsync -4/-6)

marked as ‚Äúbroken: do not use yet‚Äù because I‚Äôm targetting a
leap second patch for this release (rsync transfers time_t
over the network, which cannot go well‚Ä¶)
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.21 2012/01/04 23:16:38 tg Exp $
a3 3
# it's missing a patch to calculate out leap seconds I'm planning to add
BROKEN=			do not use yet

@


1.21
log
@update
@
text
@d1 5
a5 2
# $MirOS: ports/net/rsync/Makefile,v 1.20 2009/05/17 17:51:07 tg Exp $
# $OpenBSD: Makefile,v 1.41 2004/05/11 13:39:17 naddy Exp $
d8 1
a8 1
VERSION=		3.0.9
d27 4
a30 1
			http://rsync.samba.org/ftp/rsync/src-previews/
d32 1
d38 1
d40 1
d42 1
a42 1
			--with-rsyncd-conf=${SYSCONFDIR:Q}/rsyncd.conf
d47 1
a47 1
			--disable-iconv \
d49 1
a49 1
			--disable-locale
d60 1
a60 1
	@@print 'AC_DEFUN([AM_ICONV], [])' >${WRKSRC}/iconv.m4
d65 2
a66 2
	mv -f ${PREFIX}/bin/rsync ${PREFIX}/bin/rsync-static
	-rm -f ${PREFIX}/man/man*/*
d68 5
a72 3
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/rsync
	cd ${WRKSRC} && ${INSTALL_DATA} NEWS OLDNEWS README TODO rsync3.txt \
	    csprotocol.txt tech_report.tex ${PREFIX}/share/doc/rsync/
@


1.20
log
@update
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.19 2008/12/30 03:01:32 tg Exp $
d5 1
a5 1
VERSION=		3.0.6
d60 2
a61 3
	cd ${WRKSRC} && ${INSTALL_DATA} COPYING NEWS OLDNEWS README TODO \
	    csprotocol.txt rsync3.txt rsyncsh.txt tech_report.tex \
	    ${PREFIX}/share/doc/rsync/
@


1.19
log
@update rsync, not even 36hrs old‚Ä¶
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.18 2008/11/29 17:03:48 tg Exp $
d5 1
a5 1
VERSION=		3.0.5
d39 1
@


1.18
log
@move anoncvs stub from /var/anoncvs/anoncvs to /var/anoncvs,
shell from /var/anoncvs/anoncvssh to /usr/libexec/anoncvssh,
devices are now on mfs, fix some typos etc. while here

=> /var/anoncvs and its subdirectories can now be mounted
   with nodev and nosuid

condition on the mfs mount: at least one user must exist
whose home directory is /var/anoncvs (or one of its sub-
directories), whose shell is /usr/libexec/anoncvssh, and
whose password is not empty ('*'); /var/anoncvs/dev will
be filled with arandom, null and zero.

also enforce stricter perms on cvs and rsync binaries in
the chroot (0110 root:_anoncvs)

do not change anything pertaining to the MirOS mirrors
yet, as these will have to be changed to match the new
default values with some OS upgrade later
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.17 2008/11/08 23:04:01 tg Exp $
d5 1
a5 1
VERSION=		3.0.3
@


1.17
log
@more mass conversions, including ancient eMail addresses
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.16 2008/07/20 21:35:41 tg Exp $
a35 1
# copy this to /var/anoncvs/anoncvs/bin/rsync, chmod 111
@


1.16
log
@fix FULLPKGNAME of the static flavour, oops
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.15 2008/07/20 00:02:39 tg Exp $
d8 1
a8 1
RESPONSIBLE=		Thorsten Glaser <tg@@66h.42h.de>
@


1.15
log
@‚Ä¢ update to 3.0.3
‚Ä¢ make rsync-static a non-conflicting package just containing the binary
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.14 2008/04/12 20:36:04 tg Exp $
d14 1
a14 1
FULLPKGNAME-static=	rsync-static-${VERSION}-${DASH_VER}
@


1.14
log
@cheap‚Äôn‚Äôsimple upgrade to rsync-3.0.2:
‚Ä¢ xattrs support is available in MidnightBSD (and possibly Darwin), so this
  is a SECURITY upgrade for them
‚Ä¢ the rsync-3.0.1pre3 distfile vanished anyway
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.13 2008/04/02 00:06:03 tg Exp $
d5 1
a5 1
DISTNAME=		rsync-3.0.2
d13 3
d42 1
d55 4
d63 1
@


1.13
log
@upgrade to rsync 3, GPLv3
‚Ä¢ took me more than 2 hours
‚Ä¢ book example of crazy buildsystem:
  ‚Ä£ does not use libtool or automake/aclocal
  ‚Ä£ does not use iconv.m4
  ‚Ä£ uses configure.sh custom filename for configure script
‚Ä¢ bump version, remove old CVE fix
‚Ä¢ switch to CONFIGURE_STYLE=autoconf
‚Ä¢ add a touching file (rsyncam.dep) for ‚Äúconfigure.sh‚Äù processing ‚òπ
‚Ä¢ use --disable-iconv explicitly for -static flavour
‚Ä¢ use libiconv module (dependency) for normal flavour
‚Ä¢ patch configure.in to use our iconv.m4 file
‚Ä¢ install a few more doc files
‚Ä¢ make rsync *NOT* link against -liconv if --disable-iconv is given!
  ‚Ä£ prevents a DT_NEEDED which otherwise appeared even if
    no function from the iconv library was imported!
‚Ä¢ when calling $CC with -c, always add $CFLAGS $CPPFLAGS (sigh‚Ä¶)
‚Ä¢ support MidnightBSD: we assume they have FreeBSD xattr support
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.12 2008/03/09 17:23:22 tg Exp $
d5 1
a5 1
DISTNAME=		rsync-3.0.1pre3
@


1.12
log
@bulk convert FLAVOR to FLAVOUR; nuke unused file; convert to $Mdocdate
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.11 2007/09/02 19:55:51 tg Exp $
d5 1
a5 1
DISTNAME=		rsync-2.6.9
a9 3
PATCH_LIST=		patch-* *.diff
DASH_VER=		1

d13 1
a13 1
# GNU GPLv2
d20 2
a21 1
			http://rsync.samba.org/ftp/rsync/old-versions/
d23 5
a27 1
CONFIGURE_STYLE=	gnu
d36 1
d39 4
d45 4
a48 1
DOCDIR=			${PREFIX}/share/doc/rsync
d51 4
a54 3
	${INSTALL_DATA_DIR} ${DOCDIR}
	cd ${WRKSRC}; ${INSTALL_DATA} NEWS OLDNEWS README TODO \
	    tech_report.tex ${DOCDIR}/
@


1.11
log
@SECURITY: fix CVE-2007-4091
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.10 2007/02/17 20:49:06 tg Exp $
d13 2
a14 2
FLAVORS=		static
FLAVOR?=
d30 1
a30 1
.if ${FLAVOR:L} == "static"
@


1.10
log
@update to 2.6.9
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.9 2006/09/14 00:12:15 tg Exp $
d10 3
@


1.9
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ≠ edited by script with manual postprocessing
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.8 2006/06/21 21:21:06 tg Exp $
d4 2
a5 2
COMMENT=			mirroring/synchronisation over low bandwidth links
DISTNAME=		rsync-2.6.8
d25 1
a25 1
			--with-rsyncd-conf="${SYSCONFDIR}/rsyncd.conf"
d30 2
d39 2
a40 1
	${INSTALL_DATA} ${WRKSRC}/tech_report.tex ${DOCDIR}/
@


1.8
log
@update to 2.8.8
disable iconv for static flavour
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.7 2006/02/09 09:36:11 tg Exp $
d4 1
a4 1
COMMENT=		"mirroring/synchronisation over low bandwidth links"
@


1.7
log
@remove SEPARATE_BUILD for once and for good, I'm fed up with
all the trouble it can cause - ports which need it (e.g. the
GCC SC doesnt "support" building gcc with srcdir=objdir) can
set stuff like WRKBUILD themselves.
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.6 2005/09/23 11:06:15 tg Exp $
d5 1
a5 2
DISTNAME=		rsync-2.6.6
PKGNAME=		${DISTNAME}-1
d19 2
a20 4
MASTER_SITES=		ftp://ftp.samba.org/pub/rsync/ \
			ftp://ftp.samba.org/pub/rsync/old-versions/ \
			http://ftp.samba.org/ftp/rsync/ \
			ftp://ftp.funet.fi/pub/mirrors/rsync.samba.org/pub/rsync/
d28 2
a29 1
# copy this to /var/anoncvs/anoncvs/usr/bin/rsync, chmod 111
d37 1
a37 1
	${INSTALL_DATA} ${WRKSRC}/tech_report.tex ${DOCDIR}
@


1.6
log
@propagate this change (ftruncate detection) to all autoconf ports,
the same manner as poll(2) is disabled on Interix already
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.5 2005/09/23 11:04:36 tg Exp $
a24 1
SEPARATE_BUILD=		simple
@


1.5
log
@circumvent broken ftruncate() detection on MirOS, OpenBSD
bump patchlevel since this adds inplace support
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.4 2005/09/21 19:36:16 tg Exp $
a30 7
.include <mirports.sys.mk>
.if ${OStype:M*BSD}
# mis-detected on MirBSD, OpenBSD due to proto in <sys/types.h>
# probably an autoconf shortcoming though
CONFIGURE_ENV+=		ac_cv_func_ftruncate=yes
.endif

@


1.4
log
@* use ssh "bulk" mode ToS - from naddy (Christian Weisgerber)
* update to 2.6.6
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.3 2005/08/21 11:49:50 tg Exp $
d6 1
d31 7
@


1.3
log
@_DOMAIN_DU_JOUR dies
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.2 2005/05/04 13:21:11 tg Exp $
d5 1
a5 1
DISTNAME=		rsync-2.6.4
d27 1
d29 1
@


1.2
log
@update
@
text
@d1 1
a1 1
# $MirOS: ports/net/rsync/Makefile,v 1.1.7.1 2005/03/18 15:49:02 tg Exp $
d8 1
a8 1
RESPONSIBLE=		Thorsten Glaser <tg@@${_DOMAIN_DU_JOUR}>
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $MirOS$
d4 5
a8 5
COMMENT=	"mirroring/synchronization over low bandwidth links"
DISTNAME=	rsync-2.6.3
CATEGORIES=	net
HOMEPAGE=	http://rsync.samba.org/
RESPONSIBLE=	Thorsten Glaser <tg@@${_DOMAIN_DU_JOUR}>
d10 1
a10 1
FLAVORS=	static
d19 4
a22 4
MASTER_SITES=	ftp://ftp.samba.org/pub/rsync/ \
		ftp://ftp.samba.org/pub/rsync/old-versions/ \
		http://ftp.samba.org/ftp/rsync/ \
		ftp://ftp.funet.fi/pub/mirrors/rsync.samba.org/pub/rsync/
a37 1
	${INSTALL_DATA} ${WRKSRC}/rsyncstats ${DOCDIR}
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
