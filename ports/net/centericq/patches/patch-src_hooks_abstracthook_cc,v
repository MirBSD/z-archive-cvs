head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2008.08.17.01.54.18;	author tg;	state Exp;
branches;
next	1.2;
commitid	10048A784A21ECFCCA3;

1.2
date	2007.12.23.23.27.28;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	100476EEEF700009199;

1.1
date	2006.10.29.02.45.12;	author tg;	state Exp;
branches;
next	;
commitid	100454415B230C2200D;


desc
@@


1.3
log
@• make gnupg flavour default
• regen distinfo
• use mirbsd master site for unfetchable distfile
• apply yahoo login fix from CenterIM, thanks
• use new mirbsd libc function for IRC charset auto-conversion, yay!
  (works better than the Perl one in MirSirc, even)
• modernise port
@
text
@$MirOS: ports/net/centericq/patches/patch-src_hooks_abstracthook_cc,v 1.2 2007/12/23 23:27:28 bsiegert Exp $
--- src/hooks/abstracthook.cc.orig	Sun Aug 17 00:39:03 2008
+++ src/hooks/abstracthook.cc	Sun Aug 17 00:52:22 2008
@@@@ -42,11 +42,24 @@@@
 
 #define NOTIFBUF 512
 
+extern "C" char *sautoconv_c(const char *);
+
+static string sautoconv(const string &atext) {
+	const char *ccp;
+	string r;
+
+	ccp = sautoconv_c(atext.c_str());
+	r = ccp;
+	return r;
+}
+
 time_t timer_current = time(0);
 
 abstracthook::abstracthook(protocolname aproto)
     : proto(aproto), searchdest(0)
-{ }
+{
+	protocharset = NULL;
+}
 
 void abstracthook::init() {
 }
@@@@ -233,6 +246,19 @@@@ string abstracthook::ruscrlfconv(const s
 
 string abstracthook::rusconv(const string &tdir, const string &text) {
     string r;
+
+    if (conf.getisunicode()) {
+#ifdef HAVE_ICONV
+	if (protocharset != NULL) {
+		if (tdir == "kw" || tdir == "ku")
+			return siconv(text, "utf-8", protocharset);
+		if (tdir == "wk" || tdir == "uk")
+			return siconv(text, protocharset, "utf-8");
+		return text;
+	}
+#endif
+	return sautoconv(text);
+    }
 
     if(!conf.getcpconvert(proto) && tdir.find("u") == -1)
 	return text;
@


1.2
log
@SECURITY: Add several patches for centericq, bump patchlevel. From Debian.

Relevant changelog entries:

  * Backport upstream patch to fix buffer overflows, which can allow
    remote attackers to execute arbitrary code
    Fixes: CVE-2007-3713
  * Applied patch by Julien Lemoine to fix buffer overflow
    [kkstrtext-0.1/kkstrtext.h,
    debian/patches/security_CVE-2005-3863.dpatch]
  * Corrected creation of temporary file in the hook handling
    [src/hooks/gaduhooks.cc, CAN-2005-1914,
    debian/patches/security_CAN-2005-1914.dpatch]
@
text
@d1 19
a19 4
$MirOS: ports/net/centericq/patches/patch-src_hooks_abstracthook_cc,v 1.1 2006/10/29 02:45:12 tg Exp $
--- src/hooks/abstracthook.cc.orig	Sun Dec 23 21:49:27 2007
+++ src/hooks/abstracthook.cc	Sun Dec 23 21:49:33 2007
@@@@ -46,7 +46,9 @@@@ time_t timer_current = time(0);
d30 1
a30 1
@@@@ -233,6 +235,18 @@@@ string abstracthook::ruscrlfconv(const s
d42 1
d45 1
a45 1
+	return text;
@


1.1
log
@improve the unicode handling (esp. with libncursesw) and
add a few debian patches; also patch an utf-8 kludge in.
@
text
@d1 4
a4 4
$MirOS$
--- src/hooks/abstracthook.cc.orig	Tue Nov  9 23:49:37 2004
+++ src/hooks/abstracthook.cc	Sun Oct 29 02:44:06 2006
@@@@ -44,7 +44,9 @@@@ time_t timer_current = time(0);
d15 1
a15 1
@@@@ -231,6 +233,18 @@@@ string abstracthook::ruscrlfconv(const s
@

