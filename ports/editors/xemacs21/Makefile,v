head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2008.03.09.17.22.39;	author tg;	state Exp;
branches;
next	1.7;
commitid	10047D41CAA7E715397;

1.7
date	2006.12.20.15.31.23;	author tg;	state Exp;
branches;
next	1.6;
commitid	100458956E02A39AB3C;

1.6
date	2006.09.14.00.09.06;	author tg;	state Exp;
branches;
next	1.5;
commitid	10045089C0E234154C3;

1.5
date	2006.02.09.11.11.31;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043EB23217A35557B;

1.4
date	2006.02.09.09.35.51;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043EB0C94610EDE76;

1.3
date	2006.02.01.15.42.14;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043E0D60F1A22E1E1;

1.2
date	2005.07.06.19.21.30;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	609742cc2f044f70;

1.1
date	2005.03.18.15.45.50;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.45.50;	author tg;	state Exp;
branches;
next	;


desc
@@


1.8
log
@bulk convert FLAVOR to FLAVOUR; nuke unused file; convert to $Mdocdate
@
text
@# $MirOS: ports/editors/xemacs21/Makefile,v 1.7 2006/12/20 15:31:23 tg Exp $
# $OpenBSD: Makefile,v 1.20 2003/07/06 18:34:48 naddy Exp $

COMMENT=		heavily customizable and extensible editor

VERSION=		21.4.12
DASH_VER=		1
DISTNAME=		xemacs-${VERSION}
CATEGORIES=     	editors

HOMEPAGE=		http://www.xemacs.org/

# GPL
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

# where the source files and patches can be fetched
MASTER_SITES= 	ftp://ftp.xemacs.org/pub/xemacs/xemacs-21.4/ \
		ftp://ftp.oleane.net/pub/xemacs/xemacs-21.4/ \
		ftp://ftp.pasteur.fr/pub/computing/xemacs/xemacs-21.4/ \
		ftp://ftp.mpi-sb.mpg.de/pub/gnu/mirror/ftp.xemacs.org/xemacs/xemacs-21.4/ \
		ftp://ftp.usyd.edu.au/pub/Xemacs/xemacs-21.4/ \
		ftp://ftp.lab.kdd.co.jp/xemacs/xemacs-21.4/ \
		ftp://ftp.th-darmstadt.de/pub/editors/xemacs/xemacs-21.4/ \
      		ftp://ftp.funet.fi/pub/mirrors/ftp.xemacs.org/pub/tux/xemacs/xemacs-21.4/

# Dependencies are very flavours-specific, you have
# to select a flavour set to know them

# build/configuration variables

# this one is not "toggle-able" in the configure script
MODULES=	devel/gettext

#USE_GMAKE=		Yes

# 'configure.in' modified to generate a 'configure'
# that knows about curses really being ncurses

CONFIGURE_STYLE=	old gnu autoconf dest
CONFIGURE_ARGS+=	--infodir='$${DESTDIR}${PREFIX}/info/${DISTNAME}' \
			--infopath='${LOCALBASE}/info/${DISTNAME}:${LOCALBASE}/info:usr/share/info' \
			--site-prefixes='${LOCALBASE}:/usr' \
			--without-ldap \
			--without-postgresql \
			--without-cde \
			--without-offix \
			--without-dragndrop \
			--without-gpm \
			--with-msw=no \
			--without-tooltalk \
			--with-sound=no \
			--with-xface=no \
			--without-wnn6 \
			--without-gtk \
			--without-gnome \
			--with-database=berkdb \
			--with-file-coding=yes \
			--with-system-malloc \
			--pdump

# there is not (yet) bsd sound support in XEmacs
# XEmacs does not work with OpenLDAP (linking problem, 
# will try to fix if somebody asks)

FAKE_FLAGS=	prefix='$${WRKINST}$${DESTDIR}${PREFIX}' \
		infodir='$${WRKINST}$${DESTDIR}${PREFIX}/info/${DISTNAME}'

####

# Arch string for configure
GCCARCH=        ${OStriplet}

CONFIGURE_ARGS+=	${GCCARCH}
SUBST_VARS=	GCCARCH

#### Flavours

# generic flavours
FLAVOURS=	mule canna wnn

# X11 Related
FLAVOURS+=	no_x11

FLAVOUR?=

#
# X11-related
#

.if ${FLAVOUR:L:Mno_x11}

CONFIGURE_ARGS+=--without-x11

.else

### X11-dependent flavours
USE_X11=	Yes

CONFIGURE_ARGS+=	--with-menubars=lucid

CONFIGURE_ARGS+=--with-scrollbars=lucid \
		--with-dialogs=athena \
		--with-widgets=athena

LIB_DEPENDS+=	jpeg.62::graphics/jpeg
CONFIGURE_ARGS+=--with-jpeg
MODULES+=		graphics/png
CONFIGURE_ARGS+=--with-png \
		--site-includes="${LOCALBASE}/include/libpng"

LIB_DEPENDS+=	tiff.35::graphics/tiff
CONFIGURE_ARGS+=--with-tiff

. if ${FLAVOUR:L:Mmule}
CONFIGURE_ARGS+=	--with-xim=xlib
# prevents XEmacs from using motif's XIM which coredumps a lot
. endif

### end of X11 dependant flavours
.endif

#
# MULE (MUlti Lingual Emacs) RELATED 
# I18N
#

.if ${FLAVOUR:L:Mmule}
CONFIGURE_ARGS+=--with-mule

. if ${FLAVOUR:L:Mcanna}
LIB_DEPENDS+=	canna16::japanese/canna
CONFIGURE_ARGS+=--with-canna
. else
CONFIGURE_ARGS+=--with-canna=no
. endif

. if ${FLAVOUR:L:Mwnn}
BUILD_DEPENDS+= ::japanese/Wnn
CONFIGURE_ARGS+=--with-wnn
. else
CONFIGURE_ARGS+=--with-wnn=no
. endif

.else

. if ${FLAVOUR:L:Mcanna} || ${FLAVOUR:L:Mwnn}
ERRORS+= "Fatal: You cannot use MULE-dependant flavours without MULE support"
. endif

CONFIGURE_ARGS+=--with-mule=no \
		--with-canna=no \
		--with-wnn=no
.endif

#######
STRIP_EXECS=    cvtmail digest-doc fakemail gnuserv hexl make-docfile \
		mmencode movemail profile sorted-doc wakeup yow
STRIP_PROGS=	${DISTNAME} gnuclient xemacs-b2m xemacs-ctags \
		xemacs-etags ootags

post-install:
# Stripping
.for file in ${STRIP_PROGS}
	@@strip ${PREFIX}/bin/${file}
.endfor
.for file in ${STRIP_EXECS}
	@@strip ${PREFIX}/lib/${DISTNAME}/${GCCARCH}/${file}
.endfor
.if !defined(LOCKDIR)
	@@rm -rf ${PREFIX}/lib/xemacs
.endif

.include <bsd.port.mk>
@


1.7
log
@sync DASH_VER usage:
* the dash doesn't belong into the DASH_VER variable,
  it's only a decimal integer value
* DASH_VER already defaults to 0 (admittedly new)
* PKGNAME already defaults to ${DISTNAME}-${DASH_VER}
@
text
@d1 1
a1 1
# $MirOS: ports/editors/xemacs21/Makefile,v 1.6 2006/09/14 00:09:06 tg Exp $
d29 2
a30 2
# Dependencies are very flavors-specific, you have
# to select a flavor set to know them
d79 1
a79 1
#### Flavors
d81 2
a82 2
# generic flavors
FLAVORS=	mule canna wnn
d85 1
a85 1
FLAVORS+=	no_x11
d87 1
a87 1
FLAVOR?=
d93 1
a93 1
.if ${FLAVOR:L:Mno_x11}
d99 1
a99 1
### X11-dependent flavors
d117 1
a117 1
. if ${FLAVOR:L:Mmule}
d122 1
a122 1
### end of X11 dependant flavors
d130 1
a130 1
.if ${FLAVOR:L:Mmule}
d133 1
a133 1
. if ${FLAVOR:L:Mcanna}
d140 1
a140 1
. if ${FLAVOR:L:Mwnn}
d149 2
a150 2
. if ${FLAVOR:L:Mcanna} || ${FLAVOR:L:Mwnn}
ERRORS+= "Fatal: You cannot use MULE-dependant flavors without MULE support"
@


1.6
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ­ edited by script with manual postprocessing
@
text
@d1 1
a1 1
# $MirOS: ports/editors/xemacs21/Makefile,v 1.5 2006/02/09 11:11:31 tg Exp $
d4 1
a4 1
COMMENT=			heavily customizable and extensible editor
d7 1
a7 1
DASH_VER=		-1
a8 1
PKGNAME=		xemacs-${VERSION}${DASH_VER}
@


1.5
log
@Fix a few abuses:
| CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include/libpng \
|			    -I${LOCALBASE}/include -I${X11BASE}/include" \
| 			LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib" \
|			PKGCONFIG_PATH=...

* use Benny's pkgconfig module
  - fixes PKGCONFIG_PATH in all places
  - adds explicit dependencies on pkgconfig where needed
* use a new png module
  - also cought a few implicit dependencies
* use a new freetype1 module in two places (more to come?)
* CPPFLAGS, LDFLAGS are in CONFIGURE_ENV anyway, so correctly
  add to them as CPPFLAGS+=<tab>foo instead
* use EXTRA_{M,X,F}AKE_FLAGS
* CC is given anyway, too
* add MAKEINFO= to gnu style

Still doesn't catch all OpenBSD abuses, but most of them.

Brokenness analysis:
* Automatically done
  - CFLAGS+=CPPFLAGS
  - CXXFLAGS+=CPPFLAGS
  - CPPFLAGS+=-I${LOCALBASE}/include
  - LDFLAGS+=-L${LOCALBASE}/lib
  - CONFIGURE_ENV, MAKE_FLAGS+=
    + LDFLAGS=LDFLAGS
    + CPPFLAGS you get the idea
    + CFLAGS
    + CXXFLAGS
    + CC
    + CXX (if USE_CXX)
* Done if USE_X11=Yes
  - CPPFLAGS+=X11BASE/include
  - LDFLAGS+=X11BASE/lib

Tell me if there are problems, but first try adding
an EXTRA_ before MAKE_FLAGS and FAKE_FLAGS.
Remember EXTRA_XAKE_FLAGS get added to both.
@
text
@d1 1
a1 1
# $MirOS: ports/editors/xemacs21/Makefile,v 1.4 2006/02/09 09:35:51 tg Exp $
d4 1
a4 1
COMMENT=		"heavily customizable and extensible editor"
@


1.4
log
@remove SEPARATE_BUILD for once and for good, I'm fed up with
all the trouble it can cause - ports which need it (e.g. the
GCC SC doesnt "support" building gcc with srcdir=objdir) can
set stuff like WRKBUILD themselves.
@
text
@d1 1
a1 1
# $MirOS: ports/editors/xemacs21/Makefile,v 1.3 2006/02/01 15:42:14 tg Exp $
d111 1
a111 1
LIB_DEPENDS+=	png.2.::graphics/png
@


1.3
log
@change the way OS version detection and variable assignment works,
and fix or break all ports which use some of the variables.

Do not use:
* OPSYS, OSMAJOR, OSMINOR: used in OpenBSD (maybe more)
* OSREV, OSrev: changed meaning relative to OpenBSD
* OSrev, OSrel, OSrelm, OSrelx, OSrpl: used in MirBSD (7 and 8)

Do use (preferred first):
* OStype (MirBSD, OpenBSD, Darwin, Interix, ...)
* OSver (always <number>.<number> in decimal)
  - on OpenBSD: 3.8
  - on MirBSD: major.patchlevel
  - on Darwin: 8.4 (without .0)
  - on Interix: 3.5
* OStriplet (i386-ecce-mirbsd8, zaurus-unknown-openbsd3.9,
  powerpc-apple-darwin8.2.0, ...)
* OSREV (the output of "uname -r")
  - on OpenBSD: 3.8
  - on MirBSD: 8
  - on Darwin: 8.4.0
@
text
@d1 1
a1 1
# $MirOS: ports/editors/xemacs21/Makefile,v 1.2 2005/07/06 19:21:30 bsiegert Exp $
a37 13
# XEmacs symlinks a lot of files in its source tree
# preventing safe SEPARATE_BUILD
# (In facts, files modified in the source tree
# are not platform-specific (elisp bytecode) but
# you cannot build the package on different systems
# sharing the same ports tree w/o risking race
# problems (yes, building over nfs is stupid but...)) 
# (there are flavors (mule) issues too)
# Lots of configure.in changes are needed to restore
# a more logical behaviour (eech)
# Therefore, this is commented out for now:
# SEPARATE_BUILD=		simple

@


1.2
log
@Move some packages (those that use DASH_VER) to new patchlevels.
@
text
@d1 1
a1 1
# $MirOS$
d88 1
a88 3
# copied from emacs and xemacs20 ports

GCCARCH=        ${MACHINE_ARCH}-unknown-openbsd${OSREV}
@


1.1
log
@Initial revision
@
text
@d7 1
a7 1
DASH_VER=		p0
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
