head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2009.08.16.17.18.35;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004A883C9B4C196B76;

1.7
date	2009.08.16.16.28.02;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004A882F1F72B43308;

1.6
date	2008.11.18.21.11.40;	author tg;	state Exp;
branches;
next	1.5;
commitid	10049232FA17490A1ED;

1.5
date	2008.10.04.19.03.34;	author tg;	state Exp;
branches;
next	1.4;
commitid	10048E7BD9A0842B398;

1.4
date	2007.04.13.19.40.49;	author bsiegert;	state Exp;
branches;
next	1.3;
commitid	100461FDCD711A9CD47;

1.3
date	2006.09.14.00.12.34;	author tg;	state Exp;
branches;
next	1.2;
commitid	10045089C0E234154C3;

1.2
date	2006.08.26.23.34.40;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044F0D836486F5483;

1.1
date	2006.03.31.03.50.14;	author tg;	state Exp;
branches;
next	;
commitid	100442CA6C3392E0ECB;


desc
@@


1.8
log
@change all V to VSN (ok bsiegert@@) and some DASH_VER while here
@
text
@# $MirOS: ports/plan9/kencc/Makefile,v 1.7 2009/08/16 16:28:02 tg Exp $

# sort of hard to add more...
ONLY_FOR_PLATFORM=	Darwin:*:powerpc MirBSD:*:i386 OpenBSD:*:i386

COMMENT=		Plan 9 compiler suite
CATEGORIES=		devel lang plan9
VSN=			20060303
DASH_VER=		1
DISTNAME=		kencc-${VSN}
DIST_SUBDIR=		inferno-${VSN}
DISTFILES=		FreeBSD.tgz MacOSX.tgz inferno.tgz utils.tgz
HOMEPAGE=		http://www.advogato.org/proj/Kencc/
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.de>
MASTER_SITES=		http://www.vitanuova.com/dist/4e/${VSN}/

# GPL, LGPL, Lucent 1.02, "Vita Nuova" (MIT-style)
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
# Vita Nuova (${PREFIX}/share/doc/kencc/NOTICE)
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes

BUILD_DEPENDS+=		::plan9/9e
WRKDIST=		${WRKDIR}/install/utils

.if ${MACHINE_OS} == "Darwin"
FBSDORMAC=		MacOSX
PROCESSOR=		power
BROKEN=			need a CPP_DEFINES line for ${MACHINE_OS}
.else
FBSDORMAC=		FreeBSD
PROCESSOR=		386
CPP_DEFINES=		__unix__ __KENCC__ __OpenBSD__ i386 __i386__
.  if ${OStype} == "MirBSD"
CPP_DEFINES+=		__MirBSD__
.  endif
.endif

PORTPATH=		${WRKSRC}/${FBSDORMAC}/${PROCESSOR}/bin:${WRKDIR}/bin:${_PORTPATH}
MK_VARS=		WRKSRC=${WRKSRC:Q} \
			MP_CC=${_PASS_CC:T:Q} MP_CFLAGS=${CFLAGS:Q} \
			FBSDORMAC=${FBSDORMAC:Q} \
			objtype=${PROCESSOR:Q}

ALL_TARGETS=	utils/libregexp libbio lib9 utils
.ifdef NUKE
NUKE_TARGETS=	libbio lib9 utils
.else
NUKE_TARGETS=	utils/libregexp libbio lib9 utils/mk
.endif

BINS=		0a 0c 0l 1a 1c 1l 2a 2c 2l 5a 5c 5coff 5cv 5l 8a 8c 8l \
		data2c data2s iar ka kc kl mk mkext qa qc ql tc va vc vl
MANSRC=		${WRKDIR}/install/inferno/man
MANS10=		2a 2c 2l 5coff 5cv iar mk
MLINKS=		2a 0a 2a 1a 2a 5a 2a 8a 2a ka 2a qa 2a va \
		2c 0c 2c 1c 2c 5c 2c 8c 2c kc 2c qc 2c vc \
		2l 0l 2l 1l 2l 5l 2l 8l 2l kl 2l ql 2l vl

do-extract:
.for _f in ${DISTFILES}
	# NB: this is supposed to fail
	-cd ${WRKDIR} && ${GZCAT} ${FULLDISTDIR}/${_f} | tar xf -
	cd ${WRKDIR}/install/${_f:R} && ${GZCAT} 1141383122.gz | 9e
.endfor
	cd ${WRKDIR}/install/utils && \
	    cp -r ../FreeBSD/FreeBSD . && cp -r ../MacOSX/MacOSX .
	cd ${WRKDIR}/install/utils/include && \
	    lndir ${WRKDIR}/install/inferno/include
	cp ${WRKDIR}/install/inferno/mkconfig ${WRKDIR}/install/utils/
	cd ${WRKDIR}/install/utils && cp -r ../inferno/mkfiles .

do-configure:
	cd ${WRKSRC} && ${SETENV} HOSTCC=${_PASS_CC:T:Q}\ ${CFLAGS:Q} \
	    FBSDORMAC=${FBSDORMAC:Q} PROCESSOR=${PROCESSOR:Q} \
	    WRKSRC=${WRKSRC:Q} ${SCRIPTS_ENV} ${SH} ./makemk.sh
	print '%g/@@PREFIX@@/s!!${PREFIX}!g\nwq' | \
	    ed -s ${WRKSRC}/utils/cc/mkfile

do-build:
.for _i in ${NUKE_TARGETS}
	cd ${WRKSRC}/${_i} && ${SETENV} ${MAKE_ENV} ${MK_VARS} mk nuke
.endfor
.for _i in ${ALL_TARGETS}
	cd ${WRKSRC}/${_i} && ${SETENV} ${MAKE_ENV} ${MK_VARS} mk
.endfor
	mkdir -p ${WRKSRC}/cat1
	${NROFF} -man ${MANSRC}/8/mkfs >${WRKSRC}/cat1/mkext.0
.for _i in ${MANS10}
	${NROFF} -man ${MANSRC}/10/${_i} >${WRKSRC}/cat1/${_i}.0
.endfor
	print '#!${MKSH}' >${WRKSRC}/9cpp
	print 'exec /usr/libexec/cpp \\' >>${WRKSRC}/9cpp
.for _i in ${CPP_DEFINES}
	print '\t-D${_i} \\' >>${WRKSRC}/9cpp
.endfor
	print '\t"$$@@"' >>${WRKSRC}/9cpp

do-install:
	cd ${WRKSRC}/utils && ${SETENV} ${MAKE_ENV} ${MK_VARS} mk install
.for _i in ${BINS}
	${INSTALL_PROGRAM} ${WRKSRC}/${FBSDORMAC}/${PROCESSOR}/bin/${_i} \
	    ${PREFIX}/bin/
.endfor
.for _i in mkext ${MANS10}
	${INSTALL_MAN} ${WRKSRC}/cat1/${_i}.0 ${PREFIX}/man/cat1/
.endfor
.for _i _j in ${MLINKS}
	cd ${PREFIX}/man/cat1 && ln -s ${_i}.0 ${_j}.0
.endfor
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/kencc
	${INSTALL_DATA} ${WRKSRC}/utils/NOTICE ${PREFIX}/share/doc/kencc/
	${INSTALL_SCRIPT} ${WRKSRC}/9cpp ${PREFIX}/bin/

.include <bsd.port.mk>
@


1.7
log
@change
â€¢ _PASS_CC back from ã€Œmpccã€ to ã€Œ${WRKDIR}/bin/mpccã€ (note that the
  former ã€Œ${WRKDIR:Q}/bin/mpccã€ was wrong)
â€¢ all uses of _PASS_CC to either
  â€£ ${_PASS_CC:T:Q} (when passing, e.g. for libtool â€“ this is for use
    when ${WRKDIR}/bin is in $$PATH)
  â€£ ${_PASS_CC:Q} (when invoking, e.g. in post-build targets â€“ only
    these I saw when mechanically doing this; Benny wants to fix the
    remaining ones; I shouldâ€™ve introduced no more breakage than was)
â€¢ _PASS_CXX/mpcxx just the same

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.6 2008/11/18 21:11:40 tg Exp $
d8 1
a8 1
V=			20060303
d10 2
a11 2
DISTNAME=		kencc-${V}
DIST_SUBDIR=		inferno-${V}
d15 1
a15 1
MASTER_SITES=		http://www.vitanuova.com/dist/4e/${V}/
@


1.6
log
@cpp
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.5 2008/10/04 19:03:34 tg Exp $
d42 1
a42 1
			MP_CC=${_PASS_CC:Q} MP_CFLAGS=${CFLAGS:Q} \
d75 1
a75 1
	cd ${WRKSRC} && ${SETENV} HOSTCC=${_PASS_CC:Q}\ ${CFLAGS:Q} \
@


1.5
log
@mass conversion from
â€¢ ${CC}
â€¢ "${CC}"
â€¢ '${CC}'
â€¢ ${CC:Q}
to ${_PASS_CC:Q} (or without :Q if itâ€™s executed, not assigned), and
same for CXXâ€¦ most of these are VERY UGLY, prone to break with ccache
and maybe even withoutâ€¦
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.4 2007/04/13 19:40:49 bsiegert Exp $
d6 1
a6 1
COMMENT=			Plan 9 compiler suite
d9 1
d94 1
a94 1
	print 'exec /usr/bin/cpp -undef \\' >>${WRKSRC}/9cpp
@


1.4
log
@change .error to BROKEN for Darwin
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.3 2006/09/14 00:12:34 tg Exp $
d41 1
a41 1
			MP_CC=${CC:Q} MP_CFLAGS=${CFLAGS:Q} \
d74 1
a74 1
	cd ${WRKSRC} && ${SETENV} HOSTCC=${CC:Q}\ ${CFLAGS:Q} \
@


1.3
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ­ edited by script with manual postprocessing
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.2 2006/08/26 23:34:40 tg Exp $
d29 1
a29 1
.error CPP_DEFINES=		
@


1.2
log
@OStype vs MACHINE_OS confusion, try to clean up the mess:

We use MACHINE_OS to distinguish between different OSes, i.e.
 BSD Darwin Interix Linux

Within these, there are OStype per MACHINE_OS, e.g.
 BSD -> MirBSD OpenBSD
 Darwin -> Darwin
 Interix -> Interix MirInterix
 Linux -> Debian

These are only the OStype""s seen until now,
so please use what semantically fits, e.g. on
Interix and MirInterix, you don't have IPv6,
but on MirInterix you won't need an explicit
texinfo dependency since it's in the base system.
Be aware that OStype can be user defined though!
@
text
@d1 1
a1 1
# $MirOS: ports/plan9/kencc/Makefile,v 1.1 2006/03/31 03:50:14 tg Exp $
d6 1
a6 1
COMMENT=		"Plan 9 compiler suite"
@


1.1
log
@add a port of the Plan 9 compiler, under MIT licence(yes!)
not quite useful though, e.g. there's no ELF support, and
I seem to be unable to run the COFF binaries (lest alone
the "garbage", Plan 9, MS-DOS .COM, MS-DOS .EXE ones ;)
nor do I have startup files or libraries... also, the .8
intermediate object format is unknown to libbfd, sadly.
@
text
@d1 1
a1 1
# $MirOS$
d26 1
a26 1
.if ${OStype} == "Darwin"
@

