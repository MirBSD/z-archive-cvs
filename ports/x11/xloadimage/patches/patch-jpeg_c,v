head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2006.10.01.03.31.48;	author tg;	state Exp;
branches;
next	1.1;
commitid	100451F35FF6DEB5A4E;

1.1
date	2005.09.11.23.45.32;	author tg;	state Exp;
branches;
next	;
commitid	6d0b4324c1a47297;


desc
@@


1.2
log
@* libjpeg: add support for "old jpeg" hunk from libtiff's contrib section
* libtiff: remove --with-jpeg-*-dir so that it does not add -L/usr/mpkg/lib
  to the command line -> doesn't link against an already installed libtiff
* libtiff: speed up build a lot (--disable-dependency-tracking and
  --disable-libtool-lock)
* libtiff: enable rpaths while here
  (sorry Benny)
* libtiff: remove no longer needed workaround
* libtiff: enable "old jpeg" support (pulls in jpegint.h temporarily tho)
* xloadimage: correct error condition abuse leading to false error message
* all: fix indenting in Makefile; sync DESCR, PLIST, distinfo; bump version
@
text
@$MirOS: ports/x11/xloadimage/patches/patch-jpeg_c,v 1.1 2005/09/11 23:45:32 tg Exp $
--- jpeg.c.orig	Sun Oct  1 03:07:18 2006
+++ jpeg.c	Sun Oct  1 03:12:15 2006
@@@@ -10,6 +10,8 @@@@
 #include "image.h"	/* xloadimage declarations */
 #ifdef HAVE_LIBJPEG
 #include "options.h"
+#define JPEG_INTERNAL_OPTIONS
+#include <err.h>
 #include <jpeglib.h>
 #include <jerror.h>
 #include <setjmp.h>	/* need setjmp/longjmp */
@@@@ -225,7 +227,7 @@@@ jpegLoad (fullname, name, verbose)
 	break;
     default:
 	image = NULL;
-	ERREXITS(&cinfo, 1, "Cannot cope with JPEG image colorspace");
+	errx(1, "Cannot cope with JPEG image colorspace");
     }
 
     row_stride = cinfo.output_width * cinfo.output_components;
@@@@ -321,8 +323,8 @@@@ static void parseOptions(j_compress_ptr 
       cinfo->arith_code = TRUE;
 #else
       fprintf(stderr, "jpegDump: sorry, arithmetic coding not supported\n");
-    }
 #endif
+    }
     else if (!strncmp("grayscale", name, strlen(name)) ||
 	     !strncmp("greyscale", name, strlen(name)) ||
 	     !strncmp("monochrome", name, strlen(name))) {
@@@@ -336,7 +338,7 @@@@ static void parseOptions(j_compress_ptr 
 #ifdef C_MULTISCAN_FILES_SUPPORTED
       if (verbose)
 	printf("  Creating a noninterleaved file.\n");
-      cinfo->interleave = FALSE;
+/*      cinfo->interleave = FALSE;*/
 #else
       fprintf(stderr, "jpegDump: sorry, multiple-scan support was not compiled\n");
 #endif
@


1.1
log
@fixes arith coding support if defined
@
text
@d1 4
a4 4
$MirOS$
--- jpeg.c.orig	Mon Nov  8 18:35:45 1993
+++ jpeg.c	Sun Sep 11 23:38:46 2005
@@@@ -10,6 +10,7 @@@@
d9 1
d13 10
a22 1
@@@@ -321,8 +322,8 @@@@ static void parseOptions(j_compress_ptr 
d32 1
a32 1
@@@@ -336,7 +337,7 @@@@ static void parseOptions(j_compress_ptr 
@

