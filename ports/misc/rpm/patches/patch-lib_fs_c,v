head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2008.07.11.14.02.43;	author tg;	state Exp;
branches;
next	1.1;
commitid	10048776813223D8644;

1.1
date	2005.03.18.15.50.35;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.50.35;	author tg;	state Exp;
branches;
next	;


desc
@@


1.2
log
@make this at least usable again, so we can update it later
‣ distfile copied to backup master site
‣ building mksh-35-1 SRPM using it…
@
text
@$MirOS$
$OpenBSD: patch-lib_fs_c,v 1.1 2002/04/07 00:31:55 espie Exp $
--- lib/fs.c.orig	Wed Jun 14 12:34:08 2000
+++ lib/fs.c	Fri Jul 11 12:40:27 2008
@@@@ -3,6 +3,73 @@@@
 #include <rpmlib.h>
 #include <rpmmacro.h>
 
+#ifdef __OpenBSD__
+#ifdef __aix__
+#define COMMENTCHAR '*'
+#else
+#define COMMENTCHAR '#'
+#endif
+
+#if HAVE_STRUCT_MNTTAB 
+static our_mntent * u_getmntent(FILE *filep) {
+    static struct mnttab entry;
+    static our_mntent item;
+
+    if (!fread(&entry, sizeof(entry), 1, filep)) return NULL;
+    item.our_mntdir = entry.mt_filsys;
+
+    return &item;
+}
+#else 
+static our_mntent *u_getmntent(FILE *filep) {
+    static our_mntent item = { NULL };
+    char buf[1024], * start;
+    char * chptr;
+
+    if (item.our_mntdir) {
+	free(item.our_mntdir);
+    }
+    
+    while (fgets(buf, sizeof(buf) - 1, filep)) {
+	/* chop off \n */
+	buf[strlen(buf) - 1] = '\0';
+
+	chptr = buf;
+	while (isspace(*chptr)) chptr++;
+
+	if (*chptr == COMMENTCHAR) continue;
+
+#	if __aix__
+	    /* aix uses a screwed up file format */
+	    if (*chptr == '/') {
+		start = chptr;
+		while (*chptr != ':') chptr++;
+		*chptr = '\0';
+		item.mnt_dir = strdup(start);
+		return &item;
+	    }
+#	else 
+	    while (!isspace(*chptr) && (*chptr)) chptr++;
+	    if (!*chptr) return NULL;
+
+	    while (isspace(*chptr) && (*chptr)) chptr++;
+	    if (!*chptr) return NULL;
+	    start = chptr;
+	
+	    while (!isspace(*chptr) && (*chptr)) chptr++;
+	    *chptr = '\0';
+
+	    item.our_mntdir = strdup(start);
+	    return &item;
+#	endif
+    }
+
+    return NULL;
+}
+#endif
+#define getmntent u_getmntent
+#endif
+
 struct fsinfo {
     /*@@only@@*/ const char * mntPoint;
     dev_t dev;
@


1.1
log
@Initial revision
@
text
@d1 1
d3 3
a5 3
--- lib/fs.c.orig	Sun Apr  7 02:16:12 2002
+++ lib/fs.c	Sun Apr  7 02:17:44 2002
@@@@ -3,6 +3,72 @@@@
d17 1
a17 1
+static our_mntent * getmntent(FILE *filep) {
d27 1
a27 1
+static our_mntent *getmntent(FILE *filep) {
d73 1
a78 6
@@@@ -301,3 +367,5 @@@@ int rpmGetFilesystemUsage(const char ** 
 
     return 0;
 }
+
+
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
