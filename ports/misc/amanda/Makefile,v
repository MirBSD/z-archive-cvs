head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2009.04.29.19.23.10;	author bsiegert;	state Exp;
branches;
next	1.5;
commitid	10049F8A7D83BBBD07F;

1.5
date	2008.05.07.22.48.31;	author tg;	state Exp;
branches;
next	1.4;
commitid	100482231C374D9CA0B;

1.4
date	2007.03.31.22.02.05;	author tg;	state Exp;
branches;
next	1.3;
commitid	100460EDA5B5AAA6E31;

1.3
date	2006.09.14.00.11.05;	author tg;	state Exp;
branches;
next	1.2;
commitid	10045089C0E234154C3;

1.2
date	2005.07.07.21.23.32;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	66bc42cd9a7ea714;

1.1
date	2005.03.18.15.50.21;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.50.21;	author tg;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to amanda-2.4.5.1-0. Port taken from OpenBSD, minimal modifications
for compatibility, use MirLibtool and autogen configure style. Build default
and db flavour in bulk.
@
text
@# $MirOS$
# $OpenBSD: Makefile,v 1.34 2007/09/15 23:54:16 merdely Exp $

COMMENT=	network-capable tape backup (client and tape server)
COMMENT-client=	network-capable tape backup (client only)
COMMENT-doc=	network-capable tape backup (documentation)

DISTVERSION=	2.4.5p1

PKGVERSION=   ${DISTVERSION:S/p/./}

DISTNAME=	amanda-${DISTVERSION}

PKGNAME=	amanda-${PKGVERSION}-${DASH_VER}
PKGNAME-client=	amanda-client-${PKGVERSION}-${DASH_VER}
PKGNAME-doc=	amanda-doc-${PKGVERSION}-${DASH_VER}

CATEGORIES=	misc

HOMEPAGE=	http://www.amanda.org/

# BSD
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=amanda/}

# AMANDA configure looks for gtar and smbclient so that it can hard-code
# the pathnames.
# Configure looks for gnuplot to see if it should build amplot.
BUILD_DEPENDS+= ::archivers/gtar \
		::math/gnuplot
#		:samba-*:net/samba

# There is no need to set RUN_DEPENDS, because AMANDA will run fine
# without gtar, smbclient, and gnuplot.  They will only be required
# if the user creates a configuration that needs them, and then
# AMANDA will gracefully tell them what is required.

MULTI_PACKAGES=	-client -doc

FLAVOURS=	db gpg
FLAVOUR?=

CONFIGURE_STYLE=		autogen
AUTOCONF_NEW=			Yes
AUTOMAKE_VERSION=		1.9

# Because AMANDA does not conform to shared library naming standards,
# and knowing that no software outside of AMANDA attempts to use the
# shared libraries, we disable the generation of shared libraries.
CONFIGURE_ARGS=	--disable-shared \
		--libexecdir=${PREFIX}/libexec/amanda \
		--localstatedir=/var \
		--with-configdir=${SYSCONFDIR}/amanda \
		--with-user=operator \
		--with-group=operator

# Use this flavor to speed things up if you have large AMANDA
# databases.
.if ${FLAVOUR:L:Mdb}
BUILD_DEPENDS+=  ::databases/db
CONFIGURE_ARGS+= --with-db=db
CFLAGS+=	 -L${LOCALBASE}/lib
.endif

.if ${FLAVOUR:L:Mgpg}
BUILD_DEPENDS+=  :gnupg-*:security/gnupg
CONFIGURE_ENV+=  GZIP=${LOCALBASE}/bin/gpgzip
.endif

OLD_DOC_DIR=	${PREFIX}/share/amanda
DOC_DIR=	${PREFIX}/share/doc/amanda
EXAMPLE_DIR=	${PREFIX}/share/examples/amanda

post-install:
	@@cd ${WRKSRC}; \
	  ${INSTALL_DATA_DIR} ${DOC_DIR}; \
	  ${INSTALL_DATA} AUTHORS ${DOC_DIR}; \
	  ${INSTALL_DATA} NEWS ${DOC_DIR}; \
	  ${INSTALL_DATA} README ${DOC_DIR}; \
	  ${INSTALL_DATA} ChangeLog ${DOC_DIR}; \
	  mv ${OLD_DOC_DIR}/* ${DOC_DIR}; \
	  rmdir ${OLD_DOC_DIR}; \
	  ${INSTALL_DATA_DIR} ${EXAMPLE_DIR}; \
	  ${INSTALL_DATA} example/*.ps ${EXAMPLE_DIR}; \
	  ${INSTALL_DATA} example/disklist ${EXAMPLE_DIR}; \
	  cd example; \
	    for f in *.conf *.conf.chg-scsi; do \
	      sed -e 's,usr/adm,var,' \
		  -e 's,/usr/local/etc,${SYSCONFDIR},' $$f \
	      > ${EXAMPLE_DIR}/$$f; \
	    done
	@@sed -e 's,@@LOCALBASE@@,${LOCALBASE},' \
	  ${FILESDIR}/crontab.sample > ${EXAMPLE_DIR}/crontab.sample
	@@${INSTALL_DATA} /dev/null ${EXAMPLE_DIR}/amandates
	@@sed -e 's,@@LOCALBASE@@,${LOCALBASE},' \
	     -e 's,@@SYSCONFDIR@@,${SYSCONFDIR},' \
	     ${FILESDIR}/gpgzip > ${PREFIX}/bin/gpgzip;

.include <bsd.port.mk>
@


1.5
log
@â€¢ replace MODGNU_CONFIG_GUESS_DIRS with MODGNU_RECURSE_DIRS
â€¢ always place ${WRKSRC} itself at the end of MODGNU_RECURSE_DIRS due to
  recursion issues inside of autoconf itself
â€¢ if MODGNU_RECURSE_DIRS=${WRKSRC} stood in the Makefile, nuke it (default)
â€¢ remove dead reference to MODGNU_TWIDDLE_DIRS
@
text
@d1 2
a2 1
# $OpenBSD: Makefile,v 1.23 2002/12/29 19:49:40 fgsch Exp $
d4 17
a20 7
COMMENT=		network-capable tape backup (client and tape server)
COMMENT-client=		network-capable tape backup (client only)
VERSION=		2.4.2p2
DISTNAME=		amanda-${VERSION}
PKGNAME-client=		amanda-client-${VERSION}-${DASH_VER}
CATEGORIES=		misc
HOMEPAGE=		http://www.amanda.org/
d28 1
a28 2
MASTER_SITES=	ftp://ftp.amanda.org/pub/amanda/ \
		${MASTER_SITE_SOURCEFORGE:=amanda/}
d30 1
a30 1
# Amanda configure looks for gtar and smbclient so that it can hard-code
d33 3
a35 3
BUILD_DEPENDS+= :gtar-*:archivers/gtar \
		:samba-*:net/samba2 \
		:gnuplot-*:math/gnuplot
d37 1
a37 1
# There is no need to set RUN_DEPENDS, because Amanda will run fine
d40 1
a40 1
# Amanda will gracefully tell them what is required.
d42 1
a42 1
MULTI_PACKAGES=	-client
d44 2
a45 8
# 2.4.2 exposed a bug in BSD make.
# Please see http://www.egroups.com/message/amanda-hackers/2333 (and
# following thread).
#
# (Summary:  yes; appears to be a problem with FreeBSD make; see
# http://www.FreeBSD.org/cgi/query-pr.cgi?pr=23328 for that part.  A
# circumvention is to hack the Makefiles; another is to use gmake.)
USE_GMAKE=	Yes
d47 3
a49 2
CONFIGURE_STYLE=gnu
MODGNU_RECURSE_DIRS=${WRKSRC}/config ${WRKSRC}
d51 2
a52 2
# Because Amanda does not conform to shared library naming standards,
# and knowing that no software outside of Amanda attempts to use the
a53 1
# Use mmap instead of shm to work around broken uvm post 2.7.
a57 1
		--with-mmap \
d61 13
d81 4
a84 3
          ${INSTALL_DATA} AUTHORS ${DOC_DIR}; \
          ${INSTALL_DATA} NEWS ${DOC_DIR}; \
          ${INSTALL_DATA} README ${DOC_DIR}; \
d96 6
a101 1
	@@${INSTALL_DATA} ${FILESDIR}/crontab.sample ${EXAMPLE_DIR}
@


1.4
log
@fix broken dependencies, <bsd.own.mk> inclusion; break other packages
@
text
@d44 1
a44 1
MODGNU_CONFIG_GUESS_DIRS= ${WRKSRC} ${WRKSRC}/config
@


1.3
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ­ edited by script with manual postprocessing
@
text
@d3 7
a9 18
COMMENT=			network-capable tape backup (client and tape server)
COMMENT-client=			network-capable tape backup (client only)

DISTVERSION=	2.4.2p2

# 2.4.2p2 is problematical as a package name, because we have been
# marking OpenBSD package revisions with a "pX" suffix.
PKGVERSION=	${DISTVERSION:S/p/./}

DISTNAME=	amanda-${DISTVERSION}

PKGNAME=	amanda-${PKGVERSION}-0
PKGNAME-client=	amanda-client-${PKGVERSION}-0

CATEGORIES=	misc

HOMEPAGE=	http://www.amanda.org/

d24 1
a24 1
		:samba-*:net/samba/stable \
@


1.2
log
@Semi-automatic update of the remaining ports to the new patchlevel format.

Please correct mistakes if you find them :).
@
text
@d3 2
a4 2
COMMENT=	"network-capable tape backup (client and tape server)"
COMMENT-client=	"network-capable tape backup (client only)"
@


1.1
log
@Initial revision
@
text
@d14 2
a15 2
PKGNAME=	amanda-${PKGVERSION}
PKGNAME-client=	amanda-client-${PKGVERSION}
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
