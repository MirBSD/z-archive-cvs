head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2011.09.03.16.39.35;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004E62583A515487C3;

1.5
date	2011.03.30.10.28.10;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004D9305BF07324C2C;

1.4
date	2010.12.12.16.37.41;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004D04FA4429C1C525;

1.3
date	2010.07.22.15.10.12;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004C485EB7168C4697;

1.2
date	2010.03.28.15.42.30;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	1004BAF78D2745DD440;

1.1
date	2010.03.23.20.44.18;	author bsiegert;	state Exp;
branches;
next	;
commitid	1004BA92757255E357E;


desc
@@


1.6
log
@sync X.509v3 certificate bundles
@
text
@# $MirOS: ports/security/nss/Makefile,v 1.5 2011/03/30 10:28:10 tg Exp $

COMMENT=		Network Security Services from the Mozilla project
VERSION=		3.12.4
MAJOR_VERSION=		3
DASH_VER=		6
V=			${VERSION:S/./_/g}
DISTNAME=		nss-${VERSION}
CATEGORIES=		security devel
HOMEPAGE=		http://www.mozilla.org/projects/security/pki/nss/

# MPL - Mozilla Public License
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=		http://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_${V}_RTM/src/

USE_CXX=		Yes
USE_GMAKE=		Yes

WRKDIST=		${WRKDIR}/${DISTNAME}/mozilla
WRKSRC=			${WRKDIST}/security/nss
CERTDIR=		${PORTSDIR}/essentials/ca-certificates

LIB_DEPENDS+=		nspr4,plc4,plds4::devel/nspr
LIB_DEPENDS+=		sqlite3::databases/sqlite

SO_VERSION=		10.0
SUBST_VARS+=		SO_VERSION
MAKE_ENV+=		SO_VERSION=${SO_VERSION}
MAKE_ENV+=		BUILD_OPT=1
MAKE_ENV+=		NS_USE_GCC=1
MAKE_ENV+=		NO_MDUPDATE=1
MAKE_ENV+=		NSS_USE_SYSTEM_SQLITE=1

ALL_TARGET=		build_coreconf build_dbm all
CPPFLAGS+=		-I${LOCALBASE}/include/nspr

PC_SED=			sed -e "s,@@prefix@@,$(TRUEPREFIX)," \
			-e "s,@@exec_prefix@@,$(TRUEPREFIX)/bin," \
			-e "s,@@libdir@@,$(TRUEPREFIX)/lib," \
			-e "s,@@includedir@@,$(TRUEPREFIX)/include," \
			-e "s,@@NSS_MAJOR_VERSION@@,$(MAJOR_VERSION),g" \
			-e "s,@@NSS_VERSION@@,$(VERSION),g"

post-extract:
	cd ${WRKSRC}/lib/ckfw/builtins/ && \
	    cp ${CERTDIR:Q}/certdata.{c,txt} . && \
	    touch certdata.txt && sleep 1 && touch certdata.c
	cd ${WRKDIST}/security/coreconf && \
	    cp FreeBSD.mk MidnightBSD.mk && \
	    ln -sf OpenBSD.mk MirBSD.mk

do-regress:
	cd ${WRKSRC}/tests && env ${MAKE_ENV} sh ./all.sh

post-install:
	cd ${WRKDIST}/dist/*.OBJ && pax -rw -L . ${PREFIX}
	cd ${WRKDIST}/dist/public && pax -rw -L . ${PREFIX}/include
	mkdir -p ${PREFIX}/lib/pkgconfig
	${PC_SED} ${FILESDIR}/nss.pc.in > ${PREFIX}/lib/pkgconfig/nss.pc
	${PC_SED} ${FILESDIR}/nss-config.in > ${PREFIX}/bin/nss-config
	chmod +x ${PREFIX}/bin/nss-config

.include <bsd.port.mk>
@


1.5
log
@refresh
@
text
@d1 1
a1 1
# $MirOS: ports/security/nss/Makefile,v 1.4 2010/12/12 16:37:41 tg Exp $
d6 1
a6 1
DASH_VER=		5
@


1.4
log
@use a central place for NSS ckbi; sync with MirBSD CA bundle
@
text
@d1 1
a1 1
# $MirOS: ports/security/nss/Makefile,v 1.3 2010/07/22 15:10:12 tg Exp $
d6 1
a6 1
DASH_VER=		4
@


1.3
log
@• update ca-certificates port with latest data
• update nsckbi in both nss (for package nss) and firesomething (for
  package nssckbi); if nss would create a subpackage nssckbi like
  firesomething does at the moment, and firesomething were to depend
  on nss and nssckbi instead of bringing their own¹, things would be
  MUCH better as it takes about 2 minutes per certdata.txt and 3-4
  minutes per certdata.c file to commit this

① maybe just build firesomething with its own nss and nssckbi but
  don’t include it in the binary package, rather use symlinks to
  the mirpackage for nss and nssckbi? or just depend on the extracted
  nss/nssckbi source tree (there’s at least one package that extracts
  jpeg and IIRC png during build in ports, so there’s precedent)

Benny, please consider cleaning up this situation.
@
text
@d1 1
a1 1
# $MirOS: ports/security/nss/Makefile,v 1.2 2010/03/28 15:42:30 bsiegert Exp $
d6 1
a6 1
DASH_VER=		2
d25 1
d50 1
a50 1
	    cp ${FILESDIR}/certdata.{c,txt} . && \
@


1.2
log
@If upstream does not deliver a nss-config and nss.pc, we can just provide
one ourselves. Taken from the LFS patches. Bump.
@
text
@d1 1
a1 1
# $MirOS: ports/security/nss/Makefile,v 1.1 2010/03/23 20:44:18 bsiegert Exp $
d6 1
a6 1
DASH_VER=		1
@


1.1
log
@Add a port for NSS, the Network Security Services, a buggy piece of crap
needed by Firesomething. certdata.{c,txt} and patches from there.
From DESCR:

Network Security Services (NSS) is a set of libraries provided by the
Mozilla project and designed to support cross-platform development of
security-enabled client and server applications. Applications built with
NSS can support SSL v2 and v3, TLS, PKCS #5, PKCS #7, PKCS #11, PKCS
#12, S/MIME, X.509 v3 certificates, and other security standards.
@
text
@d1 1
a1 1
# $MirOS: ports/devel/nspr/Makefile,v 1.6 2010/02/02 20:36:19 bsiegert Exp $
d5 2
d40 7
d61 4
@

