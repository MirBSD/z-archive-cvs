head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2008.04.01.15.47.03;	author tg;	state Exp;
branches;
next	1.1;
commitid	10047F259090D420D79;

1.1
date	2006.09.11.01.02.04;	author tg;	state Exp;
branches;
next	;
commitid	1004504B56803FF6E46;


desc
@@


1.2
log
@SECURITY update to 1.4.9:
• cf. http://www.heise.de/newsticker/GnuPG-1-4-9-und-2-0-9-beheben-Schwachstelle--/meldung/105821
• passes regression test
• no longer use libusb on mirbsd/sparc
• unify arch handling (move openbsd/m68k test into mpi config patch)
• add midnightbsd/i386 support (they require a pentium at least, according
  to nightlily, so they get the 586 asm code instead of our 386er)
• add midnightbsd/sparc64 support (same as other bsds: disable asm)
• quell macro redefinition warning in mpi code (MIN, MAX)

XXX maybe disable asm on mirbsd/sparc?
@
text
@$MirOS: ports/security/gnupg/patches/patch-util_secmem_c,v 1.1 2006/09/11 01:02:04 tg Exp $
--- util/secmem.c.orig	Tue Oct 23 07:55:08 2007
+++ util/secmem.c	Tue Apr  1 15:22:25 2008
@@@@ -36,6 +36,15 @@@@
 #include <sys/lock.h>
 #endif
 #endif
+#ifdef HAVE_SYS_PARAM_H
+#include <sys/param.h>
+#endif
+#ifdef HAVE_SYS_SYSCTL_H
+#include <sys/sysctl.h>
+#endif
+#ifdef HAVE_UVM_UVM_SWAP_ENCRYPT_H
+#include <uvm/uvm_swap_encrypt.h>
+#endif
 
 #include "types.h"
 #include "memory.h"
@@@@ -91,6 +100,19 @@@@ static int suspend_warning;
 static void
 print_warn(void)
 {
+#if defined(HAVE_SYS_PARAM_H) && defined(HAVE_SYS_SYSCTL_H) && \
+    defined(CTL_VM) && defined(VM_SWAPENCRYPT) && defined(SWPENC_ENABLE)
+  int mib[3], swapenc;
+  size_t len;
+
+  mib[0] = CTL_VM;
+  mib[1] = VM_SWAPENCRYPT;
+  mib[2] = SWPENC_ENABLE;
+  len = sizeof (swapenc);
+  if (sysctl(mib, 3, &swapenc, &len, NULL, 0) != -1)
+    if (swapenc != 0)
+      return;
+#endif
   if (!no_warning)
     {
       log_info(_("WARNING: using insecure memory!\n"));
@


1.1
log
@* fix time_t format string issues
* if vm.swapencrypt=1 don't issue secmem warning
  (why didn't the openbsd guys add a simple patch like this?)
* sync MESSAGE with reality
* fix regression test suite (1 fail in verify, but the test
  actually doesn't fail, no idea what's going wrong there,
  maybe a hidden bash dependency?)
* bump patchlevel
@
text
@d1 4
a4 4
$MirOS$
--- util/secmem.c.orig	Mon Jul 31 09:32:34 2006
+++ util/secmem.c	Mon Sep 11 00:41:33 2006
@@@@ -37,6 +37,15 @@@@
d20 1
a20 1
@@@@ -92,6 +101,19 @@@@ static int suspend_warning;
@

