head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2020.01.24.20.53.46;	author tg;	state Exp;
branches;
next	1.1;
commitid	1005E2B596657431789;

1.1
date	2007.02.18.19.36.16;	author tg;	state Exp;
branches;
next	;
commitid	10045D8AAC722575B84;


desc
@@


1.2
log
@use correct way of disabling SSLv2 in client, as to not disable TLSv1 tooâ€¦
@
text
@$MirOS: ports/security/stunnel/patches/patch-ssl_c,v 1.1 2007/02/18 19:36:16 tg Exp $
--- ssl.c.orig	Thu Apr  3 01:31:19 2003
+++ ssl.c	Fri Jan 24 20:49:15 2020
@@@@ -77,7 +77,8 @@@@ void context_init() { /* init SSL */
     SSLeay_add_ssl_algorithms();
     SSL_load_error_strings();
     if(options.option&OPT_CLIENT) {
-        ctx=SSL_CTX_new(SSLv3_client_method());
+        ctx=SSL_CTX_new(SSLv23_client_method());
+	SSL_CTX_set_options(ctx, SSL_OP_NO_SSLv2);
     } else { /* Server mode */
         ctx=SSL_CTX_new(SSLv23_server_method());
 #ifndef NO_RSA
@@@@ -465,25 +466,25 @@@@ static void info_callback(const SSL *s, 
 static void print_stats() { /* print statistics */
     log(LOG_DEBUG, "%4ld items in the session cache",
         SSL_CTX_sess_number(ctx));
-    log(LOG_DEBUG, "%4d client connects (SSL_connect())",
+    log(LOG_DEBUG, "%4ld client connects (SSL_connect())",
         SSL_CTX_sess_connect(ctx));
-    log(LOG_DEBUG, "%4d client connects that finished",
+    log(LOG_DEBUG, "%4ld client connects that finished",
         SSL_CTX_sess_connect_good(ctx));
 #if SSLEAY_VERSION_NUMBER >= 0x0922
-    log(LOG_DEBUG, "%4d client renegotiatations requested",
+    log(LOG_DEBUG, "%4ld client renegotiatations requested",
         SSL_CTX_sess_connect_renegotiate(ctx));
 #endif
-    log(LOG_DEBUG, "%4d server connects (SSL_accept())",
+    log(LOG_DEBUG, "%4ld server connects (SSL_accept())",
         SSL_CTX_sess_accept(ctx));
-    log(LOG_DEBUG, "%4d server connects that finished",
+    log(LOG_DEBUG, "%4ld server connects that finished",
         SSL_CTX_sess_accept_good(ctx));
 #if SSLEAY_VERSION_NUMBER >= 0x0922
-    log(LOG_DEBUG, "%4d server renegotiatiations requested",
+    log(LOG_DEBUG, "%4ld server renegotiatiations requested",
         SSL_CTX_sess_accept_renegotiate(ctx));
 #endif
-    log(LOG_DEBUG, "%4d session cache hits", SSL_CTX_sess_hits(ctx));
-    log(LOG_DEBUG, "%4d session cache misses", SSL_CTX_sess_misses(ctx));
-    log(LOG_DEBUG, "%4d session cache timeouts", SSL_CTX_sess_timeouts(ctx));
+    log(LOG_DEBUG, "%4ld session cache hits", SSL_CTX_sess_hits(ctx));
+    log(LOG_DEBUG, "%4ld session cache misses", SSL_CTX_sess_misses(ctx));
+    log(LOG_DEBUG, "%4ld session cache timeouts", SSL_CTX_sess_timeouts(ctx));
 }
 
 void sslerror(char *txt) { /* SSL Error handler */
@


1.1
log
@format string and gcc warning cleanup, fixes logging
@
text
@d1 1
a1 1
$MirOS$
d3 12
a14 2
+++ ssl.c	Sun Feb 18 19:24:26 2007
@@@@ -465,25 +465,25 @@@@ static void info_callback(const SSL *s, 
@

