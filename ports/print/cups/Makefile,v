head	1.19;
access;
symbols;
locks; strict;
comment	@# @;


1.19
date	2008.10.28.20.31.07;	author bsiegert;	state Exp;
branches;
next	1.18;
commitid	1004907762122C91584;

1.18
date	2007.12.21.23.37.08;	author bsiegert;	state Exp;
branches;
next	1.17;
commitid	100476C4E3C00012409;

1.17
date	2007.12.13.19.48.49;	author bsiegert;	state Exp;
branches;
next	1.16;
commitid	10047618CBB00010118;

1.16
date	2007.11.26.20.05.40;	author bsiegert;	state Exp;
branches;
next	1.15;
commitid	100474B272B00021692;

1.15
date	2007.05.19.12.50.37;	author bsiegert;	state Exp;
branches;
next	1.14;
commitid	100464EF2952AB1B3A4;

1.14
date	2007.03.15.19.22.39;	author bsiegert;	state Exp;
branches;
next	1.13;
commitid	10045F99D0E139F2F93;

1.13
date	2007.03.04.20.25.06;	author tg;	state Exp;
branches;
next	1.12;
commitid	10045EB2B39673284EF;

1.12
date	2006.12.20.15.31.38;	author tg;	state Exp;
branches;
next	1.11;
commitid	100458956E02A39AB3C;

1.11
date	2006.11.08.18.25.43;	author bsiegert;	state Exp;
branches;
next	1.10;
commitid	1004552211B3B4891CA;

1.10
date	2006.11.03.12.33.26;	author bsiegert;	state Exp;
branches;
next	1.9;
commitid	100454B36CD4141151D;

1.9
date	2006.09.14.00.12.38;	author tg;	state Exp;
branches;
next	1.8;
commitid	10045089C0E234154C3;

1.8
date	2006.07.26.19.56.00;	author bsiegert;	state Exp;
branches;
next	1.7;
commitid	10044C7C80A4BE054DF;

1.7
date	2006.07.25.21.49.50;	author tg;	state Exp;
branches;
next	1.6;
commitid	10044C692031B1CE2F9;

1.6
date	2006.07.07.16.31.02;	author bsiegert;	state Exp;
branches;
next	1.5;
commitid	10044AE8C1E714C6F53;

1.5
date	2006.06.21.19.25.32;	author bsiegert;	state Exp;
branches;
next	1.4;
commitid	10044999C7941035ADA;

1.4
date	2006.02.09.11.15.12;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043EB23217A35557B;

1.3
date	2005.12.16.01.07.12;	author bsiegert;	state Exp;
branches;
next	1.2;
commitid	10043A2129A671E20EC;

1.2
date	2005.07.06.19.21.35;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	609742cc2f044f70;

1.1
date	2005.03.18.15.51.00;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.51.00;	author tg;	state Exp;
branches;
next	;


desc
@@


1.19
log
@SECURITY: Update cups to 1.3.9-0. This release fixes several security
bugs.

As this updates cups from 1.2 to 1.3, read the release notes when updating,
please.
@
text
@# $MirOS: ports/print/cups/Makefile,v 1.18 2007/12/21 23:37:08 bsiegert Exp $

COMMENT=		Common Unix Printing System

VERSION=		1.3.9
DASH_VER=		0
DISTNAME=		cups-${VERSION}-source
PKGNAME=		${DISTNAME:S/-source//}-${DASH_VER}
CATEGORIES=		print sysutils

HOMEPAGE=		http://www.cups.org/

RESPONSIBLE=		Benny Siegert <bsiegert@@gmx.de>

# GPL
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES+=		ftp://ftp.easysw.com/pub/cups/${VERSION}/
MASTER_SITES+=		ftp://ftp2.easysw.com/pub/cups/${VERSION}/
MASTER_SITES+=		${MASTER_SITE_SOURCEFORGE:=cups/}
			
EXTRACT_SUFX=		.tar.bz2

LIB_DEPENDS+=		jpeg::graphics/jpeg
LIB_DEPENDS+=		tiff::graphics/tiff
LIB_DEPENDS+=		ldap,lber::databases/openldap
LIB_DEPENDS+=		dbus-1::sysutils/dbus
MODULES+=		graphics/png

EXTRA_XAKE_FLAGS+=	BINMODE=${BINMODE} \
			SHAREMODE=${SHAREMODE}

CONFIGURE_STYLE=	autoconf no-autoheader dest
AUTOCONF_NEW=		Yes
CONFIGURE_ARGS+=	--with-cups-user=_cups \
			--with-cups-group=_cups \
			${CONFIGURE_SHARED} \
			--localstatedir=${PREFIX}/var \
			--with-cachedir=\${DESTDIR}${PREFIX}/var/cache/cups \
			--without-php \
			--enable-ssl

CONFIGURE_ENV=		DSOFLAGS="-L${LOCALBASE}/lib"
#COPTS+=			-idirafter ${WRKSRC}

WRKDIST=		${WRKDIR}/${DISTNAME:S/-source//}

LDFLAGS+=		-pthread
REGRESS_FLAGS=		LOCALBASE=${LOCALBASE}

REGRESS_DEPENDS=	::print/htmldoc
REGRESS_IS_INTERACTIVE=	Yes

USE_CXX=		yes

pre-patch:
	@@echo 'include(libtool.m4)' >> ${WRKSRC}/aclocal.m4

post-configure:
.for i in config.h cups-config conf/cupsd.conf
	@@mv ${WRKBUILD}/${i} ${WRKBUILD}/${i}.bak
	@@sed -e s#\$${DESTDIR}##g ${WRKBUILD}/${i}.bak > ${WRKBUILD}/${i}
.endfor

post-install:
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/examples/cups
	@@cd ${WRKINST}${SYSCONFDIR}/cups && cp -Rp * ${PREFIX}/share/examples/cups
	${INSTALL_DATA} ${WRKSRC}/packaging/cups-dbus.conf ${PREFIX}/share/examples/cups
	@@${INSTALL_DATA} ${WRKBUILD}/init/cups.sh ${PREFIX}/share/cups
	@@${INSTALL_DATA} ${FILESDIR}/README.MirBSD ${PREFIX}/share/doc/cups
.for file in cups-enable cups-disable
	@@sed s,y0y0y0,${TRUEPREFIX}, < ${FILESDIR}/${file} > \
		${PREFIX}/sbin/${file}
	@@chmod ${BINMODE} ${PREFIX}/sbin/${file}
	@@chown ${BINOWN}:${BINGRP} ${PREFIX}/sbin/${file}
.endfor

.include <bsd.port.mk>
@


1.18
log
@SECURITY: Another update for CUPS. This is like the third one in a row.
This time, the SNMP backend. Patch from STR#2589.

This is in an unsafe string copy helper function. Yes, people still write
these. The "length" parameter is a (signed) int so it can underflow. Pure
idiocy.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.17 2007/12/13 19:48:49 bsiegert Exp $
d5 2
a6 2
VERSION=		1.2.11
DASH_VER=		3
d27 4
a30 2
LIB_DEPENDS=		jpeg::graphics/jpeg \
			tiff::graphics/tiff
d34 1
a34 2
			SHAREMODE=${SHAREMODE} \
			top_builddir=${WRKBUILD}
d41 2
a42 1
			--localstatedir=/var \
d47 1
d71 1
@


1.17
log
@SECURITY: Plug the biggest holes in cups _again_. This time:
CVE-2007-4352, CVE-2007-5392, and CVE-2007-5393.

These can in principle allow an attacker to exploit your server by printing
a prepared PDF file on your network printer.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.16 2007/11/26 20:05:40 bsiegert Exp $
d6 1
a6 1
DASH_VER=		2
@


1.16
log
@SECURITY: Apply patch from cups STR #2561, fixes CVE-2007-4351.

The vulnerability is caused due to a boundary error within the
"ippReadIO()" function in cups/ipp.c when processing IPP (Internet
Printing Protocol) tags. This can be exploited to overwrite one byte on
the stack with a zero by sending an IPP request containing specially
crafted "textWithLanguage" or "nameWithLanguage" tags.

Successful exploitation allows execution of arbitrary code.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.15 2007/05/19 12:50:37 bsiegert Exp $
d6 1
a6 1
DASH_VER=		1
d27 2
a28 2
LIB_DEPENDS=		jpeg.62::graphics/jpeg \
			tiff.35::graphics/tiff
@


1.15
log
@Update to 1.2.11. One of our patches was accepted upstream.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.14 2007/03/15 19:22:39 bsiegert Exp $
d6 1
d56 3
@


1.14
log
@Update cups to 1.2.9-0, available since today. While here: regularize use
of DASH_VER, shuffle MASTER_SITES around.

And they *still* cannot spell MirBSD:
-		FreeBSD* | OpenBSD* | MirBsD* | ekkoBSD*)
+		FreeBSD* | OpenBSD* | MirBSD* | ekkoBSD*)
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.13 2007/03/04 20:25:06 tg Exp $
d5 1
a5 1
VERSION=		1.2.9
@


1.13
log
@+mirror
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.12 2006/12/20 15:31:38 tg Exp $
d5 1
a5 1
VERSION=		1.2.6
d20 3
a22 3
MASTER_SITES=		ftp://ftp.easysw.com/pub/cups/${VERSION}/ \
			ftp://ftp.funet.fi/pub/mirrors/ftp.easysw.com/pub/cups/${VERSION}/ \
			ftp://ftp2.easysw.com/pub/cups/${VERSION}/
@


1.12
log
@sync DASH_VER usage:
* the dash doesn't belong into the DASH_VER variable,
  it's only a decimal integer value
* DASH_VER already defaults to 0 (admittedly new)
* PKGNAME already defaults to ${DISTNAME}-${DASH_VER}
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.11 2006/11/08 18:25:43 bsiegert Exp $
d21 1
@


1.11
log
@(Messy) update to cups-1.2.6-0.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.10 2006/11/03 12:33:26 bsiegert Exp $
a5 1
DASH_VER=		-0
d7 1
a7 1
PKGNAME=		${DISTNAME:S/-source//}${DASH_VER}
@


1.10
log
@Fix two format-string bugs, found by me, then by -Wformat. Before, time stamps
were like "31/Oct/2006:00:17:53+5000" ...
Fixes printing from Mac OS X clients on a MirOS server.

Bump patchlevel.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.9 2006/09/14 00:12:38 tg Exp $
d5 2
a6 2
VERSION=		1.2.1
DASH_VER=		-2
@


1.9
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ­ edited by script with manual postprocessing
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.8 2006/07/26 19:56:00 bsiegert Exp $
d3 1
a3 1
COMMENT=			Common Unix Printing System
d6 1
a6 1
DASH_VER=		-1
@


1.8
log
@Big round of bugfixes for cups. This time, cups and related apps (such as
ESP Ghostscript) should actually work ...

 - Thanks to tg@@ for the php detection bug.
 - Don't emit -Wl,-soname,libcups.la so linking to the libraries works
   again.
 - Fix the case where SYSCONFDIR != /etc (my bad, actually).
 - Fix a syntax error in the cups-config script.
 - Fix a typo in DESCR while here.
 - Bump patchlevel.

Hint: You MUST rebuild print/ghostscript/esp after upgrading (if you use
it, that is).
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.6 2006/07/07 16:31:02 bsiegert Exp $
d3 1
a3 1
COMMENT=		"Common Unix Printing System"
@


1.7
log
@don't pick up an eventually installed PHP

from and ok to commit bsiegert@@
@
text
@d6 1
a6 1
DASH_VER=		-0
d63 1
a63 1
	@@cd ${WRKINST}/etc/cups && cp -Rp * ${PREFIX}/share/examples/cups
@


1.6
log
@Update cups to 1.2.1-0. Regenerate and update patches.

This is my first commit over my new modem connection ... yay for commits!
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.5 2006/06/21 19:25:32 bsiegert Exp $
d40 1
@


1.5
log
@Update cups to 1.2.0-0. I had this lying around for a while but now it
finally works. New, nice admin interface too ;).

I know it is getting ridiculous with all those patches. I should(TM) submit
my libtool patches (which are done The Right Way(TM) now) to the cups
people.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.4 2006/02/09 11:15:12 tg Exp $
d5 1
a5 1
VERSION=		1.2.0
@


1.4
log
@Fix a few abuses:
| CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include/libpng \
|			    -I${LOCALBASE}/include -I${X11BASE}/include" \
| 			LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib" \
|			PKGCONFIG_PATH=...

* use Benny's pkgconfig module
  - fixes PKGCONFIG_PATH in all places
  - adds explicit dependencies on pkgconfig where needed
* use a new png module
  - also cought a few implicit dependencies
* use a new freetype1 module in two places (more to come?)
* CPPFLAGS, LDFLAGS are in CONFIGURE_ENV anyway, so correctly
  add to them as CPPFLAGS+=<tab>foo instead
* use EXTRA_{M,X,F}AKE_FLAGS
* CC is given anyway, too
* add MAKEINFO= to gnu style

Still doesn't catch all OpenBSD abuses, but most of them.

Brokenness analysis:
* Automatically done
  - CFLAGS+=CPPFLAGS
  - CXXFLAGS+=CPPFLAGS
  - CPPFLAGS+=-I${LOCALBASE}/include
  - LDFLAGS+=-L${LOCALBASE}/lib
  - CONFIGURE_ENV, MAKE_FLAGS+=
    + LDFLAGS=LDFLAGS
    + CPPFLAGS you get the idea
    + CFLAGS
    + CXXFLAGS
    + CC
    + CXX (if USE_CXX)
* Done if USE_X11=Yes
  - CPPFLAGS+=X11BASE/include
  - LDFLAGS+=X11BASE/lib

Tell me if there are problems, but first try adding
an EXTRA_ before MAKE_FLAGS and FAKE_FLAGS.
Remember EXTRA_XAKE_FLAGS get added to both.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.3 2005/12/16 01:07:12 bsiegert Exp $
d5 2
a6 2
VERSION=		1.1.23
DASH_VER=		-1
d30 1
a30 1
FAKE_FLAGS+=		BINMODE=${BINMODE} \
a32 1
MAKE_FLAGS+=		top_builddir=${WRKBUILD}
d46 1
d55 1
a55 1
.for i in cups.sh config.h cups-config conf/cupsd.conf
d63 1
a63 1
	@@${INSTALL_DATA} ${WRKBUILD}/cups.sh ${PREFIX}/share/cups
@


1.3
log
@This was broken on MirOS-current as it uses unsupported behavior: it
compiles libcupsimage agains libjpg and libpng and then "forgets" to link
them into the executables. This triggers a linker bug in my snapshot and
causes a segfault in ld.

There is some unsupported libtool stuff in the cups Makefiles. Bring it up
to shape and unconditionally use it (MirLibtool) for the build. Works for
me.

Also remove INSTALL/DEINSTALL and replace it by @@sample. Bump patchlevel.
@
text
@d1 1
a1 1
# $MirOS: ports/print/cups/Makefile,v 1.2 2005/07/06 19:21:35 bsiegert Exp $
d26 1
a26 2
LIB_DEPENDS=		png.3::graphics/png \
			jpeg.62::graphics/jpeg \
d28 1
d43 1
a43 7
CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include \
			  -I${LOCALBASE}/include/libpng" \
			DSOFLAGS="-L${LOCALBASE}/lib" \
			LDFLAGS="-L${LOCALBASE}/lib"

CFLAGS+=		"-I${LOCALBASE}/include" \
			"-I${LOCALBASE}/include/libpng"
@


1.2
log
@Move some packages (those that use DASH_VER) to new patchlevels.
@
text
@d1 1
a1 1
# $MirOS$
d6 1
a6 1
DASH_VER=		-0
d30 4
a33 2
FAKE_FLAGS=		BINMODE=${BINMODE} \
			SHAREMODE=${SHAREMODE}
d75 1
a75 1
	@@chown ${BINOWN}.${BINGRP} ${PREFIX}/sbin/${file}
@


1.1
log
@Initial revision
@
text
@d6 1
a6 1
DASH_VER=		
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
