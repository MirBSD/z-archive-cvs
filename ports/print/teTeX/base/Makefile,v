head	1.10;
access;
symbols;
locks; strict;
comment	@# @;


1.10
date	2008.05.07.22.48.39;	author tg;	state Exp;
branches;
next	1.9;
commitid	100482231C374D9CA0B;

1.9
date	2008.03.09.17.23.28;	author tg;	state Exp;
branches;
next	1.8;
commitid	10047D41CAA7E715397;

1.8
date	2007.03.08.10.15.10;	author tg;	state Exp;
branches;
next	1.7;
commitid	10045EFE23A2217A54F;

1.7
date	2007.03.04.23.30.29;	author tg;	state Exp;
branches;
next	1.6;
commitid	10045EB56A90F7DC8A5;

1.6
date	2007.03.01.21.45.53;	author tg;	state Exp;
branches;
next	1.5;
commitid	10045E749A8173E8BA0;

1.5
date	2007.02.23.02.12.41;	author tg;	state Exp;
branches;
next	1.4;
commitid	10045DE4DB0746E767B;

1.4
date	2006.09.14.00.12.46;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045089C0E234154C3;

1.3
date	2006.02.09.11.15.15;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043EB23217A35557B;

1.2
date	2005.07.07.21.25.36;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	66bc42cd9a7ea714;

1.1
date	2005.03.18.15.51.08;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.51.08;	author tg;	state Exp;
branches;
next	;


desc
@@


1.10
log
@‚Ä¢ replace MODGNU_CONFIG_GUESS_DIRS with MODGNU_RECURSE_DIRS
‚Ä¢ always place ${WRKSRC} itself at the end of MODGNU_RECURSE_DIRS due to
  recursion issues inside of autoconf itself
‚Ä¢ if MODGNU_RECURSE_DIRS=${WRKSRC} stood in the Makefile, nuke it (default)
‚Ä¢ remove dead reference to MODGNU_TWIDDLE_DIRS
@
text
@# $MirOS: ports/print/teTeX/base/Makefile,v 1.9 2008/03/09 17:23:28 tg Exp $
# $OpenBSD: Makefile,v 1.25 2003/04/04 21:19:23 sturm Exp $

COMMENT=		TeX distribution, executables
VERSION=		2.0.2
DASH_VER=		2
DISTNAME=		tetex-base-${VERSION}
PKGNAME=		${DISTNAME:S/tetex-/teTeX_/}-${DASH_VER}
CATEGORIES=		print
DISTFILES=		tetex-src-${VERSION}.tar.gz

B_R_DEPENDS+=		:teTeX_texmf->=2.0:print/teTeX/texmf
RUN_DEPENDS+=		:texi2html->=1.56:textproc/texi2html
MODULES+=		graphics/png

CONFIGURE_STYLE=	dest autogen no-autoheader
AUTOGEN=		${SHELL} ${WRKSRC}/reautoconf
USE_CXX=		yes

MODGNU_RECURSE_DIRS=	\
			${WRKSRC} \
			${WRKSRC}/libs \
			${WRKSRC}/libs/libwww \
			${WRKSRC}/libs/ncurses \
			${WRKSRC}/texk

CONFIGURE_ARGS+=	--disable-multiplatform \
			--without-texinfo \
			--with-system-ncurses \
			--with-system-pnglib \
			--with-pnglib-libdir=${LOCALBASE}/lib \
			--with-pnglib-include=${LOCALBASE}/include/libpng \
			--with-system-zlib

FLAVOURS=		no_x11
FLAVOUR?=
.if ${FLAVOUR:L:Mno_x11}
CONFIGURE_ARGS+=	--without-x
.else
CONFIGURE_ARGS+=	--with-system-t1lib \
			--with-t1lib-libdir=${LOCALBASE}/lib \
			--with-t1lib-include=${LOCALBASE}/include
LIB_DEPENDS+=		t1.4::devel/t1lib
RUN_DEPENDS+=		:ghostscript-*:print/ghostscript/artifex
USE_X11=		Yes
.endif

WRKDIST=		${WRKDIR}/${DISTNAME:S/base/src/}
TETEX_EXDIR=		${PREFIX}/share/examples/teTeX

# find texmf after fake
REGRESS_FLAGS=		DESTDIR=${WRKINST:Q}

pre-patch:
	cd ${WRKSRC}/texk/etc/autoconf; \
	    cp ${LOCALBASE}/share/autoconf-2.13/* .; \
	    chmod u+w *; \
	    patch -l -z .orig.mir <${FILESDIR}/ac.diff

post-configure:
	find ${WRKBUILD} -name Makefile -exec perl -i -pe \
	    's#^(texmf\s*\=\s*)${PREFIX}#$$1\$${${DESTDIRNAME}}${PREFIX}#' {} \;

# need the texmf part visible...
pre-fake:
	${INSTALL_DATA_DIR} ${TEXMF_DIR}
	lndir ${TRUEPREFIX}/share/texmf ${TEXMF_DIR}
	# mktexlsr is too smart for its own good
	rm ${TEXMF_DIR}/ls-R

post-install:
	${INSTALL_DATA_DIR} ${TETEX_EXDIR}
	${INSTALL_DATA} files/tetex.cfg ${TETEX_EXDIR}/tetex.cfg
	${INSTALL_SCRIPT} files/tetex_setup.sh ${PREFIX}/bin/tetex_setup
	perl -i -pe "s#%%SYSCONFDIR%%#${SYSCONFDIR}#;" \
	    -e "s#%%PREFIX%%#${TRUEPREFIX}#;" ${PREFIX}/bin/tetex_setup

# need the texmf part visible...
pre-regress: fake

.include <bsd.port.mk>
@


1.9
log
@bulk convert FLAVOR to FLAVOUR; nuke unused file; convert to $Mdocdate
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.8 2007/03/08 10:15:10 tg Exp $
d20 1
a20 1
MODGNU_CONFIG_GUESS_DIRS= \
@


1.8
log
@prevent ‚Äúupdate-patches‚Äù from finding too much
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.7 2007/03/04 23:30:29 tg Exp $
d35 3
a37 3
FLAVORS=		no_x11
FLAVOR?=
.if ${FLAVOR:L:Mno_x11}
@


1.7
log
@make !no_x11 default flavour, unbreak, bump patchlevel, sync @@dirrm
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.6 2007/03/01 21:45:53 tg Exp $
d58 1
a58 1
	    patch -l -z .mir.orig <${FILESDIR}/ac.diff
@


1.6
log
@‚Ä¢ mark as broken
‚Ä¢ re-indent (this is one of these where I like the visible-spaces option of
  jupp - ports/editors/joe - best)
‚Ä¢ add comment about the build dependency of texmf issue to bsiegert@@ to see
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.5 2007/02/23 02:12:41 tg Exp $
a3 2
BROKEN=			autoconf issues, currently under post-analysis

d6 1
d12 2
a13 5
#BUILD_DEPENDS+=	:teTeX_texmf->=2.0:print/teTeX/texmf
#XXX Benny, this looks to me as if ‚Äúpre-fake‚Äù will fail without the
#XXX build dependency, because it's lndir'd‚Ä¶ I think you want it back in.
RUN_DEPENDS=		:teTeX_texmf->=2.0:print/teTeX/texmf \
			:texi2html->=1.56:textproc/texi2html
d36 1
a36 1
FLAVOR?=		no_x11
d54 6
d61 1
a61 1
	@@find ${WRKBUILD} -name Makefile -exec perl -i -pe \
d75 1
a75 1
	@@perl -i -pe "s#%%SYSCONFDIR%%#${SYSCONFDIR}#;" \
@


1.5
log
@ghostscript/gnu is *long* gone
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.4 2006/09/14 00:12:46 tg Exp $
d4 14
a17 11
COMMENT=			TeX distribution, executables
VERSION=	2.0.2
DISTNAME=	tetex-base-${VERSION}
PKGNAME=	${DISTNAME:S/tetex-/teTeX_/}-0
CATEGORIES=	print

DISTFILES=	tetex-src-${VERSION}.tar.gz

#BUILD_DEPENDS=	:teTeX_texmf->=2.0:print/teTeX/texmf
RUN_DEPENDS=	:teTeX_texmf->=2.0:print/teTeX/texmf \
		:texi2html->=1.56:textproc/texi2html
d20 3
a22 3
CONFIGURE_STYLE=dest autogen no-autoheader
AUTOGEN=	${SHELL} ${WRKSRC}/reautoconf
USE_CXX=	yes
d25 13
a37 13
		${WRKSRC} \
		${WRKSRC}/libs \
		${WRKSRC}/libs/libwww \
		${WRKSRC}/libs/ncurses \
		${WRKSRC}/texk

CONFIGURE_ARGS= --disable-multiplatform \
		--without-texinfo \
		--with-system-ncurses \
		--with-system-pnglib \
		--with-pnglib-libdir=${PREFIX}/lib \
		--with-pnglib-include=${PREFIX}/include/libpng \
		--with-system-zlib
d39 2
a40 2
FLAVORS=	no_x11
FLAVOR?= 	no_x11
d42 1
a42 1
CONFIGURE_ARGS+=--without-x
d44 6
a49 6
CONFIGURE_ARGS+=--with-system-t1lib \
		--with-t1lib-libdir=${PREFIX}/lib \
		--with-t1lib-include=${PREFIX}/include
LIB_DEPENDS+=	t1.4::devel/t1lib
RUN_DEPENDS+=	:ghostscript-*:print/ghostscript/artifex
USE_X11=	Yes
d52 2
a53 2
WRKDIST=	${WRKDIR}/${DISTNAME:S/base/src/}
TETEX_EXDIR=	${PREFIX}/share/examples/teTeX
d56 1
a56 1
REGRESS_FLAGS=	DESTDIR="${WRKINST}"
d74 1
a74 1
		-e "s#%%PREFIX%%#${TRUEPREFIX}#;" ${PREFIX}/bin/tetex_setup
@


1.4
log
@clean up COMMENT and HOMEPAGE; regenerate INDEX (2761, 169 marked as broken, probably many many more) ≠ edited by script with manual postprocessing
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.3 2006/02/09 11:15:15 tg Exp $
d45 1
a45 1
RUN_DEPENDS+=	:ghostscript-*:print/ghostscript/gnu
@


1.3
log
@Fix a few abuses:
| CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include/libpng \
|			    -I${LOCALBASE}/include -I${X11BASE}/include" \
| 			LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib" \
|			PKGCONFIG_PATH=...

* use Benny's pkgconfig module
  - fixes PKGCONFIG_PATH in all places
  - adds explicit dependencies on pkgconfig where needed
* use a new png module
  - also cought a few implicit dependencies
* use a new freetype1 module in two places (more to come?)
* CPPFLAGS, LDFLAGS are in CONFIGURE_ENV anyway, so correctly
  add to them as CPPFLAGS+=<tab>foo instead
* use EXTRA_{M,X,F}AKE_FLAGS
* CC is given anyway, too
* add MAKEINFO= to gnu style

Still doesn't catch all OpenBSD abuses, but most of them.

Brokenness analysis:
* Automatically done
  - CFLAGS+=CPPFLAGS
  - CXXFLAGS+=CPPFLAGS
  - CPPFLAGS+=-I${LOCALBASE}/include
  - LDFLAGS+=-L${LOCALBASE}/lib
  - CONFIGURE_ENV, MAKE_FLAGS+=
    + LDFLAGS=LDFLAGS
    + CPPFLAGS you get the idea
    + CFLAGS
    + CXXFLAGS
    + CC
    + CXX (if USE_CXX)
* Done if USE_X11=Yes
  - CPPFLAGS+=X11BASE/include
  - LDFLAGS+=X11BASE/lib

Tell me if there are problems, but first try adding
an EXTRA_ before MAKE_FLAGS and FAKE_FLAGS.
Remember EXTRA_XAKE_FLAGS get added to both.
@
text
@d1 1
a1 1
# $MirOS: ports/print/teTeX/base/Makefile,v 1.2 2005/07/07 21:25:36 bsiegert Exp $
d4 1
a4 1
COMMENT=	"TeX distribution, executables"
@


1.2
log
@Semi-automatic update of the remaining ports to the new patchlevel format.

Please correct mistakes if you find them :).
@
text
@d1 1
a1 1
# $MirOS$
d15 1
a15 1
LIB_DEPENDS=	png.3::graphics/png
@


1.1
log
@Initial revision
@
text
@d7 1
a7 1
PKGNAME=	${DISTNAME:S/tetex-/teTeX_/}
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
