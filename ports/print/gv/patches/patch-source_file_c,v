head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2006.04.30.17.08.02;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	1004454EE9B6D29A177;

1.1
date	2005.03.18.15.51.05;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.51.05;	author tg;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Replace an occurrence of "sprintf" by "snprintf". Correct format specifier
for time_t, fixes segfault on loading a file.

Bump patchlevel.
@
text
@$OpenBSD: patch-source_file_c,v 1.1 2002/10/04 18:29:14 brad Exp $
--- source/file.c.orig	Fri Jun  6 21:59:40 1997
+++ source/file.c	Sun Apr 30 16:58:55 2006
@@@@ -44,7 +44,7 @@@@
 #endif
 
 #include "paths.h"
-#include INC_X11(Intrinsic.h)
+#include <X11/Intrinsic.h>
 
 #include "types.h"
 #include "config.h"
@@@@ -193,9 +193,9 @@@@ file_getTmpFilename(baseDirectory,baseFi
       int i=1;
       do {
 #ifdef VMS
-         sprintf(tempFilename,"%sgv_%lx_%x_%s_%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
+         snprintf(tempFilename,256,"%sgv_%lx_%x_%s_%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
 #else
-         sprintf(tempFilename,"%sgv_%lx_%x_%s.%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
+         snprintf(tempFilename,256,"%sgv_%llx_%x_%s.%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
 #endif
          file_translateTildeInPath(tempFilename);
          no_such_file = stat(tempFilename,&s);
@@@@ -282,6 +282,22 @@@@ file_fileIsNotUseful(fn)
   IMESSAGE(r)
   ENDMESSAGE(file_fileIsNotUseful)
   return(r);
+}
+
+/*############################################################*/
+/* file_nameIsDangerous */
+/*############################################################*/
+
+char *file_charsAllowedInName = "+,-./:=@@\\^_";
+
+int
+file_nameIsDangerous(fn)
+  char *fn;
+{
+  for (; *fn; fn++)
+    if (!isalnum(*fn) && !strchr(file_charsAllowedInName, *fn))
+      return(1);
+  return(0);
 }
 
 /*############################################################*/
@


1.1
log
@Initial revision
@
text
@d2 8
a9 4
--- source/file.c.orig	Fri Jun  6 18:00:00 1997
+++ source/file.c	Fri Oct  4 14:20:31 2002
@@@@ -285,6 +285,22 @@@@ file_fileIsNotUseful(fn)
 }
d11 21
a31 1
 /*############################################################*/
d45 3
a47 6
+}
+
+/*############################################################*/
 /* file_pdfname2psname */
 /* If the file ends in .pdf, change this to .ps.*/
 /* Return pointer to temp copy if changed, else to input string. */
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
