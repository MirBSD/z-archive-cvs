head	1.15;
access;
symbols
	bsiegert-cfgfile_BASE:1.12
	bsiegert-cfgfile:1.12.0.2
	MIRBSD_8_BASE:1.6;
locks; strict;
comment	@.\" @;


1.15
date	2018.12.25.19.38.00;	author tg;	state Exp;
branches;
next	1.14;
commitid	1005C22871909EC7FE2;

1.14
date	2016.02.11.20.16.23;	author tg;	state Exp;
branches;
next	1.13;
commitid	10056BCEC2E0F716C14;

1.13
date	2016.02.11.20.12.01;	author tg;	state Exp;
branches;
next	1.12;
commitid	10056BCEAFF41919B5B;

1.12
date	2009.11.22.18.23.32;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004B0981B210A68B89;

1.11
date	2009.11.22.15.48.45;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004B095D622ECA4D23;

1.10
date	2008.03.23.11.45.52;	author bsiegert;	state Exp;
branches;
next	1.9;
commitid	10047E642E8009B8862;

1.9
date	2008.03.14.16.46.01;	author tg;	state Exp;
branches;
next	1.8;
commitid	10047DAABDD118A6FDD;

1.8
date	2008.03.12.23.17.20;	author tg;	state Exp;
branches;
next	1.7;
commitid	10047D86495134E62E4;

1.7
date	2007.01.19.23.11.19;	author bsiegert;	state Exp;
branches;
next	1.6;
commitid	10045B14FCB796AA24B;

1.6
date	2005.11.19.02.05.28;	author bsiegert;	state Exp;
branches;
next	1.5;
commitid	6633437e87d6af88;

1.5
date	2005.11.15.19.33.57;	author tg;	state Exp;
branches;
next	1.4;
commitid	7927437a38332782;

1.4
date	2005.09.19.19.30.05;	author bsiegert;	state Exp;
branches;
next	1.3;
commitid	499c432f1149096c;

1.3
date	2005.09.12.22.53.22;	author tg;	state Exp;
branches;
next	1.2;
commitid	6e6c432606e897b6;

1.2
date	2005.08.22.16.44.15;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	6c31430a00e40153;

1.1
date	2005.03.18.15.47.16;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.47.16;	author tg;	state Exp;
branches
	1.1.7.1.2.1;
next	;

1.1.7.1.2.1
date	2005.09.11.01.05.43;	author tg;	state Exp;
branches;
next	;
commitid	2f08432382e315cf;


desc
@@


1.15
log
@update from contrib/samples/portmdoc,v 1.11
@
text
@.\" $MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.14 2016/02/11 20:16:23 tg Exp $
.\" $OpenBSD: pkg_delete.1,v 1.17 2003/08/21 20:24:56 espie Exp $
.\"
.\" FreeBSD install - a package for the installation and maintenance
.\" of non-core utilities.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" Jordan K. Hubbard
.\"-
.\" Copyright (c) 2008, 2009, 2010, 2016, 2018
.\"	mirabilos <m@@mirbsd.org>
.\"-
.\" Try to make GNU groff and AT&T nroff more compatible
.\" * ` generates ‘ in gnroff, so use \`
.\" * ' generates ’ in gnroff, \' generates ´, so use \*(aq
.\" * - generates ‐ in gnroff, \- generates −, so .tr it to -
.\"   thus use - for hyphens and \- for minus signs and option dashes
.\" * ~ is size-reduced and placed atop in groff, so use \*(TI
.\" * ^ is size-reduced and placed atop in groff, so use \*(ha
.\" * \(en does not work in nroff, so use \*(en
.\" * <>| are problematic, so redefine and use \*(Lt\*(Gt\*(Ba
.\" Also make sure to use \& *before* a punctuation char that is to not
.\" be interpreted as punctuation, and especially with two-letter words
.\" but also (after) a period that does not end a sentence (“e.g.\&”).
.\" The section after the "doc" macropackage has been loaded contains
.\" additional code to convene between the UCB mdoc macropackage (and
.\" its variant as BSD mdoc in groff) and the GNU mdoc macropackage.
.\"
.ie \n(.g \{\
.	if \*[.T]ascii .tr \-\N'45'
.	if \*[.T]latin1 .tr \-\N'45'
.	if \*[.T]utf8 .tr \-\N'45'
.	ds <= \[<=]
.	ds >= \[>=]
.	ds Rq \[rq]
.	ds Lq \[lq]
.	ds sL \(aq
.	ds sR \(aq
.	if \*[.T]utf8 .ds sL `
.	if \*[.T]ps .ds sL `
.	if \*[.T]utf8 .ds sR '
.	if \*[.T]ps .ds sR '
.	ds aq \(aq
.	ds TI \(ti
.	ds ha \(ha
.	ds en \(en
.\}
.el \{\
.	ds aq '
.	ds TI ~
.	ds ha ^
.	ds en \(em
.\}
.\"
.\" Implement .Dd with the Mdocdate RCS keyword
.\"
.rn Dd xD
.de Dd
.ie \\$1$Mdocdate: \{\
.	xD \\$2 \\$3, \\$4
.\}
.el .xD \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8
..
.\"
.\" .Dd must come before definition of .Mx, because when called
.\" with -mandoc, it might implement .Mx itself, but we want to
.\" use our own definition. And .Dd must come *first*, always.
.\"
.Dd $Mdocdate: December 25 2018 $
.\"
.\" Check which macro package we use, and do other -mdoc setup.
.\"
.ie \n(.g \{\
.	if \*[.T]utf8 .tr \[la]\*(Lt
.	if \*[.T]utf8 .tr \[ra]\*(Gt
.	ie d volume-ds-1 .ds tT gnu
.	el .ie d doc-volume-ds-1 .ds tT gnp
.	el .ds tT bsd
.\}
.el .ds tT ucb
.\"
.\" Implement .Mx (MirBSD)
.\"
.ie "\*(tT"gnu" \{\
.	eo
.	de Mx
.	nr curr-font \n[.f]
.	nr curr-size \n[.ps]
.	ds str-Mx \f[\n[curr-font]]\s[\n[curr-size]u]
.	ds str-Mx1 \*[Tn-font-size]\%MirBSD\*[str-Mx]
.	if !\n[arg-limit] \
.	if \n[.$] \{\
.	ds macro-name Mx
.	parse-args \$@@
.	\}
.	if (\n[arg-limit] > \n[arg-ptr]) \{\
.	nr arg-ptr +1
.	ie (\n[type\n[arg-ptr]] == 2) \
.	as str-Mx1 \~\*[arg\n[arg-ptr]]
.	el \
.	nr arg-ptr -1
.	\}
.	ds arg\n[arg-ptr] "\*[str-Mx1]
.	nr type\n[arg-ptr] 2
.	ds space\n[arg-ptr] "\*[space]
.	nr num-args (\n[arg-limit] - \n[arg-ptr])
.	nr arg-limit \n[arg-ptr]
.	if \n[num-args] \
.	parse-space-vector
.	print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[Tn-font-size]
.\}
.el .ie "\*(tT"gnp" \{\
.	eo
.	de Mx
.	nr doc-curr-font \n[.f]
.	nr doc-curr-size \n[.ps]
.	ds doc-str-Mx \f[\n[doc-curr-font]]\s[\n[doc-curr-size]u]
.	ds doc-str-Mx1 \*[doc-Tn-font-size]\%MirBSD\*[doc-str-Mx]
.	if !\n[doc-arg-limit] \
.	if \n[.$] \{\
.	ds doc-macro-name Mx
.	doc-parse-args \$@@
.	\}
.	if (\n[doc-arg-limit] > \n[doc-arg-ptr]) \{\
.	nr doc-arg-ptr +1
.	ie (\n[doc-type\n[doc-arg-ptr]] == 2) \
.	as doc-str-Mx1 \~\*[doc-arg\n[doc-arg-ptr]]
.	el \
.	nr doc-arg-ptr -1
.	\}
.	ds doc-arg\n[doc-arg-ptr] "\*[doc-str-Mx1]
.	nr doc-type\n[doc-arg-ptr] 2
.	ds doc-space\n[doc-arg-ptr] "\*[doc-space]
.	nr doc-num-args (\n[doc-arg-limit] - \n[doc-arg-ptr])
.	nr doc-arg-limit \n[doc-arg-ptr]
.	if \n[doc-num-args] \
.	doc-parse-space-vector
.	doc-print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[doc-Tn-font-size]
.\}
.el \{\
.	de Mx
.	nr cF \\n(.f
.	nr cZ \\n(.s
.	ds aa \&\f\\n(cF\s\\n(cZ
.	if \\n(aC==0 \{\
.		ie \\n(.$==0 \&MirBSD\\*(aa
.		el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
.	\}
.	if \\n(aC>\\n(aP \{\
.		nr aP \\n(aP+1
.		ie \\n(C\\n(aP==2 \{\
.			as b1 \&MirBSD\ #\&\\*(A\\n(aP\\*(aa
.			ie \\n(aC>\\n(aP \{\
.				nr aP \\n(aP+1
.				nR
.			\}
.			el .aZ
.		\}
.		el \{\
.			as b1 \&MirBSD\\*(aa
.			nR
.		\}
.	\}
..
.\}
.\"-
.Dt PKG_DELETE 1
.Os
.Sh NAME
.Nm pkg_delete
.Nd delete previously installed software package distributions
.Sh SYNOPSIS
.Nm pkg_delete
.Op Fl DFUcdfnqv
.Op Fl p Ar prefix
.Ar pkg-name Op Ar ...
.Sh DESCRIPTION
The
.Nm
command is used to delete packages that have been previously installed
with the
.Xr pkg_add 1
command.
.Pp
Package names may be specified either as the package name with or without
version, as the path of the installation log directory, or as a filename
with suffix.
If a name without version is given and there are multiple versions of the
package installed
.Pq for example, with the autoconf packages ,
.Nm
will fail.
.Pp
For example, the following will work:
.Bd -literal -offset indent
% pkg_delete libpixman\-0.1.6\-0
% pkg_delete libpixman
% pkg_delete /usr/mpkg/db/pkg/libpixman\-0.1.6\-0/
% pkg_delete libpixman\-0.1.6\-0.cgz
.Ed
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Ar pkg-name Op Ar ...
The named packages are deinstalled.
.It Fl D
If a deinstallation script exists for a given package, do not execute it.
.It Fl F
If not running as root, try to uninstall the package anyway.
.It Fl U
Unregister the package but don't actually delete any files.
Useful for upgrades of base packages, for example the pkgtools themselves.
Use with caution.
.It Fl c
Delete configuration files and directories, mentioned as
.Cm @@extra
or
.Cm @@sample
in the packing-list.
.It Fl C
Only delete configuration files that have the same checksum as the
original file, i.e. those that have not been changed by the user.
.It Fl d
Remove empty directories created by file cleanup.
By default, only
files/directories explicitly listed in a package's contents (either as
normal files/directories or with the
.Cm @@dirrm
directive and a shared reference counter of 1) will be removed
at deinstallation time.
This option tells
.Nm
to also remove any directories that were emptied as a result of removing
the package.
.It Fl f
Force removal of the package, even if a dependency is recorded or the
deinstall or require script fails.
Also force removing base packages.
Use with care.
.It Fl n
Don't actually deinstall a package, just report the steps that
would be taken if it were.
.It Fl p Ar prefix
Set
.Ar prefix
as the directory in which to delete files from any installed packages
which do not explicitly set theirs.
For most packages, the prefix will
be set automatically to the installed location by
.Xr pkg_add 1 .
.It Fl q
Delete package quickly, do not bother checking md5 sums before removing files.
.It Fl v
Turn on verbose output.
.El
.Sh TECHNICAL DETAILS
.Nm
does pretty much what it says.
It examines installed package records in
.Ev $LOCALBASE Ns Pa /db/pkg/<pkg-name> ,
deletes the package contents, and finally removes the package records.
.Pp
If a package is required by other installed packages,
.Nm
will list those dependent packages and refuse to delete the package
(unless the
.Fl f
option is given).
.Pp
If the package contains a
.Ar require
file (see
.Xr pkg_create 1 ) ,
then this is executed first as
.Bd -filled -offset indent
.Cm require
.Ar <pkg-name>
.Ar DEINSTALL
.Ed
.Pp
(where
.Ar pkg-name
is the name of the package in question and
.Ar DEINSTALL
is a keyword denoting that this is a deinstallation)
to see whether or not deinstallation should continue.
A non-zero exit status means no, unless the
.Fl f
option is specified.
.Pp
If a
.Cm deinstall
script exists for the package, it is executed before any files are removed.
It is this script's responsibility to clean up any additional messy details
around the package's installation, since all
.Nm
knows how to do is delete the files created in the original distribution.
The
.Nm deinstall
script is called as:
.Bd -filled -offset indent
.Cm deinstall
.Ar <pkg-name>
.Ar DEINSTALL
.Ed
.Pp
Passing the keyword
.Ar DEINSTALL
lets you potentially write only one program/script that handles all
aspects of installation and deletion.
.Pp
All scripts are called with the environment variable
.Ev PKG_PREFIX
set to the installation prefix (see the
.Fl p
option above).
This allows a package author to write a script
that reliably performs some action on the directory where the package
is installed, even if the user might have changed it by specifying the
.Fl p
option when running
.Nm
or
.Cm pkg_add .
.Sh SEE ALSO
.Xr pkg_add 1 ,
.Xr pkg_create 1 ,
.Xr pkg_info 1 ,
.Xr mkstemp 3 ,
.Xr mtree 8
.Sh AUTHORS
.Bl -tag -width indent -compact
.It "Jordan Hubbard"
most of the work
.It "John Kohl"
refined it for
.Nx
.It "Thorsten Glaser"
.Mx
adaptions.
.br
.Xr rcdb 3
based shared directory counting implementation.
.It "Benny Siegert"
various adaptions, dir/ support,
.Fl U
option.
.El
.Sh WARNING
.Bf -emphasis
Since the
.Nm
command may execute scripts or programs provided by a package file,
your system may be susceptible to
.Dq trojan horses
or other subtle
attacks from miscreants who create dangerous package files.
.Pp
You are advised to verify the competence and identity of those who
provide installable package files.
For extra protection, examine all
the package control files in the package record directory
.Pq Pa /var/db/pkg/<pkg-name>/ .
Pay particular
attention to any +INSTALL, +DEINSTALL, +REQUIRE or +MTREE_DIRS files,
and inspect the +CONTENTS file for
.Cm @@cwd ,
.Cm @@mode
(check for setuid),
.Cm @@dirrm ,
.Cm @@exec ,
and
.Cm @@unexec
directives, and/or use the
.Xr pkg_info 1
command to examine the installed package control files.
.Ef
@


1.14
log
@cleanup while here
@
text
@d1 1
a1 1
.\" $MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.13 2016/02/11 20:12:01 tg Exp $
d18 1
a18 1
.\" Copyright (c) 2008, 2009, 2010, 2016
d77 1
a77 1
.Dd $Mdocdate: November 22 2009 $
d85 1
d98 1
a98 1
.	ds str-Mx1 \*[Tn-font-size]\%MirOS\*[str-Mx]
d124 32
d162 1
a162 1
.		ie \\n(.$==0 \&MirOS\\*(aa
d168 1
a168 1
.			as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
d176 1
a176 1
.			as b1 \&MirOS\\*(aa
@


1.13
log
@merge most recent portmdoc into a̲l̲l̲ of its users; fixup .\& into \&. like
in mksh(1), for Schillix ditroff
@
text
@d1 2
a2 2
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.11 2009/11/22 15:48:45 tg Exp $
.\"	$OpenBSD: pkg_delete.1,v 1.17 2003/08/21 20:24:56 espie Exp $
@


1.12
log
@fix more manpages
@
text
@d18 2
a19 2
.\" Copyright (c) 2008, 2009
.\"	Thorsten “mirabilos” Glaser <tg@@mirbsd.org>
d29 4
d79 1
a79 1
.\" Check which macro package we use
d82 2
@


1.11
log
@update to contrib/samples/portmdoc,v 1.6
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.10 2008/03/23 11:45:52 bsiegert Exp $
d73 1
a73 1
.Dd $Mdocdate: November 17 2009 $
d173 1
a173 1
% pkg_delete libpixman-0.1.6-0
d175 2
a176 2
% pkg_delete /usr/mpkg/db/pkg/libpixman-0.1.6-0/
% pkg_delete libpixman-0.1.6-0.cgz
@


1.10
log
@New option -F to override the error "must be root to delete packages". Use
only if you know what you are doing.
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.9 2008/03/14 16:46:01 tg Exp $
d17 3
a19 4
.\"
.\"
.\"     from FreeBSD: @@(#)pkg_delete.1
.\"
d22 3
a24 3
.\" * ` generates ‘ in groff, so use \`
.\" * ' generates ’ in groff, \' generates ´, so use \*(aq
.\" * - generates ‐ in groff, \- generates −, fixed in tmac/mdoc/doc-groff
d29 4
d34 13
d60 1
d72 10
a81 1
.Dd $Mdocdate: March 14 2008 $
d84 32
a115 7
.de Mx
.nr cF \\n(.f
.nr cZ \\n(.s
.ds aa \&\f\\n(cF\s\\n(cZ
.if \\n(aC==0 \{\
.	ie \\n(.$==0 \&MirOS\\*(aa
.	el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
d117 21
a137 6
.if \\n(aC>\\n(aP \{\
.	nr aP \\n(aP+1
.	ie \\n(C\\n(aP==2 \{\
.		as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
.		ie \\n(aC>\\n(aP \{\
.			nr aP \\n(aP+1
a139 5
.		el .aZ
.	\}
.	el \{\
.		as b1 \&MirOS\\*(aa
.		nR
d141 1
d143 1
a143 1
..
@


1.9
log
@use .Dd before (re)defining .Mx, otherwise tmac.andoc fucks up on mnbsd
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.8 2008/03/12 23:17:20 tg Exp $
d55 1
a55 1
.Dd $Mdocdate$
d89 1
a89 1
.Op Fl DUcdfnqv
d123 2
@


1.8
log
@declare .Dd and .Mx
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.7 2007/01/19 23:11:19 bsiegert Exp $
d52 5
a81 1
.Dd $Mdocdate$
@


1.7
log
@Implement a new parameter: pkg_delete -C, will be used for pkg_upgrade IDC.

From the manpage:
     -C      Only delete configuration files that have the same checksum as
             the original file, i.e. those that have not been changed by the
             user.

agreed tg@@
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.6 2005/11/19 02:05:28 bsiegert Exp $
d21 57
a77 1
.Dd November 25, 1994
@


1.6
log
@Implement base package upgrades that actually work:

- add a -U option for pkg_delete to leave the files but unregister the
  package. Update manpage; while here, sort options alphabetically.
- add base package detection code into pkg_upgrade

Please test this, as I haven't done so :).

some help by tg@@
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.5 2005/11/15 19:33:57 tg Exp $
d73 3
@


1.5
log
@crude U+0060 removal
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.4 2005/09/19 19:30:05 bsiegert Exp $
d29 1
a29 1
.Op Fl cvDdnfq
a60 2
.It Fl v
Turn on verbose output.
d63 10
a72 11
.It Fl n
Don't actually deinstall a package, just report the steps that
would be taken if it were.
.It Fl p Ar prefix
Set
.Ar prefix
as the directory in which to delete files from any installed packages
which do not explicitly set theirs.
For most packages, the prefix will
be set automatically to the installed location by
.Xr pkg_add 1 .
d90 11
a100 6
.It Fl c
Delete configuration files and directories, mentioned as
.Cm @@extra
or
.Cm @@sample
in the packing-list.
d103 2
d110 1
a110 1
.Pa /var/db/pkg/<pkg-name> ,
d194 4
@


1.4
log
@Finally implement @@option base-package. This will be used to mark base
packages, which normally cannot be deleted. Documentation update, too.

This commit is actually from thor because connecting to herc does not
work from here. It might be the two bittorrents, though.

ok tg@@
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.3 2005/09/12 22:53:22 tg Exp $
d196 3
a198 1
your system may be susceptible to ``trojan horses'' or other subtle
@


1.3
log
@join tg-ports-devel branch into HEAD
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.1.7.1.2.1 2005/09/11 01:05:43 tg Exp $
d91 2
@


1.2
log
@Documentation update for latest features
@
text
@d1 1
a1 1
.\"	$MirOS$
@


1.1
log
@Initial revision
@
text
@d40 16
a55 7
Package names may be specified either as the package name itself, or as filenames which consist of the package name plus the
.Dq .cgz ,
.Dq .tgz ,
.Dq .tar.gz ,
or the
.Dq .tar
suffix.
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@


1.1.7.1.2.1
log
@merge -rHEAD into development branch

Note for bsiegert@@ please don't use csh prompts in man pages any more
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/delete/pkg_delete.1,v 1.2 2005/08/22 16:44:15 bsiegert Exp $
d40 7
a46 16
Package names may be specified either as the package name with or without
version, as the path of the installation log directory, or as a filename
with suffix.
If a name without version is given and there are multiple versions of the
package installed
.Pq for example, with the autoconf packages ,
.Nm
will fail.
.Pp
For example, the following will work:
.Bd -literal -offset indent
% pkg_delete libpixman-0.1.6-0
% pkg_delete libpixman
% pkg_delete /usr/mpkg/db/pkg/libpixman-0.1.6-0/
% pkg_delete libpixman-0.1.6-0.cgz
.Ed
@

