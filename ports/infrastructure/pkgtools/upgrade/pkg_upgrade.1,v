head	1.11;
access;
symbols
	bsiegert-cfgfile_BASE:1.9
	bsiegert-cfgfile:1.9.0.2;
locks; strict;
comment	@.\" @;


1.11
date	2018.12.25.19.38.04;	author tg;	state Exp;
branches;
next	1.10;
commitid	1005C22871909EC7FE2;

1.10
date	2016.02.11.20.12.05;	author tg;	state Exp;
branches;
next	1.9;
commitid	10056BCEAFF41919B5B;

1.9
date	2009.11.22.18.23.36;	author tg;	state Exp;
branches;
next	1.8;
commitid	1004B0981B210A68B89;

1.8
date	2009.11.22.15.48.48;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004B095D622ECA4D23;

1.7
date	2008.10.12.15.28.48;	author tg;	state Exp;
branches;
next	1.6;
commitid	10048F217AF04EEDFFE;

1.6
date	2007.07.22.19.48.00;	author bsiegert;	state Exp;
branches;
next	1.5;
commitid	10046A3B4774E64DB09;

1.5
date	2006.11.19.22.34.07;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004560DBF46435018A;

1.4
date	2006.08.22.20.50.49;	author bsiegert;	state Exp;
branches;
next	1.3;
commitid	10044EB69D9519BD195;

1.3
date	2006.08.11.22.24.20;	author bsiegert;	state Exp;
branches;
next	1.2;
commitid	10044DD03662D054C80;

1.2
date	2006.08.08.19.07.26;	author tg;	state Exp;
branches;
next	1.1;
commitid	10044D8E0F84280763D;

1.1
date	2006.08.08.18.53.02;	author bsiegert;	state Exp;
branches;
next	;
commitid	10044D8DD8F5020A629;


desc
@@


1.11
log
@update from contrib/samples/portmdoc,v 1.11
@
text
@.\" $MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.10 2016/02/11 20:12:05 tg Exp $
.\"-
.\" Copyright (c) 2006
.\"	Benny Siegert <bsiegert@@gmx.de>
.\"
.\" Licensee is hereby permitted to deal in this work without restric-
.\" tion, including unlimited rights to use, publicly perform, modify,
.\" merge, distribute, sell, give away or sublicence, provided all co-
.\" pyright notices above, these terms and the disclaimer are retained
.\" in all redistributions or reproduced in accompanying documentation
.\" or other materials provided with binary redistributions.
.\"
.\" Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
.\" any kind, expressed or implied, to the maximum extent permitted by
.\" applicable law, but with the warranty of being written without ma-
.\" licious intent or gross negligence; in no event shall licensor, an
.\" author or contributor be held liable for any damage, direct, indi-
.\" rect or other, however caused, arising in any way out of the usage
.\" of this work, even if advised of the possibility of such damage.
.\"-
.\" Copyright (c) 2008, 2009, 2010, 2016, 2018
.\"	mirabilos <m@@mirbsd.org>
.\"-
.\" Try to make GNU groff and AT&T nroff more compatible
.\" * ` generates ‘ in gnroff, so use \`
.\" * ' generates ’ in gnroff, \' generates ´, so use \*(aq
.\" * - generates ‐ in gnroff, \- generates −, so .tr it to -
.\"   thus use - for hyphens and \- for minus signs and option dashes
.\" * ~ is size-reduced and placed atop in groff, so use \*(TI
.\" * ^ is size-reduced and placed atop in groff, so use \*(ha
.\" * \(en does not work in nroff, so use \*(en
.\" * <>| are problematic, so redefine and use \*(Lt\*(Gt\*(Ba
.\" Also make sure to use \& *before* a punctuation char that is to not
.\" be interpreted as punctuation, and especially with two-letter words
.\" but also (after) a period that does not end a sentence (“e.g.\&”).
.\" The section after the "doc" macropackage has been loaded contains
.\" additional code to convene between the UCB mdoc macropackage (and
.\" its variant as BSD mdoc in groff) and the GNU mdoc macropackage.
.\"
.ie \n(.g \{\
.	if \*[.T]ascii .tr \-\N'45'
.	if \*[.T]latin1 .tr \-\N'45'
.	if \*[.T]utf8 .tr \-\N'45'
.	ds <= \[<=]
.	ds >= \[>=]
.	ds Rq \[rq]
.	ds Lq \[lq]
.	ds sL \(aq
.	ds sR \(aq
.	if \*[.T]utf8 .ds sL `
.	if \*[.T]ps .ds sL `
.	if \*[.T]utf8 .ds sR '
.	if \*[.T]ps .ds sR '
.	ds aq \(aq
.	ds TI \(ti
.	ds ha \(ha
.	ds en \(en
.\}
.el \{\
.	ds aq '
.	ds TI ~
.	ds ha ^
.	ds en \(em
.\}
.\"
.\" Implement .Dd with the Mdocdate RCS keyword
.\"
.rn Dd xD
.de Dd
.ie \\$1$Mdocdate: \{\
.	xD \\$2 \\$3, \\$4
.\}
.el .xD \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8
..
.\"
.\" .Dd must come before definition of .Mx, because when called
.\" with -mandoc, it might implement .Mx itself, but we want to
.\" use our own definition. And .Dd must come *first*, always.
.\"
.Dd $Mdocdate: December 25 2018 $
.\"
.\" Check which macro package we use, and do other -mdoc setup.
.\"
.ie \n(.g \{\
.	if \*[.T]utf8 .tr \[la]\*(Lt
.	if \*[.T]utf8 .tr \[ra]\*(Gt
.	ie d volume-ds-1 .ds tT gnu
.	el .ie d doc-volume-ds-1 .ds tT gnp
.	el .ds tT bsd
.\}
.el .ds tT ucb
.\"
.\" Implement .Mx (MirBSD)
.\"
.ie "\*(tT"gnu" \{\
.	eo
.	de Mx
.	nr curr-font \n[.f]
.	nr curr-size \n[.ps]
.	ds str-Mx \f[\n[curr-font]]\s[\n[curr-size]u]
.	ds str-Mx1 \*[Tn-font-size]\%MirBSD\*[str-Mx]
.	if !\n[arg-limit] \
.	if \n[.$] \{\
.	ds macro-name Mx
.	parse-args \$@@
.	\}
.	if (\n[arg-limit] > \n[arg-ptr]) \{\
.	nr arg-ptr +1
.	ie (\n[type\n[arg-ptr]] == 2) \
.	as str-Mx1 \~\*[arg\n[arg-ptr]]
.	el \
.	nr arg-ptr -1
.	\}
.	ds arg\n[arg-ptr] "\*[str-Mx1]
.	nr type\n[arg-ptr] 2
.	ds space\n[arg-ptr] "\*[space]
.	nr num-args (\n[arg-limit] - \n[arg-ptr])
.	nr arg-limit \n[arg-ptr]
.	if \n[num-args] \
.	parse-space-vector
.	print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[Tn-font-size]
.\}
.el .ie "\*(tT"gnp" \{\
.	eo
.	de Mx
.	nr doc-curr-font \n[.f]
.	nr doc-curr-size \n[.ps]
.	ds doc-str-Mx \f[\n[doc-curr-font]]\s[\n[doc-curr-size]u]
.	ds doc-str-Mx1 \*[doc-Tn-font-size]\%MirBSD\*[doc-str-Mx]
.	if !\n[doc-arg-limit] \
.	if \n[.$] \{\
.	ds doc-macro-name Mx
.	doc-parse-args \$@@
.	\}
.	if (\n[doc-arg-limit] > \n[doc-arg-ptr]) \{\
.	nr doc-arg-ptr +1
.	ie (\n[doc-type\n[doc-arg-ptr]] == 2) \
.	as doc-str-Mx1 \~\*[doc-arg\n[doc-arg-ptr]]
.	el \
.	nr doc-arg-ptr -1
.	\}
.	ds doc-arg\n[doc-arg-ptr] "\*[doc-str-Mx1]
.	nr doc-type\n[doc-arg-ptr] 2
.	ds doc-space\n[doc-arg-ptr] "\*[doc-space]
.	nr doc-num-args (\n[doc-arg-limit] - \n[doc-arg-ptr])
.	nr doc-arg-limit \n[doc-arg-ptr]
.	if \n[doc-num-args] \
.	doc-parse-space-vector
.	doc-print-recursive
..
.	ec
.	ds sP \s0
.	ds tN \*[doc-Tn-font-size]
.\}
.el \{\
.	de Mx
.	nr cF \\n(.f
.	nr cZ \\n(.s
.	ds aa \&\f\\n(cF\s\\n(cZ
.	if \\n(aC==0 \{\
.		ie \\n(.$==0 \&MirBSD\\*(aa
.		el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
.	\}
.	if \\n(aC>\\n(aP \{\
.		nr aP \\n(aP+1
.		ie \\n(C\\n(aP==2 \{\
.			as b1 \&MirBSD\ #\&\\*(A\\n(aP\\*(aa
.			ie \\n(aC>\\n(aP \{\
.				nr aP \\n(aP+1
.				nR
.			\}
.			el .aZ
.		\}
.		el \{\
.			as b1 \&MirBSD\\*(aa
.			nR
.		\}
.	\}
..
.\}
.\"-
.Dt PKG_UPGRADE 1
.Os
.Sh NAME
.Nm pkg_upgrade
.Nd upgrade an installed package in-place
.Sh SYNOPSIS
.Nm
.Op Fl afqsv
.Ar pkgname.cgz
.Sh DESCRIPTION
The
.Nm
command is used to upgrade an installed package in-place.
If no other version of the package is installed and
.Fl a
is not given,
.Nm
simply calls
.Xr pkg_add 1 .
Otherwise, the installed package is deleted and the new version is added,
keeping dependencies intact.
.Pp
The following command line options are supported:
.Bl -tag -width indent
.It Fl a
Ignore packages for which no older version is installed
.Pq auto .
.It Fl f
Force upgrading the package:
Also upgrade if the exact same version is already installed, useful if
you rebuilt a package from source.
If a conflicting package other than an older version of the same package
is installed, remove it.
.It Fl q
Don't print less important messages
.Pq quiet .
.It Fl s
Enable special treatment for shared libraries, see below
.Pq shlibs .
.It Fl v
Pass the
.Fl v
flag to subprocesses for more verbose operation.
.El
.Sh SHARED LIBRARY SUPPORT
.Nm
has a special mode for upgrading shared library packages.
Consider the following situation: You have installed a package
.Pa foo
that contains
.Pa libfoo.so.1.0 .
Package
.Pa bar
is also installed and contains a binary that depends on this version
of libfoo.
Now you upgrade the
.Pa foo
package, the new version contains
.Pa libfoo.so.2.0
instead.
The other binary will no longer run.
.Pp
For this reason, systems like Debian split their library packages in
two: the library itself and a
.Qq developer
package containing headers and so on.
Instead,
.Nm
creates a
.Qq stub package
from the installed package.
Basically, the installed package is split in two.
The old libraries are kept as a package named
.Pa stub Ns \- Ns Ar pkgname
while the rest is deleted and replaced by the new version.
.Pp
In the general case, this should work but you may still run into
situations where you will need to rebuild dependent packages from
source.
In any case, you can delete unused stub packages after you have
rebuilt dependent packages.
.Sh SEE ALSO
.Xr pkg_add 1 ,
.Xr pkg_create 1 ,
.Xr pkg_delete 1 ,
.Xr ports 7
.Sh AUTHORS
.Bl -tag -width indent -compact
.An Benny Siegert Aq bsiegert@@mirbsd.org
came up with the idea for
.Nm "" ,
wrote the first version and this manual page.
.An Thorsten Glaser Aq tg@@mirbsd.org
improved option handling and overall robustness.
.El
.Sh BUGS
.Nm
can easily render other packages unusable if you install a new version
of a shared library while the other package still uses the old one.
Use the
.Fl s
switch to prevent this situation.
.Pp
Shared library support needs much work.
@


1.10
log
@merge most recent portmdoc into a̲l̲l̲ of its users; fixup .\& into \&. like
in mksh(1), for Schillix ditroff
@
text
@d1 1
a1 1
.\" $MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.8 2009/11/22 15:48:48 tg Exp $
d21 1
a21 1
.\" Copyright (c) 2008, 2009, 2010, 2016
d80 1
a80 1
.Dd $Mdocdate: November 22 2009 $
d88 1
d101 1
a101 1
.	ds str-Mx1 \*[Tn-font-size]\%MirOS\*[str-Mx]
d127 32
d165 1
a165 1
.		ie \\n(.$==0 \&MirOS\\*(aa
d171 1
a171 1
.			as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
d179 1
a179 1
.			as b1 \&MirOS\\*(aa
@


1.9
log
@fix more manpages
@
text
@d21 3
d32 4
d82 1
a82 1
.\" Check which macro package we use
d85 2
@


1.8
log
@update to contrib/samples/portmdoc,v 1.6
@
text
@d1 1
a1 1
.\" $MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.7 2008/10/12 15:28:48 tg Exp $
d73 1
a73 1
.Dd $Mdocdate: November 17 2009 $
d217 1
a217 1
.Pa stub Ns - Ns Ar pkgname
@


1.7
log
@• pkg_upgrade.1: switch to portmdoc and $Mdocdate
• pkg_upgrade.1: document -s
• all: add -v option
@
text
@d1 1
a1 1
.\" $MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.6 2007/07/22 19:48:00 bsiegert Exp $
d22 3
a24 3
.\" * ` generates ‘ in groff, so use \`
.\" * ' generates ’ in groff, \' generates ´, so use \*(aq
.\" * - generates ‐ in groff, \- generates −, fixed in tmac/mdoc/doc-groff
d29 3
d34 13
d73 9
a81 1
.Dd $Mdocdate: March 14 2008 $
d85 53
a137 14
.de Mx
.nr cF \\n(.f
.nr cZ \\n(.s
.ds aa \&\f\\n(cF\s\\n(cZ
.if \\n(aC==0 \{\
.	ie \\n(.$==0 \&MirOS\\*(aa
.	el .aV \\$1 \\$2 \\$3 \\$4 \\$5 \\$6 \\$7 \\$8 \\$9
.\}
.if \\n(aC>\\n(aP \{\
.	nr aP \\n(aP+1
.	ie \\n(C\\n(aP==2 \{\
.		as b1 \&MirOS\ #\&\\*(A\\n(aP\\*(aa
.		ie \\n(aC>\\n(aP \{\
.			nr aP \\n(aP+1
a139 5
.		el .aZ
.	\}
.	el \{\
.		as b1 \&MirOS\\*(aa
.		nR
d141 1
a142 1
..
@


1.6
log
@Implement handling of @@pkgcfl for packages with @@option
no-default-conflict. Fixes for example the case of "pkg_upgrade
autoconf-2.61-0.cgz".

If -f is given, also remove _other_ conflicting packages. Example: if
foo conflicts with bar and bar is installed, "pkg_upgrade -f foo" will
remove bar first.
@
text
@d1 2
a2 2
.\"	$MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.5 2006/11/19 22:34:07 tg Exp $
.\"
d21 31
d53 33
a85 1
.Dd August 8, 2006
d93 1
a93 1
.Op Fl afq
d125 4
@


1.5
log
@whitespace at EOL sweep
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.4 2006/08/22 20:50:49 bsiegert Exp $
d51 5
a55 3
Also upgrade the package if the exact same version is already installed
.Pq force .
Useful if you rebuilt a package from source.
a122 13
.Pp
.Nm
does not handle the case of multiple non-conflicting package versions,
such as
.Li autoconf\-2.13.20050228\-1
and
.Li autoconf\-2.60\-2 ,
well.
See
.Cm @@option Ar no-default-conflict
in
.Xr pkg_create 1
for details.
@


1.4
log
@Tentatively add Mac OS X support for shared library stubs, using a similar
regexp to the libtoolise_plist stuff
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.2 2006/08/08 19:07:26 tg Exp $
d80 2
a81 2
two: the library itself and a 
.Qq developer 
d83 1
a83 1
Instead, 
@


1.3
log
@Add shared library support from the last patch. Usual caveats apply.
Note that this is only enabled if you use pkg_upgrade -s, not by default.
@
text
@d90 1
a90 1
.Pa stub - Ns Ar pkgname
d123 2
a124 2
does not handle the case of paralelly installed,
non-conflicting packages, such as
d129 5
@


1.2
log
@you're right.
* mdoc improvements
* add another bug
@
text
@d1 1
a1 1
.\"	$MirOS: ports/infrastructure/pkgtools/upgrade/pkg_upgrade.1,v 1.1 2006/08/08 18:53:02 bsiegert Exp $
d57 3
d61 37
d116 5
@


1.1
log
@pkg_upgrade needs a manpage. No, really.
@
text
@d1 1
a1 1
.\"	$MirOS$
d29 1
a29 1
.Nm pkg_upgrade
d65 6
a70 4
.It "Benny Siegert"
idea, first version, this manpage
.It "Thorsten Glaser"
option handling, robustness fixes
d76 8
@

