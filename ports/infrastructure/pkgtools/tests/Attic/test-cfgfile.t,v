head	1.1;
access;
symbols
	bsiegert-cfgfile:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2010.01.01.15.43.14;	author bsiegert;	state dead;
branches
	1.1.2.1;
next	;
commitid	1004B3E180123764EFE;

1.1.2.1
date	2010.01.01.15.43.15;	author bsiegert;	state Exp;
branches;
next	1.1.2.2;
commitid	1004B3E180123764EFE;

1.1.2.2
date	2010.02.27.11.06.07;	author bsiegert;	state Exp;
branches;
next	;
commitid	1004B88FC932807280C;


desc
@@


1.1
log
@file test-cfgfile.t was initially added on branch bsiegert-cfgfile.
@
text
@@


1.1.2.1
log
@Initial prototype of regression tests for pkgtools, using C and perl's
Test::More and Test::Harness (aka prove(1))
@
text
@a0 22
#!/usr/bin/env perl -W

use Test::More tests => 3;
use File::Temp qw( tempfile );


my $PROG = "./test-cfgfile";
my ($fh, $tempfile);

ok( -e $PROG , "Testing program exists");

BAIL_OUT("Testing program does not exist") if (! -e $PROG);

($fh, $tempfile) = tempfile();

print $fh "VAR=value\n";

is( `$PROG $tempfile`, "VAR = value\n", "One variable");

print $fh 'FOO=${VAR}2';

is( `$PROG $tempfile`, "FOO = value2\nVAR = value", "Simple variable expansion");
@


1.1.2.2
log
@11 tests now, yay!
@
text
@d3 1
a3 1
use Test::More tests => 11;
d17 1
d20 1
a20 22
is( `$PROG $tempfile UNDEF_VAR`, "UNDEF_VAR is undefined\n", "Undefined variable");

print $fh "FOO=\${VAR}2\n";
is( `$PROG $tempfile FOO`, "FOO = value2\n", "Simple variable expansion");

print $fh "_\${VAR}=This is a test.\n";
is( `$PROG $tempfile _value`, "_value = This is a test.\n", "Expansion in a variable name");

print $fh "FOO=redefined\n";
is( `$PROG $tempfile FOO`, "FOO = redefined\n", "Redefine a variable, second definition takes precedence");

print $fh "#UNDEF=test\n";
is( `$PROG $tempfile UNDEF`, "UNDEF is undefined\n", "Comments");

print $fh "WS=hello   \n";
is( `$PROG $tempfile WS`, "WS = hello\n", "Trailing whitespace");

print $fh "WS2=hello # world\n";
is( `$PROG $tempfile WS2`, "WS2 = hello\n", "Trailing whitespace before comment start");

print $fh "  WS3=hello\n";
is( `$PROG $tempfile WS3`, "WS3 = hello\n", "Leading whitespace");
d22 1
a22 2
print $fh "\tWS4=hello\t\n";
is( `$PROG $tempfile WS4`, "WS4 = hello\n", "Leading and trailing tab characters");
@


