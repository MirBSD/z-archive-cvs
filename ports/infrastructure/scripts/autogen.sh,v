head	1.14;
access;
symbols;
locks; strict;
comment	@# @;


1.14
date	2009.12.06.13.34.22;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004B1BB2E90B48FEF1;

1.12
date	2009.12.06.13.03.57;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004B1BABD31CF62BB0;

1.11
date	2009.03.29.13.04.07;	author tg;	state Exp;
branches;
next	1.10;
commitid	10049CF71B654F9EF54;

1.10
date	2008.08.16.21.48.59;	author tg;	state Exp;
branches;
next	1.9;
commitid	10048A74B4F2734BBA1;

1.9
date	2008.07.01.11.28.47;	author tg;	state Exp;
branches;
next	1.8;
commitid	100486A14FD1E2985B0;

1.8
date	2008.07.01.11.21.18;	author tg;	state Exp;
branches;
next	1.7;
commitid	100486A133E74719B6B;

1.7
date	2008.05.03.00.58.59;	author tg;	state Exp;
branches;
next	1.6;
commitid	100481BB8DA7A11176D;

1.6
date	2008.05.01.00.52.33;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004819145953F55377;

1.5
date	2006.09.09.14.14.23;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004502CC51153BF11F;

1.4
date	2006.02.05.17.41.11;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043E638C750A2B5F0;

1.3
date	2006.02.05.17.26.51;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043E6357136F1E70D;

1.2
date	2006.02.05.17.22.23;	author tg;	state Exp;
branches;
next	1.1;
commitid	10043E634617D1F8EE7;

1.1
date	2006.02.05.17.16.40;	author tg;	state Exp;
branches;
next	;
commitid	10043E632F42429EBF4;


desc
@@


1.14
log
@new AUTOCONF_FLAGS, AUTOHEADER_FLAGS, ACLOCAL_FLAGS for manual overrides
@
text
@#!/bin/mksh
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.12 2009/12/06 13:03:57 tg Exp $
#-
# Copyright (c) 2004, 2005, 2006, 2008, 2009
#	Thorsten Glaser <tg@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.

if [[ -z $AUTOCONF_VERSION ]]; then
	export AUTOCONF_VERSION=2.13
	print -u2 Warning: AUTOCONF_VERSION unset, using $AUTOCONF_VERSION!
fi

if [[ -z $AUTOMAKE_VERSION ]]; then
	export AUTOMAKE_VERSION=1.9
	print -u2 Warning: AUTOMAKE_VERSION unset, using $AUTOMAKE_VERSION!
fi

if [[ -z $PORTSDIR || ! -d $PORTSDIR/. ]]; then
	manual_mode=1
	PORTSDIR=/usr/ports
else
	manual_mode=0
fi
: ${GNUSYSTEM_AUX_DIR:=$PORTSDIR/infrastructure/db}

export AUTOCONF_VERSION AUTOMAKE_VERSION GNUSYSTEM_AUX_DIR

AM_FLAGS="--miros --ignore-deps"
[[ $AUTOMAKE_VERSION = 1.4 ]] && AM_FLAGS=-i
[[ -n $flags ]] && AM_FLAGS=$flags

todel=
for f in $files ChangeLog ltmain.sh; do
	[[ -e $f ]] && continue
	ln -s /dev/null $f
	todel="$todel $f"
done

for f in libtool.m4 m4salt.inc m4sugar.inc; do
	[[ -e $f ]] || todel="$todel $f"
	[[ -h $f ]] && rm -f $f
	[[ -s $f ]] || ln -sf "$GNUSYSTEM_AUX_DIR/$f" .
done

set -e
set -x
ACLOCAL_AMFLAGS=
[[ -e Makefile.am ]] && ACLOCAL_AMFLAGS=$(grep '^[:space:]*ACLOCAL_AMFLAGS' \
    Makefile.am | cut -d '=' -f 2)
[[ -n $NO_ACLOCAL ]] || aclocal -I . $ACLOCAL_AMFLAGS $ACLOCAL_FLAGS
f=configure.ac
[[ ! -e $f ]] && f=configure.in
[[ -n $NO_AUTOHEADER ]] || if fgrep -q \
    -e AC_CONFIG_HEADER -e AM_CONFIG_HEADER $f; then
	autoheader $AUTOHEADER_FLAGS
fi
set +e
integer rv=0
[[ ! -e Makefile.am ]] || automake --foreign -a $AM_FLAGS || rv=$?
if autoconf $AUTOCONF_FLAGS; then
	chmod 664 configure
else
	(( rv = rv ? rv : 1 ))
fi
(( manual_mode )) || rm -rf autom4te.cache $todel
exit $rv
@


1.12
log
@introduce $NO_ACLOCAL (same as $NO_AUTOHEADER)
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.11 2009/03/29 13:04:07 tg Exp $
d64 1
a64 1
[[ -n $NO_ACLOCAL ]] || aclocal -I . $ACLOCAL_AMFLAGS
d69 1
a69 1
	autoheader
d74 1
a74 1
if autoconf; then
@


1.11
log
@• take care of dbins
• #!/bin/mksh shebang, in most places
• rcsid while here
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.10 2008/08/16 21:48:59 tg Exp $
d4 2
a5 2
# Copyright (c) 2004, 2005, 2006, 2008
#	Thorsten Glaser <tg@@mirbsd.de>
d64 1
a64 1
aclocal -I . $ACLOCAL_AMFLAGS
@


1.10
log
@… but I need to patch here:

fix “bad modifier: )” warnings for automake-1.4 !use_gmake cases
@
text
@d1 2
a2 2
#!/usr/bin/env mksh
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.9 2008/07/01 11:28:47 tg Exp $
@


1.9
log
@if PORTSDIR is not set, assume manual mode and don't nuke temps
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.8 2008/07/01 11:21:18 tg Exp $
d43 1
a43 1
[[ $AUTOMAKE_VERSION = 1.4 ]] && AM_FLAGS=
@


1.8
log
@use sane default for PORTSDIR, for manual callers
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.7 2008/05/03 00:58:59 tg Exp $
d32 6
a37 1
: ${PORTSDIR:=/usr/ports}
d79 1
a79 1
rm -rf autom4te.cache $todel
@


1.7
log
@sort of merge the two autogen scripts
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.6 2008/05/01 00:52:33 tg Exp $
d32 2
a33 1
[[ -n $GNUSYSTEM_AUX_DIR ]] || GNUSYSTEM_AUX_DIR=$PORTSDIR/infrastructure/db
@


1.6
log
@remove the advertising clause from all of my contributions
to the MirPorts Framework
@
text
@d1 2
a2 2
#!/bin/mksh
# $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $
d4 1
a4 1
# Copyright (c) 2004, 2005, 2006
d24 1
a24 1
	print Warning: AUTOCONF_VERSION unset!
d29 1
a29 1
	print Warning: AUTOMAKE_VERSION unset!
d32 8
d41 6
d50 1
a50 1
	[[ -s $f ]] || ln -sf "$(dirname "$0")/$f" .
d56 2
a57 1
[[ -e Makefile.am ]] && ACLOCAL_AMFLAGS=$(grep '^[:space:]*ACLOCAL_AMFLAGS' Makefile.am | cut -d '=' -f 2)
d61 3
a63 2
if fgrep -q -e AC_CONFIG_HEADER -e AM_CONFIG_HEADER $f; then
	[[ -n $NO_AUTOHEADER ]] || autoheader
d66 9
a74 5
[[ ! -e Makefile.am ]] || automake --foreign -i
autoconf && chmod 664 configure
[[ -z $todel ]] || eval rm -f $todel
[[ -e autom4te.cache ]] && rm -rf autom4te.cache
exit 0
@


1.5
log
@add patch to honour m4 subdir, from bsiegert@@
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.4 2006/02/05 17:41:11 tg Exp $
d7 5
a11 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d13 8
a20 12
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a nontrivial bug.
@


1.4
log
@partially revert, doesn't work as it should
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.1 2006/02/05 17:16:40 tg Exp $
d46 3
a48 1
aclocal -I .
@


1.3
log
@+AUTOHEADER_FLAGS
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.2 2006/02/05 17:22:23 tg Exp $
d46 1
a46 1
aclocal -I . $ACLOCAL_FLAGS
d50 1
a50 1
	[[ -n $NO_AUTOHEADER ]] || autoheader $AUTOHEADER_FLAGS
@


1.2
log
@-I . is always needed (libtool.m4)
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/autogen.sh,v 1.1 2006/02/05 17:16:40 tg Exp $
d50 1
a50 1
	[[ -n $NO_AUTOHEADER ]] || autoheader
@


1.1
log
@* move autogen.sh from db/ to scripts/
* add ACLOCAL_FLAGS possibility
* remove in (almost?) all cases the need for no-autoheader
  by checking ourselves
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.6 2006/01/24 22:24:02 tg Rel $
d46 1
a46 1
aclocal ${ACLOCAL_FLAGS:--I .}
@

