head	1.21;
access;
symbols
	MIRBSD_8_BASE:1.9;
locks; strict;
comment	@# @;


1.21
date	2010.10.01.16.24.07;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004CA60B3B1644CEEE;

1.20
date	2010.09.29.19.32.06;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004CA3944849072BA7;

1.19
date	2010.09.29.19.15.02;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004CA390420201C2BF;

1.18
date	2009.03.29.13.04.07;	author tg;	state Exp;
branches;
next	1.17;
commitid	10049CF71B654F9EF54;

1.17
date	2008.11.02.14.49.37;	author tg;	state Exp;
branches;
next	1.16;
commitid	100490DBE0946151EDD;

1.16
date	2008.11.01.23.17.49;	author tg;	state Exp;
branches;
next	1.15;
commitid	100490CE2CB42CA9ACA;

1.15
date	2008.11.01.23.02.20;	author tg;	state Exp;
branches;
next	1.14;
commitid	100490CE00E08A80CEA;

1.14
date	2008.11.01.23.00.55;	author tg;	state Exp;
branches;
next	1.13;
commitid	100490CDFB752863403;

1.13
date	2008.11.01.22.57.23;	author tg;	state Exp;
branches;
next	1.12;
commitid	100490CDECE38054B7B;

1.12
date	2008.05.25.20.49.50;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004839D0D87606697A;

1.11
date	2008.05.01.00.52.33;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004819145953F55377;

1.10
date	2006.11.19.13.17.28;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004560597245D5D90C;

1.9
date	2005.12.18.16.36.43;	author tg;	state Exp;
branches;
next	1.8;
commitid	10043A58BE830AFB807;

1.8
date	2005.12.17.05.46.20;	author tg;	state Exp;
branches;
next	1.7;
commitid	10043A3A3E65E20A413;

1.7
date	2005.12.17.01.12.10;	author tg;	state Exp;
branches;
next	1.6;
commitid	10043A365F67F0823EE;

1.6
date	2005.12.16.11.14.51;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043A2A1A835317767;

1.5
date	2005.12.16.11.09.00;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043A2A05E1EFE1B25;

1.4
date	2005.12.16.11.08.35;	author tg;	state Exp;
branches;
next	1.3;
commitid	10043A2A0443B2573B0;

1.3
date	2005.11.22.15.35.55;	author tg;	state Exp;
branches;
next	1.2;
commitid	50a843833ae42a45;

1.2
date	2005.11.20.11.03.44;	author tg;	state Exp;
branches;
next	1.1;
commitid	1125438057ef43d5;

1.1
date	2005.11.17.22.08.59;	author tg;	state Exp;
branches;
next	;
commitid	7e15437cff561d3c;


desc
@@


1.21
log
@display redirection
@
text
@#!/bin/mksh
# $MirOS: src/share/misc/licence.template,v 1.28 2008/11/14 15:33:44 tg Rel $
#-
# Copyright (c) 2005, 2006, 2008, 2010
#	Thorsten Glaser <tg@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.

: ${TMPDIR:=/tmp}
unset CVSREADONLYFS
integer rv

cpio=
CVS=cvs
while getopts "Cs" ch; do
	case $ch {
	(C)	cpio=-C ;;
	(s)	CVS=svn ;;
	}
done
shift $((OPTIND - 1))

target=$1
repo=$2
tag=
CVSARGS="-qd $repo co -PA"
[[ $CVS = cvs && $repo != :* ]] && export CVSREADONLYFS=1

redirection=
if [[ $CVS = svn ]]; then
	if [[ -n $4 ]]; then
		tag=$4
	else
		tag=${repo##*/}
	fi
	[[ -n $3 ]] && repo=$repo@@$3
	CVSARGS="co --non-interactive -q $repo"
	if [[ $tag = - ]]; then
		CVSARGS='cat'
		bn=${1##*/}
		bn=${bn%.*}
		redirection='>"$bn"'
		tag=$repo
	fi
elif [[ -n $3 && -n $4 ]]; then
	tag="-r$4:$3"
elif [[ -z $3 ]]; then
	tag="-r$4"
else
	tag="-D $3"
fi

export TZ=UTC
if ! T=$(mktemp -d $TMPDIR/mkmcz.XXXXXXXXXX); then
	print -u2 mkmcz: Cannot mktemp
	exit 1
fi
cd $T
print -r -- - "$CVS $CVSARGS $tag $5 $redirection"
if ! ( umask 022; \
    eval 'exec env CVSUMASK=022 $CVS $CVSARGS "$tag" $5' $redirection ); then
	cd /
	rm -rf "$T"
	print -u2 mkmcz: Checkout failed
	exit 1
fi
print -r -- - "mpczar -o '$1' -I /CVS -I /.svn -r . $cpio"
mpczar -o "$1" -I /CVS -I /.svn -r . $cpio
rv=$?
cd /
rm -rf "$T"
(( rv )) && print -u2 mkmcz: Archive creation failed
exit $rv
@


1.20
log
@friendlier to users
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.19 2010/09/29 19:15:02 tg Exp $
d4 2
a5 2
# Copyright (c) 2005, 2006, 2008
#	Thorsten Glaser <tg@@mirbsd.de>
d72 1
a72 1
print -r -- - "$CVS $CVSARGS $tag $5"
@


1.19
log
@facilitate suckwÃ¼rstchen single-file checkouts
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.18 2009/03/29 13:04:07 tg Exp $
d53 3
a55 1
		redirection='>SINGLEFILE'
@


1.18
log
@â€¢ take care of dbins
â€¢ #!/bin/mksh shebang, in most places
â€¢ rcsid while here
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.17 2008/11/02 14:49:37 tg Exp $
d42 1
d51 5
d71 2
a72 1
if ! ( umask 022; exec env CVSUMASK=022 $CVS $CVSARGS "$tag" $5 ); then
@


1.17
log
@allow use of TMPDIR to tell different place for .mcz creation
@
text
@d1 2
a2 2
#!/usr/bin/env mksh
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.16 2008/11/01 23:17:49 tg Exp $
@


1.16
log
@sync whatâ€™s displayed with whatâ€™s actually run (cosmetics)
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.15 2008/11/01 23:02:20 tg Exp $
d22 1
d59 1
a59 1
if ! T=$(mktemp -d /tmp/mkmcz.XXXXXXXXXX); then
d66 1
a66 1
	cd /tmp
d74 1
a74 1
cd /tmp
@


1.15
log
@oeps, do not forget the revision
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.14 2008/11/01 23:00:55 tg Exp $
d70 1
a70 1
print -r -- - "mpczar -o '$1' -I CVS -I .svn -r . $cpio"
@


1.14
log
@convert to builtin getopts
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.13 2008/11/01 22:57:23 tg Exp $
a41 1
	CVSARGS="co --non-interactive -q $repo"
d48 1
@


1.13
log
@implement and document SVN_DISTFILE fetch method (re-using _CVS_DISTF
stuff) after, what, like two years?
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.12 2008/05/25 20:49:50 tg Exp $
d23 11
a34 12
if [[ $1 = -C ]]; then
	cpio=-C
	shift
else
	cpio=
fi
if [[ $1 = -s ]]; then
	CVS=svn
	shift
else
	CVS=cvs
fi
d39 2
a40 1
[[ $repo != :* ]] && export CVSREADONLYFS=1
d75 1
a75 1
[[ $rv = 0 ]] || print -u2 mkmcz: Archive creation failed
@


1.12
log
@â€¢ unset CVSREADONLYFS if itâ€™s set e.g. from /etc/profile
â€¢ set it if the repo URI doesnâ€™t begin with a colon, like others
â€¢ use #!/usr/bin/env mksh while here
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.11 2008/05/01 00:52:33 tg Exp $
d39 8
a46 4
if [[ -n $3 && -n $4 ]]; then
	if [[ $CVS = svn ]]; then
		print -u2 mkmcz: Do not know how to do this
		exit 2
d48 2
a52 2
elif [[ $CVS = svn ]]; then
	[[ -n $3 ]] && tag="-r { $3 }"
a55 6
if [[ $CVS = svn ]]; then
	CVSARGS="co --non-interactive -q $repo"
else
	CVSARGS="-qd $repo co -PA"
	[[ $repo != :* ]] && export CVSREADONLYFS=1
fi
d71 1
a71 1
mpczar -o "$1" -I CVS -I .svn -r . $cpio
@


1.11
log
@remove the advertising clause from all of my contributions
to the MirPorts Framework
@
text
@d1 2
a2 2
#!/bin/mksh
# $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $
d4 1
a4 1
# Copyright (c) 2005, 2006
d22 2
d56 1
@


1.10
log
@update and change distfile to cpio format

agreed bsiegert@@
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.14 2006/08/09 19:35:23 tg Rel $
d7 5
a11 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d13 8
a20 12
# Advertising materials mentioning features or use of this work must
# display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
@


1.9
log
@Part 2 of the big commit:
* www/vbegin.php: don't output the UTF-8 BOM for now
* ports/Setup.sh: change order in which path is divined [1]
* ports/books/mirex: convert to CVS_DISTF
* ports/comms/ssfe: increase line length limit and history buffer size
* ports/infrastructure/install/setup.sh: sync path order with Setup.sh [1]
* ports/infrastructure/mk/bsd.port.mk: (_PORTPATH) sync default PATH [1]
* ports/infrastructure/mk/bsd.port.mk: (_UPGRADE_FLAGS) new, default to -a
* ports/infrastructure/mk/bsd.port.mk: (_upgrade) use it
* ports/infrastructure/mk/bsd.port.mk: (reupgrade) new target, set to -a -f
* ports/infrastructure/scripts/mkmcz: don't use $LOCALBASE, trust in PATH
* ports/infrastructure/mk/bsd.port.mk: (_CVS_FETCH) use _PORTPATH
* ports/infrastructure/pkgtools/create: treat /usr/info same as /usr/man
* ports/infrastructure/pkgtools/upgrade: fix path to temp +REQUIRED_BY
* ports/www/firesomething: break, suggest Opera-Linux/K-Meleon/Safari
* src/Makefile, src/gcc/Makefile.lang: if build GCJ, check if X11 installed
* src/Makefile, src/gnu/usr.bin/perl/Makefile.bsd-wrapper: defer h2ph
  execution to end of build
* src/distrib/lists: sync with pre-h2ph change
* src/etc/services: add openvpn, from IANA
* src/gcc/Makefile.inc, Makefile.lang: fragment out NO_*= stuff
* src/gcc/libjava/Makefile.bsd-wrapper: DEBUGPROGS is gone
* src/gnu/usr.bin/perl/Makefile.bsd-wrapper: flesh out h2ph, fix perms
* src/lib/libc/time/localtime.c: fix undefined extern
* ports/net/sirc/Makefile: automatically insert version into CTCP VERSION
* ports/net/sirc/dist/PROGRAMMING: document capab hooks
* ports/net/sirc/dist/dsircp: several hours of perl hacking with Club-Mate
  - publish $msgchannel, $talkserver [2]
  - support for CAPAB: publish $has_capab, $capab_cmd, $capab_response;
    add "capab" hook in reply
  - support for CAPAB IDENTIFY-MSG: publish $has_identifymsg; new
    $unverified, $unverified_m; enable automatically if present;
    change <...> [...] -...- to «...» [[...]] ¬...¬
  - /describe nick now looks [*] (or [[*]]) instead of *, /me now looks
    # instead of * if identified, to facilitate this conversion
  - fix abuse of U+0060
  - sort /names [2]
  - fix ^B ^_ ^V [2]
  - remove trailing whitespace on outgoing msgs [2]
  - remove trailing whitespace on incoming msgs
  - fix indentation
  - auto-split overlong lines (partially [2])
  - in NOTICE make nick bold too [2]
  - disable DCC since it crashes
  - beautify CTCP TIME replies
  - add ACCEPT command (for ratbox-ircd, e.g. Freeforge)
* ports/net/sirc/pkg/DESCR: summarise new features

[1] all for the sake of bsiegert@@ wanting to not have to souce a
    SetEnv.sh or SetEnv.csh before building in "default MirPorts"
    (i.e. LOCALBASE=/usr/mpkg SYSCONFDIR=/etc BINOWN=root SUDO=sudo)
[2] adapted from http://co.ordinate.org/sirc/
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.8 2005/12/17 05:46:20 tg Exp $
d4 2
a5 2
# Copyright (c) 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d14 2
a15 2
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
d25 1
a25 1
# the possibility of such damage or existence of a nontrivial bug.
d27 6
d74 2
a75 2
print -r -- - "mpczar -o '$1' -I CVS -I .svn -r ."
mpczar -o "$1" -I CVS -I .svn -r .
@


1.8
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.7 2005/12/17 01:12:10 tg Exp $
d68 2
a69 2
print -r -- - "$LOCALBASE/bin/mpczar -o '$1' -I CVS -I .svn -r ."
$LOCALBASE/bin/mpczar -o "$1" -I CVS -I .svn -r .
@


1.7
log
@don't always compress, it might cause trouble
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.6 2005/12/16 11:14:51 tg Exp $
d18 8
a25 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
@


1.6
log
@* make using CVS checkout method for both date and tag possible (tested)
* mkmcz: revert unintended debugging change which broke archive creation
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.5 2005/12/16 11:09:00 tg Exp $
d51 1
a51 1
	CVSARGS="-qz6 -d $repo co -PA"
@


1.5
log
@tag needs no space
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.4 2005/12/16 11:08:35 tg Exp $
d35 7
a41 1
if [[ -z $3 ]]; then
d68 1
a68 1
$LOCALBASE/bin/mpczar -o '$1' -I CVS -I .svn -r .
@


1.4
log
@be loud on CVS commands
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.3 2005/11/22 15:35:55 tg Exp $
d36 1
a36 1
	tag="-r $4"
@


1.3
log
@I got bored so I added the necessary hooks for a svn fetch method
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.2 2005/11/20 11:03:44 tg Exp $
d54 1
d61 2
a62 1
$LOCALBASE/bin/mpczar -o "$1" -I CVS -I .svn -r .
@


1.2
log
@I knew I had forgotten one thing... umask

bsiegert@@ please test whether this
a) works as expected (ought to), e.g. setting umask to 077 then make fetch
b) aborts if cvs(1) fails (should, but I'm not that sure)

I'm not going to do any more ports work till src-HEAD builds again
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/scripts/mkmcz,v 1.1 2005/11/17 22:08:59 tg Exp $
d26 6
d34 1
d37 2
d42 5
d54 1
a54 2
if ! ( umask 022; exec env CVSUMASK=022 \
    cvs -qz6 -d $repo co -PA "$tag" $5 ); then
d60 1
a60 1
$LOCALBASE/bin/mpczar -o "$1" -I CVS -r .
@


1.1
log
@add fetching part for .mcz files, including archive generation and
size checks (XXX ssh might be interactive, or cvs login needed)

ok bsiegert@@
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.2 2005/03/03 19:43:30 tg Rel $
d40 2
a41 1
if ! cvs -qz6 -d $repo co -PA "$tag" $5; then
@

