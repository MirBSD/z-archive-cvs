head	1.14;
access;
symbols;
locks; strict;
comment	@# @;


1.14
date	2005.09.19.19.37.55;	author tg;	state dead;
branches;
next	1.13;
commitid	1352432f13a2bc9f;

1.13
date	2005.09.12.22.53.16;	author tg;	state Exp;
branches;
next	1.12;
commitid	6e6c432606e897b6;

1.12
date	2005.08.21.13.48.30;	author tg;	state Exp;
branches;
next	1.11;
commitid	362e430886426500;

1.11
date	2005.08.21.13.39.35;	author tg;	state Exp;
branches;
next	1.10;
commitid	3cae4308842312f4;

1.10
date	2005.08.20.13.13.15;	author tg;	state Exp;
branches
	1.10.2.1;
next	1.9;
commitid	60843072c5c1551;

1.9
date	2005.05.21.01.07.13;	author tg;	state Exp;
branches;
next	1.8;
commitid	6efa428e89cc2fda;

1.8
date	2005.04.13.21.44.23;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2005.04.13.17.15.13;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2005.04.12.20.35.29;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2005.04.12.19.31.37;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.12.19.02.18;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.04.12.18.14.52;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.04.12.18.12.06;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.18.15.47.16;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.47.16;	author tg;	state Exp;
branches;
next	;

1.10.2.1
date	2005.09.11.01.05.40;	author tg;	state Exp;
branches;
next	;
commitid	2f08432382e315cf;


desc
@@


1.14
log
@new mirmake -> Darwin support
@
text
@#!/bin/bash
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.13 2005/09/12 22:53:16 tg Exp $
#-
# Copyright (c) 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
#
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
#
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
#-
# Retrieve prerequisites for running MirPorts on Mac OSX

# DO NOT UNCOMMENT
#testing=1

export PATH=/bin:/sbin:/usr/bin:/usr/sbin

bd=$(cd $(dirname $0); pwd)
td=$(cd $bd/../..; pwd)

#target=${1:-/usr/mpkg}
mirror=$1 # will be $2
binown=$(echo "${2:-root:bin}" | sed 's/:.*$//') # will be $3
bingrp=$(echo "${2:-root:bin}" | sed 's/^.*://') # will be $3
[ -z $mirror ] && mirror=http://mirbsd.mirsolutions.de/MirOS/dist/

mksh=mir/mksh/mksh-R24b.cpio.gz
make=mir/make/mirmake-20050820.cpio.gz
mtar=mir/cpio/paxmirabilis-20050413.cpio.gz

T=$(mktemp -d /tmp/mirports.XXXXXXXXXX) || { echo Cannot generate temp dir; \
    exit 1; }

echo "===> building in $T"

cd $T
case "$mirror" in
/*)	# file
	echo cp $mirror/$mksh .
	cp $mirror/$mksh .
	echo cp $mirror/$make .
	cp $mirror/$make .
	echo cp $mirror/$mtar .
	cp $mirror/$mtar .
	;;
*)	# http
	echo ftp $mirror$mksh
	ftp $mirror$mksh
	echo ftp $mirror$make
	ftp $mirror$make
	echo ftp $mirror$mtar
	ftp $mirror$mtar
	;;
esac
mksh=$(basename $mksh)	#XXX better way?
make=$(basename $make)
mtar=$(basename $mtar)
echo 'checking MD5 sums... (tell Apple to make RMD160 part of the base OS!)'
md5 $mksh >s
md5 $make >>s
md5 $mtar >>s
echo "MD5 ($mksh) = 48d0df73eba1ef4e9c0758f69262eb66" >t
echo "MD5 ($make) = 40bebd7e2192cf7cebebf168e2dea9d2" >>t
echo "MD5 ($mtar) = 8f48631579a700b5328025c7dbc7ac7d" >>t

if ! cmp -s s t; then
	echo Checksum failure!
	diff -u12 t s | fgrep MD5
	if [ x"$testing" != x"1" ]; then
		cd $td
		rm -rf $T
		exit 1
	else
		echo WARNING: testing engaged!
	fi
fi


export CC="${CC:-gcc}"
export CFLAGS="${CFLAGS:--O2 -fno-strength-reduce -fno-strict-aliasing}"

set -e # XXX should set up a trap, but...
set -x

gzip -dc $mksh | cpio -id
cd mksh
SHELL=/bin/bash bash ./Build.sh -d -r
install -c -s -o $binown -g $bingrp -m 555 mksh /bin/mksh
install -c -o $binown -g $bingrp -m 444 mksh.1 /usr/share/man/man1/mksh.1
if ! fgrep /bin/mksh /etc/shells >/dev/null 2>&1; then
	echo /bin/mksh >>/etc/shells
fi
cd ..
rm -rf mksh

gzip -dc $make | cpio -id
cd mirmake
SHELL=/bin/mksh /bin/mksh ./Build.sh \
    Darwin /usr/mpkg man/man mmake \
    "" "" Darwin \
    /bin/mksh $binown:$bingrp
/bin/mksh ./Install.sh
cd ..
export PATH=/usr/mpkg/bin:$PATH
rm -rf mirmake

gzip -dc $mtar | cpio -id
cd pax
SHELL=/bin/mksh mmake obj
SHELL=/bin/mksh mmake depend
SHELL=/bin/mksh mmake
mkdir -p /usr/mpkg/bin /usr/mpkg/man/cat1
SHELL=/bin/mksh mmake install BINDIR=/usr/mpkg/bin MANDIR=/usr/mpkg/man/cat
cd ..
rm -rf pax

cd $td
rm -rf $T
mmake setup SHELL=/bin/mksh
@


1.13
log
@join tg-ports-devel branch into HEAD
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.10.2.1 2005/09/11 01:05:40 tg Exp $
@


1.12
log
@oops
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.11 2005/08/21 13:39:35 tg Exp $
@


1.11
log
@mksh R24b (untested), req'd by bsiegert@@
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.10 2005/08/20 13:13:15 tg Exp $
d42 1
a42 1
mksh=mir/mksh/mksh-R24.cpio.gz
@


1.10
log
@plug new mirmake, required by bsiegert@@
plug new mksh, required by new mirmake

XXX untested, only the checksums and build mechanism fit
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.9 2005/05/21 01:07:13 tg Exp $
d40 1
a40 1
[ -z $mirror ] && mirror=http://mirbsd.mirsolutions.de/MirOS/distfiles/
d42 3
a44 3
mksh=mksh-R24.cpio.gz
make=mirmake-20050820.cpio.gz
mtar=paxmirabilis-20050413.cpio.gz
d70 3
d77 1
a77 1
echo "MD5 ($mksh) = e9156dcd8236f2f6210bd3758f08fefb" >t
@


1.10.2.1
log
@merge -rHEAD into development branch

Note for bsiegert@@ please don't use csh prompts in man pages any more
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.12 2005/08/21 13:48:30 tg Exp $
d40 1
a40 1
[ -z $mirror ] && mirror=http://mirbsd.mirsolutions.de/MirOS/dist/
d42 3
a44 3
mksh=mir/mksh/mksh-R24b.cpio.gz
make=mir/make/mirmake-20050820.cpio.gz
mtar=mir/cpio/paxmirabilis-20050413.cpio.gz
a69 3
mksh=$(basename $mksh)	#XXX better way?
make=$(basename $make)
mtar=$(basename $mtar)
d74 1
a74 1
echo "MD5 ($mksh) = 48d0df73eba1ef4e9c0758f69262eb66" >t
@


1.9
log
@new mirmake version, now mandatory for Darwin too
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.8 2005/04/13 21:44:23 tg Exp $
d42 2
a43 2
mksh=mirbsdksh-R20.cpio.gz
make=mirmake-20050521.cpio.gz
d74 2
a75 2
echo "MD5 ($mksh) = 2267876639a682dd8d43f28aa697241c" >t
echo "MD5 ($make) = 436949ce3f3163e5cb6cbf41a84cdb10" >>t
d98 2
a99 2
cd ksh
SHELL=/bin/bash WEIRD_OS=1 bash ./Build.sh
d106 1
a106 1
rm -rf ksh
@


1.8
log
@update on Darwin, too
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.7 2005/04/13 17:15:13 tg Exp $
d43 1
a43 1
make=mirmake-20050413.cpio.gz
d75 1
a75 1
echo "MD5 ($make) = 22c5710bc85a92837efb16251021bae3" >>t
@


1.7
log
@cry out which temp dir we're using, since we don't
clean it up on error
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.6 2005/04/12 20:35:29 tg Exp $
d43 2
a44 2
make=mirmake-20050412.cpio.gz
mtar=paxmirabilis-20050228.cpio.gz
d75 2
a76 2
echo "MD5 ($make) = 5b98026d54cb9bb6018a48426543d939" >>t
echo "MD5 ($mtar) = e7169bcb482f3d3be30848a5d9993f3e" >>t
@


1.6
log
@latest MirMake, sorry, you do need it
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.5 2005/04/12 19:31:37 tg Exp $
d49 2
@


1.5
log
@fix darwin, update to latest MirMake and remove a debugging printf
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.4 2005/04/12 19:02:18 tg Exp $
d73 1
a73 1
echo "MD5 ($make) = 04040c694825e522f24de029997b3e3a" >>t
@


1.4
log
@* fix determination of top dir
* md5 diff shouldbe reallyis
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.3 2005/04/12 18:14:52 tg Exp $
d29 1
a29 1
testing=1
d73 1
a73 1
echo "MD5 ($make) = afa2c57333a8d8d1226fb0d20d81a899" >>t
@


1.3
log
@experimental MirMake update, not yet done
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.2 2005/04/12 18:12:06 tg Exp $
d34 1
a34 1
td=$(cd $bd/../../..; pwd)
d73 1
a73 1
echo "MD5 ($make) = 8f09cb31652a23207b4f4fa4cf26a2b0" >>t
d78 1
a78 1
	diff -u12 s t | fgrep MD5
@


1.2
log
@some debugging, from Interix port
@
text
@d2 1
a2 1
# $MirOS: ports/infrastructure/install/Setup-Darwin.sh,v 1.1.7.1 2005/03/18 15:47:16 tg Exp $
d29 1
a29 1
#testing=1
d43 1
a43 1
make=mirmake-20050228.cpio.gz
d83 2
d88 1
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $MirOS: src/share/misc/licence.template,v 1.1 2005/02/11 14:23:55 tg Rel $
d28 3
d79 5
a83 3
	cd $td
	rm -rf $T
	exit 1
d86 3
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
