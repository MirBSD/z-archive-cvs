head	1.11;
access;
symbols
	MIRBSD_8_BASE:1.6;
locks; strict;
comment	@# @;


1.11
date	2009.08.16.16.27.09;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004A882F1F72B43308;

1.10
date	2008.10.04.18.37.32;	author tg;	state Exp;
branches;
next	1.9;
commitid	10048E7B76F1F1670BC;

1.9
date	2007.01.29.01.26.11;	author tg;	state Exp;
branches;
next	1.8;
commitid	10045BD4D401A768AD3;

1.8
date	2006.12.30.22.07.58;	author tg;	state Exp;
branches;
next	1.7;
commitid	1004596E351305E056F;

1.7
date	2006.12.30.22.05.48;	author tg;	state Exp;
branches;
next	1.6;
commitid	1004596E2CF710DA0E1;

1.6
date	2005.12.15.01.24.43;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043A0C5D7068BC1DF;

1.5
date	2005.10.16.11.01.25;	author bsiegert;	state Exp;
branches;
next	1.4;
commitid	211b435232d6a5df;

1.4
date	2005.09.12.22.53.19;	author tg;	state Exp;
branches;
next	1.3;
commitid	6e6c432606e897b6;

1.3
date	2005.08.20.12.33.54;	author tg;	state Exp;
branches
	1.3.2.1;
next	1.2;
commitid	1bdf4307228d6819;

1.2
date	2005.04.28.20.53.02;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.3.2.1
date	2005.09.01.22.54.22;	author tg;	state Exp;
branches;
next	;
commitid	456b431786a69847;

1.1.7.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches;
next	;


desc
@@


1.11
log
@change
â€¢ _PASS_CC back from ã€Œmpccã€ to ã€Œ${WRKDIR}/bin/mpccã€ (note that the
  former ã€Œ${WRKDIR:Q}/bin/mpccã€ was wrong)
â€¢ all uses of _PASS_CC to either
  â€£ ${_PASS_CC:T:Q} (when passing, e.g. for libtool â€“ this is for use
    when ${WRKDIR}/bin is in $$PATH)
  â€£ ${_PASS_CC:Q} (when invoking, e.g. in post-build targets â€“ only
    these I saw when mechanically doing this; Benny wants to fix the
    remaining ones; I shouldâ€™ve introduced no more breakage than was)
â€¢ _PASS_CXX/mpcxx just the same

agreed bsiegert@@
@
text
@# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.10 2008/10/04 18:37:32 tg Exp $
# $OpenBSD: imake.port.mk,v 1.3 2003/07/28 17:17:05 sturm Exp $

# XXX
#PREFIX=/usr/local

.if empty(CONFIGURE_STYLE:L:Mnoman)
INSTALL_TARGET+=	install.man
.endif

XMKMF?=			xmkmf -a
XMKMF+=			-DPorts
EXTRA_XAKE_FLAGS+=	CC=${_PASS_CC:T:Q} COPTS=${COPTS:Q} CPPFLAGS=${CPPFLAGS:Q}

.if ${USE_X11:L} != "yes"
IGNORE=			"uses imake, but USE_X11 not set"
.endif

.if !exists(${X11BASE})
IGNORE=			"uses imake, but ${X11BASE} not found"
.endif

MODIMAKE_configure= \
	if [ -e ${X11BASE}/lib/X11/config/ports.cf ] || \
		fgrep >/dev/null 2>/dev/null Ports \
			${X11BASE}/lib/X11/config/OpenBSD.cf; then \
		cd ${WRKSRC} && ${_SYSTRACE_CMD} ${SETENV} ${MAKE_ENV} ${XMKMF}; \
	else \
		echo >&2 "Error: your X installation is not recent enough"; \
		echo >&2 "Update to a more recent version, or use a ports tree"; \
		echo >&2 "that predates March 18, 2000"; \
		exit 1; \
	fi

# Kludge
.if ${CONFIGURE_STYLE:Mimake}
MODIMAKE_pre_install= \
	${SUDO} mkdir -p /usr/local/lib/X11; \
	if [ ! -e /usr/local/lib/X11/app-defaults ]; then \
		${SUDO} ln -sf /etc/X11/app-defaults /usr/local/lib/X11/app-defaults; \
	fi
.endif
@


1.10
log
@fix the ccache thing as discusses:
we now always use
_PASS_CC=	/usr/ports/security/pgp+/w-pgp-2.6.3in-3/bin/mpcc
_PASS_CXX=	/usr/ports/security/pgp+/w-pgp-2.6.3in-3/bin/mpcxx
for compilation; the new _ORIG_CC and _ORIG_CXX are saved (_ORIG_CXX is
even not set to false) and used for Darwin spec file generation (Benny,
please test if this works); Systrace doesnâ€™t bitch; and we now have two
_USE_CC and _USE_CXX variables wich contain what is actually written in
the mpcc and mpcxx files. All six of these are internal, but a Makefile
shouldâ„¢ use _PASS_CC and _PASS_CXX ipv CC and CXX, so that things still
will work when the user overrides CC via the command line (but it works
if he doesnâ€™t already)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.9 2007/01/29 01:26:11 tg Exp $
d13 1
a13 1
EXTRA_XAKE_FLAGS+=	CC=${_PASS_CC:Q} COPTS=${COPTS:Q} CPPFLAGS=${CPPFLAGS:Q}
@


1.9
log
@prevent the likely error of image w/o USE_X11
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.8 2006/12/30 22:07:58 tg Exp $
d13 1
a13 1
EXTRA_XAKE_FLAGS+=	CC=${CC:Q} COPTS=${COPTS:Q} CPPFLAGS=${CPPFLAGS:Q}
@


1.8
log
@ok, can't be done here...
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.7 2006/12/30 22:05:48 tg Exp $
d15 4
@


1.7
log
@imake obviously uses X11
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.6 2005/12/15 01:24:43 tg Exp $
a10 1
USE_X11=		Yes
@


1.6
log
@* use ${FOO:Q} i.p.v. '${FOO}' or "${FOO}"
* replace v='' and v="" with v= while here
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.5 2005/10/16 11:01:25 bsiegert Exp $
d11 1
@


1.5
log
@Why does this set PREFIX=/usr/local? Comment out the line for now. This
works for me with plan9/w9wm.
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.4 2005/09/12 22:53:19 tg Exp $
d13 1
a13 1
EXTRA_XAKE_FLAGS+=	CC="${CC}" COPTS="${COPTS}" CPPFLAGS="${CPPFLAGS}"
@


1.4
log
@join tg-ports-devel branch into HEAD
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.3.2.1 2005/09/01 22:54:22 tg Exp $
d5 1
a5 1
PREFIX=/usr/local
@


1.3
log
@half-hearted attempt to unify LOCALBASE to /usr/mpkg for all platforms
agreed some time ago bsiegert@@
no veto on miros-discuss@@

for now, hardcode PREFIX to /usr/local for imake and old-install ports
(we should probably do something about imake anyway, regarding both
Interix and Darwin - maybe require our own XFree86® port, but later...)

some of the code (especially shell and make) will be rewritten now,
since it can be simplified (nuking bugs, maybe)

what about changing /etc/mk.conf as well (conflict with obsd and maybe
others)? I think of /etc/${MAKE}.cfg (MAKE=make or mmake) maybe?

please test, as usual...
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.2 2005/04/28 20:53:02 tg Exp $
a2 1
# Based on bsd.port.mk, originally by Jordan K. Hubbard.
@


1.3.2.1
log
@shrink some stuff; optimise; remove useless comments
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.3 2005/08/20 12:33:54 tg Exp $
d3 1
@


1.2
log
@unbreak imake ports on MirOS-current
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/imake.port.mk,v 1.1.7.1 2005/03/18 15:47:19 tg Exp $
d5 3
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $MirOS$
d11 1
a11 4
.if ${NO_CXX:L} == "No"
XMKMF+=			-DPortsWithCXX
.endif
MAKE_ENV+=		"COPTS=${CFLAGS}"
d14 1
a14 1
IGNORE="uses imake, but ${X11BASE} not found"
d28 1
d30 1
a30 1
.  if ${CONFIGURE_STYLE:Mimake}
d36 1
a36 1
.  endif
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
