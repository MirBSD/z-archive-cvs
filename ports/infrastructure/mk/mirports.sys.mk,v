head	1.63;
access;
symbols
	MIRBSD_8_BASE:1.27;
locks; strict;
comment	@# @;


1.63
date	2018.07.15.13.41.21;	author tg;	state Exp;
branches;
next	1.62;
commitid	1005B4B4F0B4ECDB6D4;

1.62
date	2015.10.13.17.27.47;	author tg;	state Exp;
branches;
next	1.61;
commitid	100561D3F205891FD1E;

1.61
date	2014.11.26.19.29.28;	author tg;	state Exp;
branches;
next	1.60;
commitid	10054762A213E06B080;

1.60
date	2014.05.29.18.40.47;	author tg;	state Exp;
branches;
next	1.59;
commitid	10053877F337DFCFA47;

1.59
date	2014.04.02.17.02.30;	author tg;	state Exp;
branches;
next	1.58;
commitid	100533C42BF7E7A7972;

1.58
date	2012.10.18.16.41.27;	author tg;	state Exp;
branches;
next	1.57;
commitid	1005080313B0D9D852C;

1.57
date	2012.08.04.18.13.20;	author tg;	state Exp;
branches;
next	1.56;
commitid	100501D662F4B51A414;

1.56
date	2009.12.28.14.55.13;	author tg;	state Exp;
branches;
next	1.55;
commitid	1004B38C6D25E238175;

1.55
date	2009.12.04.22.55.02;	author tg;	state Exp;
branches;
next	1.54;
commitid	1004B19935B041F22C9;

1.54
date	2008.12.10.18.40.13;	author tg;	state Exp;
branches;
next	1.53;
commitid	10049400D213BD80DD4;

1.53
date	2008.10.13.21.22.54;	author tg;	state Exp;
branches;
next	1.52;
commitid	10048F3BC211DF83D9D;

1.52
date	2008.10.05.16.10.05;	author tg;	state Exp;
branches;
next	1.51;
commitid	10048E8E6E26536FCB9;

1.51
date	2008.05.03.18.58.38;	author tg;	state Exp;
branches;
next	1.50;
commitid	100481CB5DE6F76D4A0;

1.50
date	2008.05.01.00.52.32;	author tg;	state Exp;
branches;
next	1.49;
commitid	1004819145953F55377;

1.49
date	2008.03.14.20.19.43;	author tg;	state Exp;
branches;
next	1.48;
commitid	10047DADDAB252C4C44;

1.48
date	2008.03.14.15.33.53;	author tg;	state Exp;
branches;
next	1.47;
commitid	10047DA9AE621D7BEB1;

1.47
date	2008.03.14.15.25.22;	author tg;	state Exp;
branches;
next	1.46;
commitid	10047DA98D049E42B58;

1.46
date	2008.03.12.23.44.57;	author tg;	state Exp;
branches;
next	1.45;
commitid	10047D86B017C3DDEB7;

1.45
date	2008.03.12.23.43.12;	author tg;	state Exp;
branches;
next	1.44;
commitid	10047D86A9C2D04FA59;

1.44
date	2008.03.09.17.22.56;	author tg;	state Exp;
branches;
next	1.43;
commitid	10047D41CAA7E715397;

1.43
date	2007.03.22.01.27.11;	author tg;	state Exp;
branches;
next	1.42;
commitid	1004601DB8055CAC4CD;

1.42
date	2006.12.29.01.14.04;	author tg;	state Exp;
branches;
next	1.41;
commitid	10045946BE37287563F;

1.41
date	2006.12.28.03.34.27;	author tg;	state Exp;
branches;
next	1.40;
commitid	10045933B52267F74D7;

1.40
date	2006.12.21.20.38.39;	author tg;	state Exp;
branches;
next	1.39;
commitid	100458AEF8418AF8817;

1.39
date	2006.10.17.21.15.42;	author tg;	state Exp;
branches;
next	1.38;
commitid	100453547F255F4DEE4;

1.38
date	2006.10.13.17.09.19;	author tg;	state Exp;
branches;
next	1.37;
commitid	100452FC7FA2E1D2241;

1.37
date	2006.09.24.17.32.58;	author tg;	state Exp;
branches;
next	1.36;
commitid	1004516C1327FCA4BF5;

1.36
date	2006.09.22.00.09.19;	author tg;	state Exp;
branches;
next	1.35;
commitid	100451329B522B433AB;

1.35
date	2006.09.20.22.24.49;	author tg;	state Exp;
branches;
next	1.34;
commitid	1004511BFAD3427E1F6;

1.34
date	2006.08.16.19.51.15;	author tg;	state Exp;
branches;
next	1.33;
commitid	10044E377364156F55A;

1.33
date	2006.08.10.16.45.48;	author tg;	state Exp;
branches;
next	1.32;
commitid	10044DB62C55FC3E97F;

1.32
date	2006.07.23.17.42.35;	author tg;	state Exp;
branches;
next	1.31;
commitid	10044C3B4364E1E1D4A;

1.31
date	2006.05.27.22.32.24;	author tg;	state Exp;
branches;
next	1.30;
commitid	1004478D3855530EB58;

1.30
date	2006.05.27.21.12.26;	author tg;	state Exp;
branches;
next	1.29;
commitid	1004478BEDC7A380466;

1.29
date	2006.02.01.15.42.15;	author tg;	state Exp;
branches;
next	1.28;
commitid	10043E0D60F1A22E1E1;

1.28
date	2006.01.10.20.58.21;	author tg;	state Exp;
branches;
next	1.27;
commitid	10043C41FCB14E41393;

1.27
date	2005.12.17.05.46.19;	author tg;	state Exp;
branches;
next	1.26;
commitid	10043A3A3E65E20A413;

1.26
date	2005.12.16.22.04.17;	author tg;	state Exp;
branches;
next	1.25;
commitid	10043A339F018DB22F3;

1.25
date	2005.12.15.01.24.43;	author tg;	state Exp;
branches;
next	1.24;
commitid	10043A0C5D7068BC1DF;

1.24
date	2005.11.19.12.54.26;	author tg;	state Exp;
branches;
next	1.23;
commitid	4064437f20740661;

1.23
date	2005.11.11.00.02.13;	author tg;	state Exp;
branches;
next	1.22;
commitid	7e154373df9bcd48;

1.22
date	2005.11.11.00.00.45;	author tg;	state Exp;
branches;
next	1.21;
commitid	17064373df2eb4d9;

1.21
date	2005.11.10.23.45.07;	author tg;	state Exp;
branches;
next	1.20;
commitid	6cc44373db822a63;

1.20
date	2005.11.10.22.20.47;	author tg;	state Exp;
branches;
next	1.19;
commitid	49d84373c7025ee2;

1.19
date	2005.11.10.20.38.11;	author tg;	state Exp;
branches;
next	1.18;
commitid	7fa04373af2a07ff;

1.18
date	2005.11.07.20.34.03;	author tg;	state Exp;
branches;
next	1.17;
commitid	1e20436fba3a089d;

1.17
date	2005.10.13.22.04.12;	author tg;	state Exp;
branches;
next	1.16;
commitid	63b0434ed9ed17de;

1.16
date	2005.09.22.20.27.47;	author bsiegert;	state Exp;
branches;
next	1.15;
commitid	53c0433313ce82b8;

1.15
date	2005.09.20.19.50.25;	author tg;	state Exp;
branches;
next	1.14;
commitid	199a43306807bc09;

1.14
date	2005.09.13.11.21.35;	author tg;	state Exp;
branches;
next	1.13;
commitid	3e0e4326b64b3a9c;

1.13
date	2005.09.13.11.18.52;	author tg;	state Exp;
branches;
next	1.12;
commitid	130b4326b5a3c266;

1.12
date	2005.09.12.22.53.19;	author tg;	state Exp;
branches;
next	1.11;
commitid	6e6c432606e897b6;

1.11
date	2005.08.21.11.49.02;	author tg;	state Exp;
branches;
next	1.10;
commitid	3af74308676450c3;

1.10
date	2005.08.20.12.33.54;	author tg;	state Exp;
branches
	1.10.2.1;
next	1.9;
commitid	1bdf4307228d6819;

1.9
date	2005.07.05.20.08.30;	author tg;	state Exp;
branches;
next	1.8;
commitid	6fe042cae8bb6f4d;

1.8
date	2005.07.05.18.50.21;	author tg;	state Exp;
branches;
next	1.7;
commitid	45ea42cad66ff1b2;

1.7
date	2005.06.17.20.09.15;	author tg;	state Exp;
branches;
next	1.6;
commitid	7c8b42b32e00699f;

1.6
date	2005.05.30.16.47.10;	author tg;	state Exp;
branches;
next	1.5;
commitid	4fc6429b436d42cb;

1.5
date	2005.04.11.14.52.48;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.10.21.50.06;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2005.04.10.20.56.06;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.19.11.51.38;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.10.2.1
date	2005.08.21.11.08.28;	author tg;	state Exp;
branches;
next	1.10.2.2;
commitid	31c743085fec9b02;

1.10.2.2
date	2005.08.21.12.32.56;	author tg;	state Exp;
branches;
next	1.10.2.3;
commitid	498643087480723e;

1.10.2.3
date	2005.08.21.12.41.20;	author tg;	state Exp;
branches;
next	1.10.2.4;
commitid	384e4308767e9c73;

1.10.2.4
date	2005.08.21.12.47.09;	author tg;	state Exp;
branches;
next	1.10.2.5;
commitid	4072430877da806f;

1.10.2.5
date	2005.09.01.21.08.32;	author tg;	state Exp;
branches;
next	1.10.2.6;
commitid	13a843176de2be58;

1.10.2.6
date	2005.09.01.22.15.26;	author tg;	state Exp;
branches;
next	1.10.2.7;
commitid	786f43177d7275c0;

1.10.2.7
date	2005.09.01.22.31.01;	author tg;	state Exp;
branches;
next	1.10.2.8;
commitid	42a4431781060721;

1.10.2.8
date	2005.09.01.22.45.02;	author tg;	state Exp;
branches;
next	1.10.2.9;
commitid	2cc943178439e36e;

1.10.2.9
date	2005.09.01.22.58.45;	author tg;	state Exp;
branches;
next	1.10.2.10;
commitid	571e431787b5f652;

1.10.2.10
date	2005.09.01.23.31.44;	author tg;	state Exp;
branches;
next	1.10.2.11;
commitid	51de43178f6f1bff;

1.10.2.11
date	2005.09.11.01.05.42;	author tg;	state Exp;
branches;
next	1.10.2.12;
commitid	2f08432382e315cf;

1.10.2.12
date	2005.09.11.02.12.21;	author tg;	state Exp;
branches;
next	1.10.2.13;
commitid	6a743239294d866;

1.10.2.13
date	2005.09.12.22.10.44;	author tg;	state Exp;
branches;
next	1.10.2.14;
commitid	33164325fcec88b0;

1.10.2.14
date	2005.09.12.22.13.48;	author tg;	state Exp;
branches;
next	1.10.2.15;
commitid	8c94325fdad7150;

1.10.2.15
date	2005.09.12.22.50.54;	author tg;	state Exp;
branches;
next	;
commitid	66a5432606614e95;

1.1.7.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches;
next	;


desc
@@


1.63
log
@further limit the amount of mailto links we‚Äôre giving out
@
text
@# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.62 2015/10/13 17:27:47 tg Exp $
#-
# Copyright (c) 2005, 2006, 2008, 2012, 2014, 2015
#	mirabilos <m@@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided "AS IS" and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person's immediate fault when using the work as intended.

.ifndef	MIRPORTS_SYS_MK

__MAKEFLAGS_HACKERY?=	Yes

# Basic defaults.
.if !defined(OSNAME) || empty(OSNAME)
OSNAME!=		uname -s
.  if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=		${.MAKEFLAGS} OSNAME=${OSNAME:Q}
.  endif
.endif
.if !defined(OSname) || empty(OSname)
OSname=			${OSNAME:L}
.  if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=		${.MAKEFLAGS} OSname=${OSname:Q}
.  endif
.endif

# Determine version number. OSREV is uname -r, OSver is major.minor
.if !defined(OSver) || !defined(OSREV)
.  if ${OStype} == "MirBSD"
OSver!=	print '.include "/usr/share/mk/sys.mk"\nall:\n.ifdef OSrelm\n\t@@echo' \
	    '$${OSrel}.$${OSrelm}\n.else\n\t@@echo $${OSrev}.$${OSrpl}\n.endif' \
	    | env -i "PATH=$$PATH" ${MAKE} -rf - all
# fake 'uname -r' for speed
OSREV=	${OSver:R}
.  elif ${OStype} == "MidnightBSD"
OSver!=	uname -r | sed 's/^\([0-9]*\)\.\([0-9]*\)[^0-9]*.*$$/\1.\2/'
OSREV=	${OSver}
.  elif ${OStype} == "OpenBSD"
OSver!=	print '.include "/usr/share/mk/sys.mk"\nall:\n\t@@echo $${OSREV}' \
	    | env -i "PATH=$$PATH" ${MAKE} -rf - all
# fake 'uname -r' for speed
OSREV=	${OSver}
.  elif ${OStype} == "Interix"
.    error Fill in later!
.  elif ${OStype} == "Darwin"
OSREV!=	uname -r
OSver=	${OSREV:C/^([0-9]*\.[0-9]*)\..*$/\1/}
.  else
.    error Unknown OStype '${OStype}'!
.  endif
.  if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=	${.MAKEFLAGS} OSver=${OSver:Q} OSREV=${OSREV:Q}
.  endif
.endif
.ifndef OSrev
OSrev=		${OSREV:S/.//}
.  if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=	${.MAKEFLAGS} OSrev=${OSrev:Q}
.  endif
.endif

#--- Check for ulimit

.ifndef _VMEM_UNLOCK_CMDS
#XXX more?
.  for _i in -d -m -v
_VMEM_UNLOCK_CMDS_t${_i}!=ulimit ${_i} >/dev/null 2>&1; echo $$?
.    if ${_VMEM_UNLOCK_CMDS_t${_i}} == 0
_VMEM_UNLOCK_CMDS_h${_i}!=ulimit -H ${_i}
_VMEM_UNLOCK_CMDS+=	ulimit ${_i} ${_VMEM_UNLOCK_CMDS_h${_i}};
.    endif
.  endfor
.  if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=		${.MAKEFLAGS} _VMEM_UNLOCK_CMDS=${_VMEM_UNLOCK_CMDS:Q}
.  endif
.endif

#--- Specific OS Dependencies

.if ${OStype} == "Darwin"
CPPFLAGS+=		-D__unix__=1
LDFLAGS+=		-specs=${LOCALBASE}/db/specs.${_ORIG_CC:S!/!_!g}
NOPIC=			No	# XXX
LDCONFIG=
HAS_CKSUM?=		md
NO_SYSTRACE=		not on Darwin
FETCH_CMD?=		/usr/bin/ftp -o
TAR=			${LOCALBASE}/bin/tar
UNZIP=			/usr/bin/unzip
BZIP2=			/usr/bin/bzip2
CHOWN=			/usr/sbin/chown
M4?=			/usr/bin/gm4
.endif

#---

.if ${OStype} == "Interix"
# Use a better working resolver
CPPFLAGS+=		-I/usr/local/include/bind
LDFLAGS+=		-Wl,--library-after=/usr/local/lib/bind
LDADD+=			-lbind -ldb

NO_SYSTRACE=		not on Interix
UNZIP=			/usr/contrib/bin/unzip
CHOWN=			/bin/chown
_MAKE_COOKIE=		/bin/touch
GZIP_CMD=		/usr/contrib/bin/gzip -nf ${GZIP}
GZCAT?=			/usr/contrib/bin/gzip -dc

.  ifndef BOOTSTRAP	# Install these first
M4=			${LOCALBASE}/bin/gm4
.  endif
FETCH_CMD?=		${LOCALBASE}/bin/wget -O
PATCH?=			${LOCALBASE}/bin/patch
.endif

#---

.if ${OStype} == "OpenBSD"
HAS_CKSUM?=		old
PKG_ARGS_ADD+=		-Z
PKG_SUFX=		.tgz
FETCH_CMD=		/usr/bin/ftp -V -m -o

.  if ${OSrev} < 35
MODPERL_DESTDIR=	$${${DESTDIRNAME}}
_SYSTRACE_ARGS=		-i -a
.  endif

.  if ${OSrev} < 36
_GDIFFLAG=		NEED_GDIFF=yes
.  endif
.endif

#---

.if ${OStype} == "MidnightBSD"
LDFLAGS+=		-specs=${LOCALBASE}/db/specs.${_ORIG_CC:S!/!_!g}
.  ifndef BOOTSTRAP	# Install these first
M4=			${LOCALBASE}/bin/gm4
.  endif
HAS_CKSUM?=		old
NO_SYSTRACE=		not on MidnightBSD
FETCH_CMD?=		/usr/bin/ftp -o
PATCH?=			${LOCALBASE}/bin/patch
TAR=			${LOCALBASE}/bin/tar
BZIP2=			/usr/bin/bzip2
CHOWN=			/usr/sbin/chown
OScompat?=		6
.endif

#---

.if ${OStype} == "MirBSD"
.  if ${OSver:R} < 8
.    error Operating System too old and unsupported.
.  elif ${OSver:R} == 8
.    if ${OSver:E} < 40
HAS_CXX=		reason
NO_CXX=			C++ is still broken, please update
.    endif
.  elif ${OSver:R} == 9
.    if ${OSver:E} > 129
HAS_CKSUM?=		Yes
CKSUM_CMD?=		/bin/cksum
_STAT_SIZE=		#defined
.    endif
.  elif ${OSver:R} == 10
.    if ${OSver:E} > 180
HAS_CXX=		reason
NO_CXX=			C++ is no longer part of the base system
.    endif
HAS_CKSUM?=		Yes
CKSUM_CMD?=		/bin/cksum
_STAT_SIZE=		#defined
.  else
HAS_CXX=		reason
NO_CXX=			C++ is no longer part of the base system
HAS_CKSUM?=		Yes
CKSUM_CMD?=		/bin/cksum
_STAT_SIZE=		#defined
.  endif
OScompat?=		3.5
_CCLD=			mgcc
.endif

#--- End of OS Dependencies

SHELL=			${MKSH}		# missing ? not an oversight

# this is supposed to be alphabetically sorted
_CCLD?=			gcc
_MIROS_ANONCVS=		_anoncvs@@anoncvs.mirbsd.org:/cvs
ARCH?=			${MACHINE_ARCH}
FETCH_CMD?=		/usr/bin/ftp -EV -m -o
HAS_CKSUM?=		No
HAS_CXX?=		base
LP64_PLATFORMS?=	*:*:alpha *:*:amd64 *:*:sparc64
MKSH?=			/bin/mksh
MODPERL_DESTDIR?=
NOPIC_PLATFORMS?=
PKG_ARGS_ADD?=
PKG_SUFX?=		.cgz
_GDIFFLAG?=
_SYSTRACE_ARGS?=	-i -a -e

.if ${HAS_CKSUM:L} == "yes"
CKSUM_CMD?=		${LOCALBASE}/bin/cksum
.endif
CKSUM_CMD?=		cksum

.if defined(NOPIC) && ${NOPIC:L} != "no"
NO_SHARED_LIBS?=	Yes
LDFLAGS?=
.  if !${LDFLAGS:L:M-static}
LDFLAGS+=		-static
.  endif
.endif
NO_SHARED_LIBS?=	No

.if (${BINOWN} == "root") && (${LOCALBASE} == "/usr/mpkg")
__SYSTEM_PORTS=		Yes
.else
__SYSTEM_PORTS=		No
.endif

# These used to be in <bsd.port.mk> but here they're more
# easily checked and overridden by ports' Makefiles.
USE_CXX?=		No
USE_GMAKE?=		No
USE_MOTIF?=		No
USE_SCHILY?=		No
USE_X11?=		No

#--- former pkgpath.mk

.ifndef	PKGPATH
.  ifndef _PORTSDIR
_PORTSDIR!=		realpath ${PORTSDIR}
.    if ${__MAKEFLAGS_HACKERY:L} == "yes"
.MAKEFLAGS:=		${.MAKEFLAGS} _PORTSDIR=${_PORTSDIR:Q}
.    endif
.  endif
_CURDIR!=		realpath ${.CURDIR}
PKGPATH=		${_CURDIR:S,${_PORTSDIR}/,,}
.endif
.if empty(PKGPATH)
PKGDEPTH=
.else
PKGDEPTH=		${PKGPATH:C|[^./][^/]*|..|g}/
.endif

PORTSDIR_PATH?=		${PORTSDIR}:${PORTSDIR}/Mystuff
HTMLIFY=		sed -e 's/&/\&amp;/g' -e 's/>/\&gt;/g' -e 's/</\&lt;/g'

# Code to invoke to split dir,-multi,flavour

_flavour_fragment= \
	multi=; flavour=; space=; sawflavour=false; \
	case "$$dir" in \
	*,) \
		dir=$${dir%,}; \
		sawflavour=true; \
		;; \
	*,*) \
		IFS=,; first=true; for i in $$dir; do \
			if $$first; then \
				dir=$$i; first=false; \
			else \
				case X"$$i" in \
				X-*) \
					multi="$$i"	;; \
				*) \
					sawflavour=true; \
					flavour="$$flavour$$space$$i"; \
					space=' '	;; \
				esac \
			fi; \
		done; unset IFS	;; \
	esac; \
	toset="PKGPATH=$$dir"; \
	[[ -z $$multi ]] || toset="$$toset SUBPACKAGE=\"$$multi\""; \
	if $$sawflavour; then \
		toset="$$toset FLAVOUR=\"$$flavour\""; \
	fi; \
	IFS=:; found_dir=false; bases=${PORTSDIR_PATH}; \
	for base in $$bases; do \
		cd $$base 2>/dev/null || continue; \
		if [ -L "$$dir" ]; then \
			print -u2 ">> Broken dependency:" \
			    "$$base/$$dir is a symbolic link"; \
			exit 1; \
		fi; \
		if cd $$dir 2>/dev/null; then \
			found_dir=true; \
			break; \
		fi; \
	done; unset IFS; \
	if ! $$found_dir; then \
		print -u2 ">> Broken dependency: $$dir non-existent"; \
		exit 1; \
	fi

_depfile_fragment= \
	if [[ -z $$_DEPENDS_FILE ]]; then \
		_DEPENDS_FILE=$$(mktemp /tmp/depends.XXXXXXXXXXXX|| exit 1); \
		export _DEPENDS_FILE; \
		trap "rm -f $${_DEPENDS_FILE}" 0 1 2 3 5 13 15; \
	fi

MIRPORTS_SYS_MK=	done
.endif
@


1.62
log
@make ‚Äúecho '.include <mirports.sys.mk>' | mmake -f - ___DISPLAY_MAKEVARS=PORTSDIR‚Äù work
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.61 2014/11/26 19:29:28 tg Exp $
a204 1
_MIRPORTS_ADDRESS=	<miros-discuss@@MirBSD.org>
@


1.61
log
@remove MKC_USAP fully from the tree, we don‚Äôt deal with patents
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.60 2014/05/29 18:40:47 tg Exp $
d3 2
a4 2
# Copyright (c) 2005, 2006, 2008, 2012, 2014
#	Thorsten ‚Äúmirabilos‚Äù Glaser <tg@@mirbsd.org>
d44 1
a44 1
	    | MAKEFLAGS= ${MAKE} -rf - all
d52 1
a52 1
	    | MAKEFLAGS= ${MAKE} -rf - all
@


1.60
log
@change FETCH_CMD to end with -o (ftp, fetch) or -O (GNU wget)
and use this
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.59 2014/04/02 17:02:30 tg Exp $
a132 1
MKC_USAP?=		Yes
a211 1
MKC_USAP?=		No
@


1.59
log
@record C++ removal from base
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.58 2012/10/18 16:41:27 tg Exp $
d99 1
a99 1
FETCH_CMD?=		/usr/bin/ftp
d125 1
a125 1
FETCH_CMD?=		${LOCALBASE}/bin/wget
d136 1
a136 1
FETCH_CMD=		/usr/bin/ftp -V -m
d157 1
a157 1
FETCH_CMD?=		/usr/bin/ftp
d209 1
a209 1
FETCH_CMD?=		/usr/bin/ftp -EV -m
@


1.58
log
@add a way to disable adding stuff to .MAKEFLAGS
for badly behaved sub-makes
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.57 2012/08/04 18:13:20 tg Exp $
d3 2
a4 2
# Copyright (c) 2005, 2006, 2008, 2012
#	Thorsten ‚Äúmirabilos‚Äù Glaser <tg@@mirbsd.de>
d181 8
d190 2
@


1.57
log
@check which ulimits are available before choosing to unlock them
- reported by bsiegert@@

the hardlimits are checked only once now, as $(‚Ä¶) cannot be passed
via .MAKEFLAGS
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.56 2009/12/28 14:55:13 tg Exp $
d23 2
d28 1
d30 1
d34 1
d36 1
d63 1
d65 1
d69 1
d71 1
d85 1
d87 1
d245 1
d247 1
@


1.56
log
@speed up recursive ops by use of .MAKEFLAGS (not MAKEFLAGS like TNF,
since our make is different, apparently)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.55 2009/12/04 22:55:02 tg Exp $
d3 1
a3 1
# Copyright (c) 2005, 2006, 2008
d64 14
@


1.55
log
@new: ${_CCLD} = mgcc or gcc
to be used by foreign compilers when needing a link command ONLY
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.55 2009/12/04 22:54:01 tg Exp $
d26 1
d30 1
d34 2
a35 1
.if ${OStype} == "MirBSD"
d41 1
a41 1
.elif ${OStype} == "MidnightBSD"
d44 1
a44 1
.elif ${OStype} == "OpenBSD"
d49 3
a51 3
.elif ${OStype} == "Interix"
.  error Fill in later!
.elif ${OStype} == "Darwin"
d54 8
a61 2
.else
.  error Unknown OStype '${OStype}'!
a62 1
OSrev=	${OSREV:S/.//}
d217 1
d219 2
a287 1

@


1.54
log
@eurynome: anoncvs@@ ‚Üí _anoncvs@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.53 2008/10/13 21:22:54 tg Exp $
d153 1
d161 1
@


1.53
log
@change the name of the db/specs file to match the compiler name,
for use of multiple compilers

Reason: I‚Äôm trying
tglaser@@anakin:~/mirports/devel/glib1 $ mmake CC=/Developer/usr/bin/llvm-gcc CXX=/Developer/usr/bin/llvm-gxx
because normal Apple gcc in Leopard has broken inlining‚Ä¶ *sigh*
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.52 2008/10/05 16:10:05 tg Exp $
d159 1
a159 1
# this is supposed to be alphabetically supported.
d161 1
a161 1
_MIROS_ANONCVS=		anoncvs@@anoncvs.mirbsd.org:/cvs
@


1.52
log
@we have required a pretty up-to-date mksh for a while,
so make use of the ‚Äúrealpath‚Äù builtin
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.51 2008/05/03 18:58:38 tg Exp $
d60 1
a60 1
LDFLAGS+=		-specs=${LOCALBASE}/db/specs
d117 1
a117 1
LDFLAGS+=		-specs=${LOCALBASE}/db/specs
@


1.51
log
@define OScompat if it isn‚Äôt ‚Äì the OpenBSD or FreeBSD version we emulate
when we pass MirBSD/MidnightBSD for them
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.50 2008/05/01 00:52:32 tg Exp $
d207 2
a208 2
_PORTSDIR!=		readlink -nf ${PORTSDIR}
_CURDIR!=		readlink -nf ${.CURDIR}
@


1.50
log
@remove the advertising clause from all of my contributions
to the MirPorts Framework
@
text
@d1 1
a1 1
# $MirOS: src/share/misc/licence.template,v 1.24 2008/04/22 11:43:31 tg Rel $
d128 1
d152 1
@


1.49
log
@add new ‚Äúp5‚Äù module, included implicitly by ‚Äúperl‚Äù module
every non-modperl user of ${P5ARCH} *must* now include that
it contains the real fix for darwin-thread-multi-2level and
x86-interix-thread-multi‚Ä¶ and cleans up the confusion between
i386-midnightbsd and i386-freebsd-64int‚Ä¶
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.48 2008/03/14 15:33:53 tg Exp $
d6 5
a10 6
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
d12 8
a19 12
# Advertising materials mentioning features or use of this work must
# display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor offers the work "AS IS" and WITHOUT WARRANTY of any kind,
# express, or implied, to the maximum extent permitted by applicable
# law, without malicious intent or gross negligence; in no event may
# licensor, an author or contributor be held liable for any indirect
# or other damage, or direct damage except proven a consequence of a
# direct error of said person and intended use of this work, loss or
# other issues arising in any way out of its use, even if advised of
# the possibility of such damage or existence of a defect.
@


1.48
log
@okay okay, use native cksum+md5 on darwin, cksum+md5+rmd160 on mnbsd+obsd
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.47 2008/03/14 15:25:22 tg Exp $
a75 1
P5ARCH=			${P5SITE}/darwin-thread-multi-2level
a86 1
P5ARCH=			${P5SITE}/x86-interix-thread-multi
@


1.47
log
@switch cksum logic. either you have a cksum with -a options, which is
recent enough (to include TIGER), or you don't, in which case you can
ONLY use the cksum checksum, no hash, until mircksum is installed
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.46 2008/03/12 23:44:57 tg Exp $
d68 1
d105 1
d128 1
d181 1
a181 1
.if ${HAS_CKSUM:L} != "no"
@


1.46
log
@fgrep -r HAS_TIMET64 /usr/ports *only* finds this file oO
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.45 2008/03/12 23:43:12 tg Exp $
a67 5
.  ifndef BOOTSTRAP	# Install these first
_CKSUM_A=		${LOCALBASE}/bin/cksum -a
.  else
_CKSUM_A=
.  endif
a94 1
_CKSUM_A=		${LOCALBASE}/bin/cksum -a
a95 2
.  else
_CKSUM_A=
a114 1
_CKSUM_A=
a123 1
_CKSUM_A=		${LOCALBASE}/bin/cksum -a
a124 2
.  else
_CKSUM_A=
d146 2
a147 1
_CKSUM_SIZE=		#defined
d151 2
a152 1
_CKSUM_SIZE=		#defined
d166 1
a174 1
_CKSUM_A?=		cksum -a
d178 5
@


1.45
log
@Initial support for running the MirPorts Framework (mirports)
on MidnightBSD (mnbsd), parallel to their native ‚Äúmports‚Äù:
‚Ä¢ the test was on stargazer, which is a FreeBSD ‚Äúupgraded‚Äù to
  mnbsd, so there may be differences to a real mnbsd-current
‚Ä¢ we do need upgraded MirMake, but I didn‚Äôt release that yet,
  since I‚Äôd have to test it first
‚Ä¢ the default MANPATH needs a re-check, like OpenBSD
‚Ä¢ the setup.ksh change installs lndir(1) and a tzfile.h from
  ports/infrastructure/install/ manually; this should be moved
  into MirMake (at least lndir, which is part of XFree86¬Æ, which,
  in turn, is seen less and less in the public, sadly)
‚Ä¢ builds paxmirabilis (MirCpio), MirPatch, GNU m4, MirCksum,
  lndir (see above), and the MirPackageTools ‚ò∫
‚Ä¢ uses gcc spec file, like Darwin, to call native ld as collect2
  after parsing -Wl,--library-after (XXX why does OpenBSD not
  need this, does it use $PATH to call ld? if so, why none else?)
‚Ä¢ XXX HAS_TIMET64=No on LP64 platforms?
‚Ä¢ XXX does mnbsd not have systrace?

Additional tweaks:
‚Ä¢ bump ¬© and stuff
‚Ä¢ use a temporary playpen in LOCALBASE/tmp while upgrading,
  so that pkg_add paxmirabilis*cgz does not need to use tar
  to copy over the new files _after_ removing tar‚Ä¶
‚Ä¢ use full path to pkg_add when calling it manually
‚Ä¢ resolve possible conflict of a native rmd160(1) while
  bootstrapping GNU m4, when MirCksum is already installed
  XXX remove _CKSUM_SIZE and _CKSUM_A compatibility crap ASAP
‚Ä¢ if collect2 isn‚Äôt known by gcc, use ld instead in the wrapper
‚Ä¢ in pkgtools, always link against libmirmake unless OpenBSD/MirBSD
  (XXX in cksum, we always link against it if it exists)
‚Ä¢ XXX possibly remove the dependency of MirCpio to tzfile.h
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.44 2008/03/09 17:22:56 tg Exp $
d3 2
a4 2
# Copyright (c) 2005, 2006
#	Thorsten Glaser <tg@@mirbsd.de>
a72 1
HAS_TIMET64=		No
a90 1
HAS_TIMET64=		No
a114 1
HAS_TIMET64=		No
a137 1
HAS_TIMET64=		No
a176 1
HAS_TIMET64?=		No
@


1.44
log
@bulk convert FLAVOR to FLAVOUR; nuke unused file; convert to $Mdocdate
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.43 2007/03/22 01:27:11 tg Exp $
d43 3
d133 19
@


1.43
log
@nuke more dead stuff
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.42 2006/12/29 01:14:04 tg Exp $
d238 1
a238 1
		toset="$$toset FLAVOR=\"$$flavour\""; \
@


1.42
log
@export ${OSrev} globally, not only on OpenBSD
I'm sure it was intended that way
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.41 2006/12/28 03:34:27 tg Exp $
a122 1
HAS_DLADDR=		No
a158 1
HAS_DLADDR?=		Yes
@


1.41
log
@"cksum" interaction trouble
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.40 2006/12/21 20:38:39 tg Exp $
d56 1
a116 2
OSrev=			${OSREV:S/.//}

@


1.40
log
@unbreak mmake -dl (finally, I got annoyed enough to dig)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.39 2006/10/17 21:15:42 tg Exp $
d64 3
d68 1
d100 2
@


1.39
log
@experimental (i.e., untested): move ${WRKDIR}/specs to ${LOCALBASE}/db/
and make it depend on the compiler used

only affects darwin; moving requested by bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.38 2006/10/13 17:09:19 tg Exp $
d40 1
a40 1
	    | ${MAKE} -rf - all
d45 1
a45 1
	    | ${MAKE} -rf - all
@


1.38
log
@new cksum package, leads to more distinguished choices
should, however, bring TIGER to everyone
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.37 2006/09/24 17:32:58 tg Exp $
d61 1
a61 1
LDFLAGS+=		-specs=${WRKDIR}/specs
@


1.37
log
@* for #9bis and up, as well as #9-current, #10 and up,
  enable the "new cksum(1)" stuff - for now...
  (I hope we can package it for other OSes some time)
* while here, canonify anoncvs URI
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.36 2006/09/22 00:09:19 tg Exp $
d137 1
d141 1
@


1.36
log
@formalise the check whether we have a 'new' cksum
XXX think better about this
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.35 2006/09/20 22:24:49 tg Exp $
d134 2
a135 2
.  endif
.  if ${_MIRMAKE_VER} >= 20060921
d137 2
a138 2
.  endif
.  if ${OSver:E} > 129
d149 1
a149 1
_MIROS_ANONCVS=		anoncvs@@unixforge.de:/cvs
@


1.35
log
@catch signal 5 too, idea from original lynx "oldlynx" sample script, thanks TD
while here, update licences where I can
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.34 2006/08/16 19:51:15 tg Exp $
d135 6
@


1.34
log
@hopefully fix shared library build on the Mac
needs at lease commitid 10044E3758755E1B9A8 and 10044E3762016E082FD
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.33 2006/08/10 16:45:48 tg Exp $
d13 2
a14 2
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
d24 1
a24 1
# the possibility of such damage or existence of a nontrivial bug.
d251 1
a251 1
		trap "rm -f $${_DEPENDS_FILE}" 0 1 2 3 13 15; \
@


1.33
log
@fix 'FLAVOR= mmake clean' with FLAVOR?=non-empty in Makefile
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.32 2006/07/23 17:42:35 tg Exp $
d61 1
@


1.32
log
@add an ld(1) wrapper which provides --library-after=X as new option,
which works like --library-path=X (-LX), install the wrapper and use
it for ${LOCALBASE}/lib and (USE_X11=Yes) ${X11BASE}/lib

now curl 7.15.4 can be built while curl 7.15.1 (missing function
in /usr/mpkg/lib/libcurl.so.something which is new in the new version)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.31 2006/05/27 22:32:24 tg Exp $
d203 4
@


1.31
log
@This time, the diff says it all. No comment.
@@@@ -59,2 +59,3 @@@@
 .if ${OStype} == "Darwin"
+CPPFLAGS+=             -D__unix__=1
 NOPIC=                 No      # XXX
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.30 2006/05/27 21:12:26 tg Exp $
d80 1
a80 1
LDFLAGS+=		-L/usr/local/lib/bind
@


1.30
log
@make miros anoncvs a variable
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.29 2006/02/01 15:42:15 tg Exp $
d60 1
@


1.29
log
@change the way OS version detection and variable assignment works,
and fix or break all ports which use some of the variables.

Do not use:
* OPSYS, OSMAJOR, OSMINOR: used in OpenBSD (maybe more)
* OSREV, OSrev: changed meaning relative to OpenBSD
* OSrev, OSrel, OSrelm, OSrelx, OSrpl: used in MirBSD (7 and 8)

Do use (preferred first):
* OStype (MirBSD, OpenBSD, Darwin, Interix, ...)
* OSver (always <number>.<number> in decimal)
  - on OpenBSD: 3.8
  - on MirBSD: major.patchlevel
  - on Darwin: 8.4 (without .0)
  - on Interix: 3.5
* OStriplet (i386-ecce-mirbsd8, zaurus-unknown-openbsd3.9,
  powerpc-apple-darwin8.2.0, ...)
* OSREV (the output of "uname -r")
  - on OpenBSD: 3.8
  - on MirBSD: 8
  - on Darwin: 8.4.0
@
text
@d1 1
a1 1
# $MirOS: src/share/misc/licence.template,v 1.6 2006/01/24 22:24:02 tg Rel $
d141 1
@


1.28
log
@MirMake now defaults DEBUGLIBS to "no", and DEBUGPROGS is gone,
so for the case someone has set it to "yes" himself, add -g1 to
CFLAGS for ports builds (since INSTALL_STRIP is still set, this
really only affects libraries, despite a small slowdown).
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.27 2005/12/17 05:46:19 tg Exp $
d3 2
a4 2
# Copyright (c) 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
d36 19
a54 5
.if !defined(OSREV) || empty(OSREV)
OSREV!=			uname -r
.endif
.if !defined(OSrev) || empty(OSrev)
OSrev=			${OSREV:S/.//g}
d108 2
d125 1
a125 1
.  if ${OSrev} < 8
d127 2
a128 5
.  elif ${OSrev} == 8
.    ifndef OSrpl
OSrpl!=			x=$$(uname -l); x=16\#$${x\#@@(\#[0-9][a-z])}; let x=$${x%%-*}; print $$x
.    endif
.    if ${OSrpl} < 40
a150 1
OSREV?=			${OSrev}
@


1.27
log
@big fat licence update (I left some which are bsiegert@@'s alone though)
also, remove licence boilerplate from some .h files who don't deserve it
and remove and add some advertising clauses because I say so
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.26 2005/12/16 22:04:17 tg Exp $
a27 4
# Provide consistent MirPorts behaviour. (Sync with mirports.bsd.mk)
DEBUGLIBS=		No
DEBUGPROGS=		No

@


1.26
log
@remove LDADD_CYCLIC, just use the groups always, it's not that much a payoff
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.25 2005/12/15 01:24:43 tg Exp $
d17 8
a24 7
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
@


1.25
log
@* use ${FOO:Q} i.p.v. '${FOO}' or "${FOO}"
* replace v='' and v="" with v= while here
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.24 2005/11/19 12:54:26 tg Exp $
a69 1
LDADD_CYCLIC=		#defined
@


1.24
log
@* mirmake: update to 20051119
* infrastructure: (MAKE_ENV) add LDADD, LDADD_CYCLIC if defined
  (Interix) employ LDADD_CYCLIC
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.23 2005/11/11 00:02:13 tg Exp $
d191 1
a191 1
	multi=''; flavour=''; space=''; sawflavour=false; \
@


1.23
log
@oops
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.22 2005/11/11 00:00:45 tg Exp $
d70 1
@


1.22
log
@my perl (hand-compiled) is x86-interix-thread-multi
I'll fix that on the next occasion I reinstall windows though
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.21 2005/11/10 23:45:07 tg Exp $
d73 1
a73 1
P5ARCH=			${P5SITE}/${MACHINE_ARCH}-${OSname}-thread-multi
@


1.21
log
@* add ${LDADD} to LIBS= in CONFIGURE_ENV
* on Interix, add -lbind -ldb to LDADD
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.20 2005/11/10 22:20:47 tg Exp $
d73 1
@


1.20
log
@* texinfo: must not depend on m4, autoconf on Interix
* setup.ksh: install patch(1) as port on Interix
* setup.ksh: install GNU wget last (huge load of dependencies)
* mirports.sys.mk: add /usr/local/lib/bind to ld path on Interix
* network.conf.template: add some HTTP mirrors of GNU
* m4: must not depend on m4 on Interix
* m4: depends on texinfo on Interix
* wget: update to 1.10.2-1
* wget: add HTTP mirror of Debian
* wget: does not need GNU make
* wget: add -lbind (and its dependency -ldb) on Interix
  XXX I hope bdb4 does NOT get used by this... we actually
  XXX have a libdb.so.3.5 in base on Interix 3.5
* wget: 1,$ = % in ed(1) scripts
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.19 2005/11/10 20:38:11 tg Exp $
d69 1
@


1.19
log
@* locate wget/fetch/ftp and nrcon in $localbase/bin too
* prefer installed MirPorts wget on Interix over Weihenstephan's
* Build.sh -d is auto-recognised in mksh R25
* redirect mksh man page installation errors to /dev/null
* need MirCpio on Interix too (I think)
* add glue for GNU wget, GNU m4 on Interix
* fix build of MirCksum package
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.18 2005/11/07 20:34:03 tg Exp $
d68 1
d83 1
@


1.18
log
@remove USE_SYSTRACE since NO_SYSTRACE can be set to disable it anyway,
and OpenBSD only needs it because these baka-tachi default it to No
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.17 2005/10/13 22:04:12 tg Exp $
d80 1
a81 2
TAR=			${LOCALBASE}/bin/tar
.  endif
@


1.17
log
@new global: __SYSTEM_PORTS (Yes/No)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.16 2005/09/22 20:27:47 bsiegert Exp $
d53 1
a53 1
USE_SYSTRACE=		No
d70 1
a70 1
USE_SYSTRACE=		No
a165 1
USE_SYSTRACE?=		Yes
@


1.16
log
@Add a custom P5ARCH dir on Darwin---one which corresponds to reality ;).

ok tg@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.15 2005/09/20 19:50:25 tg Exp $
d154 6
@


1.15
log
@missing escapes of dollars and pounds

(damn these imperialists... if they'd use the Euro... ;) SCNR
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.14 2005/09/13 11:21:35 tg Exp $
d60 1
@


1.14
log
@same !defined() || empty() stuff for OSNAME/OSname
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.13 2005/09/13 11:18:52 tg Exp $
d112 1
a112 1
OSrpl!=			x=$(uname -l); x=16#${x#@@(#[0-9][a-z])}; let x=${x%%-*}; print $x
@


1.13
log
@* replace . with nothing, not _, in OSrev
* use !defined() || empty() to check
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.12 2005/09/12 22:53:19 tg Exp $
d32 1
a32 1
.ifndef	OSname
d34 2
@


1.12
log
@join tg-ports-devel branch into HEAD
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.15 2005/09/12 22:50:54 tg Exp $
d37 1
a37 1
.ifndef OSREV
d40 2
a41 2
.ifndef OSrev
OSrev=			${OSREV:S/./_/g}
@


1.11
log
@_DOMAIN_DU_JOUR dies
@
text
@d1 23
a23 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10 2005/08/20 12:33:54 tg Exp $
d27 1
a27 6
# First, let's have a look at what the OS says.
.ifndef	BSD_OWN_MK
.  include <bsd.own.mk>
.endif

# But provide a consistent MirPorts behaviour.
d29 1
a35 1
PORTSDIR?=		/usr/ports
d37 80
a116 5
# Do we have overrides?
.if exists(${PORTSDIR}/infrastructure/mk/mirports.osdep.mk)
.  include "${PORTSDIR}/infrastructure/mk/mirports.osdep.mk"
.else
.  include "${PORTSDIR}/infrastructure/mk/mirports.miros.mk"
d119 1
d121 3
a123 1
# Let's assume a sane environment now.
d126 8
d135 6
a140 6
LP64_PLATFORMS?=	*:*:alpha *:*:amd64 *:*:sparc64
LOCALBASE?=		/usr/mpkg
X11BASE?=		/usr/X11R6
MKSH?=			/bin/mksh	# path to mirbsdksh
SHELL=			${MKSH}		# missing ? not an oversight
# assume osdep provides MACHINE_OS, OStype, OStriplet, OBJECT_FMT etc.
d160 1
a160 17
# mirports.osdep.mk is expected to provide these variables
# (where they differ from defaults); only fill in changes.
# this is supposed to be alphabetically supported.
AUTOCONF_FAKEOS?=	${ARCH}-ecce-openbsd${OScompat}
FETCH_CMD?=		/usr/bin/ftp -V -m
HAS_CXX?=		base
HAS_DLADDR?=		Yes
HAS_TIMET64?=		No
MKC_USAP?=		No
MODPERL_DESTDIR?=
PKG_ARGS_ADD?=
PKG_SUFX?=		.cgz
SYSTRACE_ARGS_ADD?=
_CKSUM_A?=		cksum -a
_GDIFFLAG?=

# former pkgpath.mk
d163 2
a164 2
_PORTSDIR!=		cd ${PORTSDIR} && pwd -P
_CURDIR!=		cd ${.CURDIR} && pwd -P
d181 1
a181 1
	  *,*) \
d187 6
a192 6
					  X-*) \
						multi="$$i"	;; \
					  *) \
						sawflavour=true; \
						flavour="$$flavour$$space$$i"; \
						space=' '	;; \
d198 1
a198 3
	case X$$multi in "X");; *) \
		toset="$$toset SUBPACKAGE=\"$$multi\""	;; \
	esac; \
d204 10
a213 9
	    cd $$base 2>/dev/null || continue; \
	    if [ -L "$$dir" ]; then \
		    echo 1>&2 ">> Broken dependency: $$base/$$dir is a symbolic link"; \
		    exit 1; \
	    fi; \
	    if cd $$dir 2>/dev/null; then \
	    	found_dir=true; \
		break; \
	    fi; \
d216 2
a217 2
	    echo 1>&2 ">> Broken dependency: $$dir non existent"; \
	    exit 1; \
d221 2
a222 2
	case X$${_DEPENDS_FILE} in \
		X) _DEPENDS_FILE=$$(mktemp /tmp/depends.XXXXXXXXXXXX|| exit 1); \
d224 2
a225 2
		trap "rm -f $${_DEPENDS_FILE}" 0 1 2 3 13 15	;; \
	esac
@


1.10
log
@half-hearted attempt to unify LOCALBASE to /usr/mpkg for all platforms
agreed some time ago bsiegert@@
no veto on miros-discuss@@

for now, hardcode PREFIX to /usr/local for imake and old-install ports
(we should probably do something about imake anyway, regarding both
Interix and Darwin - maybe require our own XFree86Æ port, but later...)

some of the code (especially shell and make) will be rewritten now,
since it can be simplified (nuking bugs, maybe)

what about changing /etc/mk.conf as well (conflict with obsd and maybe
others)? I think of /etc/${MAKE}.cfg (MAKE=make or mmake) maybe?

please test, as usual...
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.9 2005/07/05 20:08:30 tg Exp $
d29 1
a29 2
_DOMAIN_DU_JOUR=	MirBSD.org
_MIRPORTS_ADDRESS=	<miros-discuss@@${_DOMAIN_DU_JOUR}>
@


1.10.2.1
log
@* OBJECT_FMT is provided by MirMake
  (XXX openbsd?)
* LOCALBASE and SYSCONFDIR are now in mirports.sys.mk
* SYSCONFDIR now defaults to LOCALBASE/etc
* new variable MMAKE
* protect some by .ifndef BOOTSTRAP
* amend portpath by LOCALBASE/sbin
* default MKC_USAP on openbsd to yes
* stub openbsd 3.7, 3.8 (clone 3.6)
* clean up and mksh'ify in bsd.port.mk and mirports.sys.mk
* no -L${LOCALBASE}/lib/debug for us
* remove _DOMAIN_DU_JOUR
* use readlink -nf better
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10 2005/08/20 12:33:54 tg Exp $
d29 2
a30 1
_MIRPORTS_ADDRESS=	<miros-discuss@@MirBSD.org>
d35 1
a35 2
SYSCONFDIR?=		${LOCALBASE}/etc
X11BASE?=		/usr/X11R6	# may be subject to change
a36 1
MMAKE?=			/usr/bin/make	# path to mirmake
d77 2
a78 2
_PORTSDIR!=		readlink -nf ${PORTSDIR}
_CURDIR!=		readlink -nf ${.CURDIR}
d95 1
a95 1
	*,*) \
d101 6
a106 6
				X-*) \
					multi="$$i"	;; \
				*) \
					sawflavour=true; \
					flavour="$$flavour$$space$$i"; \
					space=' '	;; \
d112 3
a114 1
	[[ -z $$multi ]] || toset="$$toset SUBPACKAGE=\"$$multi\""; \
d120 9
a128 10
		cd $$base 2>/dev/null || continue; \
		if [ -L "$$dir" ]; then \
			print -u2 ">> Broken dependency:" \
			    "$$base/$$dir is a symbolic link"; \
			exit 1; \
		fi; \
		if cd $$dir 2>/dev/null; then \
			found_dir=true; \
			break; \
		fi; \
d131 2
a132 2
		print -u2 ">> Broken dependency: $$dir non-existent"; \
		exit 1; \
d136 2
a137 2
	if [[ -z $$_DEPENDS_FILE ]]; then \
		_DEPENDS_FILE=$$(mktemp /tmp/depends.XXXXXXXXXXXX|| exit 1); \
d139 2
a140 2
		trap "rm -f $${_DEPENDS_FILE}" 0 1 2 3 13 15; \
	fi
@


1.10.2.2
log
@default SYSCONFDIR to /etc, requested by bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.1 2005/08/21 11:08:28 tg Exp $
a33 1
SYSCONFDIR?=		/etc		# comment out for co-existence
@


1.10.2.3
log
@get rid of another almost-empty file
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.2 2005/08/21 12:32:56 tg Exp $
d23 2
a26 10
.if ${OSNAME} == "MirBSD"
.  if ${OSrev} >= 8
SYSTRACE_ARGS_ADD+=	-e
.  endif

.  if (${OSrev} == 8) && (${OSrpl} < 40)
HAS_CXX=		reason
NO_CXX=			C++ is still broken, please update
.  endif
.endif
a63 1
FETCH_CMD?=		/usr/bin/ftp -EV -m
a74 1
OSREV?=			${OSrev}
@


1.10.2.4
log
@optimise and forgot FETCH_CMD
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.3 2005/08/21 12:41:20 tg Exp $
d26 4
d73 1
d81 1
a81 1
_SYSTRACE_ARGS?=	-i -a -e
@


1.10.2.5
log
@oops, it\s there twice
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.4 2005/08/21 12:47:09 tg Exp $
a11 1
DEBUGPROGS=		No
@


1.10.2.6
log
@move LOCALBASE, SYSCONFDIR etc. to SetEnv.make (or SetEnv.sh, SetEnv.csh)
scripts, as discussed with bsiegert@@

SYSCONFDIR still defaults to /etc
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.5 2005/09/01 21:08:32 tg Exp $
d38 4
@


1.10.2.7
log
@PORTSDIR and LOCALBASE are provided by ${.SYSMK}/mirports.sys.mk already,
as well as BSD_OWN_MK
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.6 2005/09/01 22:15:26 tg Exp $
d5 6
a10 1
# Provide consistent MirPorts behaviour. (Sync with mirports.bsd.mk)
d19 1
@


1.10.2.8
log
@sort of remove <mirports.osdep.mk>
XXX this loses support for MirOS #7 and below (including old -current)
XXX add back support for #7-stable if required, but from scratch
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.7 2005/09/01 22:31:01 tg Exp $
d15 3
a17 64
#--- Specific OS Dependencies

.if ${OStype} == "Darwin"
MACHINE_OS=		Darwin
OSREV!=			uname -r
OSrev=			${OSREV:S/./_/g:S/_0$//}

NOPIC=			No	# XXX
LDCONFIG=
_CKSUM_A=
HAS_TIMET64=		No
USE_SYSTRACE=		No
MMAKE?=			${LOCALBASE}/bin/mmake
FETCH_CMD?=		/usr/bin/ftp
TAR=			${LOCALBASE}/bin/tar
UNZIP=			/usr/bin/unzip
BZIP2=			/usr/bin/bzip2
CHOWN=			/usr/sbin/chown
M4?=			/usr/bin/gm4
.endif

#---

.if ${OStype} == "Interix"
MACHINE_OS=		Interix
OStype=			Interix

# Use a better working resolver
CPPFLAGS+=		-I/usr/local/include/bind

HAS_TIMET64=		No
USE_SYSTRACE=		No
MMAKE?=			${LOCALBASE}/bin/make
UNZIP=			/usr/contrib/bin/unzip
CHOWN=			/bin/chown
_MAKE_COOKIE=		/bin/touch
GZIP_CMD=		/usr/contrib/bin/gzip -nf ${GZIP}
GZCAT?=			/usr/contrib/bin/gzip -dc
SETENV?=		/usr/bin/env -i LD_LIBRARY_PATH="${LD_LIBRARY_PATH}"

.  ifndef BOOTSTRAP	# Install these first
_CKSUM_A=		${LOCALBASE}/bin/cksum -a
M4=			${LOCALBASE}/bin/gm4
FETCH_CMD?=		${LOCALBASE}/bin/wget
TAR=			${LOCALBASE}/bin/tar
.  else			# Half-working versions
TAR=			/bin/tar
.  endif
.endif

#---

.if ${OStype} == "OpenBSD"
MACHINE_OS=		BSD
MKC_USAP?=		Yes
PKG_ARGS_ADD+=		-Z
PKG_SUFX=		.tgz
MMAKE?=			${LOCALBASE}/bin/mmake
HAS_TIMET64=		No
FETCH_CMD=		/usr/bin/ftp -V -m

.if ${OSrev} < 35
MODPERL_DESTDIR=	$${${DESTDIRNAME}}
_SYSTRACE_ARGS=		-i -a
d20 1
a20 12
.if ${OSrev} < 36
HAS_DLADDR=		No
_CKSUM_A=
_GDIFFLAG=		NEED_GDIFF=yes
.endif

#---

.if ${OStype} == "MirBSD"
.  if ${OSrev} < 8
	ERROR: operating system too old
.  endif
a26 2
#--- End of OS Dependencies

d55 2
d58 1
d72 1
a72 1
#--- former pkgpath.mk
@


1.10.2.9
log
@move stuff around further
@
text
@d1 1
a1 23
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.8 2005/09/01 22:45:02 tg Exp $
#-
# Copyright (c) 2005
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
#
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
#
# All advertising materials mentioning features or use of this soft-
# ware must display the following acknowledgement:
#	This product includes material provided by Thorsten Glaser.
#
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
d101 1
a102 3
SHELL=			${MKSH}		# missing ? not an oversight

# this is supposed to be alphabetically supported.
d104 1
a104 4
FETCH_CMD?=		/usr/bin/ftp -EV -m
HAS_CXX?=		base
HAS_DLADDR?=		Yes
HAS_TIMET64?=		No
d106 4
a109 11
MKC_USAP?=		No
MKSH?=			/bin/mksh
MMAKE?=			/usr/bin/make
MODPERL_DESTDIR?=
NOPIC_PLATFORMS?=
OSREV?=			${OSrev}
PKG_ARGS_ADD?=
PKG_SUFX?=		.cgz
_CKSUM_A?=		cksum -a
_GDIFFLAG?=
_SYSTRACE_ARGS?=	-i -a -e
d129 14
@


1.10.2.10
log
@* fix some .if chaining problem
* use new .error
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.9 2005/09/01 22:58:45 tg Exp $
d98 1
a98 1
.  if ${OSrev} < 35
d101 1
a101 1
.  endif
d103 1
a103 1
.  if ${OSrev} < 36
a106 1
.  endif
d113 3
a115 3
.    error Operating System too old and unsupported.
.  elif ${OSrev} == 8
.    if ${OSrpl} < 40
a117 1
.    endif
@


1.10.2.11
log
@merge -rHEAD into development branch

Note for bsiegert@@ please don't use csh prompts in man pages any more
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.10 2005/09/01 23:31:44 tg Exp $
d125 1
a128 1
_MIRPORTS_ADDRESS=	<miros-discuss@@MirBSD.org>
@


1.10.2.12
log
@add LD_LIBRARY_PATH support for ordinary systems too
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.11 2005/09/11 01:05:42 tg Exp $
d75 1
@


1.10.2.13
log
@when using MirMake (not /usr/bin/make) we encounter difficulties...
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.12 2005/09/11 02:12:21 tg Exp $
a36 7
.ifndef OSREV
OSREV!=			uname -r
.endif
.ifndef OSrev
OSrev=			${OSREV:S/./_/g}
.endif

d40 4
a114 3
.    ifndef OSrpl
OSrpl!=			x=$(uname -l); x=16#${x#@@(#[0-9][a-z])}; let x=${x%%-*}; print $x
.    endif
@


1.10.2.14
log
@mmake and systrace clash
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.13 2005/09/12 22:10:44 tg Exp $
d52 1
d72 1
d96 1
d142 1
@


1.10.2.15
log
@remove redundancy
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.10.2.14 2005/09/12 22:13:48 tg Exp $
d63 3
d82 2
d90 1
@


1.9
log
@* capitalise the initial letter on Distfiles, Packages, etc.
* slightly change the Packages layout

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.8 2005/07/05 18:50:21 tg Exp $
d34 1
a34 1
LOCALBASE?=		/usr/local
@


1.8
log
@* volgens bsiegert@@ we do not support the espietools at all
* while here, correct some more spelling
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.7 2005/06/17 20:09:15 tg Exp $
d87 1
a87 1
PORTSDIR_PATH?=		${PORTSDIR}:${PORTSDIR}/mystuff
@


1.7
log
@DEBUGLIBS=no, always
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.6 2005/05/30 16:47:10 tg Exp $
a65 1
MIRBSD_PKGTOOLS?=	Yes
d90 1
a90 1
# Code to invoke to split dir,-multi,flavor
d92 2
a93 2
_flavor_fragment= \
	multi=''; flavor=''; space=''; sawflavor=false; \
d104 2
a105 2
						sawflavor=true; \
						flavor="$$flavor$$space$$i"; \
d115 2
a116 2
	if $$sawflavor; then \
		toset="$$toset FLAVOR=\"$$flavor\""; \
@


1.6
log
@flag day: /bin/mksh is now default shell (XXX untested)
pkg_scan: convert to ksh idioms, [ x"$1" ... is out
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.5 2005/04/11 14:52:48 tg Exp $
d10 3
@


1.5
log
@infrastructure part of
 OStype:ARCH (MirBSD:i386)
->
 OStype:OSREV:ARCH (MirBSD:8:i386)
change

If there is *any* operating system out there which
uses colons (:) in its version numbers, tell me.
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.4 2005/04/10 21:50:06 tg Exp $
d33 1
a33 1
MKSH?=			/bin/ksh	# path to mirbsdksh
@


1.4
log
@NOPIC_PLATFORMS, LP64_PLATFORMS and general change of
{NOT,ONLY}_FOR_{ARCH{,E,ES},OS} to {NOT,ONLY}_FOR_PLATFORM

some fallout maybe, I hope not
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.3 2005/04/10 20:56:06 tg Exp $
d30 1
a30 1
LP64_PLATFORMS?=	*:alpha *:amd64 *:sparc64
@


1.3
log
@provide definitions of NO_SHARED_ARCHS -e LP64_ARCHS
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.2 2005/03/19 11:51:38 tg Exp $
d29 2
a30 2
NO_SHARED_ARCHS?=
LP64_ARCHS?=		*:alpha *:amd64 *:sparc64
@


1.2
log
@we've got *@@mirbsd.org now
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/mirports.sys.mk,v 1.1.7.1 2005/03/18 15:47:19 tg Exp $
d29 2
a30 1
LP64_ARCHS=		alpha amd64 sparc64
@


1.1
log
@Initial revision
@
text
@d1 1
a1 4
# $MirOS$
#-
# Central configurator, hub and shared code for MirPorts.
# Yes I know that this description sucks, but I've got to have one.
d26 1
a26 1
_DOMAIN_DU_JOUR=	66h.42h.de
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
