head	1.14;
access;
symbols
	MIRBSD_8_BASE:1.4;
locks; strict;
comment	@# @;


1.14
date	2010.02.20.23.34.35;	author tg;	state Exp;
branches;
next	1.13;
commitid	1004B8071891476A39D;

1.13
date	2009.08.16.16.27.09;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004A882F1F72B43308;

1.12
date	2009.01.03.20.45.39;	author bsiegert;	state Exp;
branches;
next	1.11;
commitid	100495FCE70200E45AE;

1.11
date	2008.10.04.18.37.32;	author tg;	state Exp;
branches;
next	1.10;
commitid	10048E7B76F1F1670BC;

1.10
date	2008.03.15.23.16.54;	author tg;	state Exp;
branches;
next	1.9;
commitid	10047DC58F316B51020;

1.9
date	2008.03.14.20.19.43;	author tg;	state Exp;
branches;
next	1.8;
commitid	10047DADDAB252C4C44;

1.8
date	2007.10.04.16.52.45;	author bsiegert;	state Exp;
branches;
next	1.7;
commitid	10047051A08435DF046;

1.7
date	2006.11.24.01.15.08;	author tg;	state Exp;
branches;
next	1.6;
commitid	100456647AD46D03A2E;

1.6
date	2005.12.28.16.35.36;	author tg;	state Exp;
branches;
next	1.5;
commitid	10043B2BEE83554FD0E;

1.5
date	2005.12.28.16.20.27;	author tg;	state Exp;
branches;
next	1.4;
commitid	10043B2BB47574BD2C1;

1.4
date	2005.12.15.14.47.45;	author bsiegert;	state Exp;
branches;
next	1.3;
commitid	10043A1812715FB1DE8;

1.3
date	2005.12.15.01.24.43;	author tg;	state Exp;
branches;
next	1.2;
commitid	10043A0C5D7068BC1DF;

1.2
date	2005.06.24.17.37.13;	author tg;	state Exp;
branches;
next	1.1;
commitid	187042bc44db2630;

1.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.47.19;	author tg;	state Exp;
branches;
next	;


desc
@@


1.14
log
@unbreak after cid 1004B38C6D25E238175 exposed bug from 10047DADDAB252C4C44
cought by bsiegert@@, 10x
@
text
@# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.13 2009/08/16 16:27:09 tg Exp $
# $OpenBSD: perl.port.mk,v 1.9 2004/06/08 20:28:19 sturm Exp $
# Based on bsd.port.mk, originally by Jordan K. Hubbard.

.ifndef P5ARCH
.  include "${PORTSDIR}/infrastructure/mk/p5.port.mk"
.endif

MODPERL_BUILD?=	Build

MODPERL_PRE=	${MODPERL_DESTDIR}${PREFIX}
MODPERL_MANPRE=	${MODPERL_PRE}/man/man
MODPERL_SITEPRE=${MODPERL_PRE}/${P5SITE}
MODPERL_SRC?=	${WRKSRC}

MODPERL_CONFIG_VARS+= INSTALLSITELIB=${MODPERL_SITEPRE:Q} \
	INSTALLSITEARCH="\$${INSTALLSITELIB}/${MODPERL_ARCH}" \
	INSTALLPRIVLIB=${MODPERL_DESTDIR}/usr/libdata/perl5 \
	INSTALLARCHLIB="\$${INSTALLPRIVLIB}/${MODPERL_ARCH}" \
	INSTALLBIN=${MODPERL_PRE:Q}/bin INSTALLSCRIPT='$${INSTALLBIN}' \
	INSTALLMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLSITEMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLVENDORMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLMAN3DIR=${MODPERL_MANPRE:Q}3 \
	INSTALLSITEMAN3DIR=${MODPERL_MANPRE:Q}3 \
	INSTALLVENDORMAN3DIR=${MODPERL_MANPRE:Q}3 ${CONFIGURE_ARGS}

.if ${CONFIGURE_STYLE:L:Mmodbuild}
.  if !${PKGNAME:Mp5-Module-Build*}
BUILD_DEPENDS+=	::devel/p5-Module-Build
.  endif
MODPERL_configure= cd ${MODPERL_SRC}; ${_SYSTRACE_CMD} ${SETENV} ${CONFIGURE_ENV} \
	/usr/bin/perl Build.PL install_path=lib=${MODPERL_SITEPRE:Q} \
	install_path=arch=${MODPERL_SITEPRE:Q}/${MODPERL_ARCH:Q} \
	install_path=libdoc=${MODPERL_MANPRE:Q}3 \
	install_path=bindoc=${MODPERL_MANPRE:Q}1 \
	install_path=bin=${MODPERL_PRE:Q}/bin \
	install_path=script=${MODPERL_PRE:Q}/bin ${CONFIGURE_ARGS} 
REGRESS_TARGET?=test
.elif ${CONFIGURE_STYLE:L:Mperl}
MODPERL_configure= cd ${MODPERL_SRC}; ${_SYSTRACE_CMD} ${SETENV} ${CONFIGURE_ENV} \
	CC=${_PASS_CC:T:Q} CFLAGS=${CFLAGS:M*:Q} CXX=${_PASS_CXX:T:Q} \
	CXXFLAGS=${CXXFLAGS:M*:Q} YACC=${YACC:Q} LD=${LD:Q} \
	LDFLAGS=${LDFLAGS:Q} /usr/bin/perl Makefile.PL \
	PREFIX=${PREFIX:Q} ${MODPERL_CONFIG_VARS}
REGRESS_TARGET?=test
.endif

MODPERL_pre-fake= \
	${SUDO} mkdir -p ${WRKINST}$$(/usr/bin/perl -e \
	    'use Config; print $$Config{installarchlib}, "\n";')

MODPERL_post-fake= \
	${SUDO} find ${DESTDIR}${PREFIX}/${P5ARCH} -name .packlist -exec rm \{\} \; ; \
	${SUDO} find -d ${DESTDIR}${PREFIX}/${P5ARCH} -type d -exec rmdir \{\} \; 2>&1

.if ${CONFIGURE_STYLE:L:Mmodbuild}
.  if !target(do-build)
do-build: 
	@@cd ${MODPERL_SRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
		${MODPERL_BUILD} build
.  endif
.  if !target(do-regress)
do-regress:
	@@cd ${MODPERL_SRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
		${MODPERL_BUILD} ${REGRESS_TARGET}

.  endif
.  if !target(do-install)
do-install:
	@@cd ${MODPERL_SRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
		${MODPERL_BUILD} destdir=${WRKINST} ${FAKE_TARGET}
.  endif
.endif
@


1.13
log
@change
• _PASS_CC back from 「mpcc」 to 「${WRKDIR}/bin/mpcc」 (note that the
  former 「${WRKDIR:Q}/bin/mpcc」 was wrong)
• all uses of _PASS_CC to either
  ‣ ${_PASS_CC:T:Q} (when passing, e.g. for libtool – this is for use
    when ${WRKDIR}/bin is in $$PATH)
  ‣ ${_PASS_CC:Q} (when invoking, e.g. in post-build targets – only
    these I saw when mechanically doing this; Benny wants to fix the
    remaining ones; I should’ve introduced no more breakage than was)
• _PASS_CXX/mpcxx just the same

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.12 2009/01/03 20:45:39 bsiegert Exp $
d5 1
a5 1
.ifndef MODPERL_ARCH
@


1.12
log
@bsd.port.mk: Implement ${MODFOO_post-fake}, which is run just before
the "post-install" target, if any.

perl.port.mk: In post-fake, remove .packlist file and prune empty directories
under P5ARCH, including maybe P5ARCH itself. Thus, no more manually editing
PLIST files for perl module ports!
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.11 2008/10/04 18:37:32 tg Exp $
d42 1
a42 1
	CC=${_PASS_CC:Q} CFLAGS=${CFLAGS:M*:Q} CXX=${_PASS_CXX:Q} \
@


1.11
log
@fix the ccache thing as discusses:
we now always use
_PASS_CC=	/usr/ports/security/pgp+/w-pgp-2.6.3in-3/bin/mpcc
_PASS_CXX=	/usr/ports/security/pgp+/w-pgp-2.6.3in-3/bin/mpcxx
for compilation; the new _ORIG_CC and _ORIG_CXX are saved (_ORIG_CXX is
even not set to false) and used for Darwin spec file generation (Benny,
please test if this works); Systrace doesn’t bitch; and we now have two
_USE_CC and _USE_CXX variables wich contain what is actually written in
the mpcc and mpcxx files. All six of these are internal, but a Makefile
should™ use _PASS_CC and _PASS_CXX ipv CC and CXX, so that things still
will work when the user overrides CC via the command line (but it works
if he doesn’t already)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.10 2008/03/15 23:16:54 tg Exp $
d49 1
a49 1
MODPERL_pre_fake= \
d53 4
@


1.10
log
@bsiegert@@ agrees that it’s better to have all the variables in the p5 module
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.9 2008/03/14 20:19:43 tg Exp $
d42 1
a42 1
	CC=${CC:Q} CFLAGS=${CFLAGS:M*:Q} CXX=${CXX:Q} \
@


1.9
log
@add new “p5” module, included implicitly by “perl” module
every non-modperl user of ${P5ARCH} *must* now include that
it contains the real fix for darwin-thread-multi-2level and
x86-interix-thread-multi… and cleans up the confusion between
i386-midnightbsd and i386-freebsd-64int…
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.8 2007/10/04 16:52:45 bsiegert Exp $
a70 5

P5MAN3EXT!=	/usr/bin/perl -e 'use Config; print ".".$$Config{man3ext};'
P5DLEXT!=	/usr/bin/perl -e 'use Config; print ".".$$Config{dlext};'

SUBST_VARS+=	P5SITE P5MAN3EXT P5DLEXT
@


1.8
log
@Make most of the ExtUtils::MakeMaker stuff apply only when
CONFIGURE_STYLE=perl, so you can do e.g.

MODULES+=perl

and profit from definitions like P5ARCH, P5SITE, and MODPERL_CONFIG_VARS.
The latter contains variables given to Makefile.PL and can be appended in
the port Makefile.
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.7 2006/11/24 01:15:08 tg Exp $
d5 4
a9 1
MODPERL_ARCH!=	/usr/bin/perl -e 'use Config; print $$Config{archname}, "\n";'
d75 1
a75 1
SUBST_VARS+=	P5ARCH P5SITE P5MAN3EXT P5DLEXT
@


1.7
log
@use :M* not :C/ *$//
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.6 2005/12/28 16:35:36 tg Exp $
a4 1
REGRESS_TARGET?=test
d13 12
d36 2
a37 1
.else
d42 2
a43 11
     	PREFIX=${PREFIX:Q} INSTALLSITELIB=${MODPERL_SITEPRE:Q} \
	INSTALLSITEARCH="\$${INSTALLSITELIB}/${MODPERL_ARCH}" \
	INSTALLPRIVLIB=${MODPERL_DESTDIR:Q}/usr/libdata/perl5 \
	INSTALLARCHLIB="\$${INSTALLPRIVLIB}/${MODPERL_ARCH}" \
	INSTALLBIN=${MODPERL_PRE:Q}/bin INSTALLSCRIPT='$${INSTALLBIN}' \
	INSTALLMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLSITEMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLVENDORMAN1DIR=${MODPERL_MANPRE:Q}1 \
	INSTALLMAN3DIR=${MODPERL_MANPRE:Q}3 \
	INSTALLSITEMAN3DIR=${MODPERL_MANPRE:Q}3 \
	INSTALLVENDORMAN3DIR=${MODPERL_MANPRE:Q}3 ${CONFIGURE_ARGS}
@


1.6
log
@same treatment for the manpage extension
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.5 2005/12/28 16:20:27 tg Exp $
d27 2
a28 2
	CC=${CC:Q} CFLAGS=${CFLAGS:C/ *$//:Q} CXX=${CXX:Q} \
	CXXFLAGS=${CXXFLAGS:C/ *$//:Q} YACC=${YACC:Q} LD=${LD:Q} \
@


1.5
log
@change P5DLEXT from 'so' to '.so'
(hint: try mmake plist on a port which has files called sound*)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.4 2005/12/15 14:47:45 bsiegert Exp $
d66 1
a66 1
P5MAN3EXT!=	/usr/bin/perl -e 'use Config; print $$Config{man3ext};'
@


1.4
log
@Add two new subst vars for perl:

* P5MAN3EXT contains the extension for perl manpages (configure-time option)
* P5LDEXT contains the extension for dlopened perl modules (platform-specific)

These should be substituted in ALL p5-* Makefiles. I have tested the URI and
Socket6 ports, and they now work under Darwin. The substitution for the other
Makefiles will be done with a little ed script.

p5-Socket6 change ok tg@@ (maintainer)
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.3 2005/12/15 01:24:43 tg Exp $
d67 1
a67 1
P5DLEXT!=	/usr/bin/perl -e 'use Config; print $$Config{dlext};'
@


1.3
log
@* use ${FOO:Q} i.p.v. '${FOO}' or "${FOO}"
* replace v='' and v="" with v= while here
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.2 2005/06/24 17:37:13 tg Exp $
d66 4
a69 1
SUBST_VARS+=	P5ARCH P5SITE
@


1.2
log
@allow WRKSRC override
@
text
@d1 1
a1 1
# $MirOS: ports/infrastructure/mk/perl.port.mk,v 1.1.7.1 2005/03/18 15:47:19 tg Exp $
d19 6
a24 6
	/usr/bin/perl Build.PL install_path=lib="${MODPERL_SITEPRE}" \
	install_path=arch="${MODPERL_SITEPRE}/${MODPERL_ARCH}" \
	install_path=libdoc="${MODPERL_MANPRE}3" \
	install_path=bindoc="${MODPERL_MANPRE}1" \
	install_path=bin="${MODPERL_PRE}/bin" \
	install_path=script="${MODPERL_PRE}/bin" ${CONFIGURE_ARGS} 
d27 4
a30 4
	CC="${CC}" CFLAGS="${CFLAGS:C/ *$//}" CXX="${CXX}" \
	CXXFLAGS="${CXXFLAGS:C/ *$//}" YACC="${YACC}" LD="${LD}" \
	LDFLAGS="${LDFLAGS}" /usr/bin/perl Makefile.PL \
     	PREFIX='${PREFIX}' INSTALLSITELIB='${MODPERL_SITEPRE}' \
d32 1
a32 1
	INSTALLPRIVLIB='${MODPERL_DESTDIR}/usr/libdata/perl5' \
d34 7
a40 7
	INSTALLBIN='${MODPERL_PRE}/bin' INSTALLSCRIPT='$${INSTALLBIN}' \
	INSTALLMAN1DIR='${MODPERL_MANPRE}1' \
	INSTALLSITEMAN1DIR='${MODPERL_MANPRE}1' \
	INSTALLVENDORMAN1DIR='${MODPERL_MANPRE}1' \
	INSTALLMAN3DIR='${MODPERL_MANPRE}3' \
	INSTALLSITEMAN3DIR='${MODPERL_MANPRE}3' \
	INSTALLVENDORMAN3DIR='${MODPERL_MANPRE}3' ${CONFIGURE_ARGS}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $MirOS$
d12 1
d18 1
a18 1
MODPERL_configure= cd ${WRKSRC}; ${_SYSTRACE_CMD} ${SETENV} ${CONFIGURE_ENV} \
d26 1
a26 1
MODPERL_configure= cd ${WRKSRC}; ${_SYSTRACE_CMD} ${SETENV} ${CONFIGURE_ENV} \
d50 1
a50 1
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
d55 1
a55 1
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
d61 1
a61 1
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} /usr/bin/perl \
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
