head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2007.04.03.19.42.25;	author tg;	state dead;
branches;
next	1.1;
commitid	1004612AC977E789195;

1.1
date	2005.11.17.14.48.41;	author tg;	state Exp;
branches;
next	;
commitid	22d8437c97fd966a;


desc
@@


1.2
log
@• remove ports that are simply broken, don't work, for too long, with no
  update or update-willing person in sight, kde stuff, web2.0 stuff that
  we don't want in ports (just stuff it into /var/www yourself, it isn't
  that difficult, right?), stuff for which no new version exists/will be
  and some obsd cruft; adjust dependencies
• no BUILD_DEPENDS+=RUN_DEPENDS or vice versa any more, *ever*
• fix some other stuff partially

ok bsiegert@@
@
text
@$MirOS: ports/emulators/qvm86/patches/patch-vl_c,v 1.1 2005/11/17 14:48:41 tg Exp $
--- vl.c.orig	Tue Nov 15 22:16:05 2005
+++ vl.c	Thu Nov 17 14:35:23 2005
@@@@ -43,7 +43,7 @@@@
 #include <netdb.h>
 #ifdef _BSD
 #include <sys/stat.h>
-#ifndef __APPLE__
+#if !defined(__APPLE__) && !defined(__OpenBSD__)
 #include <libutil.h>
 #endif
 #else
@@@@ -509,10 +509,18 @@@@ int64_t cpu_get_real_ticks(void)
 
 #elif defined(__i386__)
 
+#ifdef __OpenBSD__
+#include <machine/pctr.h>
+#endif
+
 int64_t cpu_get_real_ticks(void)
 {
     int64_t val;
+#ifdef __OpenBSD__
+    val = rdtsc();
+#else
     asm volatile ("rdtsc" : "=A" (val));
+#endif
     return val;
 }
 
@@@@ -917,13 +925,6 @@@@ static int start_rtc_timer(void)
     return 0;
 }
 
-#else
-
-static int start_rtc_timer(void)
-{
-    return -1;
-}
-
 #endif /* !defined(__linux__) */
 
 #endif /* !defined(_WIN32) */
@@@@ -992,7 +993,9 @@@@ static void init_timers(void)
         } else 
 #endif /* defined(__linux__) */
         {
+#if defined(__linux__)
         use_itimer:
+#endif
             pit_min_timer_count = ((uint64_t)itv.it_interval.tv_usec * 
                                    PIT_FREQ) / 1000000;
         }
@@@@ -2022,6 +2025,7 @@@@ static int tap_open(char *ifname, int if
 {
     int fd;
     char *dev;
+#ifndef __OpenBSD__
     struct stat s;
 
     fd = open("/dev/tap", O_RDWR);
@@@@ -2032,6 +2036,22 @@@@ static int tap_open(char *ifname, int if
 
     fstat(fd, &s);
     dev = devname(s.st_rdev, S_IFCHR);
+#else
+    char dvn[20];
+    int n;
+
+    dev = dvn;
+    for (n = 0; n < 2147483647; ++n) {
+	snprintf(dvn, sizeof(dvn), "/dev/tun%d", n);
+	if ((fd = open(dvn, O_RDWR)) != -1)
+	    break;
+    }
+    if (fd == -1) {
+	fprintf(stderr, "warning: failed to open /dev/tunN for N = 0 .. 2147483647, no virtual network emulation\n");
+	return -1;
+    }
+    printf("Connected to host network interface: %s\n", dvn);
+#endif
     pstrcpy(ifname, ifname_size, dev);
 
     fcntl(fd, F_SETFL, O_NONBLOCK);
@@@@ -4179,7 +4199,7 @@@@ int main(int argc, char **argv)
         serial_devices[i][0] = '\0';
     serial_device_index = 0;
     
-    pstrcpy(parallel_devices[0], sizeof(parallel_devices[0]), "vc");
+    pstrcpy(parallel_devices[0], sizeof(parallel_devices[0]), "null");
     for(i = 1; i < MAX_PARALLEL_PORTS; i++)
         parallel_devices[i][0] = '\0';
     parallel_device_index = 0;
@


1.1
log
@initial port of qemu-HEAD + qvm86-HEAD
* not tested, only a make-compile attempt
  -> pcnet and so on removed
* i386 -> i386 only
* kqemu/qvm86 support disabled for now
  (no attempt at porting the LKM has been done yet)
* untested if it still works

conflicts with qemu-* of course (bsiegert@@ please check the syntax :)
@
text
@d1 1
a1 1
$MirOS: ports/emulators/qemu/patches/patch-vl_c,v 1.3 2005/11/15 12:25:10 tg Exp $
@

