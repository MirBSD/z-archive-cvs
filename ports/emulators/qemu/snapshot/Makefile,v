head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2015.10.13.21.48.31;	author tg;	state Exp;
branches;
next	1.5;
commitid	100561D7C4151CBFFC0;

1.5
date	2009.10.17.21.43.52;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004ADA3A7B39AC3403;

1.4
date	2009.08.16.16.26.45;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004A882F1F72B43308;

1.3
date	2008.10.04.19.03.06;	author tg;	state Exp;
branches;
next	1.2;
commitid	10048E7BD9A0842B398;

1.2
date	2008.05.11.20.35.46;	author tg;	state Exp;
branches;
next	1.1;
commitid	100482758AB5CB3B36E;

1.1
date	2008.05.07.15.53.06;	author tg;	state Exp;
branches;
next	;
commitid	1004821D01929BE53C2;


desc
@@


1.6
log
@… of course, kqemu got dropped upstream eventually anyway
@
text
@# $MirOS: ports/emulators/qemu/snapshot/Makefile,v 1.5 2009/10/17 21:43:52 tg Exp $
# $OpenBSD: Makefile,v 1.32 2008/04/28 22:52:38 todd Exp $
# $NetBSD: Makefile,v 1.60 2009/10/11 16:04:13 asau Exp $

# no success building on other platforms yet
ONLY_FOR_PLATFORMS=	\
			MirBSD:*:i386 \
			OpenBSD:*:i386 \
			OpenBSD:*:macppc

COMMENT=		multi system emulator
DISTNAME=		qemu-0.11.0
CATEGORIES=		emulators
HOMEPAGE=		http://wiki.qemu.org/Index.html
MASTER_SITES=		http://download.savannah.gnu.org/releases/qemu/

# GPLv2/LGPLv2/BSD
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes

.include <mirports.sys.mk>

BUILD_DEPENDS+=		::textproc/texi2html
LIB_DEPENDS+=		SDL::devel/sdl
USE_GMAKE=		Yes
USE_X11=		Yes
FILESDIR=		${.CURDIR}/../files
CONFIGURE_STYLE=	simple
CONFIGURE_ARGS+=	--prefix=${PREFIX:Q} \
			--interp-prefix=${LOCALBASE:Q}/share/qemu/gnemul-%M \
			--cc=${_PASS_CC:T:Q} \
			--make=${GMAKE:Q} \
			--audio-card-list='ac97 es1370 sb16 adlib'
#CONFIGURE_ARGS+=	--enable-werror
CPPFLAGS+=		-DMPPREFIX=\"${LOCALBASE:Q}\"
EXTRA_XAKE_FLAGS+=	V=1
EXTRA_XAKE_FLAGS+=	INSTALL_DIR=${INSTALL_DATA_DIR:Q}
VMEM_WARNING=		Yes

# Currently, the regression tests are utterly broken.
NO_REGRESS=		Yes

post-extract:
	cp ${FILESDIR}/{{gnu-c99-math,vgafont}.h,scn.c} ${WRKSRC}/

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/qemu
	${INSTALL_SCRIPT} ${FILESDIR}/qemu-if{up,down} \
	    ${FILESDIR}/Makefile.multinode-NetBSD \
	    ${PREFIX}/share/examples/qemu/

.include <bsd.port.mk>
@


1.5
log
@new qemu, slight help from pkgsrc® here (website only shows RC…)

• sparc: regression against 0.10.1/linux – fdc probing results
  in a timeout and then an unexpected interrupt or something
  (probably skippable via UKC)
• i386: findcpuspeed division by zero, should be fixable
@
text
@d1 1
a1 1
# $MirOS: ports/emulators/qemu/snapshot/Makefile,v 1.4 2009/08/16 16:26:45 tg Exp $
d14 1
a14 1
HOMEPAGE=		http://www.nongnu.org/qemu/
@


1.4
log
@change
• _PASS_CC back from 「mpcc」 to 「${WRKDIR}/bin/mpcc」 (note that the
  former 「${WRKDIR:Q}/bin/mpcc」 was wrong)
• all uses of _PASS_CC to either
  ‣ ${_PASS_CC:T:Q} (when passing, e.g. for libtool – this is for use
    when ${WRKDIR}/bin is in $$PATH)
  ‣ ${_PASS_CC:Q} (when invoking, e.g. in post-build targets – only
    these I saw when mechanically doing this; Benny wants to fix the
    remaining ones; I should’ve introduced no more breakage than was)
• _PASS_CXX/mpcxx just the same

agreed bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/emulators/qemu/snapshot/Makefile,v 1.3 2008/10/04 19:03:06 tg Exp $
d3 1
a7 1
			OpenBSD:*:amd64 \
d12 1
a12 1
DISTNAME=		qemu-0.9.1
d14 2
a15 2
HOMEPAGE=		http://fabrice.bellard.free.fr/qemu/
MASTER_SITES=		${HOMEPAGE}
d32 1
d35 1
a35 5
			--interp-prefix=${LOCALBASE:Q}/share/qemu/gnemul-%M \
			--extra-cflags=${CFLAGS:M*:Q} \
			--extra-ldflags=${LDFLAGS:M*:Q} \
			--enable-adlib \
			--disable-vnc-tls
d38 3
d43 1
a43 5
REGRESS_TARGET=		test test2

.if ${MACHINE_ARCH} == "amd64"
PATCH_LIST=		patch-* misc-*
.endif
d51 1
@


1.3
log
@mass conversion from
• ${CC}
• "${CC}"
• '${CC}'
• ${CC:Q}
to ${_PASS_CC:Q} (or without :Q if it’s executed, not assigned), and
same for CXX… most of these are VERY UGLY, prone to break with ccache
and maybe even without…
@
text
@d1 1
a1 1
# $MirOS: ports/emulators/qemu/snapshot/Makefile,v 1.2 2008/05/11 20:35:46 tg Exp $
d32 1
a32 1
			--cc=${_PASS_CC:Q} \
@


1.2
log
@• unify builds
• bring kqemu to qemu-stable
@
text
@d1 1
a1 1
# $MirOS: ports/emulators/qemu/snapshot/Makefile,v 1.1 2008/05/07 15:53:06 tg Exp $
d32 1
a32 1
			--cc=${CC:Q} \
@


1.1
log
@add qemu-0.9.1 port snitched from openbsd, with most of our old patches
applied, and fixed to build with -Werror as well

pro:
• can netboot openbsd 3.9-current/amd64
• can _almost_ boot mirbsd #10/sparc (bsd.rd has issues with esp, bsd.net
  has none, except I have no rootfs handy ATM)
• can still boot MS-DOS
• said to be able to use kqemu – untested

con:
• regression: can *NOT* boot mirbsd #10/i386 any more
@
text
@d1 1
a1 1
# $MirOS: ports/emulators/qemu/Makefile,v 1.8 2007/06/30 02:31:28 tg Exp $
d29 1
d33 1
@

