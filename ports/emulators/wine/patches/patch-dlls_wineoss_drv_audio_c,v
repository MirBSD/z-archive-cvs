head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2008.07.30.00.15.48;	author tg;	state Exp;
branches;
next	;
commitid	100488FB23E3E0E7494;


desc
@@


1.1
log
@Wine 1.0 port, mostly taken from pkgsrc®

request for help: there is probably something about mmap.c the only
thing preventing us from running this… similar to the issues outlined
in the FreeBSD wiki about Wine, but made harder due to W^X probably

This will almost certainly not work on MidnightBSD, have a hard time
working on OpenBSD (especially due to no VFORK_SHM there), is totally
untested on Darwin (and PFRAG.dylib is missing), and not for Interix;
I wonder if it would work on NetBSD® (it should) if MirPorts ran the-
re, but if so, it had IPX support, which theirs doesn’t ☺
@
text
@$MirOS$
$NetBSD: patch-bc,v 1.1 2008/06/27 02:51:11 jmcneill Exp $
--- dlls/wineoss.drv/audio.c.orig	Tue Jun 17 14:07:08 2008
+++ dlls/wineoss.drv/audio.c	Tue Jul 29 17:52:28 2008
@@@@ -75,6 +75,12 @@@@
 
 #include "audio.h"
 
+#if defined(__NetBSD__) || defined(__OpenBSD__)
+#define SOUND_DEV	"/dev/sound"
+#else
+#define SOUND_DEV	"/dev/dsp"
+#endif
+
 WINE_DEFAULT_DEBUG_CHANNEL(wave);
 
 /* Allow 1% deviation for sample rates (some ES137x cards) */
@@@@ -1167,12 +1173,12 @@@@ LRESULT OSS_WaveInit(void)
     }
     else
     {
-        WOutDev[0].ossdev.dev_name = WInDev[0].ossdev.dev_name = StrDup("/dev/dsp",NULL);
+        WOutDev[0].ossdev.dev_name = WInDev[0].ossdev.dev_name = StrDup(SOUND_DEV,NULL);
         WOutDev[0].ossdev.mixer_name = WInDev[0].ossdev.mixer_name = StrDup("/dev/mixer",NULL);
         for (i = 1; i < MAX_WAVEDRV; ++i)
         {
             WOutDev[i].ossdev.dev_name = WInDev[i].ossdev.dev_name = HeapAlloc(GetProcessHeap(),0,11);
-            sprintf(WOutDev[i].ossdev.dev_name, "/dev/dsp%d", i);
+            sprintf(WOutDev[i].ossdev.dev_name, SOUND_DEV "%d", i);
             WOutDev[i].ossdev.mixer_name = WInDev[i].ossdev.mixer_name = HeapAlloc(GetProcessHeap(),0,13);
             sprintf(WOutDev[i].ossdev.mixer_name, "/dev/mixer%d", i);
         }
@
