head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2007.06.26.21.23.30;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	1004681833C769527EE;

1.1
date	2005.03.18.15.44.51;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.44.51;	author tg;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 2.14.6, the exact same version as in OpenBSD ports. It was from
there that I took the patches, except that they didn't work. So it was
still not trivial.

This port is a nightmare. It is full of system dependencies. Just one look
at the patch filenames should tell you enough. It actually defines _KERNEL
in some places to get things like struct msginfo. Its server is sgid kmem.
@
text
@$OpenBSD: patch-sysdeps_freebsd_prockernel_c,v 1.4 2007/01/18 19:31:34 jasper Exp $
--- sysdeps/freebsd/prockernel.c.orig	Wed Jan 17 08:57:14 2007
+++ sysdeps/freebsd/prockernel.c	Wed Jan 17 09:00:34 2007
@@@@ -35,8 +35,9 @@@@
 #if (!defined __OpenBSD__) && (!defined __bsdi__)
 #include <sys/user.h>
 #endif
-#if !defined(__bsdi__) && !(defined(__FreeBSD__) && defined(__alpha__)) && \
-    !defined(__NetBSD__) 
+#if !(defined(__NetBSD__) || defined(__bsdi__) || defined(__FreeBSD__) || \
+      defined(__OpenBSD__)) && \
+     defined(__alpha__)
 #include <machine/pcb.h>
 #endif
 
@@@@ -84,7 +85,9 @@@@ void
 glibtop_init_proc_kernel_p (glibtop *server)
 {
 	server->sysdeps.proc_kernel = _glibtop_sysdeps_proc_kernel_pstats |
+#if (!defined __OpenBSD__) || (defined __i386__)
 		_glibtop_sysdeps_proc_kernel_pcb |
+#endif
 		_glibtop_sysdeps_proc_kernel_wchan;
 }
 
@@@@ -216,13 +219,15 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
 			/*xxx FreeBSD/Alpha? */
 #endif
 #else
-#ifdef __i386__
+#if (!defined __OpenBSD__) || (defined __i386__)
 			buf->kstk_esp = (guint64) pcb.pcb_tss.tss_esp0;
 #ifdef __bsdi__
 			buf->kstk_eip = (guint64) pcb.pcb_tss.tss_eip;
 #else
+#if (!defined __OpenBSD__) || (defined __i386__)
 			buf->kstk_eip = (guint64) pcb.pcb_tss.__tss_eip;
 #endif
+#endif
 #else
 #if defined(__NetBSD__)
 #if defined(__m68k__)
@@@@ -249,7 +254,10 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
 			buf->kstk_eip = (guint64) 0;
 #endif /* ${MACHINE_ARCH} */
 #endif /* __NetBSD__ */
+
+#if (!defined __OpenBSD__) || (defined __i386__)
 			buf->flags |= _glibtop_sysdeps_proc_kernel_pcb;
+#endif
 #endif
 #endif
 		}
@


1.1
log
@Initial revision
@
text
@d1 5
a5 3
--- sysdeps/freebsd/prockernel.c.orig	2004-07-18 22:33:34.000000000 +0200
+++ sysdeps/freebsd/prockernel.c	2005-03-01 17:59:24.000000000 +0100
@@@@ -35,7 +35,7 @@@@
d8 5
a12 3
 #if !defined(__bsdi__) && !(defined(__FreeBSD__) && defined(__alpha__)) && \
-    !defined(__NetBSD__)
+    !defined(__NetBSD__) || !defined(__OpenBSD__)
d16 9
a24 18
@@@@ -46,15 +46,7 @@@@
 #include <osreldate.h>
 #endif
 
-#ifdef __NetBSD__
-#include <machine/vmparam.h>
-#include <machine/pmap.h>
-#ifdef __arm32__
-#define	KERNBASE	KERNEL_BASE
-#endif
-#endif
-
-#ifdef __NetBSD__
+#ifdef __NetBSD__ || defined(__OpenBSD__)
 #include <machine/vmparam.h>
 #include <machine/pmap.h>
 #ifdef __arm32__
@@@@ -132,7 +124,7 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
d26 2
a28 24
 
-#if !defined(__NetBSD__) || !defined(SACTIVE)
+#if !defined(__NetBSD__) && !defined(__OpenBSD__) || !defined(SACTIVE)
 	buf->nwchan = (unsigned long) pinfo [0].PROC_WCHAN &~ KERNBASE;
 
 	buf->flags |= (1L << GLIBTOP_PROC_KERNEL_NWCHAN);
@@@@ -164,8 +156,8 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
 
 	glibtop_suid_enter (server);
 
-#if !defined(__NetBSD__) || !defined(SACTIVE)
-#ifdef __NetBSD__
+#if !defined(__NetBSD__) && !defined(__OpenBSD__) || !defined(SACTIVE)
+#if defined(__NetBSD__) || defined(__OpenBSD__)
 	/* On NetBSD, there is no kvm_uread(), and kvm_read() always reads
 	 * from kernel memory.  */
 
@@@@ -193,7 +185,7 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
 			buf->flags |= _glibtop_sysdeps_proc_kernel_pstats;
 		}
 
-#ifdef __NetBSD__
+#ifdef __NetBSD__ || defined(__OpenBSD__)
 	if (kvm_read (server->machine.kd,
d30 7
a36 2
 	if ((pinfo [0].kp_proc.p_flag & P_INMEM) &&
@@@@ -223,7 +215,7 @@@@ glibtop_get_proc_kernel_p (glibtop *serv
d39 1
d41 1
a41 2
-#if defined(__NetBSD__)
+#if defined(__NetBSD__) || defined(__OpenBSD__)
d43 1
a43 1
 			buf->kstk_esp = (guint64) pcb.pcb_usp;
d45 9
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
