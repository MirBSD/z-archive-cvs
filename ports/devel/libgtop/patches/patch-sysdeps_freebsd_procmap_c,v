head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2007.06.26.21.23.30;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	1004681833C769527EE;

1.1
date	2005.03.18.15.44.51;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.44.51;	author tg;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 2.14.6, the exact same version as in OpenBSD ports. It was from
there that I took the patches, except that they didn't work. So it was
still not trivial.

This port is a nightmare. It is full of system dependencies. Just one look
at the patch filenames should tell you enough. It actually defines _KERNEL
in some places to get things like struct msginfo. Its server is sgid kmem.
@
text
@$MirOS$
$OpenBSD: patch-sysdeps_freebsd_procmap_c,v 1.6 2007/02/21 17:27:54 steven Exp $
--- sysdeps/freebsd/procmap.c.orig	Tue Jan  2 23:50:28 2007
+++ sysdeps/freebsd/procmap.c	Sun Feb 18 20:23:18 2007
@@@@ -36,7 +36,7 @@@@
 #include <vm/vm_object.h>
 #include <vm/vm_prot.h>
 #include <vm/vm_map.h>
-#elif defined(__NetBSD__) && (__NetBSD_Version__ >= 105020000)
+#elif defined(__NetBSD__) && (__NetBSD_Version__ >= 105020000) || defined(__OpenBSD__)
 #include <uvm/uvm_extern.h>
 #else
 #include <vm/vm_object.h>
@@@@ -64,11 +64,11 @@@@
 #include <sys/user.h>
 #endif
 #include <sys/sysctl.h>
-#if !defined(__NetBSD__) || (__NetBSD_Version__ < 105020000)
+#if (!defined(__NetBSD__) || (__NetBSD_Version__ < 105020000)) && ! defined(__OpenBSD__)
 #include <vm/vm.h>
 #endif
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000) || defined(__OpenBSD__)
 /* Fixme ... */
 #undef _KERNEL
 #define _UVM_UVM_AMAP_I_H_ 1
@@@@ -102,7 +102,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
 	struct kinfo_proc *pinfo;
 	struct vm_map_entry entry, *first;
 	struct vmspace vmspace;
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000) || defined(__OpenBSD__)
 	struct vnode vnode;
 	struct inode inode;
 #else
@@@@ -167,7 +167,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
 
 	/* I tested this a few times with `mmap'; as soon as you write
 	 * to the mmap'ed area, the object type changes from OBJT_VNODE
-	 * to OBJT_DEFAULT so if seems this really works. */
+	 * to OBJT_DEFAULT so it seems this really works. */
 
 	do {
 		if (update) {
@@@@ -188,7 +188,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
  			continue;
 #endif
 #else
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000) || defined(__OpenBSD__)
  		if (UVM_ET_ISSUBMAP (&entry))
 			continue;
 #else
@@@@ -214,7 +214,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
 
 		i++;
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000) || defined(__OpenBSD__)
 		if (!entry.object.uvm_obj)
 			continue;
 
@@@@ -238,7 +238,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
 			glibtop_error_io_r (server, "kvm_read (object)");
 #endif
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000) || defined(__OpenBSD__)
 #if defined(UVM_VNODE_VALID)
 		if (!vnode.v_uvm.u_flags & UVM_VNODE_VALID)
 			continue;
@


1.1
log
@Initial revision
@
text
@d1 5
a5 3
--- sysdeps/freebsd/procmap.c.orig	Wed Jun  9 11:52:21 2004
+++ sysdeps/freebsd/procmap.c	Fri Dec 10 19:15:09 2004
@@@@ -35,7 +35,7 @@@@
d14 2
a15 1
@@@@ -58,10 +58,12 @@@@
d18 3
a20 4
 #if !defined(__NetBSD__) || (__NetBSD_Version__ < 105020000)
-#include <vm/vm.h>
+#include <uvm/uvm.h>
+#else
d24 1
a24 2
+#if defined(__NetBSD__) && \
+    (__NetBSD_Version__ >= 104000000) && (__NetBSD_Version__ < 105020000)
d28 1
a28 1
@@@@ -95,7 +97,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
d37 10
a46 1
@@@@ -179,7 +181,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
d55 1
a55 1
@@@@ -205,7 +207,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
d64 1
a64 1
@@@@ -229,7 +231,7 @@@@ glibtop_get_proc_map_p (glibtop *server,
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
