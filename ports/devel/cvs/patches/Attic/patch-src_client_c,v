head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2012.02.11.19.29.56;	author tg;	state dead;
branches;
next	1.4;
commitid	1004F36C11F02848ED5;

1.4
date	2011.06.11.03.55.36;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004DF2E74A6938C5EF;

1.3
date	2010.09.18.22.35.09;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004C953D8624E3E654;

1.2
date	2010.09.15.23.41.21;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004C9159AB6B64B332;

1.1
date	2010.09.15.20.56.59;	author tg;	state Exp;
branches;
next	;
commitid	1004C9132F41004B31C;


desc
@@


1.5
log
@update the CVS package in MirPorts (to match base and Debian)

• since the Debian cvs source package was taken over by this one,
  reverse things and use the Debian *.diff.gz to get our patches
  from ;-) saves tracking things in CVS thrice
• since the Debian cvs binary package contains PDF documentation
  generated from something with our patches, ship it instead of
  the one from the vanilla CVS distfile
• ship cvs-switchroot(1) from Debian, which is just a fancy name
  for mircvs://src/scripts/mnt-cvsroot and has a manpage
• move stuff from PREFIX/share/cvs to PREFIX/share/doc/cvs as is proper
• fix regression testsuite on MirBSD as much as possible (same as base)
@
text
@$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.4 2011/06/11 03:55:36 tg Exp $
--- src/client.c.orig	Sun Oct  2 15:16:58 2005
+++ src/client.c	Sat Jun 11 03:06:20 2011
@@@@ -20,6 +20,8 @@@@
 #include "buffer.h"
 #include "save-cwd.h"
 
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.4 2011/06/11 03:55:36 tg Exp $");
+
 #ifdef CLIENT_SUPPORT
 
 # include "log-buffer.h"
@@@@ -3901,8 +3903,12 @@@@ open_connection_to_server (cvsroot_t *ro
 	case ext_method:
 #ifdef NO_EXT_METHOD
 	    error (0, 0, ":ext: method not supported by this port of CVS");
+	    if (0)
+	case extssh_method:
+		error (0, 0, ":extssh: method not supported by this port of CVS");
 	    error (1, 0, "try :server: instead");
 #else /* ! NO_EXT_METHOD */
+	case extssh_method:
 	    start_rsh_server (root, to_server_p,
                               from_server_p);
 #endif /* NO_EXT_METHOD */
@@@@ -4362,7 +4368,7 @@@@ send_modified (const char *file, const c
 	  sprintf (tmp, "%lu\n", (unsigned long) newsize);
 	  send_to_server (tmp, 0);
 
-          send_to_server (buf, newsize);
+          send_to_server ((const void *)buf, newsize);
         }
     }
     else
@@@@ -4415,7 +4421,7 @@@@ send_modified (const char *file, const c
 	 * one.
 	 */
 	if (newsize > 0)
-	    send_to_server (buf, newsize);
+	    send_to_server ((const void *)buf, newsize);
     }
     free (buf);
     free (mode_string);
@


1.4
log
@update and bring them in sync
@
text
@d1 1
a1 1
$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.3 2010/09/18 22:35:09 tg Exp $
d8 1
a8 1
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.3 2010/09/18 22:35:09 tg Exp $");
@


1.3
log
@wip mostly from working on testsuite
• run part of it under posixtz (can't do for all of it because date(1) is
  linked statically and thus not affected, which breaks parts of it)
• sync getdate.c
• adjust getdate testsuite against our output format
• revert debian patches because they break things and the original issues
  cannot be reproduced anyway
  ‣ 93_homedir
  ‣ 95_flag_conflicted_copies
• parseinfo.c: correct off-by-one bug in the original GNU CVS, discovered
  because of the testsuite (it was not adapted to binary ISO units yet)
• sanity.sh: work on the cvs testsuite
  – add (commented out) debug to aid temporarily
  – configure UserAdminOptions because --with-cvs-admin-group=_cvsadmin
  – accept our version strings
  – recognise GNU getopt changed error messages
  – run part of it with posixtz
  – sync with changed output
  – use ISO/IEC 60027-2 binary præficēs properly
@
text
@d1 1
a1 1
$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.2 2010/09/15 23:41:21 tg Exp $
d3 1
a3 1
+++ src/client.c	Wed Sep 15 23:31:26 2010
d8 1
a8 1
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.2 2010/09/15 23:41:21 tg Exp $");
d13 14
a26 1
@@@@ -4362,7 +4364,7 @@@@ send_modified (const char *file, const c
d35 1
a35 1
@@@@ -4415,7 +4417,7 @@@@ send_modified (const char *file, const c
@


1.2
log
@oh well… warning freeness (-Wall -Werror on MirBSD, some on MirDebian)
@
text
@d1 1
a1 1
$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.1 2010/09/15 20:56:59 tg Exp $
d8 1
a8 1
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_client_c,v 1.1 2010/09/15 20:56:59 tg Exp $");
a30 14
@@@@ -4533,10 +4535,9 @@@@ warning: ignoring -k options due to serv
 	/* File no longer exists.  Don't do anything, missing files
 	   just happen.  */
     }
-    else if (!vers->ts_rcs || args->force
-	     || strcmp (vers->ts_conflict
-		        ? vers->ts_conflict : vers->ts_rcs, vers->ts_user)
-	     || (vers->ts_conflict && !strcmp (cvs_cmd_name, "diff")))
+    else if (vers->ts_rcs == NULL
+             || args->force
+             || strcmp (vers->ts_user, vers->ts_rcs) != 0)
     {
 	if (args->no_contents
 	    && supported_request ("Is-modified"))
@


1.1
log
@WIP port (will be worked on more, commit for safety)

Some changes, in this order:
• re-sync with MirOS base cvs
• reduce diff against upstream
• apply cvs-datetime.patch from Arkadiusz Miskiewicz <arekm>
  via Concurrent Versions System - Bugs: bug #21523, can't parse date/time: =UTC when commiting file (workaround/fix attached)
• apply (only those considered somewhat sane) patches from Debian cvs_1:1.12.13-12
  – 11_check_method_crash
  – 12_rcs2log_POSIX_sort
  – 14_ext_expansion
  – 15_PATH_MAX_check
  – 20_readdir_errno
  – 21_getcwd_chroot
  – 25_import-n-X
  – 51_newlines_in_commit_template (partially)
  – 55_keyword_alphanumerics (modified)
  – 62_cvsrc_whitespace
  – 65_login_cvspass_message
  – 69_ext_allowroot (modified)
  – 71_cvsbug_tmpfix
  – 81_fix_-l (modified)
  – 85_normalize_correct_roots
  – 86_server_wrapper (modified)
  – 93_homedir (modified)
  – 95_flag_conflicted_copies
  – 96_manpage_fixes (partially)
  – 97_cvs.info.typo (partially)
  – 98_fix_sparc_sigbus.diff
• document Debian’s changes in the Texinfo manual
• modify mkman.pl to produce more correct looking output
• point to texinfo HTML document from HTML manpage
• fix fseeko configure.in test
• correct bugs in Debian’s changes
@
text
@d1 1
a1 1
$MirOS$
d3 1
a3 1
+++ src/client.c	Wed Sep 15 19:36:15 2010
d8 1
a8 1
+__RCSID("$MirOS$");
d13 18
@

