head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2012.02.11.19.29.56;	author tg;	state dead;
branches;
next	1.1;
commitid	1004F36C11F02848ED5;

1.1
date	2010.09.18.23.14.07;	author tg;	state Exp;
branches;
next	;
commitid	1004C9547CD4D455210;


desc
@@


1.2
log
@update the CVS package in MirPorts (to match base and Debian)

• since the Debian cvs source package was taken over by this one,
  reverse things and use the Debian *.diff.gz to get our patches
  from ;-) saves tracking things in CVS thrice
• since the Debian cvs binary package contains PDF documentation
  generated from something with our patches, ship it instead of
  the one from the vanilla CVS distfile
• ship cvs-switchroot(1) from Debian, which is just a fancy name
  for mircvs://src/scripts/mnt-cvsroot and has a manpage
• move stuff from PREFIX/share/cvs to PREFIX/share/doc/cvs as is proper
• fix regression testsuite on MirBSD as much as possible (same as base)
@
text
@$MirOS: ports/devel/cvs/patches/patch-src_annotate_c,v 1.1 2010/09/18 23:14:07 tg Exp $
--- src/annotate.c.orig	Thu Mar 17 17:14:57 2005
+++ src/annotate.c	Sat Sep 18 23:11:03 2010
@@@@ -19,8 +19,11 @@@@
 
 #include "cvs.h"
 
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_annotate_c,v 1.1 2010/09/18 23:14:07 tg Exp $");
+
 /* Options from the command line.  */
 
+static int backwards = 0;
 static int force_tag_match = 1;
 static int force_binary = 0;
 static char *tag = NULL;
@@@@ -36,7 +39,8 @@@@ static int rannotate_proc (int argc, cha
 
 static const char *const annotate_usage[] =
 {
-    "Usage: %s %s [-lRfF] [-r rev] [-D date] [files...]\n",
+    "Usage: %s %s [-blRfF] [-r rev] [-D date] [files...]\n",
+    "\t-b\tBackwards, show when a line was removed.\n",
     "\t-l\tLocal directory only, no recursion.\n",
     "\t-R\tProcess directories recursively.\n",
     "\t-f\tUse head revision if tag/date not found.\n",
@@@@ -63,10 +67,13 @@@@ annotate (int argc, char **argv)
 	usage (annotate_usage);
 
     optind = 0;
-    while ((c = getopt (argc, argv, "+lr:D:fFR")) != -1)
+    while ((c = getopt (argc, argv, "+blr:D:fFR")) != -1)
     {
 	switch (c)
 	{
+	    case 'b':
+		backwards = 1;
+		break;
 	    case 'l':
 		local = 1;
 		break;
@@@@ -105,6 +112,8 @@@@ annotate (int argc, char **argv)
 
 	ign_setup ();
 
+	if (backwards)
+	    send_arg ("-b");
 	if (local)
 	    send_arg ("-l");
 	if (!force_tag_match)
@@@@ -280,7 +289,8 @@@@ annotate_fileproc (void *callerdat, stru
     else
     {
 	RCS_deltas (finfo->rcs, NULL, NULL,
-		    version, RCS_ANNOTATE, NULL, NULL, NULL, NULL);
+		    version, backwards ? RCS_ANNOTATE_BACKWARDS : RCS_ANNOTATE,
+		    NULL, NULL, NULL, NULL);
     }
     free (version);
     return 0;
@


1.1
log
@• apply 90zlib-read-compressed.diff from Debian, with the following
  explanation from DragonFly BSD via MidnightBSD (thanks laffer1):
  zlib.c: byte by byte to fix infinity waiting on some zlib operations while using compression.
• add MidnightBSD’s global “-g” option: force group-writable permissions
• merge patch for backwards annotation from DragonFly BSD via MidnightBSD
@
text
@d1 1
a1 1
$MirOS$
d8 1
a8 1
+__RCSID("$MirOS$");
@

