head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2012.02.11.19.30.01;	author tg;	state dead;
branches;
next	1.3;
commitid	1004F36C11F02848ED5;

1.3
date	2011.06.11.03.55.37;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004DF2E74A6938C5EF;

1.2
date	2010.09.15.20.57.03;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004C9132F41004B31C;

1.1
date	2006.10.02.05.59.18;	author tg;	state Exp;
branches;
next	;
commitid	1004520AAAB453C7791;


desc
@@


1.4
log
@update the CVS package in MirPorts (to match base and Debian)

• since the Debian cvs source package was taken over by this one,
  reverse things and use the Debian *.diff.gz to get our patches
  from ;-) saves tracking things in CVS thrice
• since the Debian cvs binary package contains PDF documentation
  generated from something with our patches, ship it instead of
  the one from the vanilla CVS distfile
• ship cvs-switchroot(1) from Debian, which is just a fancy name
  for mircvs://src/scripts/mnt-cvsroot and has a manpage
• move stuff from PREFIX/share/cvs to PREFIX/share/doc/cvs as is proper
• fix regression testsuite on MirBSD as much as possible (same as base)
@
text
@$MirOS: ports/devel/cvs/patches/patch-src_rsh-client_c,v 1.3 2011/06/11 03:55:37 tg Exp $
--- src/rsh-client.c.orig	Sun Oct  2 15:16:59 2005
+++ src/rsh-client.c	Sat Jun 11 03:06:20 2011
@@@@ -15,6 +15,8 @@@@
 #include "cvs.h"
 #include "buffer.h"
 
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_rsh-client_c,v 1.3 2011/06/11 03:55:37 tg Exp $");
+
 #ifdef CLIENT_SUPPORT
 
 #include "rsh-client.h"
@@@@ -53,9 +55,10 @@@@ start_rsh_server (cvsroot_t *root, struc
     char *cvs_server = (root->cvs_server != NULL
 			? root->cvs_server : getenv ("CVS_SERVER"));
     int i = 0;
-    /* This needs to fit "rsh", "-b", "-l", "USER", "host",
+    /* This needs to fit "rsh", "-b", "-l", "USER", "-p", port, "host",
        "cmd (w/ args)", and NULL.  We leave some room to grow. */
-    char *rsh_argv[10];
+    char *rsh_argv[16];
+    char argvport[16];
 
     if (!cvs_rsh)
 	/* People sometimes suggest or assume that this should default
@@@@ -97,8 +100,17 @@@@ start_rsh_server (cvsroot_t *root, struc
 	rsh_argv[i++] = root->username;
     }
 
+    if (root->method == extssh_method && root->port)
+    {
+	snprintf(argvport, sizeof(argvport), "%d", root->port);
+	rsh_argv[i++] = "-p";
+	rsh_argv[i++] = argvport;
+    }
+
     rsh_argv[i++] = root->hostname;
     rsh_argv[i++] = cvs_server;
+    if (readonlyfs)
+	rsh_argv[i++] = "-R";
     rsh_argv[i++] = "server";
 
     /* Mark the end of the arg list. */
@@@@ -154,10 +166,11 @@@@ start_rsh_server (cvsroot_t *root, struc
      * on the server machine does not set CVSROOT to something
      * containing a colon (or better yet, upgrade the server).
      */
-    command = Xasprintf ("%s server", cvs_server);
+    command = Xasprintf ("%s%s server", cvs_server, readonlyfs ? " -R" : "");
 
     {
-        char *argv[10];
+	char argvport[16];
+        char *argv[16];
 	char **p = argv;
 
 	*p++ = cvs_rsh;
@@@@ -169,6 +182,13 @@@@ start_rsh_server (cvsroot_t *root, struc
 	{
 	    *p++ = "-l";
 	    *p++ = root->username;
+	}
+
+	if (root->method == extssh_method && root->port)
+	{
+		snprintf(argvport, sizeof(argvport), "%d", root->port);
+		*p++ = "-p";
+		*p++ = argvport;
 	}
 
 	*p++ = root->hostname;
@


1.3
log
@update and bring them in sync
@
text
@d1 1
a1 1
$MirOS: ports/devel/cvs/patches/patch-src_rsh-client_c,v 1.2 2010/09/15 20:57:03 tg Exp $
d8 1
a8 1
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_rsh-client_c,v 1.2 2010/09/15 20:57:03 tg Exp $");
@


1.2
log
@WIP port (will be worked on more, commit for safety)

Some changes, in this order:
• re-sync with MirOS base cvs
• reduce diff against upstream
• apply cvs-datetime.patch from Arkadiusz Miskiewicz <arekm>
  via Concurrent Versions System - Bugs: bug #21523, can't parse date/time: =UTC when commiting file (workaround/fix attached)
• apply (only those considered somewhat sane) patches from Debian cvs_1:1.12.13-12
  – 11_check_method_crash
  – 12_rcs2log_POSIX_sort
  – 14_ext_expansion
  – 15_PATH_MAX_check
  – 20_readdir_errno
  – 21_getcwd_chroot
  – 25_import-n-X
  – 51_newlines_in_commit_template (partially)
  – 55_keyword_alphanumerics (modified)
  – 62_cvsrc_whitespace
  – 65_login_cvspass_message
  – 69_ext_allowroot (modified)
  – 71_cvsbug_tmpfix
  – 81_fix_-l (modified)
  – 85_normalize_correct_roots
  – 86_server_wrapper (modified)
  – 93_homedir (modified)
  – 95_flag_conflicted_copies
  – 96_manpage_fixes (partially)
  – 97_cvs.info.typo (partially)
  – 98_fix_sparc_sigbus.diff
• document Debian’s changes in the Texinfo manual
• modify mkman.pl to produce more correct looking output
• point to texinfo HTML document from HTML manpage
• fix fseeko configure.in test
• correct bugs in Debian’s changes
@
text
@d1 1
a1 1
$MirOS$
d3 1
a3 1
+++ src/rsh-client.c	Wed Sep 15 19:36:15 2010
d8 1
a8 1
+__RCSID("$MirOS$");
d13 32
a44 1
@@@@ -154,7 +156,7 @@@@ start_rsh_server (cvsroot_t *root, struc
d52 20
a71 1
         char *argv[10];
@


1.1
log
@add cvs port, compiles fine and warning-free on MirOS-current;
other OSes not tested, older MirOS may have issues (mktime, regex/wctype)
@
text
@d3 11
a13 2
+++ src/rsh-client.c	Mon Oct  2 04:40:37 2006
@@@@ -154,7 +154,7 @@@@ start_rsh_server (cvsroot_t *root, struc
@

