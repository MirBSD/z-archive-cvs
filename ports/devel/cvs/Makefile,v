head	1.30;
access;
symbols
	tg-release_reconsider:1.4;
locks; strict;
comment	@# @;


1.30
date	2017.11.19.22.08.42;	author tg;	state Exp;
branches;
next	1.29;
commitid	1005A12010550877140;

1.29
date	2017.08.28.00.02.14;	author tg;	state Exp;
branches;
next	1.28;
commitid	10059A35DA148A6EFF3;

1.28
date	2017.04.30.03.35.17;	author tg;	state Exp;
branches;
next	1.27;
commitid	10059055B8F07F249A9;

1.27
date	2017.01.28.21.31.44;	author tg;	state Exp;
branches;
next	1.26;
commitid	100588D0DD268D0A162;

1.26
date	2016.11.09.17.40.24;	author tg;	state Exp;
branches;
next	1.25;
commitid	10058235F9A0698E939;

1.25
date	2016.10.23.01.51.04;	author tg;	state Exp;
branches;
next	1.24;
commitid	100580C17976614E3D1;

1.24
date	2016.10.22.04.01.32;	author tg;	state Exp;
branches;
next	1.23;
commitid	100580AE4A5726E841E;

1.23
date	2012.02.11.19.29.46;	author tg;	state Exp;
branches;
next	1.22;
commitid	1004F36C11F02848ED5;

1.22
date	2011.12.04.19.19.43;	author tg;	state Exp;
branches;
next	1.21;
commitid	1004EDBC7E358D7B751;

1.21
date	2011.07.28.15.54.30;	author tg;	state Exp;
branches;
next	1.20;
commitid	1004E3186491EE91625;

1.20
date	2011.06.11.04.05.12;	author tg;	state Exp;
branches;
next	1.19;
commitid	1004DF2E9801DB6B546;

1.19
date	2011.06.11.03.55.34;	author tg;	state Exp;
branches;
next	1.18;
commitid	1004DF2E74A6938C5EF;

1.18
date	2011.05.06.23.17.26;	author tg;	state Exp;
branches;
next	1.17;
commitid	1004DC4819C685DDCFE;

1.17
date	2010.09.19.19.59.29;	author tg;	state Exp;
branches;
next	1.16;
commitid	1004C966BB47821D773;

1.16
date	2010.09.19.00.42.39;	author tg;	state Exp;
branches;
next	1.15;
commitid	1004C955C69247794E9;

1.15
date	2010.09.18.22.35.07;	author tg;	state Exp;
branches;
next	1.14;
commitid	1004C953D8624E3E654;

1.14
date	2010.09.16.21.26.09;	author tg;	state Exp;
branches;
next	1.13;
commitid	1004C928B8750306B7E;

1.13
date	2010.09.16.21.25.15;	author tg;	state Exp;
branches;
next	1.12;
commitid	1004C928B4C62A1AD04;

1.12
date	2010.09.15.20.56.55;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004C9132F41004B31C;

1.11
date	2009.09.06.11.51.00;	author tg;	state Exp;
branches;
next	1.10;
commitid	1004AA3A2295C6D49FB;

1.10
date	2009.08.16.17.16.47;	author tg;	state Exp;
branches;
next	1.9;
commitid	1004A883C9B4C196B76;

1.9
date	2008.10.09.16.39.34;	author tg;	state Exp;
branches;
next	1.8;
commitid	10048EE33D204285E14;

1.8
date	2008.10.04.23.13.23;	author tg;	state Exp;
branches;
next	1.7;
commitid	10048E7F825748E2BDC;

1.7
date	2008.03.02.20.35.18;	author tg;	state Exp;
branches;
next	1.6;
commitid	10047CB0F9A59BAA10E;

1.6
date	2007.09.13.14.12.53;	author tg;	state Exp;
branches;
next	1.5;
commitid	10046E945535545783F;

1.5
date	2007.06.06.13.46.43;	author tg;	state Exp;
branches;
next	1.4;
commitid	1004666BAAA7E1DD106;

1.4
date	2007.03.10.23.53.46;	author tg;	state Exp;
branches;
next	1.3;
commitid	10045F344D65465EF23;

1.3
date	2007.02.22.22.57.45;	author tg;	state Exp;
branches;
next	1.2;
commitid	10045DE1FF10F590776;

1.2
date	2007.02.01.23.29.33;	author tg;	state Exp;
branches;
next	1.1;
commitid	10045C277DE68C59215;

1.1
date	2006.10.02.05.59.14;	author tg;	state Exp;
branches;
next	;
commitid	1004520AAAB453C7791;


desc
@@


1.30
log
@sync
@
text
@# $MirOS: ports/devel/cvs/Makefile,v 1.27 2017/01/28 21:31:44 tg Exp $

COMMENT=		Concurrent Versions System
CATEGORIES=		devel essentials
VSN=			1.12.13
# track both in patches/patch-configure_in as well!
DASH_VER=		21
DEBIAN_REV=		25		# in sync with MirOS-0AB8.4 revision
HOMEPAGE=		http://www.nongnu.org/cvs/
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.org>

# GNU GPLv1, GPLv2+, LGPLv2, MIT, BSD, zlib
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes

DISTNAME=		cvs-${VSN}
MASTER_SITES=		${MASTER_SITE_GNU:gnu/=non-gnu/cvs/source/feature/${VSN}/}
MASTER_SITES0=		${MASTER_SITE_DEBIAN:=c/cvs/}
DISTFILES=		${DISTNAME}${EXTRACT_SUFX} \
			cvs_1.12.13+real-${DEBIAN_REV}_i386.deb:0
PATCHFILES=		cvs_1.12.13+real-${DEBIAN_REV}.diff.gz:0
PATCH_DIST_STRIP=	-p1

CONFIGURE_STYLE=	autogen
AUTOCONF_NEW=		Yes
AUTOMAKE_VERSION=	1.9
CONFIGURE_ARGS+=	--disable-maintainer-mode \
			--disable-pam \
			--disable-nls \
			--enable-client \
			--enable-password-authenticated-client \
			--enable-server \
			--enable-proxy \
			--enable-case-sensitivity \
			--disable-lock-compatibility \
			--enable-rootcommit \
			--disable-old-info-format-support \
			--enable-config-override=no \
			--with-external-zlib \
			--with-rsh=ssh \
			--with-editor=/bin/ed \
			--with-tmpdir=/var/tmp \
			--with-umask=002 \
			--with-cvs-admin-group=_cvsadmin
# hardcoded paths
CONFIGURE_ENV+=		ac_cv_path_CSH=${LOCALBASE:Q}/bin/csh
CONFIGURE_ENV+=		ac_cv_path_PS2PDF=false

# see mircvs://contrib/code/Snippets/posixtz.c
.if exists(/usr/lib/libposixtz.so)
REGRESS_ENV+=		GETDATE_LD_PRELOAD=/usr/lib/libposixtz.so
.endif
# this is ugly ugly ugly… get ssh to localhost working if you can, and rsync
REGRESS_ENV+=		SSH_AUTH_SOCK=${SSH_AUTH_SOCK:Q}
REGRESS_IS_INTERACTIVE=	Yes

post-extract:
	# install the PDFs generated by Debian from our sources, thanks ;)
	cd ${WRKDIR} && exec ${TAR} -xzf data.tar.gz

post-patch:
	# use prebuilt one so to not depend on GNU bison
	-rm -f ${WRKSRC}/lib/getdate.y

post-build:
	# we install cvs-switchroot(1) from Debian now
	gzip -d <${WRKDIR}/usr/share/man/man1/cvs-switchroot.1.gz \
	    >${WRKBUILD}/cvs-switchroot.1

post-install:
	cd ${WRKSRC} && ${INSTALL_DATA} AUTHORS BUGS DEVEL-CVS FAQ HACKING \
	    MINOR-BUGS NEWS PROJECTS README TODO doc/HACKING.DOCS \
	    doc/RCSFILES doc/*.ms doc/*.rtf ${PREFIX}/share/cvs/
	cd ${WRKSRC}/contrib && ${INSTALL_DATA} descend.man rcs2log.1 \
	    sandbox_status.man ${PREFIX}/share/cvs/contrib/
	cd ${WRKSRC}/contrib && ${INSTALL_SCRIPT} descend.sh rcs2sccs.sh \
	    ${PREFIX}/share/cvs/contrib/
	cd ${WRKDIR}/usr/share/doc/cvs && ${INSTALL_DATA} *.html *.pdf \
	    ${PREFIX}/share/cvs/
	${INSTALL_SCRIPT} ${WRKDIR}/usr/bin/cvs-switchroot ${PREFIX}/bin/
	${INSTALL_MAN} ${WRKBUILD}/cvs-switchroot.1 ${PREFIX}/man/man1/
	mv ${PREFIX}/share/cvs ${PREFIX}/share/doc/cvs

.include <bsd.port.mk>
@


1.29
log
@simple bump
@
text
@d7 2
a8 2
DASH_VER=		20
DEBIAN_REV=		24		# in sync with MirOS-0AB8.3 revision
@


1.28
log
@update
@
text
@d7 2
a8 2
DASH_VER=		19
DEBIAN_REV=		23		# in sync with MirOS-0AB8.1 revision
@


1.27
log
@update to latest Debian upload
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.26 2016/11/09 17:40:24 tg Exp $
d7 2
a8 2
DASH_VER=		18
DEBIAN_REV=		21		# in sync with MirOS-0AB7.7 revision
@


1.26
log
@update; passes (in)sanity on -current as well
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.25 2016/10/23 01:51:04 tg Exp $
d7 2
a8 2
DASH_VER=		17
DEBIAN_REV=		20		# in sync with MirOS-0AB7.6 revision
d29 3
a31 1
CONFIGURE_ARGS+=	--disable-nls \
d60 2
a61 2
	# install the PDFs generated in Debian, they are closer to the truth
	cd ${WRKDIR}; tar xzf data.tar.gz
@


1.25
log
@bump after successful test execution and all that
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.24 2016/10/22 04:01:32 tg Exp $
d7 2
a8 2
DASH_VER=		16
DEBIAN_REV=		18		# in sync with MirOS-0AB7.4 revision
@


1.24
log
@updated port (modulo regression testsuite)
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.23 2012/02/11 19:29:46 tg Exp $
d7 2
a8 2
DASH_VER=		15
DEBIAN_REV=		17		# in sync with MirOS-0AB7.3 revision
a44 2
# caught by systrace, tries to write to ${LOCALBASE}/lib as check
CONFIGURE_ENV+=		ac_cv_sys_long_file_names=yes
d53 1
a53 1
# this is ugly ugly ugly… get ssh to localhost working if you can
@


1.23
log
@update the CVS package in MirPorts (to match base and Debian)

• since the Debian cvs source package was taken over by this one,
  reverse things and use the Debian *.diff.gz to get our patches
  from ;-) saves tracking things in CVS thrice
• since the Debian cvs binary package contains PDF documentation
  generated from something with our patches, ship it instead of
  the one from the vanilla CVS distfile
• ship cvs-switchroot(1) from Debian, which is just a fancy name
  for mircvs://src/scripts/mnt-cvsroot and has a manpage
• move stuff from PREFIX/share/cvs to PREFIX/share/doc/cvs as is proper
• fix regression testsuite on MirBSD as much as possible (same as base)
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.22 2011/12/04 19:19:43 tg Exp $
d6 3
a8 1
DASH_VER=		14		# in sync with MirOS-0AB0.1 revision
d12 1
a12 1
# GNU GPLv1, GPLv2
d22 2
a23 2
			cvs_1.12.13+real-8_i386.deb:0
PATCHFILES=		cvs_1.12.13+real-8.diff.gz:0
d36 1
a36 1
			--disable-rootcommit \
d59 7
a65 3
pre-configure:
	print '%g/\(MirPorts-\)QQ/s//\1${DASH_VER}/g\nwq' | \
	    ed -s ${WRKSRC}/configure
a67 8
	# we install the PDFs generated in Debian, they are closer
	cd ${WRKDIR}; tar xzf data.tar.gz
	gzip -d <${WRKDIR}/usr/share/doc/cvs/cvs-paper.pdf.gz \
	    >${WRKBUILD}/cvs-paper.pdf
	gzip -d <${WRKDIR}/usr/share/doc/cvs/cvs.pdf.gz \
	    >${WRKBUILD}/cvs.pdf
	gzip -d <${WRKDIR}/usr/share/doc/cvs/cvsclient.pdf.gz \
	    >${WRKBUILD}/cvsclient.pdf
d76 3
a78 2
	cd ${WRKSRC}/contrib && ${INSTALL_DATA} cvs_acls.html cvshelp.man \
	    descend.man descend.sh rcs2sccs.sh sandbox_status.man \
d80 2
a81 3
	${INSTALL_MAN} ${WRKSRC}/contrib/rcs2log.1 ${PREFIX}/man/man1/
	cd ${WRKBUILD} && ${INSTALL_DATA} cvs-paper.pdf cvs.pdf \
	    cvsclient.pdf ${PREFIX}/share/cvs/
d84 1
a84 1
	mv ${PREFIX}/share/cvs ${PREFIX}/share/doc/
@


1.22
log
@add a note about version keeping
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.21 2011/07/28 15:54:30 tg Exp $
d6 1
a6 1
DASH_VER=		12		# in sync with MirOS-0AAF.1 revision
d18 5
d61 13
d77 1
a77 1
	    doc/RCSFILES doc/*.ms doc/*.pdf doc/*.rtf ${PREFIX}/share/cvs/
d82 5
@


1.21
log
@bump version number and sync mirbsd/mirports/debian
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.20 2011/06/11 04:05:12 tg Exp $
d6 1
a6 1
DASH_VER=		12		# in sync with MirOS-0AAF.1 rev.
@


1.20
log
@we must use autogen now that we patch a .am file
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.19 2011/06/11 03:55:34 tg Exp $
d6 1
a6 1
DASH_VER=		11		# in sync with MirOS-0AAE.2 rev.
d38 1
a38 1
# cought by systrace, tries to write to ${LOCALBASE}/lib as check
@


1.19
log
@update and bring them in sync
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.18 2011/05/06 23:17:26 tg Exp $
d19 1
a19 1
CONFIGURE_STYLE=	autoconf
d21 1
@


1.18
log
@refresh
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.17 2010/09/19 19:59:29 tg Exp $
d6 1
a6 1
DASH_VER=		10		# in sync with MirOS-0AAE.1 rev.
@


1.17
log
@let’s begin eating our own dogfood…
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.16 2010/09/19 00:42:39 tg Exp $
d6 1
a6 1
DASH_VER=		9		# in sync with MirOS-0AAD rev.
@


1.16
log
@ok, now it compiles cleanly again, but the regression test still barfs
when actually letting it run over ssh – the “you are using an even vendor
branch” warning is duplicated per-line ⇒ still WIP…
@
text
@d1 1
a1 3
# $MirOS: ports/devel/cvs/Makefile,v 1.15 2010/09/18 22:35:07 tg Exp $

IGNORE=wip
d6 1
a6 1
DASH_VER=		9		# in sync with MirOS-0AAC rev.
@


1.15
log
@wip mostly from working on testsuite
• run part of it under posixtz (can't do for all of it because date(1) is
  linked statically and thus not affected, which breaks parts of it)
• sync getdate.c
• adjust getdate testsuite against our output format
• revert debian patches because they break things and the original issues
  cannot be reproduced anyway
  ‣ 93_homedir
  ‣ 95_flag_conflicted_copies
• parseinfo.c: correct off-by-one bug in the original GNU CVS, discovered
  because of the testsuite (it was not adapted to binary ISO units yet)
• sanity.sh: work on the cvs testsuite
  – add (commented out) debug to aid temporarily
  – configure UserAdminOptions because --with-cvs-admin-group=_cvsadmin
  – accept our version strings
  – recognise GNU getopt changed error messages
  – run part of it with posixtz
  – sync with changed output
  – use ISO/IEC 60027-2 binary præficēs properly
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.14 2010/09/16 21:26:09 tg Exp $
d49 3
@


1.14
log
@fix licencing hint
@
text
@d1 3
a3 1
# $MirOS: ports/devel/cvs/Makefile,v 1.13 2010/09/16 21:25:15 tg Exp $
d8 1
a8 1
DASH_VER=		8		# in sync with MirOS-0AAC rev.
d45 5
@


1.13
log
@I say, let’s do it…
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.12 2010/09/15 20:56:55 tg Exp $
d10 1
a10 1
# GNU GPLv1, LGPLv2
@


1.12
log
@WIP port (will be worked on more, commit for safety)

Some changes, in this order:
• re-sync with MirOS base cvs
• reduce diff against upstream
• apply cvs-datetime.patch from Arkadiusz Miskiewicz <arekm>
  via Concurrent Versions System - Bugs: bug #21523, can't parse date/time: =UTC when commiting file (workaround/fix attached)
• apply (only those considered somewhat sane) patches from Debian cvs_1:1.12.13-12
  – 11_check_method_crash
  – 12_rcs2log_POSIX_sort
  – 14_ext_expansion
  – 15_PATH_MAX_check
  – 20_readdir_errno
  – 21_getcwd_chroot
  – 25_import-n-X
  – 51_newlines_in_commit_template (partially)
  – 55_keyword_alphanumerics (modified)
  – 62_cvsrc_whitespace
  – 65_login_cvspass_message
  – 69_ext_allowroot (modified)
  – 71_cvsbug_tmpfix
  – 81_fix_-l (modified)
  – 85_normalize_correct_roots
  – 86_server_wrapper (modified)
  – 93_homedir (modified)
  – 95_flag_conflicted_copies
  – 96_manpage_fixes (partially)
  – 97_cvs.info.typo (partially)
  – 98_fix_sparc_sigbus.diff
• document Debian’s changes in the Texinfo manual
• modify mkman.pl to produce more correct looking output
• point to texinfo HTML document from HTML manpage
• fix fseeko configure.in test
• correct bugs in Debian’s changes
@
text
@d1 1
a1 3
# $MirOS: ports/devel/cvs/Makefile,v 1.11 2009/09/06 11:51:00 tg Exp $

IGNORE=wip
d6 1
a6 1
DASH_VER=		8		# not yet in sync with MirOS-0AAC rev.
@


1.11
log
@apply cid 1004AA2AEDB55018A46 (-rtag:BASE support) here as well
@
text
@d1 3
a3 1
# $MirOS: ports/devel/cvs/Makefile,v 1.10 2009/08/16 17:16:47 tg Exp $
d8 1
a8 1
DASH_VER=		7		# in sync with MirOS-0AAA rev.
d41 3
d50 3
a52 3
	cd ${WRKSRC} && ${INSTALL_DATA} AUTHORS BUGS FAQ MINOR-BUGS NEWS \
	    PROJECTS README TODO doc/RCSFILES doc/cvs-paper.* doc/cvs.pdf \
	    doc/cvsclient.pdf doc/writeproxy.rtf ${PREFIX}/share/cvs/
d54 2
a55 1
	    descend.man descend.sh rcs2sccs.sh ${PREFIX}/share/cvs/contrib/
@


1.10
log
@change all V to VSN (ok bsiegert@@) and some DASH_VER while here
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.9 2008/10/09 16:39:34 tg Exp $
d6 1
a6 1
DASH_VER=		6		# in sync with MirOS-0AA2 rev.
d8 1
a8 1
RESPONSIBLE=		Thorsten Glaser <tg@@mirbsd.de>
@


1.9
log
@it’s actually better to bump to _future_ not _past_ versions ;)
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.8 2008/10/04 23:13:23 tg Exp $
d5 1
a5 1
V=			1.12.13
d16 2
a17 2
DISTNAME=		cvs-$V
MASTER_SITES=		${MASTER_SITE_GNU:gnu/=non-gnu/cvs/source/feature/$V/}
@


1.8
log
@change bsiegert@@’s patch to retain log messages on abortion
in a somewhat hackish way (set a flag, loop back to the
beginning, skip over some code, then exit; using two gotos)
to strip off the “CVS:” lines b̲e̲f̲o̲r̲e̲hand; also, defer unlink
of the old temp file until the new temp file has been writ-
ten, to lose even less log messages ☺
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.7 2008/03/02 20:35:18 tg Exp $
d6 1
a6 1
DASH_VER=		6		# in sync with MirOS-0AA1 rev.
@


1.7
log
@sync
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.6 2007/09/13 14:12:53 tg Exp $
d6 1
a6 1
DASH_VER=		5		# in sync with MirOS-0A80 rev.
@


1.6
log
@fix stuff like
$ cvs -d /cvs rdiff -uprMIRBSD_8:2005/12/22 -rMIRBSD_8:2006/01/01 src/share/mk
diff mostly from http://ximbiot.com/cvs/wiki/index.php?title=Design_Proposals
someone on irc://irc.mirbsd.org/#cvs told me about it, but I forgot the nick,
sorry…
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.5 2007/06/06 13:46:43 tg Exp $
d6 1
a6 1
DASH_VER=		4		# in sync with MirOS-0A80 rev.
@


1.5
log
@support the $Mdocdate keyword of that Other bsd
credits to jmc@@obsd for the idea and most of the code
actual implementation by me though
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.4 2007/03/10 23:53:46 tg Exp $
d6 1
a6 1
DASH_VER=		3		# in sync with MirOS-0A18 rev.
@


1.4
log
@sync the cvs port and the cvs in the base system;
RCSID stuff like in commitid 10045F33CB2157CFEAE
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.3 2007/02/22 22:57:45 tg Exp $
d6 1
a6 1
DASH_VER=		2		# in sync with MirOS-0A10 rev.
@


1.3
log
@remove redundancy
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.2 2007/02/01 23:29:33 tg Exp $
d6 1
a6 1
DASH_VER=		1
@


1.2
log
@bring in bsiegert@@'s "wtf don't eat my fscking log messages!" patch
@
text
@d1 1
a1 1
# $MirOS: ports/devel/cvs/Makefile,v 1.1 2006/10/02 05:59:14 tg Exp $
d21 1
a21 2
CONFIGURE_ARGS+=	--disable-dependency-tracking \
			--disable-nls \
@


1.1
log
@add cvs port, compiles fine and warning-free on MirOS-current;
other OSes not tested, older MirOS may have issues (mktime, regex/wctype)
@
text
@d1 1
a1 1
# $MirOS$
d6 1
a6 1
PL=			0
a16 1
PKGNAME=		cvs-$V-${PL}
d42 2
a43 1
	print '%g/\(MirPorts-\)QQ/s//\1${PL}/g\nwq' | ed -s ${WRKSRC}/configure
@

