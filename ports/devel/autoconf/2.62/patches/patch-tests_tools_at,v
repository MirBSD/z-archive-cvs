head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2009.11.22.00.16.24;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004B088259208162D8;

1.1
date	2009.11.18.20.48.09;	author bsiegert;	state Exp;
branches;
next	;
commitid	1004B045D7A02892B0A;


desc
@@


1.2
log
@merge bsiegert@@’s OpenBSD 2.62 port, my MirBSD 2.61 port, add portability
to GNU m4 (back which was removed by these OpenBSD people), fix things,
and add a few workarounds for bugs in our m4 (which increments the line
number too early, upon first encounter of a newline even if the newline
is pushed back into the input buffer)

this is still not ready for general consumption, but good for testing,
and a candidate for AUTOCONF_NEW default *after* the next full MirBSD
release (or, at the very least, full snapshot, which has been adopted);
although I’d rather like to get a 2.65 (but not tonight…) with our m4
working first and switch there then
@
text
@$MirOS$
$OpenBSD: patch-tests_tools_at,v 1.1.1.1 2008/08/19 23:52:19 espie Exp $
--- tests/tools.at.orig	Sat Apr  5 23:04:25 2008
+++ tests/tools.at	Sat Nov 21 23:28:30 2009
@@@@ -199,13 +199,7 @@@@ END
 [m4@@&t@@_include(foo.m4)
 m4@@&t@@_divert(0)d@@&t@@nl]
 END
-  rm -rf "$file.m4f"
-  AT_CHECK_AUTOM4TE([-C "$cachedir" -I "$dir" --language=m4sugar --freeze -o "$file.m4f" "$file"])
-  AT_CHECK([test -s "$file.m4f"])
 
-  # Check --reload-state
-  AT_CHECK_AUTOM4TE([-C "$cachedir" --language=m4sugar -o "$outfile" "$file.m4f" /dev/null])
-
   test ! -f b
 done
 
@@@@ -564,7 +558,7 @@@@ AC_DEFINE(this, "whatever you want.")
 
 AT_CHECK_AUTOHEADER([], [], [], [ignore])
 AT_CHECK([cat config.hin], 0,
-[[/* config.hin.  Generated from configure.ac by autoheader.  */
+[[/* config.hin.  Generated from configure.ac by autoheader ]]AT_PACKAGE_VERSION[[]]AT_PACKAGE_BRAND[[.  */
 /* Define this to whatever you want. */
 #undef this
 
@@@@ -629,7 +623,7 @@@@ AC_DEFINE([ANT], [@@], [The Ant in a h@@t.
 # files.
 AT_CHECK_AUTOHEADER([--force], [], [], [ignore])
 AT_CHECK([cat config.hin], 0,
-[[/* config.hin.  Generated from configure.ac by autoheader.  */
+[[/* config.hin.  Generated from configure.ac by autoheader ]]AT_PACKAGE_VERSION[[]]AT_PACKAGE_BRAND[[.  */
 /* Top from acconfig.h. */
 /* Middle from acconfig.h. */
 
@@@@ -741,7 +735,7 @@@@ AT_CLEANUP
 AT_SETUP([autoupdating AC_PREREQ])
 
 # Produce `AC_PREREQ(<AUTOUPDATE VERSION>)'.
-AT_CHECK([autoupdate --version | sed 's/.*) //;q'], 0, [stdout])
+AT_CHECK([autoupdate --version | sed 's/.*) //;s/-MirPo.*//;q'], 0, [stdout])
 autoupdate_version=`cat stdout`
 echo "AC_PREREQ($autoupdate_version)" >expout
 
@


1.1
log
@Pull in autoconf 2.62 from OpenBSD ports, with minimal modifications,
no "MirPorts" branding. Works with /usr/bin/m4.
@
text
@d1 1
d3 3
a5 3
--- tests/tools.at.orig	Fri Aug 15 15:41:41 2008
+++ tests/tools.at	Fri Aug 15 15:41:46 2008
@@@@ -199,12 +199,6 @@@@ END
d12 1
a12 1
-
d15 1
a15 1
 
d18 28
@

