head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2016.03.29.20.03.52;	author tg;	state Exp;
branches;
next	1.2;
commitid	10056FADFBB0C6DD678;

1.2
date	2010.07.30.21.00.42;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004C533D792571D446;

1.1
date	2005.03.18.15.43.12;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.43.12;	author tg;	state Exp;
branches;
next	;


desc
@@


1.3
log
@work around a crash due to memory overread
@
text
@$MirOS$
$OpenBSD: patch-resample_c,v 1.1 2001/07/05 10:48:24 espie Exp $
--- resample.c.orig	Mon May 20 13:09:27 1996
+++ resample.c	Tue Mar 29 19:57:05 2016
@@@@ -22,7 +22,12 @@@@
 
 #include <math.h>
 #include <stdio.h>
+
+#ifdef __OpenBSD__
+#include <stdlib.h>
+#else
 #include <malloc.h>
+#endif
 
 #include "config.h"
 #include "common.h"
@@@@ -695,7 +700,7 @@@@ void pre_resample(Sample * sp)
   a = ((double) (sp->sample_rate) * freq_table[(int) (sp->note_to_use)]) /
     ((double) (sp->root_freq) * play_mode->rate);
   newlen = sp->data_length / a;
-  dest = newdata = safe_malloc(newlen >> (FRACTION_BITS - 1));
+  dest = newdata = safe_malloc((newlen >> (FRACTION_BITS - 1)) /*XXX*/ + 16);
 
   count = (newlen >> FRACTION_BITS) - 1;
   ofs = incr = (sp->data_length - (1 << FRACTION_BITS)) / count;
@@@@ -708,7 +713,7 @@@@ void pre_resample(Sample * sp)
   while (--count)
     {
       vptr = src + (ofs >> FRACTION_BITS);
-      v1 = *(vptr - 1);
+      v1 = (vptr > src) ? (*(vptr - 1)) : 0;
       v2 = *vptr;
       v3 = *(vptr + 1);
       v4 = *(vptr + 2);
@


1.2
log
@make this at least resemble something useful
• fix C
• fix SIGSEGV
• fix strcpy, strcat, sprintf
• make curses flavour default
@
text
@d1 1
d4 1
a4 1
+++ resample.c	Fri Jul 30 20:47:58 2010
d18 9
@


1.1
log
@Initial revision
@
text
@d2 2
a3 2
--- resample.c.orig	Mon May 20 15:09:47 1996
+++ resample.c	Fri Apr 27 08:01:39 2001
d17 9
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
