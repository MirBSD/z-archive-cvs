head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2016.03.29.20.03.52;	author tg;	state Exp;
branches;
next	1.2;
commitid	10056FADFBB0C6DD678;

1.2
date	2010.07.30.21.00.41;	author tg;	state Exp;
branches;
next	1.1;
commitid	1004C533D792571D446;

1.1
date	2005.03.18.15.43.12;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.43.12;	author tg;	state Exp;
branches;
next	;


desc
@@


1.3
log
@work around a crash due to memory overread
@
text
@$MirOS$
$OpenBSD: patch-instrum_c,v 1.1 2001/07/05 10:48:22 espie Exp $
--- instrum.c.orig	Mon May 20 13:14:50 1996
+++ instrum.c	Tue Mar 29 19:59:31 2016
@@@@ -31,7 +31,7 @@@@
 #include <strings.h>
 #endif
 
-#if defined(__FreeBSD__) || defined (__WIN32__)
+#if defined(__FreeBSD__) || defined (__WIN32__) || defined(__OpenBSD__)
 #include <stdlib.h>
 #else
 #include <malloc.h>
@@@@ -207,8 +207,8 @@@@ static Instrument *load_instrument(char 
 	{
 	  if (strlen(name)+strlen(patch_ext[i])<1024)
 	    {
-	      strcpy(tmp, name);
-	      strcat(tmp, patch_ext[i]);
+	      strlcpy(tmp, name, sizeof(tmp));
+	      strlcat(tmp, patch_ext[i], sizeof(tmp));
 	      if ((fp=open_file(tmp, 1, OF_NORMAL)))
 		{
 		  noluck=0;
@@@@ -421,7 +421,7 @@@@ static Instrument *load_instrument(char 
 	}
 
       /* Then read the sample data */
-      sp->data = safe_malloc(sp->data_length);
+      sp->data = safe_malloc(sp->data_length /*XXX*/ + 16);
       if (1 != fread(sp->data, sp->data_length, 1, fp))
 	goto fail;
       
@@@@ -430,7 +430,7 @@@@ static Instrument *load_instrument(char 
 	  int32 i=sp->data_length;
 	  uint8 *cp=(uint8 *)(sp->data);
 	  uint16 *tmp,*new;
-	  tmp=new=safe_malloc(sp->data_length*2);
+	  tmp=new=safe_malloc(sp->data_length*2 /*XXX*/ + 16);
 	  while (i--)
 	    *tmp++ = (uint16)(*cp++) << 8;
 	  cp=(uint8 *)(sp->data);
@


1.2
log
@make this at least resemble something useful
• fix C
• fix SIGSEGV
• fix strcpy, strcat, sprintf
• make curses flavour default
@
text
@d1 1
d4 1
a4 1
+++ instrum.c	Fri Jul 30 20:51:07 2010
d25 18
@


1.1
log
@Initial revision
@
text
@d2 2
a3 2
--- instrum.c.orig	Mon May 20 15:15:10 1996
+++ instrum.c	Fri Apr 27 08:01:39 2001
d13 11
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
