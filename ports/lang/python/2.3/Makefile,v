head	1.14;
access;
symbols;
locks; strict;
comment	@# @;


1.14
date	2008.08.26.14.16.39;	author tg;	state Exp;
branches;
next	1.13;
commitid	10048B4105D3947F32F;

1.13
date	2008.08.19.18.07.29;	author tg;	state Exp;
branches;
next	1.12;
commitid	10048AB0BC837149826;

1.12
date	2008.07.30.15.25.54;	author tg;	state Exp;
branches;
next	1.11;
commitid	1004890880672F7B301;

1.11
date	2008.07.30.15.22.32;	author tg;	state Exp;
branches;
next	1.10;
commitid	10048908711634D2DB6;

1.10
date	2008.07.30.15.17.44;	author tg;	state Exp;
branches;
next	1.9;
commitid	100489086233FACC634;

1.9
date	2008.07.15.19.47.14;	author bsiegert;	state Exp;
branches;
next	1.8;
commitid	100487CFEA04998EF8E;

1.8
date	2007.12.29.16.57.34;	author bsiegert;	state Exp;
branches;
next	1.7;
commitid	10047767C9600007725;

1.7
date	2007.07.19.20.26.15;	author bsiegert;	state Exp;
branches;
next	1.6;
commitid	100469FC8AF0D5AD7BE;

1.6
date	2007.04.03.19.44.08;	author tg;	state Exp;
branches;
next	1.5;
commitid	1004612AC977E789195;

1.5
date	2005.11.16.19.08.23;	author tg;	state Exp;
branches;
next	1.4;
commitid	6735437b83b3a100;

1.4
date	2005.11.15.19.16.56;	author tg;	state Exp;
branches;
next	1.3;
commitid	3e70437a3435830c;

1.3
date	2005.11.04.14.02.45;	author tg;	state Exp;
branches;
next	1.2;
commitid	35cd436b691eab9c;

1.2
date	2005.07.07.21.22.32;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	66bc42cd9a7ea714;

1.1
date	2005.03.18.15.47.49;	author tg;	state Exp;
branches
	1.1.7.1;
next	;

1.1.7.1
date	2005.03.18.15.47.49;	author tg;	state Exp;
branches;
next	;


desc
@@


1.14
log
@here too...
@
text
@# $MirOS: ports/lang/python/2.3/Makefile,v 1.13 2008/08/19 18:07:29 tg Exp $
# $OpenBSD: Makefile,v 1.18 2005/08/27 15:57:31 naddy Exp $

NOT_FOR_PLATFORM+=	Darwin:*:*

VERSION=		2.3
PATCHLEVEL=		.7
DASH_VER=		2

COMMENT-bsddb=		Berkeley db module for Python
COMMENT-expat=		expat module for Python
COMMENT-gdbm=		GNU dbm module for Python
COMMENT-idle=		IDE for Python
COMMENT-mpz=		GNU arbitrary magnitude integer module for Python
COMMENT-tests=		Python test suite
COMMENT-tkinter=	tk GUI module for Python
COMMENT-tools=		extra tools for Python

.include <mirports.sys.mk>

FLAVOURS+=		no_bsddb no_cxx no_expat no_gdbm no_idle no_mpz no_tkinter
FLAVOUR?=		no_bsddb

.if ${OStype} == "Darwin"
# no TCL/Tk on Darwin (yet?)
FLAVOUR+=		no_tkinter
# gmp is broken on Darwin/i386
FLAVOUR+=		no_mpz
.endif

.if ${FLAVOUR:L:Mno_cxx}
FLAVOUR+=		no_bsddb no_expat no_gdbm no_idle no_mpz no_tkinter
CONFIGURE_ARGS+=	--without-cxx
MULTI_PACKAGES=
.else
USE_CXX=		Yes
MULTI_PACKAGES=		-tests -tools
.endif

SUBPACKAGE?=

.if defined(PACKAGING)
#  All subpackages depend on the main python package.
.  if !empty(SUBPACKAGE)
.    if ${FLAVOUR:L:Mno_cxx}
RUN_DEPENDS+=		::lang/python/${VERSION},no_cxx
.    else
RUN_DEPENDS+=		::lang/python/${VERSION}
.    endif
LIB_DEPENDS=
.  endif
.endif

# On architectures with shared libs, no_xxx flavours are a convenient
# way to avoid pulling in dependencies, and don't actually show up
# in the final package names.  On architectures without shared libs,
# no_xxx flavours dictate what gets linked into the Python binary.

.if empty(FLAVOUR:L:Mno_bsddb)
.  if ${FLAVOUR:L:Mno_cxx}
BUILD_DEPENDS+=		::databases/db,no_cxx
.  else
BUILD_DEPENDS+=		::databases/db
.  endif
SETUP_LOCAL+=		Setup.bsddb
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
MULTI_PACKAGES+=	-bsddb
.  else
LIB_DEPENDS+=		db.4.2::databases/db
.  endif
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-bsddb"
LIB_DEPENDS+=		db.4.2::databases/db
.endif

.if empty(FLAVOUR:L:Mno_gdbm)
BUILD_DEPENDS+=		::databases/gdbm
SETUP_LOCAL+=		Setup.gdbm
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
MULTI_PACKAGES+=	-gdbm
.  else
LIB_DEPENDS+=		gdbm.3::databases/gdbm
.  endif
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-gdbm"
LIB_DEPENDS+=		gdbm.3::databases/gdbm
.endif

.if empty(FLAVOUR:L:Mno_idle) && empty(FLAVOUR:L:Mno_tkinter)
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
MULTI_PACKAGES+=	-idle
.  endif
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-idle"
RUN_DEPENDS+=		::lang/python/${VERSION},-tkinter
.endif

.if empty(FLAVOUR:L:Mno_tkinter)
USE_X11=		Yes
BUILD_DEPENDS+=		::x11/tk/8.4
SETUP_LOCAL+=		Setup.tkinter
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
MULTI_PACKAGES+=	-tkinter
SED_PLIST+=		| sed -e '/^%%tkinter%%/d' \
			| sed -e '/^%%tkinter_no_shared%%/r${PKGDIR}/PFRAG-tkinter.no_shared' -e '//d'
.  else
SED_PLIST+=		| sed -e '/^%%tkinter%%/r${PKGDIR}/PFRAG-tkinter.no_shared' -e '//d'
LIB_DEPENDS+=		tk84::x11/tk/8.4
.  endif
.else
SED_PLIST+=		| sed -e '/^%%tkinter%%/d'
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-tkinter"
LIB_DEPENDS+=		tk84::x11/tk/8.4
.endif

.if empty(FLAVOUR:L:Mno_mpz) && ${VERSION} == "2.3"
BUILD_DEPENDS+=		::devel/gmp
SETUP_LOCAL+=		Setup.mpz
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
MULTI_PACKAGES+= 	-mpz
.  else
LIB_DEPENDS+=		gmp::devel/gmp
.  endif
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-mpz"
LIB_DEPENDS+=		gmp::devel/gmp
.endif

.if empty(FLAVOUR:L:Mno_expat) && ${VERSION} == "2.3"
SETUP_LOCAL+=		Setup.expat
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
.    if !defined(PACKAGING)
MODULES+=		textproc/expat
.    endif
MULTI_PACKAGES+= 	-expat
.  else
MODULES+=		textproc/expat
.  endif
.endif

.if defined(PACKAGING) && ${SUBPACKAGE} == "-expat"
MODULES+=		textproc/expat
.endif

# Strip off no_xxx flavours from the package name if we are not
# building the "monster" Python for platforms without shared libraries.

.if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
FULLPKGNAME=		${PKGNAME}${FLAVOUR_EXT:S/-no_bsddb//:S/-no_expat//:S/-no_gdbm//:S/-no_idle//:S/-no_mpz//:S/-no_tkinter//}
.endif

FULLPKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-gdbm=	python-gdbm-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-idle=	python-idle-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}-${DASH_VER}
FULLPKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}-${DASH_VER}

.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:U} == YES
NOSHARED=	\#
CONFIGURE_ENV+=	OPT=${CFLAGS:Q}
.else
CONFIGURE_ENV+= OPT=${CFLAGS:Q}\ -DTHREAD_STACK_SIZE=${THREAD_STACK_SIZE:Q}\ ${PICFLAG:Q}
MAKE_FLAGS+=	MAJOR=0 MINOR=0 LDLIBRARY=libpython${VERSION}.so.0.0 \
		LD_LIBRARY_PATH=${WRKSRC} PATH=${WRKDIST:Q}:${PORTPATH:Q}
FAKE_FLAGS+=	MAJOR=0 MINOR=0 LDLIBRARY=libpython${VERSION}.so.0.0 \
		LD_LIBRARY_PATH=${WRKSRC} RANLIB=:
.endif
LDFLAGS+=	-L${WRKSRC}

post-configure:
	@@sed -e 's,@@NOSHARED@@,${NOSHARED},g'	\
	     -e 's,@@NO64BIT@@,${NO64BIT},g'	\
	     -e 's,@@NONIS@@,${NONIS},g'		\
		${FILESDIR}/Setup >${WRKSRC}/Modules/Setup
.for file in ${SETUP_LOCAL}
	@@sed -e 's,@@NOSHARED@@,${NOSHARED},g'	\
		${FILESDIR}/${file} >>${WRKSRC}/Modules/Setup.local
.endfor
	@@cd ${WRKSRC} && ${MAKE_PROGRAM} Makefile



.include <bsd.port.mk>
@


1.13
log
@• introduce the GNU libreadline module and pkgviews!
• required to unbreak and fix gnuplot, and do so
• … including time_t crap
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.12 2008/07/30 15:25:54 tg Exp $
d8 1
a8 1
DASH_VER=		1
d169 1
a169 1
CONFIGURE_ENV+=	OPT='${CFLAGS}' LDFLAGS='-L${WRKSRC}'
d171 1
a171 2
CONFIGURE_ENV+= OPT='${CFLAGS} -DTHREAD_STACK_SIZE=${THREAD_STACK_SIZE} ${PICFLAG}'
LDFLAGS+=	-L${WRKSRC}
d173 1
a173 1
	LD_LIBRARY_PATH=${WRKSRC} PATH="${WRKDIST}:${PORTPATH}"
d175 1
a175 1
	LD_LIBRARY_PATH=${WRKSRC} RANLIB=:
d177 1
@


1.12
log
@temporarily break on Darwin, I *hope* Benny can fix this, I can’t:

gcc -specs=/Users/tglaser/.mpkg/db/specs -L/Users/tglaser/ports/lang/python/2.3/w-python-2.3.7-0-no_bsddb-no_mpz-no_tkinter/Python-2.3.7  -Wl,--library-after=/Users/tglaser/.mpkg/lib -Wl,--library-after=/usr/X11R6/lib -u __dummy -u _PyMac_Error -framework System -framework CoreServices -framework Foundation -o python.exe  Modules/python.o  -lpython2.3 -pthread -ldl
Undefined symbols:
  "__dummy", referenced from:
ld: symbol(s) not found
collect2: ld returned 1 exit status
*** Error code 1
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.11 2008/07/30 15:22:32 tg Exp $
d8 1
a8 1
DASH_VER=		0
@


1.11
log
@break gmp on Darwin/i386
cause:
│ gcc -std=gnu99 -c -DHAVE_CONFIG_H -I. -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_udiv -isystem /Users/tglaser/.mpkg/share/mmake -include /Users/tglaser/.mpkg/share/mmake/mirmake.h -D__unix__=1 -idirafter /Users/tglaser/.mpkg/include -O2 -pipe tmp-udiv.s -fno-common -DPIC -o .libs/udiv.o
│/usr/include/i386/_types.h:37:no such instruction: ypedef signed char __int8_t'

possible problem: trying to compile an assembly source w/o -D_ASM_SOURCE
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.10 2008/07/30 15:17:44 tg Exp $
d4 2
@


1.10
log
@default to no_tkinter on Darwin, because Benny hasn’t ported TCL/Tk yet
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.9 2008/07/15 19:47:14 bsiegert Exp $
d25 2
@


1.9
log
@Oops, Makefile.inc has to be changed for this to work. While here, adapt
2.3 to the new Makefile.in (actually, move almost everything over to
2.3/Makefile) and upgrade to 2.3.7.
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.8 2007/12/29 16:57:34 bsiegert Exp $
d17 2
d22 5
@


1.8
log
@All python ports: new MASTER_SITE, mirroring has been discontinued (!).
2.3: update to 2.3.6-0.
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.7 2007/07/19 20:26:15 bsiegert Exp $
d5 1
a5 1
PATCHLEVEL=		.6
d8 173
@


1.7
log
@Two fixes for python:

- on MirOS, also disable nis module in setup.py.
- IMPORTANT: time_t fix, makes stuff like date.today() and
  date.fromtimestamp() work again.
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.6 2007/04/03 19:44:08 tg Exp $
d5 2
a6 2
PATCHLEVEL=		.5
DASH_VER=		1
@


1.6
log
@• remove ports that are simply broken, don't work, for too long, with no
  update or update-willing person in sight, kde stuff, web2.0 stuff that
  we don't want in ports (just stuff it into /var/www yourself, it isn't
  that difficult, right?), stuff for which no new version exists/will be
  and some obsd cruft; adjust dependencies
• no BUILD_DEPENDS+=RUN_DEPENDS or vice versa any more, *ever*
• fix some other stuff partially

ok bsiegert@@
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.5 2005/11/16 19:08:23 tg Exp $
d6 1
a6 1
PKG_PATCHLEVEL=		-0
@


1.5
log
@whoops... -0 confusion
thanks bsiegert@@ for noticing
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.4 2005/11/15 19:16:56 tg Exp $
a7 3
# needed for www/zope
THREAD_STACK_SIZE=	0x100000

@


1.4
log
@update to 2.3.5 (final)
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.3 2005/11/04 14:02:45 tg Exp $
d6 1
a6 1
PKG_PATCHLEVEL=		0
@


1.3
log
@Preliminary commit, to be ok'd by bsiegert@@ later
* remove Python 2.1
* remove Python 2.2
* make the Python 2.3 Makefile easier by shoving stuff into Makefile.inc
* sync patch-configure_in with OpenBSD
  + cc -shared for a.out platforms on 3.8+
  + support for 3.7, 3.8
* add RCS IDs to all patches/files
* sync port and Makefile.inc better against OpenBSD
* sort flavours
* sort Makefile.inc order
* no_cxx flavour now implies _all_ other no_* (missed expat)
* use ${PICFLAG} not -fPIC (invalid on e.g. Darwin, Interix)
* by default, still pull in only the no_cxx flavour as a dependency
  XXX should make no-no_cxx match no_cxx dependency
* XXX update to 2.3.5 missing, will commit that (and 2.4) later
  after this is ok'd by bsiegert@@

untested, WIP
@
text
@d1 1
a1 1
# $MirOS: ports/lang/python/2.3/Makefile,v 1.2 2005/07/07 21:22:32 bsiegert Exp $
d5 2
a6 4
PATCHLEVEL=		.4

COMMENT-bsddb=		"Berkeley db module for Python"
FULLPKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}-0
@


1.2
log
@Semi-automatic update of the remaining ports to the new patchlevel format.

Please correct mistakes if you find them :).
@
text
@d1 2
a2 2
# $MirOS$
# $OpenBSD: Makefile,v 1.4 2004/04/06 02:39:23 brad Exp $
a5 1
PKG_PATCHLEVEL=
d8 1
a8 1
FULLPKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}-0
d10 2
a11 7
CONFIGURE_STYLE=	autoconf
CONFIGURE_ARGS=		--enable-ipv6
AUTOCONF_NEW=		Yes

LIB_DEPENDS+=		bz2::archivers/bzip2

FLAVORS+=		no_bsddb
@


1.1
log
@Initial revision
@
text
@d9 1
a9 1
FULLPKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
@


1.1.7.1
log
@Import the MirPorts Framework, many files moved or renamed though, no KDE/QT
@
text
@@
