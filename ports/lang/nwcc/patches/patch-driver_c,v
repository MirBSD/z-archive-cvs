head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2009.09.27.11.37.03;	author tg;	state Exp;
branches;
next	1.2;
commitid	1004ABF4E7608B2DE2E;

1.2
date	2009.04.17.14.54.39;	author tg;	state dead;
branches;
next	1.1;
commitid	10049E897FF3FBC9E12;

1.1
date	2008.10.30.17.11.16;	author tg;	state Exp;
branches;
next	;
commitid	1004909EAC02C00339A;


desc
@@


1.3
log
@bring back nwcc 0.8 by request of Nils Weller; almost working well
@
text
@$MirOS$
--- driver.c.orig	Wed Sep 23 20:36:07 2009
+++ driver.c	Sun Sep 27 11:10:43 2009
@@@@ -44,6 +44,8 @@@@
 #include "defs.h"
 #include "n_libc.h"
 
+int verbose_flag = 0;
+
 /*
  * Store file path referenced by ``name'' in dynamically allocated variable
  * *output_names, resize it if necessary (*output_index contains the
@@@@ -595,6 +597,12 @@@@ driver(char **cpp_flags, char *asm_flags
 				}
 				nwcc1_args[j] = NULL;
 #define DEVEL
+				if (verbose_flag) {
+					size_t argnum = 0;
+					do {
+						printf("argv[%zu]='%s'\n", argnum, nwcc1_args[argnum]);
+					} while (nwcc1_args[++argnum]);
+				}
 #ifdef DEVEL
 				execv("./nwcc1", nwcc1_args);
 #endif 
@


1.2
log
@• update to 0.7.8
  ‣ remove patches integrated into upstream
• fix compilation and installation
  ‣ installprefix is hard-coded into the resulting binaries, so it must
    not contain the fake prefix ⇒ install.sh needs DESTDIR support
  ‣ lib/dynlibnwcc.o was never installed
  ‣ symlinks were absolute instead of relative ⇒ broken
• fix upstream’s laziness
  (lots of compiler warnings)
• break, because nwcpp does not get built, so it has no usable cpp
  and refuses to compile even a hello world programme
@
text
@d1 25
a25 33
$MirOS: ports/lang/nwcc/patches/patch-driver_c,v 1.1 2008/10/30 17:11:16 tg Exp $
--- driver.c.orig	Sat Aug 16 00:17:14 2008
+++ driver.c	Thu Oct 30 16:37:11 2008
@@@@ -110,6 +110,14 @@@@ driver(char **cpp_flags, char *asm_flags
 			"%s /usr/lib/crti.o /usr/lib/crtbegin.o " 
 			"-L/usr/lib -lc /usr/lib/crtend.o /usr/lib/crtn.o ",
 			sharedflag? "-shared": "/usr/lib/crt1.o");
+#elif defined __MirBSD__
+		sprintf(ld_std_flags, sharedflag ?
+			"-shared "
+			"/usr/lib/crti.o /usr/lib/crtbeginS.o "
+			"/usr/lib/crtendS.o /usr/lib/crtn.o " :
+			"-e __start -dynamic-linker /usr/libexec/ld.so "
+			"/usr/lib/crti.o /usr/lib/crt0.o /usr/lib/crtbegin.o "
+			"-lc /usr/lib/crtend.o /usr/lib/crtn.o ");
 #elif defined __OpenBSD__		
 		sprintf(ld_std_flags,
 			"-e __start -Bdynamic -dynamic-linker "
@@@@ -180,6 +188,14 @@@@ driver(char **cpp_flags, char *asm_flags
 			"-dynamic-linker /lib64/ld-linux.so.2 "
 			"-L/lib64 -L/usr/lib64 /usr/lib64/crt1.o "
 			"/usr/lib64/crti.o /usr/lib64/crtn.o -lc ");
+#elif defined __MirBSD__
+		sprintf(ld_std_flags, sharedflag ?
+			"-shared "
+			"/usr/lib/crti.o /usr/lib/crtbeginS.o "
+			"/usr/lib/crtendS.o /usr/lib/crtn.o " :
+			"-e __start -dynamic-linker /usr/libexec/ld.so "
+			"/usr/lib/crti.o /usr/lib/crt0.o /usr/lib/crtbegin.o "
+			"-lc /usr/lib/crtend.o /usr/lib/crtn.o ");
 #else /* Solaris */
 		/*
 		 * Because Solaris/SPARC does not ship with crt1.o, we
@


1.1
log
@say hello to nwcc, slightly b0rken though
@
text
@d1 1
a1 1
$MirOS$
@

