head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2009.09.27.11.37.03;	author tg;	state Exp;
branches;
next	1.3;
commitid	1004ABF4E7608B2DE2E;

1.3
date	2009.04.21.10.09.42;	author tg;	state dead;
branches;
next	1.2;
commitid	10049ED9B2562139591;

1.2
date	2009.04.17.14.54.39;	author tg;	state Exp;
branches;
next	1.1;
commitid	10049E897FF3FBC9E12;

1.1
date	2008.10.30.17.11.16;	author tg;	state Exp;
branches;
next	;
commitid	1004909EAC02C00339A;


desc
@@


1.4
log
@bring back nwcc 0.8 by request of Nils Weller; almost working well
@
text
@$MirOS$
--- test.sh.orig	Tue Sep 22 18:55:35 2009
+++ test.sh	Sun Sep 27 11:10:43 2009
@@@@ -133,10 +133,18 @@@@ if test `uname -p` = sparc; then
 	GCC_CFLAGS="-m64"
 fi
 
+# copied as-is from configure
+GCC=gcc
+LIBGCC=`gcc -print-libgcc-file-name 2>/dev/null` || {
+	# 2009-07-30 mirabilos: try $CC if gcc errors out / is not found
+	GCC=${CC-cc}
+	LIBGCC=`$GCC -print-libgcc-file-name 2>/dev/null` || GCC=gcc #false
+}
+
 try_files() {
-	if ! gcc $GCC_CFLAGS $FILES >/dev/null 2>/dev/null; then
+	if ! $GCC $GCC_CFLAGS $FILES >/dev/null 2>/dev/null; then
 		echo "gcc error"
-		continue
+		return 1
 	fi	
 
 	echo $INPUT | ./a.out >output
@@@@ -150,7 +158,7 @@@@ try_files() {
 
 	if ! test -f a.out; then
 		echo "NWCC ERROR"
-		continue
+		return 1
 	fi	
 
 	echo $INPUT | ./a.out >output2
@


1.3
log
@remove by a (rather rude, I didn’t even read all of the eMail) upstream
request; no big loss for us, as this one’s currently broken anyway (does
not build nwcpp, so cannot generate any executables) and prior versions
produced bogus warnings and wrong code – way to go… (NOT!)
@
text
@d1 4
a4 16
$MirOS: ports/lang/nwcc/patches/patch-test_sh,v 1.2 2009/04/17 14:54:39 tg Exp $

	Add MirBSD; honour $CC, $CFLAGS

--- test.sh.orig	Wed Mar  4 16:18:03 2009
+++ test.sh	Fri Apr 17 14:26:27 2009
@@@@ -57,7 +57,7 @@@@ SYS=`uname -s`
 MACH=`uname -m`
 
 if test "$SYS" = "Linux" || test "$SYS" = "FreeBSD" || \
-	test "$SYS" = "OpenBSD"; then
+	test "$SYS" = "OpenBSD" || test "$SYS" = "MirBSD"; then
 	if test "$MACH" = "x86_64" || test "$MACH" = "amd64"; then
 		if test "$NWCC_ASM" != ""; then
 			BASEASM=`basename $NWCC_ASM`
@@@@ -126,8 +126,9 @@@@ if test `uname -p` = sparc; then
d8 8
a15 1
+: ${CC=gcc}
d18 1
a18 1
+	if ! $CC $CFLAGS $GCC_CFLAGS $FILES >/dev/null 2>/dev/null; then
d20 2
a21 1
 		continue
d23 11
@


1.2
log
@• update to 0.7.8
  ‣ remove patches integrated into upstream
• fix compilation and installation
  ‣ installprefix is hard-coded into the resulting binaries, so it must
    not contain the fake prefix ⇒ install.sh needs DESTDIR support
  ‣ lib/dynlibnwcc.o was never installed
  ‣ symlinks were absolute instead of relative ⇒ broken
• fix upstream’s laziness
  (lots of compiler warnings)
• break, because nwcpp does not get built, so it has no usable cpp
  and refuses to compile even a hello world programme
@
text
@d1 1
a1 1
$MirOS: ports/lang/nwcc/patches/patch-test_sh,v 1.1 2008/10/30 17:11:16 tg Exp $
@


1.1
log
@say hello to nwcc, slightly b0rken though
@
text
@d1 1
a1 1
$MirOS$
d5 2
a6 2
--- test.sh.orig	Sat Aug 16 00:17:14 2008
+++ test.sh	Thu Oct 30 16:43:36 2008
d16 1
a16 1
@@@@ -124,8 +124,9 @@@@ if test `uname -p` = sparc; then
@

