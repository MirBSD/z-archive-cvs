head	1.11;
access;
symbols;
locks; strict;
comment	@# @;


1.11
date	2008.05.02.19.44.32;	author tg;	state Exp;
branches;
next	1.10;
commitid	100481B6F311C9F7843;

1.10
date	2008.05.02.14.52.13;	author tg;	state Exp;
branches;
next	1.9;
commitid	100481B2A942F5E2B78;

1.9
date	2008.04.12.20.22.14;	author tg;	state Exp;
branches;
next	1.8;
commitid	100480119FC3B66D4A6;

1.8
date	2008.04.07.19.46.56;	author tg;	state Exp;
branches;
next	1.7;
commitid	10047FA7A292EA81FEC;

1.7
date	2008.04.07.19.37.25;	author tg;	state Exp;
branches;
next	1.6;
commitid	10047FA78000C1A7B1B;

1.6
date	2008.04.07.19.21.55;	author tg;	state Exp;
branches;
next	1.5;
commitid	10047FA746A00C9E18D;

1.5
date	2008.03.23.17.04.36;	author tg;	state Exp;
branches;
next	1.4;
commitid	10047E68DB74249BAF7;

1.4
date	2006.11.03.22.06.15;	author tg;	state Exp;
branches;
next	1.3;
commitid	100454BBD6820E59370;

1.3
date	2006.06.25.01.56.00;	author tg;	state Exp;
branches;
next	1.2;
commitid	100449DED40524CC95D;

1.2
date	2006.03.06.21.58.36;	author bsiegert;	state Exp;
branches;
next	1.1;
commitid	100440CB08A155399E5;

1.1
date	2006.02.09.11.11.51;	author tg;	state Exp;
branches;
next	;
commitid	10043EB23217A35557B;


desc
@@


1.11
log
@make a variable name more self-descriptive

evolutionary process with bsiegert@@ on the phone, ok’d by him
@
text
@# $MirOS: ports/graphics/png/png.port.mk,v 1.10 2008/05/02 14:52:13 tg Exp $

# Valid choices: any, base, port
USE_PNG?=		any
MODPNG_AUTODEPS?=	Yes

.if ${USE_PNG:L:Many}
.  if ${OStype} != "MirBSD"
USE_PNG=		port
.  elif exists(/usr/lib/libpng.a)
USE_PNG=		base
.  else
USE_PNG=		port
.  endif
.endif

.if ${USE_PNG:L:Mport}
MODPNG_DEPENDS=		pkgview/png/lib/png:png->=1.2.26-0:graphics/png
PNG_BASE=		${LOCALBASE}/pkgview/png
CPPFLAGS+=		-I${PNG_BASE:Q}/include
LDFLAGS+=		-Wl,-rpath,${PNG_BASE:Q}/lib -L${PNG_BASE:Q}/lib
.elif ${USE_PNG:L:Mbase}
MODPNG_DEPENDS=		#empty
PNG_BASE=		/usr
.else
.  error USE_PNG=${USE_PNG:L} invalid
.endif

.if ${MODPNG_AUTODEPS:L} == "yes"
LIB_DEPENDS+=		${MODPNG_DEPENDS}
.endif
@


1.10
log
@• new MODPNG_INHIBIT: if defined, don't add to LIB_DEPENDS
  (for MULTI_PACKAGES scenariï)
• even if USE_PNG=base, define PNG_BASE (to /usr)
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.9 2008/04/12 20:22:14 tg Exp $
d5 1
d29 1
a29 1
.ifndef MODPNG_INHIBIT
@


1.9
log
@../ is not right here, actually
interesting find, discovered on stargazer.MidnightBSD.org
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.8 2008/04/07 19:46:56 tg Exp $
d17 1
a17 1
LIB_DEPENDS+=		pkgview/png/lib/png:png->=1.2.26-0:graphics/png
d21 4
a24 1
.elif !${USE_PNG:L:Mbase}
d27 4
@


1.8
log
@• fix LIB_DEPENDS
• merge RUN_DEPENDS into LIB_DEPENDS (middle part) – bsieger@@ says we can
• add to CPPFLAGS too
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.7 2008/04/07 19:37:25 tg Exp $
d17 1
a17 1
LIB_DEPENDS+=		../pkgview/png/lib/png:png->=1.2.26-0:graphics/png
@


1.7
log
@upgrade, fakepkgviewise
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.6 2008/04/07 19:21:55 tg Exp $
d17 1
a17 1
LIB_DEPENDS+=		png:png->=1.2.26-0:graphics/png
@


1.6
log
@WTF?
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.5 2008/03/23 17:04:36 tg Exp $
d17 4
a20 2
LIB_DEPENDS+=		png::graphics/png
CPPFLAGS+=		-I${LOCALBASE}/include/libpng
@


1.5
log
@USE_PNG?=any ☺
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.4 2006/11/03 22:06:15 tg Exp $
d9 1
a9 1
.  elif exists(/usr/lib/libncursesw.a)
@


1.4
log
@wrap this entire file in between .if !exists(/usr/lib/libpng.a)
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.3 2006/06/25 01:56:00 tg Exp $
d3 14
a16 1
.if !exists(/usr/lib/libpng.a)
d19 2
@


1.3
log
@fix include path for obse
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.2 2006/03/06 21:58:36 bsiegert Exp $
d3 1
d6 1
@


1.2
log
@The port is called png, not libpng.

How TF could this go undetected?
@
text
@d1 1
a1 1
# $MirOS: ports/graphics/png/png.port.mk,v 1.1 2006/02/09 11:11:51 tg Exp $
d4 1
a4 1
CPPFLAGS+=		-I${LOCALBASE}/libpng
@


1.1
log
@Fix a few abuses:
| CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include/libpng \
|			    -I${LOCALBASE}/include -I${X11BASE}/include" \
| 			LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib" \
|			PKGCONFIG_PATH=...

* use Benny's pkgconfig module
  - fixes PKGCONFIG_PATH in all places
  - adds explicit dependencies on pkgconfig where needed
* use a new png module
  - also cought a few implicit dependencies
* use a new freetype1 module in two places (more to come?)
* CPPFLAGS, LDFLAGS are in CONFIGURE_ENV anyway, so correctly
  add to them as CPPFLAGS+=<tab>foo instead
* use EXTRA_{M,X,F}AKE_FLAGS
* CC is given anyway, too
* add MAKEINFO= to gnu style

Still doesn't catch all OpenBSD abuses, but most of them.

Brokenness analysis:
* Automatically done
  - CFLAGS+=CPPFLAGS
  - CXXFLAGS+=CPPFLAGS
  - CPPFLAGS+=-I${LOCALBASE}/include
  - LDFLAGS+=-L${LOCALBASE}/lib
  - CONFIGURE_ENV, MAKE_FLAGS+=
    + LDFLAGS=LDFLAGS
    + CPPFLAGS you get the idea
    + CFLAGS
    + CXXFLAGS
    + CC
    + CXX (if USE_CXX)
* Done if USE_X11=Yes
  - CPPFLAGS+=X11BASE/include
  - LDFLAGS+=X11BASE/lib

Tell me if there are problems, but first try adding
an EXTRA_ before MAKE_FLAGS and FAKE_FLAGS.
Remember EXTRA_XAKE_FLAGS get added to both.
@
text
@d1 1
a1 1
# $MirOS$
d3 1
a3 1
LIB_DEPENDS+=		png::graphics/libpng
@

